{"id":"cass_memory_system-02d8","title":"[Unit] llm.ts - LLM Client \u0026 Response Handling","description":"## Target: src/llm.ts - LLM Integration\n\n### Functions to Test:\n\n1. **createLLMClient(config)** - Client factory\n   - Creates Anthropic client\n   - Creates OpenAI client\n   - Validates API key presence\n   - Returns typed client\n\n2. **generateContext(prompt, options)** - Context generation\n   - Sends prompt to LLM\n   - Returns response text\n   - Handles rate limits\n   - Timeout handling\n\n3. **parseStructuredResponse(response, schema)** - Parse LLM JSON\n   - Valid JSON extracted\n   - Schema validation\n   - Partial response handling\n   - Markdown code block extraction\n\n4. **buildPrompt(template, variables)** - Prompt construction\n   - Variable substitution\n   - Escaping handled\n   - Missing variables error\n   - Template validation\n\n5. **estimateTokens(text)** - Token estimation\n   - Approximate count\n   - Handles Unicode\n   - Handles code blocks\n   - Returns conservative estimate\n\n6. **retryWithBackoff(fn, options)** - Retry logic\n   - Existing tests in test/retry.test.ts\n   - EXPAND coverage\n   - Verify exponential backoff\n   - Max retries respected\n\n### API Key Handling:\n- ANTHROPIC_API_KEY\n- OPENAI_API_KEY\n- Error when missing\n- Redaction in logs\n\n### Mock-Free Testing Strategy:\n- Test pure functions without API calls\n- Integration tests hit real API (separate suite)\n- Use test API keys for CI\n- Skip gracefully when no keys","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:28:41.264474-05:00","updated_at":"2025-12-08T14:22:22.778194-05:00","closed_at":"2025-12-08T14:22:22.778194-05:00","dependencies":[{"issue_id":"cass_memory_system-02d8","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:17.953307-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-02d8","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:33:00.435352-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-02tu","title":"Improve test coverage for curate.ts","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T21:09:31.845458-05:00","updated_at":"2025-12-07T21:52:25.920412-05:00","closed_at":"2025-12-07T21:52:25.920412-05:00"}
{"id":"cass_memory_system-05x","title":"[Cass] CASS_EXIT_CODES constant - Error code mapping","description":"Define CASS_EXIT_CODES constant for intelligent error recovery.\n\n## Signature\n```typescript\nconst CASS_EXIT_CODES: Record\u003cnumber, { \n  name: string; \n  retryable: boolean; \n  action?: string \n}\u003e\n```\n\n## Exit Code Mapping\n- 0: { name: \"success\", retryable: false }\n- 2: { name: \"usage_error\", retryable: false }\n- 3: { name: \"index_missing\", retryable: true, action: \"rebuild_index\" }\n- 4: { name: \"not_found\", retryable: false }\n- 5: { name: \"idempotency_mismatch\", retryable: false }\n- 9: { name: \"unknown\", retryable: false }\n- 10: { name: \"timeout\", retryable: true, action: \"reduce_limit\" }\n\n## Purpose\nUsed throughout cass wrapper functions to determine:\n- Whether an operation should be retried\n- What recovery action to take (rebuild index, reduce limit, etc.)\n- How to classify errors for user feedback\n\n## Implementation Notes\n- Export as const for type safety\n- Use in withCassErrorRecovery and individual wrapper functions\n- Document each exit code meaning in comments","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:52.76852-05:00","updated_at":"2025-12-07T18:48:03.178563-05:00","closed_at":"2025-12-07T18:43:32.613956-05:00"}
{"id":"cass_memory_system-07rn","title":"Unit tests for tracking.ts - Session tracking","description":"Complete unit test coverage for tracking.ts:\n- Session tracking state management\n- Processed session recording\n- Session metadata extraction\n- Progress tracking APIs\n- Edge cases: concurrent access, corrupted state files\nNO MOCKS - use real temp directory fixtures","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:25:42.625455-05:00","updated_at":"2025-12-07T22:38:33.958685-05:00","closed_at":"2025-12-07T22:38:26.0246-05:00","dependencies":[{"issue_id":"cass_memory_system-07rn","depends_on_id":"cass_memory_system-ai52","type":"blocks","created_at":"2025-12-07T20:28:09.583583-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-0dv","title":"[Curator] detectConflicts - Find contradictory rules","description":"Detect semantic conflicts between new and existing bullets using deterministic heuristics.\n\nSignature:\nfunction detectConflicts(\n  newContent: string,\n  existingBullets: PlaybookBullet[]\n): ConflictReport[]\n\nConflict detection heuristics:\n1. Negation conflict:\n   - Same category\n   - One contains 'never'/'don\\'t'/'avoid'\n   - Other is affirmative\n   - High word overlap (jaccard \u003e 0.5)\n   \n2. Opposite sentiment:\n   - Same category\n   - One says 'always'/'must'/'required'\n   - Other says 'never'/'avoid'/'forbidden'\n   - Subject matter overlap\n   \n3. Explicit contradiction:\n   - Patterns like 'X is good' vs 'X is bad'\n   - 'Use X' vs 'Don\\'t use X'\n   \n4. Scope conflict:\n   - One is general, one is specific exception\n   - Example: 'Always validate input' vs 'Skip validation for trusted sources'\n\nFor each conflict found, create ConflictReport:\n- newBulletContent: the content being added\n- conflictingBulletId: existing bullet ID\n- conflictingContent: existing bullet content\n- reason: human-readable explanation\n\nImportant: Conflicts are WARNINGS, not blockers.\n- Still allows add (new bullet may be valid exception)\n- Reports conflicts in CurationResult\n- User/analyst can review and resolve\n\nThis prevents false positives while maintaining awareness.","notes":"Fixed lock staleness option bug: withLock now respects staleLockThresholdMs; added coverage","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:45:03.082308-05:00","updated_at":"2025-12-08T12:54:46.485062-05:00","closed_at":"2025-12-08T12:54:46.485062-05:00"}
{"id":"cass_memory_system-0ede","title":"[Unit] tracking.ts - Feedback Event Management","description":"## Target: src/tracking.ts - Feedback Tracking\n\n### Functions to Test:\n\n1. **addFeedbackEvent(bullet, event)** - Add event to bullet\n   - Adds to feedbackEvents array\n   - Creates array if missing\n   - Validates event schema\n   - Timestamp added if missing\n   - Returns updated bullet\n\n2. **markHelpful(bullet, context?)** - Mark as helpful\n   - Adds helpful event\n   - Context stored if provided\n   - Timestamp is current time\n   - Idempotent (multiple calls OK)\n\n3. **markHarmful(bullet, context?)** - Mark as harmful\n   - Adds harmful event\n   - Context stored if provided\n   - Timestamp is current time\n   - Does NOT remove helpful events\n\n4. **getLastFeedback(bullet)** - Get most recent feedback\n   - Returns most recent event\n   - Handles empty events\n   - Handles missing events\n\n5. **getFeedbackCounts(bullet)** - Count feedback types\n   - Returns {helpful: N, harmful: M}\n   - Handles empty/missing events\n   - Efficient for large arrays\n\n6. **clearFeedback(bullet)** - Reset feedback\n   - Removes all events\n   - Returns updated bullet\n   - Preserves other fields\n\n### Event Schema Validation:\n- type: 'helpful' | 'harmful' only\n- timestamp: valid ISO string\n- context: optional string\n\n### Edge Cases:\n- Null/undefined bullet\n- Malformed feedbackEvents\n- Very large event arrays (1000+)\n- Events with identical timestamps","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:27:54.003462-05:00","updated_at":"2025-12-08T14:16:37.969071-05:00","closed_at":"2025-12-08T14:16:37.969071-05:00","dependencies":[{"issue_id":"cass_memory_system-0ede","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:15.940834-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ede","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:32:59.602972-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-0ew","title":"Phase 2: Core Pipeline + Anti-Patterns","description":"# EPIC: Core Pipeline + Anti-Patterns\n\n## Purpose\nImplement the full diary → reflect → curate pipeline with anti-pattern learning.\nThis phase makes the system actually learn from agent sessions.\n\n## Background \u0026 Reasoning\nThe ACE paper's key insight is that LLM-generated rules can \"collapse\" if the LLM \nrewrites the entire playbook. The solution: deterministic curation that only applies\ndelta operations (add/helpful/harmful/replace/deprecate).\n\nThis phase also introduces anti-pattern inversion - when a bullet proves harmful \nmultiple times, instead of deleting it, we invert it to \"DON'T do X\" and mark it\nas kind=anti_pattern. This captures negative learnings.\n\n## Priority Features (from ROI analysis)\n- P3: Anti-pattern inversion (8× impact)\n- P5: Maturity states candidate/established/proven (5× impact)\n- P6: Cascading config global + .cass/ repo-level (4× impact)\n- P8: Forget command + toxic bullet log (3× impact)\n- P11: Evidence-count gate pre-LLM validation (8× impact)\n- P13: Doctor command system health (5× DX impact)\n\n## Key Deliverables\n1. `cass-memory diary \u003csession\u003e` - Generate structured diary from session\n2. `cass-memory reflect --days N` - Run full reflection cycle\n3. `cass-memory curate` - Apply deltas deterministically\n4. `cass-memory mark \u003cid\u003e --helpful/--harmful` - Record feedback\n5. `cass-memory forget \u003cid\u003e` - Permanently block toxic patterns\n6. `cass-memory doctor` - System health check\n\n## Critical Algorithms\n1. **Evidence-count gate**: Before sending to LLM validator, check if session\n   success/failure counts provide enough signal. If 5+ successes with 0 failures,\n   auto-accept. If 3+ failures with 0 successes, auto-reject.\n\n2. **Anti-pattern inversion**: When harmfulCount crosses threshold, transform\n   bullet from \"Use X for Y\" to \"AVOID: X causes Z problems when doing Y\"\n\n3. **Maturity state machine**:\n   - draft: \u003c3 feedback events\n   - established: 3-10 helpful, \u003c30% harmful\n   - proven: 10+ helpful, \u003c10% harmful ratio\n   - retired: deprecated OR 30%+ harmful\n\n## Dependencies\n- Requires Phase 1 completion (types, config, cass wrapper)","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-07T16:16:41.288609-05:00","updated_at":"2025-12-07T16:16:41.288609-05:00","dependencies":[{"issue_id":"cass_memory_system-0ew","depends_on_id":"cass_memory_system-5eh","type":"blocks","created_at":"2025-12-07T16:23:18.428702-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-0ew.1","title":"Diary Generation: cass-memory diary (Reflector Input)","description":"# Feature: Diary Generation Command\n\n## Purpose\nThe \"Working Memory\" layer: transform raw agent sessions into structured diary\nentries. These diaries become input to the Reflector for delta extraction.\n\n## Usage\n```bash\ncass-memory diary ~/.claude/sessions/session-abc.jsonl --json\ncass-memory diary \u003csession-path\u003e [--enrich] [--save]\n```\n\n## Process Flow\n```\n1. Load session via cass export (markdown format)\n2. Apply secret sanitization\n3. Run LLM extraction (DiaryExtractionSchema)\n4. If --enrich: Query cass for related sessions (cross-agent)\n5. Save to ~/.cass-memory/diary/{id}.json\n6. Output result\n```\n\n## DiaryEntry Fields (from LLM)\n- **status**: success | failure | mixed\n- **accomplishments**: What was completed (SPECIFIC - file names, functions)\n- **decisions**: Design choices with rationale\n- **challenges**: Problems encountered, errors, blockers\n- **preferences**: User style revelations\n- **keyLearnings**: Reusable insights\n\n## Cross-Agent Enrichment (--enrich)\n```typescript\nasync function enrichDiary(diary: DiaryEntry, config: Config): Promise\u003cDiaryEntry\u003e {\n  // Extract keywords from diary content\n  const keywords = [\n    ...diary.keyLearnings,\n    ...diary.challenges.map(extractKeywords).flat()\n  ].slice(0, 5);\n  \n  // Query cass for related sessions from OTHER agents\n  const related = await safeCassSearch(keywords.join(\" \"), {\n    limit: 5,\n    days: 30,\n    // Exclude the same agent\n    agent: ALL_AGENTS.filter(a =\u003e a !== diary.agent)\n  }, config.cassPath);\n  \n  diary.relatedSessions = related.map(h =\u003e ({\n    sessionPath: h.source_path,\n    agent: h.agent,\n    relevanceScore: h.score,\n    snippet: h.snippet\n  }));\n  \n  return diary;\n}\n```\n\n## LLM Prompt (Key Instructions)\n```\nBe SPECIFIC and ACTIONABLE. Avoid generic statements.\nInclude specific:\n- File names and paths\n- Function/class/component names\n- Error messages and stack traces\n- Commands run\n- Tools used\n\nIf the session lacks information for a field, provide an empty array.\n```\n\n## Output\n```json\n{\n  \"id\": \"diary-abc123\",\n  \"sessionPath\": \"~/.claude/sessions/session-abc.jsonl\",\n  \"timestamp\": \"2025-12-07T10:30:00Z\",\n  \"agent\": \"claude\",\n  \"workspace\": \"/Users/x/projects/myapp\",\n  \"status\": \"success\",\n  \"accomplishments\": [\n    \"Fixed authentication timeout by increasing session TTL in config.ts:42\",\n    \"Added retry logic to AuthService.refresh() method\"\n  ],\n  \"decisions\": [\n    \"Chose 7200s TTL to match expected user session duration\"\n  ],\n  \"challenges\": [\n    \"Initial confusion about which config file controls TTL\"\n  ],\n  \"preferences\": [\n    \"User prefers explicit error messages over silent failures\"\n  ],\n  \"keyLearnings\": [\n    \"Auth timeout issues are usually config-related, not code bugs\"\n  ],\n  \"relatedSessions\": [...],\n  \"tags\": [\"auth\", \"timeout\", \"config\"],\n  \"searchAnchors\": [\"authentication timeout\", \"session TTL\", \"AuthService\"]\n}\n```\n\n## Dependency\n- Requires Phase 1 completion (LLM, cass wrapper, sanitization)","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T16:21:02.394292-05:00","updated_at":"2025-12-07T19:00:11.693754-05:00","closed_at":"2025-12-07T19:00:10.967186-05:00","dependencies":[{"issue_id":"cass_memory_system-0ew.1","depends_on_id":"cass_memory_system-0ew","type":"parent-child","created_at":"2025-12-07T16:21:02.39531-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.1","depends_on_id":"cass_memory_system-5eh.9","type":"blocks","created_at":"2025-12-07T16:23:18.50333-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.1","depends_on_id":"cass_memory_system-5eh.4","type":"blocks","created_at":"2025-12-07T16:23:18.579027-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.1","depends_on_id":"cass_memory_system-5eh.5","type":"blocks","created_at":"2025-12-07T16:23:18.645627-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-0ew.2","title":"Mark Command: cass-memory mark (Feedback Recording)","description":"# Feature: Mark Command\n\n## Purpose\nRecord bullet usage feedback. This is how the playbook learns:\n- Mark helpful when a rule helps you succeed\n- Mark harmful when following a rule causes problems\n\n## Usage\n```bash\ncass-memory mark b-abc123 --helpful\ncass-memory mark b-abc123 --harmful --reason \"Caused test failures\"\ncass-memory mark b-abc123 --helpful --session ~/.claude/sessions/abc.jsonl\n```\n\n## Implementation\n```typescript\nasync function markCommand(\n  bulletId: string,\n  flags: { helpful?: boolean; harmful?: boolean; reason?: string; session?: string }\n): Promise\u003cvoid\u003e {\n  const config = await loadConfig();\n  const playbook = await loadMergedPlaybook(config);\n  \n  // Find bullet\n  const bullet = findBullet(playbook, bulletId);\n  if (!bullet) {\n    error(`Bullet not found: ${bulletId}`);\n    process.exit(1);\n  }\n  \n  // Create feedback event WITH TIMESTAMP (P1 - critical for decay)\n  const event: FeedbackEvent = {\n    type: flags.helpful ? \"helpful\" : \"harmful\",\n    timestamp: now(),\n    sessionPath: flags.session,\n    reason: flags.reason\n  };\n  \n  // Add event to bullet\n  bullet.feedbackEvents.push(event);\n  \n  // Update legacy counts (for backwards compatibility)\n  if (flags.helpful) bullet.helpfulCount++;\n  else bullet.harmfulCount++;\n  \n  // Update timestamps\n  bullet.updatedAt = now();\n  \n  // Recalculate state\n  bullet.state = calculateMaturityState(bullet, config);\n  \n  // Save playbook\n  await savePlaybook(playbook, config.playbookPath);\n  \n  // Also log to usage.jsonl for audit trail\n  await appendUsageLog({\n    bulletId,\n    event,\n    effectiveScoreAfter: getEffectiveScore(bullet, config)\n  });\n  \n  output({\n    success: true,\n    bulletId,\n    event,\n    newState: bullet.state,\n    effectiveScore: getEffectiveScore(bullet, config)\n  }, formatMarkResult, flags);\n}\n```\n\n## Usage Log Format\n```\n~/.cass-memory/usage.jsonl\n{\"bulletId\":\"b-abc123\",\"type\":\"helpful\",\"timestamp\":\"2025-12-07T10:30:00Z\",\"session\":\"...\"}\n{\"bulletId\":\"b-def456\",\"type\":\"harmful\",\"timestamp\":\"2025-12-07T11:00:00Z\",\"reason\":\"...\"}\n```\n\n## State Transitions After Mark\n- If new harmful feedback pushes ratio \u003e 30%: state → \"retired\"\n- If helpful feedback reaches 10 with ratio \u003c 10%: state → \"proven\"\n- Automatic decay recalculation happens on every read\n\n## Output\n```json\n{\n  \"success\": true,\n  \"bulletId\": \"b-abc123\",\n  \"event\": {\n    \"type\": \"helpful\",\n    \"timestamp\": \"2025-12-07T10:30:00Z\"\n  },\n  \"newState\": \"proven\",\n  \"effectiveScore\": 15.2\n}\n```","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T16:21:02.639637-05:00","updated_at":"2025-12-07T19:10:47.876676-05:00","closed_at":"2025-12-07T19:04:29.154986-05:00","dependencies":[{"issue_id":"cass_memory_system-0ew.2","depends_on_id":"cass_memory_system-0ew","type":"parent-child","created_at":"2025-12-07T16:21:02.640418-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.2","depends_on_id":"cass_memory_system-5eh.8","type":"blocks","created_at":"2025-12-07T16:23:18.720967-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.2","depends_on_id":"cass_memory_system-5eh.6","type":"blocks","created_at":"2025-12-07T16:23:18.796945-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-0ew.3","title":"Reflector Pipeline: src/reflect.ts (Delta Extraction)","description":"# Feature: Reflector Pipeline\n\n## Purpose\nThe \"Reflector\" phase of ACE: extract reusable lessons (deltas) from diary entries.\nThis is where the LLM analyzes sessions and proposes playbook changes.\n\n## Key Innovation: Multi-Iteration Reflection\nInstead of one pass, run the reflector multiple times (configurable 1-3):\n- Iteration 0: General insights\n- Iteration 1: Focus on missed patterns\n- Iteration 2: Focus on edge cases\n\nThis catches insights a single pass might miss.\n\n## Implementation\n```typescript\nasync function reflectOnSession(\n  diary: DiaryEntry,\n  playbook: Playbook,\n  config: Config\n): Promise\u003cDelta[]\u003e {\n  const allDeltas: Delta[] = [];\n  \n  // Get cass history for cross-referencing\n  const cassHistory = await getCassHistoryForDiary(diary, config);\n  \n  // Format existing bullets for prompt\n  const existingBullets = formatBulletsForPrompt(playbook.bullets);\n  \n  // Multi-iteration reflection\n  for (let i = 0; i \u003c config.maxReflectorIterations; i++) {\n    const iterationNote = i \u003e 0\n      ? `This is iteration ${i + 1}. Focus on insights you may have missed.`\n      : \"\";\n    \n    const output = await runReflector(\n      ReflectorOutputSchema,\n      diary,\n      existingBullets,\n      cassHistory,\n      i,\n      config\n    );\n    \n    // Convert raw output to typed deltas\n    const deltas = output.deltas.map(d =\u003e convertToTypedDelta(d, diary.sessionPath));\n    \n    // Deduplicate against previous iterations\n    const newDeltas = deduplicateDeltas(deltas, allDeltas);\n    allDeltas.push(...newDeltas);\n    \n    // Early exit if no new insights\n    if (newDeltas.length === 0) break;\n  }\n  \n  return allDeltas;\n}\n```\n\n## Delta Types Extracted\n1. **add**: New insight not covered by existing bullets\n2. **helpful**: Existing bullet proved useful\n3. **harmful**: Existing bullet caused problems\n4. **replace**: Existing bullet needs updated wording\n5. **deprecate**: Existing bullet is outdated\n\n## Prompt Guidelines (Critical for Quality)\n```\nGuidelines for the LLM:\n- Be SPECIFIC. Bad: \"Write tests\". Good: \"For React hooks, test effects separately with renderHook\"\n- Include concrete examples, file patterns, command flags when relevant\n- Only propose deltas for genuinely reusable insights\n- Consider if a bullet would help a DIFFERENT agent on a similar problem\n- Maximum 20 deltas per reflection\n```\n\n## Deduplication Logic\n```typescript\nfunction deduplicateDeltas(newDeltas: Delta[], existing: Delta[]): Delta[] {\n  return newDeltas.filter(d =\u003e {\n    if (d.type === \"add\") {\n      // Check content similarity\n      return !existing.some(e =\u003e\n        e.type === \"add\" \u0026\u0026 jaccardSimilarity(d.bullet.content, e.bullet.content) \u003e 0.8\n      );\n    }\n    // For helpful/harmful, allow multiple from same session\n    return true;\n  });\n}\n```","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T16:21:03.831701-05:00","updated_at":"2025-12-07T19:29:08.539047-05:00","closed_at":"2025-12-07T19:28:49.563158-05:00","dependencies":[{"issue_id":"cass_memory_system-0ew.3","depends_on_id":"cass_memory_system-0ew","type":"parent-child","created_at":"2025-12-07T16:21:03.832365-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.3","depends_on_id":"cass_memory_system-0ew.1","type":"blocks","created_at":"2025-12-07T16:23:18.869954-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.3","depends_on_id":"cass_memory_system-5eh.9","type":"blocks","created_at":"2025-12-07T16:23:18.947072-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-0ew.4","title":"Evidence-Count Gate: Pre-LLM Validator (P11)","description":"# Feature: Evidence-Count Gate (P11)\n\n## Purpose\nBEFORE sending a proposed rule to the LLM validator, check if historical\nsession success/failure counts provide enough signal to auto-accept or\nauto-reject. This saves LLM tokens and speeds up the pipeline.\n\n## The Insight\nIf 5+ sessions SUCCEEDED with a pattern and 0 FAILED, we don't need an LLM\nto tell us it's valid. Conversely, if 3+ sessions FAILED and 0 SUCCEEDED,\nwe can auto-reject without burning tokens.\n\n## Implementation\n```typescript\ninterface EvidenceGateResult {\n  action: \"auto-accept\" | \"auto-reject\" | \"needs-llm\";\n  confidence: number;\n  successCount: number;\n  failureCount: number;\n  relevantSessions: CassHit[];\n}\n\nasync function evidenceCountGate(\n  proposedRule: string,\n  config: Config\n): Promise\u003cEvidenceGateResult\u003e {\n  // 1. Extract keywords from proposed rule\n  const keywords = extractKeywords(proposedRule);\n  \n  // 2. Search cass for sessions mentioning this pattern\n  const hits = await safeCassSearch(keywords.join(\" \"), {\n    limit: 20,\n    days: config.validationLookbackDays\n  }, config.cassPath);\n  \n  // 3. Classify sessions by outcome (success/failure)\n  let successCount = 0;\n  let failureCount = 0;\n  \n  for (const hit of hits) {\n    const outcome = classifySessionOutcome(hit);\n    if (outcome === \"success\") successCount++;\n    else if (outcome === \"failure\") failureCount++;\n  }\n  \n  // 4. Apply gates\n  // Strong success signal: auto-accept\n  if (successCount \u003e= 5 \u0026\u0026 failureCount === 0) {\n    return {\n      action: \"auto-accept\",\n      confidence: 0.95,\n      successCount,\n      failureCount,\n      relevantSessions: hits\n    };\n  }\n  \n  // Strong failure signal: auto-reject\n  if (failureCount \u003e= 3 \u0026\u0026 successCount === 0) {\n    return {\n      action: \"auto-reject\",\n      confidence: 0.9,\n      successCount,\n      failureCount,\n      relevantSessions: hits\n    };\n  }\n  \n  // Ambiguous: needs LLM analysis\n  return {\n    action: \"needs-llm\",\n    confidence: 0.5,\n    successCount,\n    failureCount,\n    relevantSessions: hits\n  };\n}\n```\n\n## Session Outcome Classification\n```typescript\nfunction classifySessionOutcome(hit: CassHit): \"success\" | \"failure\" | \"unknown\" {\n  const snippet = hit.snippet.toLowerCase();\n  \n  // Success indicators\n  if (snippet.includes(\"fixed\") || \n      snippet.includes(\"resolved\") ||\n      snippet.includes(\"completed\") ||\n      snippet.includes(\"works now\")) {\n    return \"success\";\n  }\n  \n  // Failure indicators\n  if (snippet.includes(\"failed\") ||\n      snippet.includes(\"error\") ||\n      snippet.includes(\"broken\") ||\n      snippet.includes(\"didn't work\")) {\n    return \"failure\";\n  }\n  \n  return \"unknown\";\n}\n```\n\n## Integration with Validator\n```typescript\nasync function validateRule(\n  proposedRule: string,\n  config: Config\n): Promise\u003cValidationResult\u003e {\n  // 1. Check evidence gate first\n  const gateResult = await evidenceCountGate(proposedRule, config);\n  \n  if (gateResult.action === \"auto-accept\") {\n    return {\n      valid: true,\n      reason: `Auto-accepted: ${gateResult.successCount} successes, 0 failures`,\n      confidence: gateResult.confidence\n    };\n  }\n  \n  if (gateResult.action === \"auto-reject\") {\n    return {\n      valid: false,\n      reason: `Auto-rejected: ${gateResult.failureCount} failures, 0 successes`,\n      confidence: gateResult.confidence\n    };\n  }\n  \n  // 2. Fall through to LLM validation\n  return runLLMValidator(proposedRule, gateResult.relevantSessions, config);\n}\n```\n\n## ROI\n- Saves LLM tokens on clear-cut cases\n- Faster pipeline (no network call for auto-decisions)\n- More transparent reasoning (explicit success/failure counts)","status":"closed","priority":0,"issue_type":"feature","assignee":"FuchsiaPond","created_at":"2025-12-07T16:22:32.925118-05:00","updated_at":"2025-12-07T19:28:35.735671-05:00","closed_at":"2025-12-07T19:28:07.689228-05:00","dependencies":[{"issue_id":"cass_memory_system-0ew.4","depends_on_id":"cass_memory_system-0ew","type":"parent-child","created_at":"2025-12-07T16:22:32.926095-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.4","depends_on_id":"cass_memory_system-5eh.4","type":"blocks","created_at":"2025-12-07T16:23:19.037002-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-0ew.5","title":"Curator Pipeline: Deterministic Delta Application (ACE Core)","description":"# Feature: Curator Pipeline (Deterministic Delta Application)\n\n## Purpose\nThe \"Curator\" phase of ACE: apply validated deltas to the playbook\nDETERMINISTICALLY. No LLM rewriting of the playbook - only precise\ndelta operations. This prevents \"context collapse\" where the LLM\nrewrites everything and loses accumulated knowledge.\n\n## Critical Principle\nThe ACE paper's key insight: if you let the LLM rewrite the entire\nplaybook, information is lost through summarization and compression.\nInstead, the curator only applies specific operations:\n- Add new bullets\n- Increment helpful/harmful counts\n- Replace specific content\n- Deprecate specific bullets\n- Merge similar bullets\n\n## Implementation\n```typescript\nfunction curatePlaybook(\n  playbook: Playbook,\n  deltas: Delta[],\n  config: Config\n): { playbook: Playbook; applied: number; skipped: number } {\n  let applied = 0;\n  let skipped = 0;\n  \n  for (const delta of deltas) {\n    switch (delta.type) {\n      case \"add\":\n        // Check for duplicates BEFORE adding\n        if (isDuplicate(delta.bullet.content, playbook.bullets, config.dedupSimilarityThreshold)) {\n          // Merge into existing instead of adding\n          const existing = findSimilarBullet(delta.bullet.content, playbook.bullets);\n          if (existing) {\n            existing.feedbackEvents.push({\n              type: \"helpful\",\n              timestamp: now(),\n              sessionPath: delta.sourceSession\n            });\n            existing.helpfulCount++;\n          }\n          skipped++;\n          continue;\n        }\n        \n        // Add new bullet\n        const newBullet = createBullet(delta.bullet, delta.sourceSession);\n        playbook.bullets.push(newBullet);\n        applied++;\n        break;\n        \n      case \"helpful\":\n      case \"harmful\":\n        const bullet = findBullet(playbook, delta.bulletId);\n        if (bullet) {\n          bullet.feedbackEvents.push({\n            type: delta.type,\n            timestamp: now(),\n            sessionPath: delta.sourceSession,\n            reason: delta.type === \"harmful\" ? delta.reason : undefined\n          });\n          if (delta.type === \"helpful\") bullet.helpfulCount++;\n          else bullet.harmfulCount++;\n          bullet.updatedAt = now();\n          applied++;\n        } else {\n          skipped++;\n        }\n        break;\n        \n      case \"replace\":\n        const toReplace = findBullet(playbook, delta.bulletId);\n        if (toReplace) {\n          toReplace.content = delta.newContent;\n          toReplace.updatedAt = now();\n          applied++;\n        } else {\n          skipped++;\n        }\n        break;\n        \n      case \"deprecate\":\n        const toDeprecate = findBullet(playbook, delta.bulletId);\n        if (toDeprecate) {\n          toDeprecate.deprecated = true;\n          toDeprecate.deprecationReason = delta.reason;\n          toDeprecate.replacedBy = delta.replacedBy;\n          toDeprecate.state = \"retired\";\n          toDeprecate.updatedAt = now();\n          applied++;\n        } else {\n          skipped++;\n        }\n        break;\n        \n      case \"merge\":\n        // Merge multiple bullets into one\n        const toMerge = delta.bulletIds.map(id =\u003e findBullet(playbook, id)).filter(Boolean);\n        if (toMerge.length \u003e= 2) {\n          const merged = mergeBullets(toMerge, delta.mergedContent);\n          playbook.bullets.push(merged);\n          toMerge.forEach(b =\u003e {\n            b.deprecated = true;\n            b.deprecationReason = \"Merged into \" + merged.id;\n            b.replacedBy = merged.id;\n          });\n          applied++;\n        } else {\n          skipped++;\n        }\n        break;\n    }\n  }\n  \n  // Update playbook metadata\n  playbook.metadata.lastReflection = now();\n  playbook.metadata.totalReflections++;\n  \n  return { playbook, applied, skipped };\n}\n```\n\n## Auto-Pruning (Decay-Aware)\n```typescript\nfunction autoPrunePlaybook(playbook: Playbook, config: Config): number {\n  const before = playbook.bullets.length;\n  \n  playbook.bullets = playbook.bullets.filter(b =\u003e {\n    // Never prune explicitly deprecated (user decision)\n    if (b.deprecated) return true;\n    \n    // Calculate effective score with decay\n    const score = getEffectiveScore(b, config);\n    \n    // Prune if score is significantly negative\n    return score \u003e -config.pruneHarmfulThreshold;\n  });\n  \n  return before - playbook.bullets.length;\n}\n```","notes":"Picking up curator deterministic delta application; will align with types and fix typecheck blockers.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T16:22:34.23458-05:00","updated_at":"2025-12-07T21:50:19.765915-05:00","closed_at":"2025-12-07T21:49:57.500174-05:00","dependencies":[{"issue_id":"cass_memory_system-0ew.5","depends_on_id":"cass_memory_system-0ew","type":"parent-child","created_at":"2025-12-07T16:22:34.235563-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.5","depends_on_id":"cass_memory_system-5eh.8","type":"blocks","created_at":"2025-12-07T16:23:19.118405-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.5","depends_on_id":"cass_memory_system-5eh.6","type":"blocks","created_at":"2025-12-07T16:23:19.211627-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.5","depends_on_id":"cass_memory_system-5eh.3","type":"blocks","created_at":"2025-12-07T16:23:19.288014-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-0ew.6","title":"Anti-Pattern Inversion (P3)","description":"# Feature: Anti-Pattern Inversion (P3 - 8× Impact)\n\n## Purpose\nWhen a bullet proves consistently harmful, instead of just deleting it,\nINVERT it into an anti-pattern. This preserves the negative learning:\n\"We tried X and it caused problems, so DON'T do X.\"\n\n## The Problem\nWithout inversion:\n- Rule: \"Use singleton pattern for database connections\"\n- Gets marked harmful 5 times (causes connection leaks)\n- System deletes it\n- 3 months later, someone proposes the same rule again\n- The failure is forgotten, cycle repeats\n\nWith inversion:\n- Rule gets inverted to: \"AVOID: Singleton pattern for database connections (causes connection leaks)\"\n- Marked as kind=anti_pattern\n- Future proposals matching this pattern trigger warnings\n\n## Implementation\n```typescript\nfunction shouldInvertToAntiPattern(bullet: PlaybookBullet, config: Config): boolean {\n  const { decayedHelpful, decayedHarmful } = getDecayedCounts(bullet, config);\n  \n  // Inversion threshold: harmful significantly outweighs helpful\n  // AND we have enough data points to be confident\n  return (\n    decayedHarmful \u003e= 3 \u0026\u0026                    // Minimum harmful events\n    decayedHarmful \u003e decayedHelpful * 2 \u0026\u0026    // 2:1 harmful:helpful ratio\n    !bullet.deprecated                         // Not already handled\n  );\n}\n\nfunction invertToAntiPattern(\n  bullet: PlaybookBullet,\n  reason: string\n): PlaybookBullet {\n  // Create inverted content\n  const invertedContent = generateAntiPatternContent(bullet.content, reason);\n  \n  return {\n    ...bullet,\n    id: generateBulletId(), // New ID for the anti-pattern\n    kind: \"anti_pattern\",\n    content: invertedContent,\n    \n    // Reset feedback (this is a new bullet)\n    feedbackEvents: [],\n    helpfulCount: 0,\n    harmfulCount: 0,\n    state: \"draft\",\n    \n    // Track provenance\n    sourceSessions: bullet.sourceSessions,\n    sourceAgents: bullet.sourceAgents,\n    tags: [...bullet.tags, \"inverted\", \"anti-pattern\"],\n    \n    createdAt: now(),\n    updatedAt: now()\n  };\n}\n\nfunction generateAntiPatternContent(\n  originalContent: string,\n  reason: string\n): string {\n  // Transform positive advice into negative warning\n  // \"Use X for Y\" → \"AVOID: X for Y (causes Z)\"\n  \n  // Simple heuristic transformation\n  const cleaned = originalContent\n    .replace(/^(always |prefer |use |try |consider )/i, \"\")\n    .trim();\n  \n  return `AVOID: ${cleaned}. ${reason}`;\n}\n```\n\n## Integration with Curator\n```typescript\nfunction curatePlaybook(playbook: Playbook, deltas: Delta[], config: Config) {\n  // ... apply deltas ...\n  \n  // Check for bullets that should be inverted\n  for (const bullet of playbook.bullets) {\n    if (shouldInvertToAntiPattern(bullet, config)) {\n      const antiPattern = invertToAntiPattern(\n        bullet,\n        `Marked harmful ${bullet.harmfulCount} times`\n      );\n      \n      // Add anti-pattern\n      playbook.bullets.push(antiPattern);\n      \n      // Deprecate original\n      bullet.deprecated = true;\n      bullet.deprecationReason = `Inverted to anti-pattern: ${antiPattern.id}`;\n      bullet.replacedBy = antiPattern.id;\n      bullet.state = \"retired\";\n    }\n  }\n}\n```\n\n## Example Inversion\n**Before** (harmful rule):\n```yaml\n- id: \"b-abc123\"\n  kind: \"stack_pattern\"\n  content: \"Use global mutable state for sharing data between components\"\n  harmfulCount: 5\n  helpfulCount: 1\n```\n\n**After** (anti-pattern):\n```yaml\n- id: \"b-def456\"\n  kind: \"anti_pattern\"\n  content: \"AVOID: Global mutable state for sharing data between components. Marked harmful 5 times - causes race conditions and debugging nightmares.\"\n  tags: [\"inverted\", \"anti-pattern\", \"state-management\"]\n  \n- id: \"b-abc123\"\n  deprecated: true\n  deprecationReason: \"Inverted to anti-pattern: b-def456\"\n  replacedBy: \"b-def456\"\n  state: \"retired\"\n```","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T16:22:34.432332-05:00","updated_at":"2025-12-07T19:29:08.542036-05:00","closed_at":"2025-12-07T19:28:48.047336-05:00","dependencies":[{"issue_id":"cass_memory_system-0ew.6","depends_on_id":"cass_memory_system-0ew","type":"parent-child","created_at":"2025-12-07T16:22:34.438818-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.6","depends_on_id":"cass_memory_system-0ew.5","type":"blocks","created_at":"2025-12-07T16:23:19.358742-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.6","depends_on_id":"cass_memory_system-5eh.6","type":"blocks","created_at":"2025-12-07T16:23:19.429251-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-0ew.7","title":"Forget Command + Toxic Bullet Log (P8)","description":"# Feature: Forget Command + Toxic Bullet Log (P8)\n\n## Purpose\nPermanently block a pattern that should NEVER be suggested again.\nMore severe than deprecation - this is for truly harmful patterns\nthat caused production issues, security problems, etc.\n\n## Usage\n```bash\ncass-memory forget b-abc123 --reason \"Caused production outage\"\ncass-memory forget --list  # Show toxic bullet log\n```\n\n## Difference from Deprecation\n| Aspect | Deprecate | Forget |\n|--------|-----------|--------|\n| Reversible | Yes | No (requires manual edit) |\n| Stays in playbook | Yes (marked deprecated) | Removed entirely |\n| Future proposals | Allowed | Blocked via semantic matching |\n| Audit trail | In playbook | In toxic_bullets.log |\n\n## Implementation\n```typescript\nasync function forgetCommand(\n  bulletId: string,\n  flags: { reason: string; list?: boolean }\n): Promise\u003cvoid\u003e {\n  if (flags.list) {\n    return listToxicBullets();\n  }\n  \n  const config = await loadConfig();\n  const playbook = await loadMergedPlaybook(config);\n  \n  // Find bullet\n  const bullet = findBullet(playbook, bulletId);\n  if (!bullet) {\n    error(`Bullet not found: ${bulletId}`);\n    process.exit(1);\n  }\n  \n  // Log to toxic bullets file BEFORE removing\n  await appendToxicLog({\n    id: bullet.id,\n    content: bullet.content,\n    reason: flags.reason,\n    forgottenAt: now(),\n    originalBullet: bullet\n  });\n  \n  // Remove from playbook\n  playbook.bullets = playbook.bullets.filter(b =\u003e b.id !== bulletId);\n  \n  await savePlaybook(playbook, config.playbookPath);\n  \n  output({\n    success: true,\n    bulletId,\n    action: \"forgotten\",\n    reason: flags.reason\n  }, formatForgetResult, flags);\n}\n```\n\n## Toxic Bullet Log Format\n```\n~/.cass-memory/toxic_bullets.log\n# One JSON object per line\n{\"id\":\"b-abc123\",\"content\":\"Use eval() for dynamic code execution\",\"reason\":\"Security vulnerability - allows code injection\",\"forgottenAt\":\"2025-12-07T10:30:00Z\"}\n```\n\n## Blocking Future Proposals\nWhen the curator processes new \"add\" deltas, check against toxic log:\n```typescript\nasync function isSemanticallyToxic(\n  content: string,\n  toxicPatterns: ToxicEntry[]\n): Promise\u003cboolean\u003e {\n  for (const toxic of toxicPatterns) {\n    const similarity = jaccardSimilarity(content, toxic.content);\n    if (similarity \u003e 0.7) {\n      log(`Blocked: \"${content}\" matches toxic pattern \"${toxic.content}\"`);\n      return true;\n    }\n  }\n  return false;\n}\n```\n\n## Cascading Toxic Logs\nBoth global and repo-level toxic logs are checked:\n```typescript\nconst globalToxic = await loadToxicLog(\"~/.cass-memory/toxic_bullets.log\");\nconst repoToxic = await loadToxicLog(\"./.cass/toxic.log\");\nconst allToxic = [...globalToxic, ...repoToxic];\n```\n\n## List Output\n```bash\n$ cass-memory forget --list\n\nTOXIC BULLETS (permanently blocked):\n\n[b-abc123] 2025-12-07\n  \"Use eval() for dynamic code execution\"\n  Reason: Security vulnerability - allows code injection\n\n[b-def456] 2025-11-15  \n  \"Store passwords in localStorage\"\n  Reason: Security violation - passwords must never be in client storage\n```","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T16:22:34.672378-05:00","updated_at":"2025-12-07T20:34:28.838444-05:00","closed_at":"2025-12-07T20:34:13.670032-05:00","dependencies":[{"issue_id":"cass_memory_system-0ew.7","depends_on_id":"cass_memory_system-0ew","type":"parent-child","created_at":"2025-12-07T16:22:34.674322-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.7","depends_on_id":"cass_memory_system-5eh.8","type":"blocks","created_at":"2025-12-07T16:23:19.508632-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-0ew.8","title":"Doctor Command: System Health Check (P13)","description":"# Feature: Doctor Command (P13 - 5× DX Impact)\n\n## Purpose\nComprehensive system health check. Catches configuration issues, missing\ndependencies, stale data, and other problems BEFORE they cause failures.\n\n## Usage\n```bash\ncass-memory doctor\ncass-memory doctor --fix  # Auto-fix simple issues\ncass-memory doctor --json\n```\n\n## Checks Performed\n\n### 1. Configuration Checks\n- Config file exists and is valid JSON\n- Required fields present\n- API key environment variables set\n- Paths are writable\n\n### 2. Dependency Checks  \n- cass is available and healthy\n- cass index is up to date\n- LLM API is reachable (optional ping)\n\n### 3. Data Integrity Checks\n- Playbook YAML is valid\n- No orphaned bullet references\n- No circular deprecation chains\n- feedbackEvents timestamps are valid ISO 8601\n\n### 4. Health Metrics\n- Bullets with negative effective scores\n- Stale bullets (no feedback in 90+ days)\n- High harmful ratio bullets\n- Duplicate content detection\n\n## Implementation\n```typescript\ninterface DoctorCheck {\n  name: string;\n  status: \"pass\" | \"warn\" | \"fail\";\n  message: string;\n  fixable?: boolean;\n  fix?: () =\u003e Promise\u003cvoid\u003e;\n}\n\nasync function doctorCommand(flags: { fix?: boolean; json?: boolean }): Promise\u003cvoid\u003e {\n  const checks: DoctorCheck[] = [];\n  \n  // Configuration checks\n  checks.push(await checkConfigExists());\n  checks.push(await checkConfigValid());\n  checks.push(await checkApiKeys());\n  \n  // Dependency checks\n  checks.push(await checkCassAvailable());\n  checks.push(await checkCassIndex());\n  \n  // Data integrity checks\n  checks.push(await checkPlaybookValid());\n  checks.push(await checkNoOrphanedRefs());\n  checks.push(await checkNoCircularDeprecations());\n  checks.push(await checkTimestampsValid());\n  \n  // Health metrics\n  checks.push(await checkNegativeScoreBullets());\n  checks.push(await checkStaleBullets());\n  checks.push(await checkHighHarmfulRatio());\n  checks.push(await checkDuplicateContent());\n  \n  // Auto-fix if requested\n  if (flags.fix) {\n    for (const check of checks.filter(c =\u003e c.status !== \"pass\" \u0026\u0026 c.fixable)) {\n      await check.fix?.();\n      check.status = \"pass\";\n      check.message += \" (auto-fixed)\";\n    }\n  }\n  \n  // Output\n  output({ checks, summary: summarizeChecks(checks) }, formatDoctorResult, flags);\n  \n  // Exit code based on results\n  const hasFailures = checks.some(c =\u003e c.status === \"fail\");\n  if (hasFailures) process.exit(1);\n}\n```\n\n## Example Output\n```\n╭─────────────────────────────────────────────────────────────╮\n│                   CASS-MEMORY DOCTOR                        │\n├─────────────────────────────────────────────────────────────┤\n│                                                             │\n│ CONFIGURATION                                               │\n│   ✓ Config file exists                                      │\n│   ✓ Config is valid JSON                                    │\n│   ✓ ANTHROPIC_API_KEY is set                                │\n│                                                             │\n│ DEPENDENCIES                                                │\n│   ✓ cass is available (v0.5.2)                              │\n│   ⚠ cass index is 3 days old (run: cass index --incremental)│\n│                                                             │\n│ DATA INTEGRITY                                              │\n│   ✓ Playbook YAML is valid                                  │\n│   ✓ No orphaned references                                  │\n│   ✓ No circular deprecations                                │\n│                                                             │\n│ PLAYBOOK HEALTH                                             │\n│   ⚠ 3 bullets have negative effective scores                │\n│   ⚠ 12 bullets are stale (no feedback in 90+ days)          │\n│   ✓ No high harmful ratio bullets                           │\n│   ⚠ 2 potential duplicate pairs detected                    │\n│                                                             │\n├─────────────────────────────────────────────────────────────┤\n│ Summary: 8 passed, 4 warnings, 0 failures                   │\n│                                                             │\n│ Recommendations:                                            │\n│   • Run `cass index --incremental` to update search index   │\n│   • Review bullets with negative scores:                    │\n│     cass-memory playbook list --at-risk                     │\n│   • Consider merging duplicate bullets:                     │\n│     cass-memory similar b-abc123                            │\n╰─────────────────────────────────────────────────────────────╯\n```","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T16:22:34.902332-05:00","updated_at":"2025-12-07T19:29:08.543005-05:00","closed_at":"2025-12-07T19:28:58.933918-05:00","dependencies":[{"issue_id":"cass_memory_system-0ew.8","depends_on_id":"cass_memory_system-0ew","type":"parent-child","created_at":"2025-12-07T16:22:34.903228-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.8","depends_on_id":"cass_memory_system-5eh.7","type":"blocks","created_at":"2025-12-07T16:23:19.581038-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.8","depends_on_id":"cass_memory_system-5eh.4","type":"blocks","created_at":"2025-12-07T16:23:19.664395-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.8","depends_on_id":"cass_memory_system-5eh.8","type":"blocks","created_at":"2025-12-07T16:23:19.735154-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-0ew.9","title":"Reflect Command: cass-memory reflect (Full Pipeline)","description":"# Feature: Reflect Command (Full Pipeline Orchestration)\n\n## Purpose\nOrchestrate the full diary → reflect → validate → curate pipeline.\nThis is the command that makes the playbook learn from recent sessions.\n\n## Usage\n```bash\ncass-memory reflect --days 7 --max-sessions 10\ncass-memory reflect --dry-run --json  # See what would happen\ncass-memory reflect --session ~/.claude/sessions/abc.jsonl  # Single session\n```\n\n## Process Flow\n```\n1. Find unprocessed sessions (not in processed.log)\n2. For each session:\n   a. Generate diary (if not exists)\n   b. Run reflector (extract deltas)\n   c. Run validator on \"add\" deltas (evidence gate + LLM)\n   d. Apply deltas via curator\n   e. Mark session as processed\n3. Save updated playbook\n4. Run auto-prune\n5. Check for anti-pattern inversions\n```\n\n## Implementation\n```typescript\nasync function reflectCommand(flags: ReflectFlags): Promise\u003cvoid\u003e {\n  const config = await loadConfig();\n  const playbook = await loadMergedPlaybook(config);\n  \n  // 1. Find sessions to process\n  const sessions = flags.session\n    ? [{ path: flags.session, agent: detectAgent(flags.session) }]\n    : await findUnprocessedSessions(config);\n  \n  if (sessions.length === 0) {\n    output({ message: \"No new sessions to process\" }, null, flags);\n    return;\n  }\n  \n  const results: ReflectionResult[] = [];\n  \n  // 2. Process each session\n  for (const session of sessions.slice(0, flags.maxSessions || 10)) {\n    // 2a. Generate diary\n    let diary = await loadDiary(session.path);\n    if (!diary) {\n      diary = await generateDiary(session.path, session.agent, config);\n      await saveDiary(diary);\n    }\n    \n    // 2b. Run reflector\n    const deltas = await reflectOnSession(diary, playbook, config);\n    \n    // 2c. Validate \"add\" deltas\n    const validatedDeltas: Delta[] = [];\n    for (const delta of deltas) {\n      if (delta.type === \"add\" \u0026\u0026 config.validationEnabled) {\n        const validation = await validateRule(delta.bullet.content, config);\n        if (validation.valid) {\n          // Optionally use refined content\n          if (validation.refinedContent) {\n            delta.bullet.content = validation.refinedContent;\n          }\n          validatedDeltas.push(delta);\n        }\n      } else {\n        validatedDeltas.push(delta);\n      }\n    }\n    \n    // 2d. Dry run check\n    if (flags.dryRun) {\n      results.push({\n        session: session.path,\n        diary,\n        proposedDeltas: validatedDeltas,\n        applied: false\n      });\n      continue;\n    }\n    \n    // 2e. Apply deltas\n    const { applied, skipped } = curatePlaybook(playbook, validatedDeltas, config);\n    \n    // 2f. Mark processed\n    await markSessionProcessed(session.path);\n    \n    results.push({\n      session: session.path,\n      diary,\n      proposedDeltas: validatedDeltas,\n      applied: true,\n      deltasApplied: applied,\n      deltasSkipped: skipped\n    });\n  }\n  \n  // 3. Save playbook (if not dry run)\n  if (!flags.dryRun) {\n    // Run anti-pattern inversion check\n    checkAndInvertAntiPatterns(playbook, config);\n    \n    // Auto-prune\n    const pruned = autoPrunePlaybook(playbook, config);\n    \n    await savePlaybook(playbook, config.playbookPath);\n    \n    output({\n      sessionsProcessed: results.length,\n      results,\n      pruned\n    }, formatReflectResult, flags);\n  } else {\n    output({\n      dryRun: true,\n      sessionsAnalyzed: results.length,\n      results\n    }, formatReflectDryRun, flags);\n  }\n}\n```\n\n## Processed Log\n```\n~/.cass-memory/reflections/global.processed.log\n# Format: {diaryId}\\t{timestamp}\\t{sessionPath}\ndiary-abc123\t2025-12-07T10:30:00Z\t~/.claude/sessions/session-001.jsonl\ndiary-def456\t2025-12-07T11:00:00Z\t~/.cursor/state.vscdb:session-xyz\n```\n\n## Output (--json)\n```json\n{\n  \"sessionsProcessed\": 3,\n  \"results\": [\n    {\n      \"session\": \"~/.claude/sessions/abc.jsonl\",\n      \"deltasApplied\": 5,\n      \"deltasSkipped\": 2,\n      \"newBullets\": [\"b-abc123\", \"b-def456\"],\n      \"helpfulMarks\": 2,\n      \"harmfulMarks\": 1\n    }\n  ],\n  \"pruned\": 0,\n  \"antiPatternsInverted\": 0\n}\n```","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T16:23:02.233237-05:00","updated_at":"2025-12-07T19:29:08.543456-05:00","closed_at":"2025-12-07T19:28:58.010246-05:00","dependencies":[{"issue_id":"cass_memory_system-0ew.9","depends_on_id":"cass_memory_system-0ew","type":"parent-child","created_at":"2025-12-07T16:23:02.234721-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.9","depends_on_id":"cass_memory_system-0ew.1","type":"blocks","created_at":"2025-12-07T16:23:19.815499-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.9","depends_on_id":"cass_memory_system-0ew.3","type":"blocks","created_at":"2025-12-07T16:23:19.887792-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.9","depends_on_id":"cass_memory_system-0ew.4","type":"blocks","created_at":"2025-12-07T16:23:19.959156-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.9","depends_on_id":"cass_memory_system-0ew.5","type":"blocks","created_at":"2025-12-07T16:23:20.025207-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0ew.9","depends_on_id":"cass_memory_system-0ew.6","type":"blocks","created_at":"2025-12-07T16:23:20.1012-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-0htq","title":"[MCP:Future] MCP server architecture design","description":"Run cass-memory as MCP server for direct agent integration:\n- No CLI parsing overhead\n- Native tool calls from agents\n- Real-time communication\n\nBenefits:\n- Faster than CLI invocation\n- Richer error handling\n- Streaming support for long operations\n\nThis is a future enhancement (P4 priority) that will enable agents to interact with cass-memory more efficiently through the Model Context Protocol.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T16:49:27.530409-05:00","updated_at":"2025-12-07T21:49:40.716133-05:00","closed_at":"2025-12-07T21:49:36.581852-05:00"}
{"id":"cass_memory_system-0k57","title":"[Integration] File System Operations - Real I/O Tests","description":"## Target: Integration tests for file I/O across modules\n\n### Test Scenarios:\n\n1. **Playbook File Lifecycle**\n   - Create temp directory\n   - Save playbook to disk\n   - Load playbook from disk\n   - Verify round-trip integrity\n   - Concurrent read/write handling\n   - File locking verification\n\n2. **Config File Lifecycle**\n   - Create config in temp home\n   - Modify and save config\n   - Reload and verify\n   - Migration from older versions\n\n3. **Diary Directory Scanning**\n   - Create temp diary structure\n   - Add various file types (.md, .json, .jsonl)\n   - Scan and verify all found\n   - Handle permission issues\n   - Handle symlinks\n\n4. **Cross-Module File Operations**\n   - Init creates structure\n   - Context reads from structure\n   - Mark modifies playbook\n   - Verify all in sync\n\n### Test Infrastructure:\n\n```typescript\n// test/helpers/temp-env.ts\nexport async function withTempCassHome(fn: (home: string) =\u003e Promise\u003cvoid\u003e) {\n  const tempDir = await mkdtemp(join(tmpdir(), 'cass-test-'));\n  const originalHome = process.env.HOME;\n  try {\n    process.env.HOME = tempDir;\n    await fn(tempDir);\n  } finally {\n    process.env.HOME = originalHome;\n    await rm(tempDir, { recursive: true });\n  }\n}\n```\n\n### Logging Requirements:\n- Log each file operation\n- Include timestamps\n- Show file sizes\n- Report timing for perf issues","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:30:05.491647-05:00","updated_at":"2025-12-08T14:27:02.244907-05:00","closed_at":"2025-12-08T14:27:02.244907-05:00","dependencies":[{"issue_id":"cass_memory_system-0k57","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:32.987978-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0k57","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:32:33.282807-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0k57","depends_on_id":"cass_memory_system-zc1d","type":"blocks","created_at":"2025-12-07T20:33:03.567671-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-0l6","title":"[Cass] cassView - Get specific line from session","description":"Implement cassView() to get a specific line from a session.\n\n## Signature\n```typescript\nasync function cassView(\n  sessionPath: string, \n  lineNumber: number,\n  cassPath = \"cass\"\n): Promise\u003cstring | null\u003e\n```\n\n## CLI Command\n`cass view {sessionPath} -n {lineNumber} --json`\n\n## Implementation\n- Use execFile() to run view command\n- Return exact line content\n- Return null on error\n\n## Error Handling\n- Return null if session not found\n- Return null if line number out of range\n- No retries needed\n\n## Parameters\n- sessionPath: Full path to session file\n- lineNumber: Specific line to retrieve (1-indexed)\n\n## Output\nReturns just the content of the specified line without line number prefix.\n\n## Usage\nPrecise line retrieval for:\n- Following up on search hits\n- Fetching specific context\n- Validation and verification\n\n```typescript\nconst line = await cassView(\"/path/to/session.txt\", 42);\nif (line) {\n  console.log(\"Line 42:\", line);\n}\n```\n\n## vs cassExpand\n- cassView: Single line only, exact content\n- cassExpand: Context window around line, includes line numbers\n\n## Exit Codes\n- 0: Success\n- 4: Session or line not found","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:02.815833-05:00","updated_at":"2025-12-07T18:48:03.182043-05:00","closed_at":"2025-12-07T18:43:59.085236-05:00"}
{"id":"cass_memory_system-0q0","title":"[LLM] PROMPTS.reflector - Delta extraction prompt template","description":"Full prompt template for delta extraction with variables:\n{existingBullets}, {status}, {accomplishments}, {decisions}, {challenges}, {preferences}, {keyLearnings}, {cassHistory}, {iterationNote}\n\nKey delta types:\n1. ADD: New insight not covered by existing bullets - MUST be specific\n2. HELPFUL: Existing bullet proved useful\n3. HARMFUL: Following existing bullet caused problems\n4. REPLACE: Existing bullet needs updated wording\n5. DEPRECATE: Existing bullet is outdated/wrong\n\nGuidelines emphasized:\n- Only genuinely reusable insights\n- Consider: Would this help a DIFFERENT agent?\n- Max 20 deltas per reflection\n- Be specific with file names, function names, error messages\n- Avoid vague/generic rules\n\nTemperature: 0.5 (slightly higher for creativity)\nUsed in runReflector function.\n\nIteration note: On subsequent iterations, remind LLM to focus on novel insights not already proposed.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:52.858965-05:00","updated_at":"2025-12-07T18:53:18.233462-05:00","closed_at":"2025-12-07T18:49:30.145923-05:00"}
{"id":"cass_memory_system-0rfo","title":"Unit tests for curate.ts - Curator pipeline logic","description":"Complete unit test coverage for curate.ts:\n- curatePlaybook() with various playbook states\n- Anti-pattern detection and inversion\n- Bullet merging and deduplication logic\n- Pruning based on harmful threshold\n- Maturity state transitions (candidate -\u003e active -\u003e proven)\n- Deprecation handling\n- Decay half-life configuration application\n- Edge cases: empty playbook, single bullet, all harmful\nNO MOCKS - use real playbook fixtures","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:25:14.551852-05:00","updated_at":"2025-12-08T00:17:18.111905-05:00","closed_at":"2025-12-08T00:16:32.398387-05:00","dependencies":[{"issue_id":"cass_memory_system-0rfo","depends_on_id":"cass_memory_system-ai52","type":"blocks","created_at":"2025-12-07T20:28:08.021879-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-0sv","title":"[Generator] checkDeprecatedPatterns - Warn about deprecated usage","description":"Check if deprecated patterns appear in historical context and generate warnings.\n\nSIGNATURE:\nfunction checkDeprecatedPatterns(history: CassHit[], playbook: Playbook): string[]\n\nPURPOSE:\nAlert the agent when historical context shows usage of patterns that have been marked as deprecated in the playbook. Helps prevent repeating outdated approaches.\n\nFLOW:\n1. Get all deprecatedPatterns from playbook\n2. For each deprecated pattern:\n   a. Check if pattern.oldPattern appears in any history snippet\n   b. If found, generate warning string using pattern.replacement\n3. Return array of warning strings\n\nDEPRECATED PATTERN STRUCTURE:\n{\n  oldPattern: string,        // What to look for (regex or literal)\n  replacement: string,       // What to use instead\n  reason?: string,          // Why it was deprecated\n  deprecatedAt: Date        // When it was deprecated\n}\n\nEXAMPLE:\nPlaybook has:\n  { oldPattern: 'AuthHandler', replacement: 'AuthService', reason: 'Refactored to service pattern' }\n\nHistory contains:\n  'Using AuthHandler.authenticate() for login flow'\n\nOutput:\n  ['AuthHandler class was deprecated - use AuthService instead (Reason: Refactored to service pattern)']\n\nWARNING FORMAT:\n'{oldPattern} was deprecated - use {replacement} instead'\nIf reason exists: append '(Reason: {reason})'\n\nMATCHING LOGIC:\n- Case-sensitive substring match by default\n- Support regex if pattern starts with '/' (optional enhancement)\n- Match against snippet content only (not metadata)\n\nUSE CASE:\nPrevents agent from learning from old sessions that use deprecated approaches, even if those sessions were marked helpful at the time.\n\nIMPLEMENTATION NOTES:\n- Return empty array if no deprecatedPatterns defined\n- Return empty array if history is empty\n- Multiple warnings possible (one per deprecated pattern found)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:58.536656-05:00","updated_at":"2025-12-07T19:20:01.022789-05:00","closed_at":"2025-12-07T19:18:39.52114-05:00"}
{"id":"cass_memory_system-0thy","title":"[Unit Tests] reflect.ts - Reflector pipeline functions","description":"## Unit Tests: reflect.ts - Reflector Pipeline Functions\n\n### Test Categories\n\n#### 1. runReflector()\n- Generates structured reflection from session content\n- Includes summary, lessons, patterns, warnings\n- Handles empty session gracefully\n- Respects max tokens/length constraints\n\n#### 2. extractDiaryFields()\n- Parses LLM response into diary structure\n- Handles missing optional fields\n- Validates field types\n- Sanitizes malformed content\n\n#### 3. buildReflectionPrompt()\n- Includes session transcript excerpts\n- Includes existing playbook context\n- Formats as clear LLM instruction\n- Handles long sessions (truncation)\n\n#### 4. parseReflectionResponse()\n- Extracts structured data from LLM JSON\n- Handles markdown-wrapped JSON\n- Falls back gracefully on parse errors\n- Validates against expected schema\n\n#### 5. shouldReflect()\n- True when session exceeds min message count\n- True when time since last reflection \u003e threshold\n- False for trivial sessions\n- Respects force flag override\n\n#### 6. Edge Cases\n- Very long sessions (1000+ messages)\n- Sessions with only system messages\n- Sessions with code blocks and special chars\n- Non-UTF8 content handling\n\n### Test Approach\n- Use sample session fixtures\n- Verify prompt construction (no LLM calls)\n- Test parsing with various LLM response formats\n- Real file I/O for diary writes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:23:30.386074-05:00","updated_at":"2025-12-07T21:53:11.517996-05:00","closed_at":"2025-12-07T21:53:11.517996-05:00","dependencies":[{"issue_id":"cass_memory_system-0thy","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2025-12-07T20:31:04.859663-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0thy","depends_on_id":"cass_memory_system-p4mv","type":"blocks","created_at":"2025-12-07T20:31:04.988236-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-0thy","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2025-12-07T20:31:08.174265-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-0z1y","title":"[CLI:stats] renderStatsUI - Pretty terminal output","description":"Implements the renderStatsUI function that creates beautiful terminal output for playbook statistics.\n\nFUNCTION SIGNATURE:\n```typescript\nfunction renderStatsUI(stats: PlaybookStats): string\n```\n\nOUTPUT FORMAT:\n```\n╭─────────────────────────────────────────────────────╮\n│              CASS-MEMORY PLAYBOOK HEALTH            │\n├─────────────────────────────────────────────────────┤\n│ Total Bullets: 156 (Global: 89, Workspace: 67)      │\n│                                                     │\n│ BY MATURITY:                                        │\n│   ● Candidate:   23 (14.7%)  ░░░░░                  │\n│   ● Established: 87 (55.8%)  ████████████████       │\n│   ● Proven:      41 (26.3%)  ████████               │\n│   ● Deprecated:   5 ( 3.2%)  █                      │\n│                                                     │\n│ BY TYPE:                                            │\n│   ● Rules:         142 (91.0%)                      │\n│   ● Anti-Patterns:  14 ( 9.0%)                      │\n│                                                     │\n│ SCORE DISTRIBUTION:                                 │\n│   🌟 Excellent (8+):  28 (17.9%)                    │\n│   ✓  Good (4-7):      94 (60.3%)                    │\n│   –  Neutral (0-3):   29 (18.6%)                    │\n│   ⚠  At Risk (\u003c0):     5 ( 3.2%)                    │\n│                                                     │\n│ TOP PERFORMERS:                                     │\n│   1. [12.4] Use React.memo for expensive renders   │\n│   2. [11.8] Run migrations in transaction          │\n│   3. [10.2] Validate input at API boundary         │\n│                                                     │\n│ ⚠  AT RISK (5):                                     │\n│   • [-2.1] abc-123: Cache without expiry           │\n│   • [-1.5] def-456: Skip error handling            │\n│                                                     │\n│ 📊 STALE BULLETS (12): No feedback in 90+ days     │\n│ 🔗 MERGE CANDIDATES (3): High similarity detected  │\n│                                                     │\n│ 💡 RECOMMENDATIONS:                                 │\n│   • Review at-risk bullets: cass-memory show \u003cid\u003e  │\n│   • Consider merging similar rules                 │\n│   • Clean up stale bullets                         │\n╰─────────────────────────────────────────────────────╯\n```\n\nIMPLEMENTATION REQUIREMENTS:\n\n1. BOX DRAWING:\n   - Use Unicode box characters (╭╮╰╯├┤│─)\n   - Dynamic width based on terminal size\n   - Proper padding and alignment\n\n2. COLOR CODING (using chalk):\n   - Green: Good metrics, top performers\n   - Yellow: Neutral, warnings\n   - Red: At risk, negative scores\n   - Blue: Headers, section titles\n   - Gray: Secondary information\n\n3. VISUAL ELEMENTS:\n   - Bar charts using █░ characters\n   - Percentage display with proper formatting\n   - Icons/emoji for quick scanning\n   - Proper number formatting (1,234 vs 1234)\n\n4. RESPONSIVE LAYOUT:\n   - Detect terminal width\n   - Truncate long bullet previews with ellipsis\n   - Adjust bar chart length to fit\n   - Collapse sections if terminal too narrow\n\n5. INFORMATION HIERARCHY:\n   - Most important metrics at top\n   - Actionable items highlighted\n   - Supporting details below\n   - Recommendations at bottom\n\nCONTENT PRIORITIZATION:\n- Show top 3 performers (not all 10)\n- Show all at-risk bullets (critical)\n- Summarize stale/merge counts (details via other commands)\n- Include next-action recommendations\n\nACCESSIBILITY:\n- Works in non-color terminals (fallback to ASCII)\n- Readable without emoji support\n- Screen reader friendly (avoid pure visual elements)\n\nDEPENDENCIES:\n- chalk (colors)\n- terminal-size (width detection)\n- String utilities (truncate, pad, align)\n\nSUCCESS CRITERIA:\n- Output fits in standard 80-column terminal\n- Colors enhance readability without being essential\n- All key metrics visible at a glance\n- Actionable insights clearly highlighted\n- Professional appearance suitable for demos","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:54:03.844591-05:00","updated_at":"2025-12-07T22:38:15.48517-05:00","closed_at":"2025-12-07T22:37:41.259082-05:00"}
{"id":"cass_memory_system-14xw","title":"[Docs] CONTRIBUTING.md - Contribution guidelines","description":"Create CONTRIBUTING.md with contribution guidelines for developers.\n\nSections:\n1. Development Setup:\n   - Prerequisites: Node.js 18+, Bun, Git\n   - Clone repository\n   - Install dependencies: bun install\n   - Run in development: bun run dev\n   \n2. Running Tests:\n   - Unit tests: bun test\n   - Integration tests: bun test:integration\n   - Coverage: bun test --coverage\n   \n3. Code Style:\n   - TypeScript strict mode enabled\n   - Prettier for formatting\n   - ESLint for linting\n   - Run: bun run lint \u0026\u0026 bun run format\n   \n4. PR Process:\n   - Fork repository\n   - Create feature branch\n   - Write tests for new features\n   - Ensure all tests pass\n   - Update documentation\n   - Submit PR with clear description\n   \n5. Issue Templates:\n   - Bug reports\n   - Feature requests\n   - Documentation improvements\n   \n6. Architecture Overview:\n   - Brief explanation for contributors\n   - Link to detailed architecture docs\n\nCode of Conduct: Be respectful and constructive","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:46.118799-05:00","updated_at":"2025-12-07T19:10:47.883612-05:00","closed_at":"2025-12-07T19:09:52.422736-05:00"}
{"id":"cass_memory_system-16qf","title":"[Bug] Curate: Auto-deprecation blocks anti-pattern inversion","description":"","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-07T20:08:58.592115-05:00","updated_at":"2025-12-07T20:11:16.246305-05:00","closed_at":"2025-12-07T20:11:14.429176-05:00"}
{"id":"cass_memory_system-1ce","title":"[Playbook] getBulletsByCategory - Filter bullets by category","description":"## Function Signature\n```typescript\nfunction getBulletsByCategory(\n  playbook: Playbook,\n  category: string,\n  includeDeprecated?: boolean\n): PlaybookBullet[]\n```\n\n## Purpose\nFilter bullets by category with optional inclusion of deprecated bullets. Returns sorted array by effective score.\n\n## Algorithm\n1. Filter playbook.bullets by category match\n2. If includeDeprecated is false (default):\n   - Filter out bullets with state === \"retired\"\n   - Filter out bullets with maturity === \"deprecated\"\n3. Calculate effective score for each bullet\n4. Sort by effective score (descending)\n5. Return sorted array\n\n## Category Matching\n- **Exact match**: category === bullet.category\n- **Case-insensitive**: Normalize to lowercase\n- **Common categories**: \"testing\", \"security\", \"performance\", \"code-quality\", \"documentation\"\n\n## Effective Score Sorting\nPriority order:\n1. Highest score first (most helpful)\n2. Recent validation (newer lastValidatedAt)\n3. Maturity level (proven \u003e established \u003e candidate)\n\n## includeDeprecated Parameter\n```typescript\n// Active bullets only (default)\nconst testing = getBulletsByCategory(playbook, \"testing\");\n\n// Include deprecated for historical analysis\nconst allTesting = getBulletsByCategory(playbook, \"testing\", true);\n```\n\n## Usage Scenarios\n1. **Context generation**: Get top N rules for category\n2. **Category stats**: Count bullets per category\n3. **Markdown export**: Group bullets by category\n4. **Search**: Find rules in specific domain\n\n## Implementation Notes\n- Case-insensitive category matching\n- Sort by effective score for relevance\n- Default excludes deprecated (most common use)\n- Return empty array if no matches\n\n## Return Value\n```typescript\nPlaybookBullet[]  // Sorted by effective score DESC\n```\n\n## Dependencies\n- calculateEffectiveScore() - for sorting\n- getActiveBullets() - similar filtering\n\n## Related Functions\n- getActiveBullets() - all active bullets\n- exportToMarkdown() - uses this for grouping\n- findMergeCandidates() - groups by category first","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:10.558681-05:00","updated_at":"2025-12-07T20:09:13.785825-05:00","closed_at":"2025-12-07T20:09:12.682626-05:00"}
{"id":"cass_memory_system-1f7","title":"[Playbook] savePlaybook - Write playbook to YAML","description":"## Function Signature\n```typescript\nasync function savePlaybook(playbook: Playbook, config: Config): Promise\u003cvoid\u003e\n```\n\n## Purpose\nWrite playbook to YAML file atomically. Updates metadata and prevents corruption through atomic write strategy.\n\n## Algorithm\n1. Update metadata.lastReflection to now()\n2. Ensure parent directory exists (mkdir -p)\n3. Stringify with yaml.stringify()\n4. Write atomically:\n   - Write to `{playbookPath}.tmp`\n   - Rename to `{playbookPath}` (atomic operation)\n5. Update metadata.totalReflections if changed\n\n## Atomic Write Strategy\n**Critical**: Never write directly to playbook.yaml\n- Write to temporary file first\n- Rename is atomic on POSIX systems\n- Prevents corruption if process crashes mid-write\n- Ensures playbook is always in valid state\n\n## Metadata Updates\n- `lastReflection`: Always updated to current timestamp\n- `totalReflections`: Incremented if bullets changed\n- `totalSessionsProcessed`: Updated by curator\n\n## Implementation Notes\n- Use fs.promises.rename() for atomic rename\n- Use yaml.stringify() with proper formatting\n- Ensure directory exists before writing\n- Handle EACCES permission errors\n\n## Error Handling\n- **EACCES**: Permission denied on directory or file\n- **ENOSPC**: No space left on device\n- **EIO**: I/O errors during write\n\n## Dependencies\n- fs/promises\n- yaml library\n- path module for directory handling\n\n## Related Functions\n- loadPlaybook() - reads what this writes\n- All mutation functions - call this to persist changes","notes":"Existing playbook helper implementations already present; no code changes made. Released reservation; feel free to take over.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:46.901077-05:00","updated_at":"2025-12-07T18:58:10.119085-05:00","closed_at":"2025-12-07T18:57:52.631064-05:00"}
{"id":"cass_memory_system-1gub","title":"[Docs] Error messages and troubleshooting guide","description":"Document common error messages and troubleshooting solutions.\n\nCommon errors:\n- 'cass not found' → Installation instructions for cass CLI prerequisite\n- 'API key missing' → How to set OPENAI_API_KEY or ANTHROPIC_API_KEY environment variables\n- 'Playbook corrupt' → Recovery instructions using validate and backup restoration\n- 'Rate limited' → Explanation of exponential backoff and retry logic\n- 'Permission denied' → chmod +x instructions for binary\n- 'Config file invalid' → JSON/YAML validation and schema errors\n- 'SQLite locked' → Concurrent access issues and solutions\n- 'Session file not found' → Path configuration and session discovery\n\nFor each error:\n- Error message text\n- Root cause explanation\n- Step-by-step solution\n- Prevention tips\n\nInclude diagnostic commands like 'doctor' for automatic troubleshooting","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:40.351434-05:00","updated_at":"2025-12-08T14:00:09.248127-05:00","closed_at":"2025-12-08T14:00:09.248127-05:00"}
{"id":"cass_memory_system-1h9","title":"[Diary] extractDiarySafe - Extraction with fallback","description":"Safe wrapper around diary extraction with graceful fallback on failure.\n\nFunction Signature:\nasync function extractDiarySafe(\n  sessionContent: string,\n  metadata: SessionMetadata,\n  config: Config\n): Promise\u003cDiaryEntry\u003e\n\nProcess:\n1. Try calling extractDiaryFields(sessionContent, metadata, config)\n2. On success: Return full DiaryEntry with all extracted fields\n3. On failure: Return minimal fallback DiaryEntry\n\nFallback DiaryEntry Structure:\n- status: 'mixed'\n- accomplishments: ['[Extraction failed - see raw session]']\n- challenges: ['Diary extraction error: {error.message}']\n- decisions: []\n- preferences: []\n- keyLearnings: []\n- suggestedTags: ['extraction-failure']\n- sessionPath: metadata.sessionPath\n- agent: metadata.agent\n- workspace: metadata.workspace\n- timestamp: current time\n\nKey Features:\n- Never crashes on LLM failure\n- Preserves session reference even on failure\n- Error message stored as challenge\n- Enables post-mortem debugging\n- Maintains diary continuity\n\nError Scenarios Handled:\n- LLM API timeout or rate limit\n- Invalid JSON response from LLM\n- Schema validation failure\n- Network errors\n- Prompt token limit exceeded\n\nPhilosophy:\nA minimal diary is better than no diary. Failed extractions are marked clearly but don't break the pipeline.\n\nOutput:\nAlways returns valid DiaryEntry, either full extraction or minimal fallback.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:25.16681-05:00","updated_at":"2025-12-07T20:10:22.232517-05:00","closed_at":"2025-12-07T20:09:47.661865-05:00"}
{"id":"cass_memory_system-1jdn","title":"[Foundation] Define ~/.cass-memory/ directory structure","description":"Define and implement the ~/.cass-memory/ global directory structure for user-level CASS Memory System data.\n\n## Context\nThe ~/.cass-memory/ directory is the user's global memory store, containing personal configuration, playbooks, diary entries, and usage tracking. This directory persists across all projects and repositories the user works on, serving as their personal agent memory layer.\n\n## Technical Specification\n\n### Directory Structure:\n~/.cass-memory/\n├── config.json              # User configuration (API keys, default model, etc.)\n├── playbook.yaml            # Personal global playbook (rules across all projects)\n├── toxic_bullets.log        # Permanently blocked patterns (user-level)\n├── diary/                   # Diary entries organized by date\n│   ├── 2025-12-07.md\n│   ├── 2025-12-06.md\n│   └── ...\n├── reflections/             # Processed session tracking\n│   ├── session-abc123.json\n│   ├── session-def456.json\n│   └── ...\n├── usage.jsonl              # Bullet usage log with timestamps\n├── embeddings/              # Local vector store for semantic search\n│   ├── index.bin\n│   └── metadata.json\n└── cost/                    # LLM cost tracking\n    ├── monthly-2025-12.jsonl\n    └── total.json\n\n### File Specifications:\n\n#### config.json:\n- llm_provider: 'openai' | 'anthropic' | 'google'\n- model: string (e.g., 'gpt-4', 'claude-opus-4-5', 'gemini-pro')\n- api_key: string (primary API key)\n- api_keys: { openai?: string, anthropic?: string, google?: string }\n- max_tokens: number (default response length)\n- temperature: number (0-1, creativity setting)\n- enable_curation: boolean (auto-curate bullets)\n- evidence_threshold: number (usage count before LLM curation)\n- enable_sanitization: boolean (auto-detect secrets)\n\n#### playbook.yaml:\n- bullets: Array of global rules (applies to ALL projects)\n- categories: SETUP, BUILD, TEST, DEBUG, DEPLOY, etc.\n- each bullet has: content, context, priority, state, usage_count\n\n#### toxic_bullets.log:\n- Newline-delimited list of blocked bullet content\n- Case-insensitive matching\n- Applied globally to prevent toxic rules\n\n#### diary/ (daily markdown files):\n- One file per day: YYYY-MM-DD.md\n- Timestamped entries\n- Free-form text + metadata frontmatter\n- Used for reflection and pattern extraction\n\n#### reflections/ (session metadata):\n- One JSON file per session\n- session_id, timestamp, repo_path, command, duration\n- extracted_patterns: Array of learned behaviors\n- applied_bullets: Array of bullets used in session\n\n#### usage.jsonl (bullet tracking):\n- One line per bullet usage\n- timestamp, bullet_hash, repo_path, session_id, outcome\n- Used for evidence-based curation\n- Queryable for historical analysis\n\n#### embeddings/ (vector store):\n- Binary index for fast semantic search\n- Metadata mapping IDs to bullet content\n- Future: enable natural language playbook queries\n\n#### cost/ (LLM usage tracking):\n- Monthly JSONL files: timestamp, provider, model, tokens, cost\n- total.json: cumulative spend across all providers\n- Helps users budget LLM usage\n\n## Reasoning\n\n### Why Global Directory:\n1. Cross-Project Memory: Rules learned in one project apply to others\n2. User Ownership: User controls their personal memory store\n3. Privacy: Personal diary and usage data stays local\n4. Portability: Backup and restore entire memory with one directory\n\n### Why config.json:\n1. Single Source of Truth: All LLM configuration in one place\n2. API Key Security: Stored locally, never committed to git\n3. User Preferences: Default model and behavior settings\n4. Easy Onboarding: cass-memory init walks through setup\n\n### Why playbook.yaml:\n1. Human-Readable: YAML is easy to edit manually\n2. Version-Controllable: Can commit to dotfiles repo\n3. Mergeable: Combines with repo-level playbooks\n4. Hierarchical: Categories organize rules logically\n\n### Why toxic_bullets.log:\n1. Safety Net: Prevents re-learning bad patterns\n2. Permanent: Once blocked, stays blocked\n3. User Control: Users curate their own blocklist\n4. Simple Format: Plain text, easy to inspect/edit\n\n### Why diary/:\n1. Human-Readable: Markdown for manual review\n2. Daily Organization: Natural time-based structure\n3. Reflection Source: LLM mines diary for patterns\n4. Debugging: Understand what agent was thinking\n\n### Why reflections/:\n1. Session Tracking: Know what agent learned when\n2. Reproducibility: Trace which bullets were applied\n3. Analytics: Measure bullet effectiveness\n4. Audit Trail: Compliance and debugging\n\n### Why usage.jsonl:\n1. Evidence-Based: Track which rules are actually useful\n2. Queryable: Filter by repo, time range, outcome\n3. Curation Input: LLM uses usage data for decisions\n4. Append-Only: Fast writes, no corruption risk\n\n### Why embeddings/:\n1. Semantic Search: Find similar rules without exact matches\n2. Local-First: No cloud dependency for search\n3. Future-Proof: Enables natural language queries\n4. Privacy: Embeddings stay on user's machine\n\n### Why cost/:\n1. Budget Tracking: Know how much LLM usage costs\n2. Provider Comparison: See which provider is most cost-effective\n3. Monthly Reports: Track spending trends\n4. Transparency: Users see exactly what they're paying\n\n## Acceptance Criteria\n\n- ~/.cass-memory/ directory is created on cass-memory init\n- All subdirectories created (diary, reflections, embeddings, cost)\n- config.json has sensible defaults if not present\n- playbook.yaml created with empty bullets array\n- toxic_bullets.log created (empty file)\n- usage.jsonl created (empty file)\n- Permissions set correctly (user read/write only for config.json)\n- Directory creation is idempotent (safe to run multiple times)\n- Helper functions in utils.ts: resolveGlobalDir(), ensureGlobalStructure()\n- cass-memory doctor verifies directory structure\n\n## How This Serves the Universal Agent Memory System\n\nThe ~/.cass-memory/ directory is the user's personal memory layer:\n\n1. Persistence: Memory survives across projects, jobs, and machines\n2. Privacy: Personal diary and usage data never leaves user's machine\n3. Portability: Backup entire memory with one directory\n4. Cross-Project Learning: Rules learned in project A apply to project B\n5. User Control: Users own and curate their memory\n6. Multi-Agent Support: Future agents can read from same memory store\n\nThis global directory is the foundation for the universal agent memory vision. Without it, agents would be memoryless, relearning the same patterns in every project.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:47:22.033613-05:00","updated_at":"2025-12-07T20:22:21.014093-05:00","closed_at":"2025-12-07T20:21:38.00747-05:00"}
{"id":"cass_memory_system-1sp","title":"[Curator] handleMergeDelta - Combine similar bullets","description":"Combine multiple similar bullets into a single consolidated rule.\n\nSignature:\nfunction handleMergeDelta(\n  playbook: Playbook,\n  delta: MergeDelta\n): { applied: boolean; newBulletId?: string }\n\nProcess:\n1. Find all bullets by delta.bulletIds\n   - If any not found: return applied: false\n2. Aggregate feedback from all bullets:\n   - Concatenate helpfulEvents arrays\n   - Concatenate harmfulEvents arrays\n   - Sum helpfulCount\n   - Sum harmfulCount\n3. Create new merged bullet:\n   - content: delta.mergedContent\n   - category: inherit from highest-maturity source\n   - kind: inherit from highest-maturity source\n   - maturity: max(source maturities)\n   - state: 'active'\n   - helpfulCount: aggregated total\n   - harmfulCount: aggregated total\n   - helpfulEvents: aggregated array\n   - harmfulEvents: aggregated array\n   - createdAt: earliest of source bullets\n   - updatedAt: current timestamp\n4. Deprecate all source bullets:\n   - For each source: handleDeprecateDelta\n   - Set deprecationReason: 'merged'\n   - Set replacedBy: new bullet ID\n5. Return applied: true, newBulletId\n\nWhy merge?\n- Consolidate duplicate rules with slightly different wording\n- Combine partial rules into comprehensive guidance\n- Reduce playbook bloat\n\nFeedback aggregation preserves trust earned across all sources.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:45:02.189871-05:00","updated_at":"2025-12-07T21:14:16.235142-05:00","closed_at":"2025-12-07T21:14:08.889784-05:00"}
{"id":"cass_memory_system-1v63","title":"[Tracking] Usage analytics tracking","description":"Purpose: Track usage patterns for internal analytics and debugging\n\nFile path: ~/.cass-memory/usage.jsonl\n\nFormat: JSON Lines (one JSON object per line)\n\nExample entries:\n```jsonl\n{\"timestamp\":\"2025-12-07T10:30:00Z\",\"event\":\"bullet_marked\",\"data\":{\"bulletId\":\"rule-123\",\"feedback\":\"helpful\"}}\n{\"timestamp\":\"2025-12-07T10:35:00Z\",\"event\":\"command_run\",\"data\":{\"command\":\"reflect\",\"scope\":\"workspace\",\"duration_ms\":2340}}\n{\"timestamp\":\"2025-12-07T11:00:00Z\",\"event\":\"session_count\",\"data\":{\"provider\":\"claude\",\"count\":15}}\n{\"timestamp\":\"2025-12-07T11:30:00Z\",\"event\":\"bullet_marked\",\"data\":{\"bulletId\":\"rule-456\",\"feedback\":\"harmful\"}}\n```\n\nTracked events:\n- bullet_marked: User feedback on playbook bullets (helpful/harmful)\n- command_run: Which commands executed and performance\n- session_count: Number of sessions discovered per provider\n- reflection_stats: Deltas proposed vs applied\n\nAnalytics use cases:\n- Which bullets are most helpful/harmful\n- Command usage patterns\n- System performance over time\n- Reflection effectiveness\n\nPrivacy: All local, never transmitted","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:20.699623-05:00","updated_at":"2025-12-08T00:42:29.205163-05:00","closed_at":"2025-12-08T00:42:29.205163-05:00"}
{"id":"cass_memory_system-1vb","title":"[Foundation] .gitignore for Bun/TypeScript project","description":"Create .gitignore file with comprehensive ignore patterns for Bun, TypeScript, and CASS Memory System artifacts.\n\n## Context\nThe .gitignore file prevents committing build artifacts, dependencies, secrets, and temporary files to version control. This is critical for security, repository cleanliness, and avoiding merge conflicts.\n\n## Technical Specification\n\n### Ignore Patterns:\n\n#### Dependencies:\nnode_modules/\n.pnp.*\n.yarn/\n\n#### Build Output:\ndist/\nbuild/\n*.js (in src/ - TypeScript source only)\n*.d.ts\n*.tsbuildinfo\n\n#### Environment \u0026 Secrets:\n.env\n.env.local\n.env.*.local\nconfig.json (if it contains API keys)\n*.key\n*.pem\n*.p12\n\n#### Logs:\n*.log\nnpm-debug.log*\nyarn-debug.log*\nyarn-error.log*\nlerna-debug.log*\npnpm-debug.log*\n\n#### Testing:\ncoverage/\n.nyc_output/\n*.lcov\n\n#### IDE \u0026 OS:\n.DS_Store\n.DS_Store?\n._*\n.Spotlight-V100\n.Trashes\nehthumbs.db\nThumbs.db\n.vscode/\n.idea/\n*.swp\n*.swo\n*~\n\n#### Bun Specific:\nbun.lockb (optional - some teams commit this)\n\n#### CASS Memory System Specific:\n.cass/config.yaml (may contain local overrides with secrets)\n.cass/toxic.log (project-specific, should be committed)\ndiary/*.md (personal diary entries - never commit)\nusage.jsonl (personal usage data)\n\n## Reasoning\n\n### Why Ignore node_modules:\n1. Size: Can be hundreds of MB\n2. Reproducibility: package.json and lock file are sufficient\n3. Platform-specific: Some packages compile binaries per OS\n\n### Why Ignore dist/:\n1. Build Artifacts: Generated from source, not source itself\n2. Reproducibility: bun run build recreates it\n3. Binary Size: Compiled binaries are large\n\n### Why Ignore .env:\n1. Security: Contains API keys and secrets\n2. Local Config: Each developer has their own keys\n3. Production Safety: Prevents accidental secret commits\n\n### Why Ignore Logs:\n1. Noise: Logs change frequently\n2. Size: Can grow large quickly\n3. Local: Each developer has their own logs\n\n### Why Ignore IDE Files:\n1. Personal Preference: Each dev uses different editors\n2. Settings Drift: IDE settings are personal\n3. Repository Cleanliness: Not relevant to project\n\n### Why NOT Ignore .cass/playbook.yaml:\n1. Memory as Code: Playbook is part of the project\n2. Team Sharing: All devs should see project-specific rules\n3. Version Control: Track changes to team knowledge\n\n### Why NOT Ignore .cass/toxic.log:\n1. Shared Blocklist: Team should share blocked patterns\n2. Safety: Prevents toxic rules from spreading\n\n## Acceptance Criteria\n\n- .gitignore exists in project root\n- All standard patterns included (node_modules, dist, .env, logs)\n- OS-specific patterns included (.DS_Store, Thumbs.db)\n- IDE patterns included (.vscode, .idea, *.swp)\n- Bun patterns included if needed\n- CASS-specific patterns included\n- Comments explain each section\n- git status shows only relevant files after build\n- Secrets are never tracked (test with dummy .env)\n\n## How This Serves the Universal Agent Memory System\n\nThe .gitignore file protects the integrity and security of the CASS Memory System:\n\n1. Security: Prevents accidental API key commits that could leak to LLM providers\n2. Collaboration: Keeps repository clean for team members\n3. CI/CD: Ensures builds are reproducible without committed artifacts\n4. Privacy: Keeps personal diary entries and usage data local\n5. Memory as Code: Ensures playbooks are committed while secrets are not\n\nWithout proper .gitignore, the repository would be polluted with build artifacts, secrets would be at risk of exposure, and team collaboration would suffer from constant merge conflicts in generated files.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:46:41.595261-05:00","updated_at":"2025-12-07T20:15:52.186125-05:00","closed_at":"2025-12-07T20:15:43.159247-05:00"}
{"id":"cass_memory_system-1w95","title":"[Unit] config.ts - Configuration Loading \u0026 Validation","description":"## Target: src/config.ts (163 LOC) - ZERO CURRENT COVERAGE\n\n### Functions to Test:\n\n1. **getDefaultConfig()** - Factory function\n   - Returns valid ConfigSchema object\n   - All paths are expandable\n   - Default values are sensible\n\n2. **loadConfig(path?)** - Load configuration\n   - Default path: ~/.cass-memory/config.json\n   - Custom path parameter works\n   - Missing file → default config\n   - Invalid JSON → graceful error\n   - Partial config → merged with defaults\n   - Environment variable overrides\n\n3. **saveConfig(config, path?)** - Save configuration\n   - Writes valid JSON\n   - Creates parent directories\n   - Atomic write\n   - Preserves unknown fields (forward compat)\n\n4. **validateConfig(config)** - Validation\n   - Valid config passes\n   - Missing required fields fail\n   - Invalid types fail\n   - Path validation (existence, permissions)\n\n5. **expandConfigPaths(config)** - Path expansion\n   - ~ expanded to home directory\n   - Environment variables expanded\n   - Relative paths resolved\n   - Cross-platform handling\n\n6. **mergeConfigs(base, override)** - Config merging\n   - Override wins on conflicts\n   - Deep merge for nested objects\n   - Arrays replaced, not merged\n\n### Environment Variables:\n- CASS_MEMORY_CONFIG_PATH\n- CASS_PATH override\n- HOME / USERPROFILE handling\n\n### Test Patterns:\n- Use real temp directories\n- Modify env vars in test (restore after)\n- Test permission scenarios where possible","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:27:52.193388-05:00","updated_at":"2025-12-08T14:16:37.968105-05:00","closed_at":"2025-12-08T14:16:37.968105-05:00","dependencies":[{"issue_id":"cass_memory_system-1w95","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:15.804711-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-1w95","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:32:59.424308-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-25k","title":"[Utils] daysSince - Days elapsed since timestamp","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:45:12.01385-05:00","updated_at":"2025-12-07T20:17:10.462473-05:00","closed_at":"2025-12-07T20:17:07.048635-05:00","comments":[{"id":1,"issue_id":"cass_memory_system-25k","author":"jemanuel","text":"## Function Signature\n```typescript\nfunction daysSince(isoDate: string): number\nfunction daysSince(timestamp: number): number\n```\n\n## Implementation Details\n- Overloaded function accepting ISO string or timestamp\n- If string, parse to Date, get timestamp via getTime()\n- Calculate (Date.now() - timestamp) in milliseconds\n- Convert to days: ms / (1000 * 60 * 60 * 24)\n- Return as number (can be fractional)\n\n## Why This Matters\nCritical for confidence decay calculation. Used to determine how old a bullet is for scoring. Fractional days allow fine-grained decay (e.g., 1.5 days old).\n\n## Edge Cases to Handle\n- Future dates - returns negative number\n- Invalid ISO string - throw error\n- Zero timestamp - returns large positive number\n- Very old dates - returns very large number\n- Same timestamp - returns 0","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-27y","title":"[Playbook] pinBullet/unpinBullet - Protect bullet from auto-prune","description":"## Function Signature\n```typescript\nfunction pinBullet(playbook: Playbook, bulletId: string, reason: string): void\nfunction unpinBullet(playbook: Playbook, bulletId: string): void\n```\n\n## Purpose\nProtect critical bullets from auto-pruning. Pinned bullets are NEVER automatically deprecated, even if they accumulate harmful feedback.\n\n## Pin Implementation\n```typescript\nconst bullet = findBullet(playbook, bulletId);\nif (!bullet) throw new Error(`Bullet not found: ${bulletId}`);\n\nbullet.pinned = true;\nbullet.pinnedReason = reason;\nbullet.updatedAt = now();\n```\n\n## Unpin Implementation\n```typescript\nconst bullet = findBullet(playbook, bulletId);\nif (!bullet) throw new Error(`Bullet not found: ${bulletId}`);\n\nbullet.pinned = false;\nbullet.pinnedReason = undefined;\nbullet.updatedAt = now();\n```\n\n## Why Pin Bullets?\n1. **Critical organizational rules**: Never prune core principles\n2. **Regulatory requirements**: Legal/compliance rules must stay\n3. **Prevent accidental removal**: Protect proven valuable rules\n4. **Override auto-prune**: Keep despite negative feedback\n\n## Common Pin Reasons\n- \"Core organizational principle\"\n- \"Regulatory compliance requirement\"\n- \"Explicitly requested by team lead\"\n- \"Historical knowledge - must preserve\"\n- \"Critical security guideline\"\n\n## Auto-Prune Protection\n```typescript\nfunction shouldPrune(bullet: PlaybookBullet): boolean {\n  if (bullet.pinned) return false;  // NEVER prune pinned\n  \n  // Check harmful threshold, etc...\n}\n```\n\n## Pin vs High Priority\n- **Pinned**: Never auto-pruned, preserved indefinitely\n- **High maturity**: Can still be pruned if harmful\n- **Both**: Pinned overrides all auto-prune logic\n\n## Usage Scenarios\n1. **Manual pin**: User runs `cm pin {bulletId} --reason=\"...\"`\n2. **Migration**: Pin critical rules during schema upgrades\n3. **Organizational policy**: Pin company-wide standards\n4. **Recovery**: Pin after accidental auto-prune\n\n## Implementation Notes\n- Check pinned status BEFORE any auto-prune logic\n- Store reason for audit trail\n- Allow unpinning when no longer needed\n- Show pinned status in stats/list commands\n\n## Dependencies\n- findBullet()\n\n## Related Functions\n- autoPrune() - checks pinned status\n- getActiveBullets() - includes pinned bullets\n- deprecateBullet() - manual deprecation still works","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:09.305217-05:00","updated_at":"2025-12-07T20:09:09.473109-05:00","closed_at":"2025-12-07T20:08:10.011741-05:00"}
{"id":"cass_memory_system-2bnu","title":"[Analysis] Document Agent Ergonomics Requirements","description":"# Document Agent Ergonomics Requirements\n\n## Purpose\nBefore making changes, we need to formally document what makes a tool ergonomic for AI agents. This becomes the design spec that guides all other work.\n\n## Key Questions to Answer\n\n1. **Context Window Economics**\n   - How much context budget can agents afford for memory retrieval?\n   - What's the sweet spot for context output size? (100 tokens? 500? 1000?)\n   - How should output scale with task complexity?\n\n2. **Command Frequency Analysis**\n   - Which commands do agents actually need to call?\n   - Which should be automated/hooks?\n   - Which are human-only operations?\n\n3. **Feedback Mechanisms**\n   - What's the lowest-friction way for agents to mark rules helpful/harmful?\n   - Can we parse structured comments from session logs?\n   - Should feedback be explicit commands or implicit signals?\n\n4. **Output Format Requirements**\n   - JSON structure for LLM consumption\n   - Essential vs optional fields\n   - Error message format for agent recovery\n\n## Deliverables\n- [ ] Written requirements doc (can be in this bead's comments or separate file)\n- [ ] Command categorization: Essential / Occasional / Automated / Human-only\n- [ ] Recommended output size targets\n- [ ] Feedback mechanism design\n\n## Considerations\n- Look at how other agent tools handle this (cass, beads/bv)\n- Consider different agent capabilities (context size, tool calling, etc.)\n- Balance between \"power user\" features and \"just works\" simplicity","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T12:45:55.220435-05:00","updated_at":"2025-12-08T13:13:27.93761-05:00","closed_at":"2025-12-08T13:13:27.93761-05:00"}
{"id":"cass_memory_system-2cb3","title":"[E2E Tests] Toxic bullet blocking - semantic similarity filtering","description":"## E2E Test: Toxic Bullet Blocking - Semantic Similarity Filtering\n\n### Test Scenario\nTest that toxic/blocked bullets prevent similar content from surfacing\n\n### Test Steps\n\n#### 1. Exact Match Blocking\n- Add 'Never use eval()' to toxic list\n- Generate context that would include eval\n- Verify eval-related bullets filtered out\n\n#### 2. Semantic Similarity Blocking\n- Toxic: 'Avoid using any type'\n- Attempt to add: 'Use any for flexibility'\n- Verify semantically similar blocked\n- Test similarity threshold\n\n#### 3. Partial Match Handling\n- Toxic: 'console.log'\n- Bullet: 'Use console.log for debugging'\n- Verify blocked (contains toxic term)\n\n#### 4. Non-Blocking Similar\n- Toxic: 'Never use var'\n- Bullet: 'Use const/let instead of var'\n- Verify NOT blocked (different intent)\n\n#### 5. Context Generation Filtering\n- Playbook with mixed bullets (some toxic-similar)\n- Generate context\n- Verify toxic-similar filtered from output\n- Log which bullets were filtered\n\n### Verbose Logging\n- Log: 'Checking bullet against toxic list...'\n- Log: 'Toxic check: \u003cbullet snippet\u003e'\n- Log: 'Similarity to toxic \"X\": Y%'\n- Log: 'BLOCKED: similarity Y% exceeds threshold Z%'\n- Log: 'PASSED: no toxic similarity'\n\n### Threshold Configuration\n- Test default threshold (80%?)\n- Test custom threshold via config\n- Verify threshold respected","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:24:56.790085-05:00","updated_at":"2025-12-08T00:53:29.432509-05:00","closed_at":"2025-12-08T00:53:29.432509-05:00","dependencies":[{"issue_id":"cass_memory_system-2cb3","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2025-12-07T20:31:26.823403-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-2cb3","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2025-12-07T20:31:26.981536-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-2cb3","depends_on_id":"cass_memory_system-33w3","type":"blocks","created_at":"2025-12-07T20:31:28.83949-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-2ejl","title":"[Unit] playbook.ts - Merging \u0026 Advanced Operations (Part 2)","description":"## Target: src/playbook.ts (697 LOC) - Part 2\n\n### Part 2: Merging \u0026 Advanced Operations\n\n1. **mergePlaybooks(global, repo)** - Merge global and repo playbooks\n   - Repo bullets override global by ID\n   - Non-conflicting bullets combined\n   - Metadata merged appropriately\n   - Empty playbooks handled\n   - Order preservation\n\n2. **findBulletById(playbook, id)** - Find bullet\n   - Returns bullet if found\n   - Returns null/undefined if not found\n   - Case sensitivity rules\n\n3. **findBulletsByScope(playbook, scope)** - Filter by scope\n   - Exact scope match\n   - Wildcard matching\n   - Global scope returns all\n   - Empty results valid\n\n4. **findBulletsByTag(playbook, tag)** - Filter by tag\n   - Single tag match\n   - Multiple tags (AND vs OR)\n   - Case sensitivity\n   - Empty tags handling\n\n5. **pinBullet(playbook, id)** / **unpinBullet(playbook, id)**\n   - Sets pinned: true/false\n   - Returns updated playbook\n   - Idempotent operations\n\n6. **pruneBullets(playbook, options)** - Auto-prune\n   - Remove bullets below score threshold\n   - Keep pinned bullets regardless\n   - Respect maxAge option\n   - Return count of pruned\n\n7. **exportToMarkdown(playbook)** - Markdown export\n   - Valid markdown output\n   - Preserves structure\n   - Handles special characters\n   - Code blocks escaped properly\n\n### Merge Conflict Scenarios:\n- Same ID, different content\n- Same ID, different feedbackEvents\n- Timestamps for conflict resolution\n- Priority overrides","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:27:50.693282-05:00","updated_at":"2025-12-08T14:22:22.768831-05:00","closed_at":"2025-12-08T14:22:22.768831-05:00","dependencies":[{"issue_id":"cass_memory_system-2ejl","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:15.643756-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-2ejl","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:32:59.281184-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-2ejl","depends_on_id":"cass_memory_system-5oro","type":"blocks","created_at":"2025-12-07T20:33:18.135899-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-2hi3","title":"[MCP:Future] MCP request handler implementation","description":"Implement MCP request handler:\n\n```typescript\nserver.setRequestHandler(\"tools/call\", async (request) =\u003e {\n  switch (request.params.name) {\n    case \"memory_context\":\n      return getContext(request.params.arguments);\n    case \"memory_mark\":\n      return markBullet(request.params.arguments);\n    case \"memory_search\":\n      return searchMemory(request.params.arguments);\n    case \"memory_reflect\":\n      return triggerReflect(request.params.arguments);\n    default:\n      throw new Error(\\`Unknown tool: ${request.params.name}\\`);\n  }\n});\n```\n\nRoutes tool calls to appropriate handler functions.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:49:33.289055-05:00","updated_at":"2025-12-07T21:49:40.720707-05:00","closed_at":"2025-12-07T21:49:35.291689-05:00"}
{"id":"cass_memory_system-2ki2","title":"[Testing] Add pure unit tests: playbook + scoring + types schemas","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:29:40.505494-05:00","updated_at":"2025-12-07T21:53:28.276003-05:00","closed_at":"2025-12-07T21:51:06.593107-05:00","dependencies":[{"issue_id":"cass_memory_system-2ki2","depends_on_id":"cass_memory_system-f63a","type":"blocks","created_at":"2025-12-07T20:29:40.508404-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-2lit","title":"[Impl] Create AGENTS.md Blurb File","description":"# Create AGENTS.md Blurb File\n\n## Purpose\nCreate the ready-to-paste blurb for AGENTS.md files. This is what humans copy into their project's AGENTS.md to teach agents about cass-memory.\n\n## Requirements (Consolidated from design task)\n1. **Self-contained**: Agent understands everything from just this blurb\n2. **Minimal**: 40-50 lines max\n3. **Actionable**: Clear protocol, working examples\n4. **Copy-paste ready**: No customization needed\n\n## Blurb Structure (Target: ~45 lines)\n\n\\`\\`\\`markdown\n## cass-memory — Persistent Memory for AI Coding Agents\n\n**What it does**: [1-2 sentences about cross-session memory]\n\n### Protocol\nSTART: cm context \\\"\u003ctask\u003e\\\" --json   ← Before non-trivial work\nWORK:  Reference rule IDs when following guidance\nEND:   Session auto-processed for learnings\n\n### Essential Commands\n\n# Get relevant rules for your task\ncm context \\\"fix authentication bug\\\" --json\n\n# Provide feedback on rules\ncm mark b-xyz123 helpful --reason \\\"prevented caching bug\\\"\ncm mark b-abc456 harmful --reason \\\"didn't apply here\\\"\n\n# Or inline in your output (auto-parsed):\n// [cass: helpful b-xyz123] this prevented a bug\n\n### Output Format\n{\n  \\\"rules\\\": [{\\\"id\\\": \\\"b-xxx\\\", \\\"content\\\": \\\"...\\\", \\\"score\\\": 8.5}],\n  \\\"antiPatterns\\\": [{\\\"id\\\": \\\"b-yyy\\\", \\\"content\\\": \\\"AVOID: ...\\\"}]\n}\n\n### More Info\ncm quickstart    # Full usage guide\ncm doctor --json # Health check\n\nExit 0 = success, stdout = JSON data\n\\`\\`\\`\n\n## Deliverables\n- [ ] AGENTS_BLURB.md file in repo root\n- [ ] Under 50 lines\n- [ ] All examples use --json\n- [ ] Test: agent can use system with ONLY this blurb\n\n## NO DEPENDENCIES\nThis task has no blockers. Just create the blurb based on requirements above.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T12:47:08.36708-05:00","updated_at":"2025-12-08T13:18:23.712665-05:00","closed_at":"2025-12-08T13:18:23.712665-05:00","dependencies":[{"issue_id":"cass_memory_system-2lit","depends_on_id":"cass_memory_system-8okk","type":"blocks","created_at":"2025-12-08T12:48:46.339672-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-2mbz","title":"E2E test: 'cass mark' command","description":"E2E test for 'cass mark' CLI command:\n- Real subprocess execution via bun\n- Test marking bullets helpful/harmful\n- Test with bullet IDs and fuzzy matching\n- Verify playbook.yaml is updated correctly\n- Verify feedback events are recorded\n- Test error cases: invalid bullet ID, already marked\n- Detailed logging: command invoked, playbook before/after diff\nSetup: fixture directory with playbook.yaml containing test bullets","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:27:12.877185-05:00","updated_at":"2025-12-08T14:04:05.814035-05:00","closed_at":"2025-12-08T14:04:05.814035-05:00","dependencies":[{"issue_id":"cass_memory_system-2mbz","depends_on_id":"cass_memory_system-8dxr","type":"blocks","created_at":"2025-12-07T20:28:33.210405-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-2nl","title":"[Playbook] exportToMarkdown - Generate AGENTS.md format","description":"## Function Signature\n```typescript\nfunction exportToMarkdown(\n  playbook: Playbook,\n  options: {\n    topN?: number;\n    showCounts?: boolean;\n    includeAntiPatterns?: boolean;\n  }\n): string\n```\n\n## Purpose\nGenerate AGENTS.md format markdown from playbook. Used by project command to create human-readable rule documentation.\n\n## Output Format\n```markdown\n## Agent Playbook (auto-generated from cass-memory)\n\nLast updated: 2025-01-15T10:30:00Z\nTotal rules: 47 (15 proven, 20 established, 12 candidate)\n\n### Testing (12 rules)\n1. [15× helpful] For React hooks, test effects separately with act()\n2. [8× helpful] Run all tests before committing to main branch\n3. [5× helpful] Use data-testid for component selection in tests\n\n### Security (8 rules)\n1. [12× helpful] Always validate user input before database queries\n2. [10× helpful] Never log sensitive data like passwords or API keys\n\n### PITFALLS TO AVOID\n- AVOID: Caching auth tokens without expiry check\n- AVOID: Using eval() on user-provided strings\n```\n\n## Algorithm\n1. Get active bullets with getActiveBullets()\n2. Group bullets by category\n3. For each category:\n   - Sort by effective score (descending)\n   - Take top N if specified\n   - Format as numbered list\n4. If includeAntiPatterns:\n   - Filter for isNegative bullets\n   - Format as PITFALLS section\n\n## Options\n- **topN**: Limit rules per category (default: all)\n- **showCounts**: Display helpful count (default: true)\n- **includeAntiPatterns**: Add PITFALLS section (default: true)\n\n## Formatting Rules\n- Category headers: ### {Category} ({count} rules)\n- Bullet format: {index}. [{count}× helpful] {content}\n- Anti-pattern format: - AVOID: {content}\n- Sections separated by blank lines\n\n## Header Metadata\nInclude playbook summary:\n- Last updated timestamp\n- Total rule count\n- Breakdown by maturity level\n- Helpful/harmful statistics\n\n## Implementation Notes\n- Sort categories alphabetically\n- Skip categories with 0 active rules\n- Use effective score for ranking\n- Truncate long rule text if needed\n- Add generation timestamp\n\n## Usage Scenarios\n1. **Project initialization**: Generate AGENTS.md\n2. **Documentation**: Export for team review\n3. **CI/CD**: Auto-update project docs\n4. **Onboarding**: Give new team members context\n\n## Dependencies\n- getActiveBullets()\n- getBulletsByCategory()\n- calculateEffectiveScore()\n\n## Related Functions\n- savePlaybook() - writes YAML format\n- loadPlaybook() - reads YAML format\n- getActiveBullets() - filters bullets for export","status":"closed","priority":0,"issue_type":"task","assignee":"ChartreuseSnow","created_at":"2025-12-07T16:45:13.166206-05:00","updated_at":"2025-12-07T20:09:13.793817-05:00","closed_at":"2025-12-07T20:09:12.923531-05:00"}
{"id":"cass_memory_system-2t1","title":"[Diary] computeDiaryStats - Summary statistics","description":"Compute summary statistics across diary entries for stats command.\n\nFunction Signature:\nfunction computeDiaryStats(diaries: DiaryEntry[]): {\n  total: number;\n  byStatus: Record\u003cstring, number\u003e;\n  byAgent: Record\u003cstring, number\u003e;\n  avgChallenges: number;\n  avgLearnings: number;\n  topTags: Array\u003c{tag: string; count: number}\u003e;\n  successRate: number;\n}\n\nStatistics Computed:\n1. total: Total number of diaries\n2. byStatus: Count grouped by status (success/failure/mixed)\n3. byAgent: Count grouped by agent (claude/cursor/codex/aider)\n4. avgChallenges: Average challenges per diary\n5. avgLearnings: Average key learnings per diary\n6. topTags: Most frequent tags across all diaries (top 10)\n7. successRate: Percentage with status='success'\n\nAlgorithm:\n- Single pass through diary array\n- Accumulate counts and sums\n- Compute averages and percentages\n- Sort tags by frequency for top 10\n\nKey Metrics:\n- Success rate indicates session quality\n- Avg challenges shows debugging intensity\n- Avg learnings measures knowledge extraction\n- Top tags reveal work focus areas\n- Agent distribution shows tool usage patterns\n\nDisplay Format (stats command):\n\n\nOutput:\nReturns statistics object with all computed metrics.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:46:54.342399-05:00","updated_at":"2025-12-07T19:59:13.155772-05:00","closed_at":"2025-12-07T19:58:25.58557-05:00"}
{"id":"cass_memory_system-2wg","title":"[Types] PlaybookBullet Schema Part 3 - State and Maturity Lifecycle","description":"## Overview\nDefine lifecycle state and maturity tracking for PlaybookBullet. TWO orthogonal dimensions: STATE (lifecycle phase) and MATURITY (progressive trust).\n\n## STATE: Simplified Lifecycle (3 States)\n\n### state: 'draft' | 'active' | 'retired'\n\n#### draft\n- Definition: Newly proposed, not yet proven\n- Source: Output from reflector with low confidence / Manual addition before validation / Evidence-gated validation suggesting 'draft' state\n- Behavior: NOT included in context by default / Can be manually promoted to 'active' after review / Requires user approval or validation to activate\n- Display: Shown in separate 'Draft Rules' section\n- Example: 'Consider using Zod for validation' (only 1 supporting session)\n\n#### active\n- Definition: Validated and in production use\n- Source: Passed scientific validation / Manually activated after review / Promoted from draft after confidence threshold\n- Behavior: Included in context hydration (subject to relevance ranking) / Participates in feedback loop / Subject to confidence decay\n- Display: Main playbook sections\n- Example: 'Use TokenValidator for JWT checks' (5+ successful sessions)\n\n#### retired\n- Definition: Deprecated, superseded, or invalidated\n- Source: Exceeded harmful threshold / Manually deprecated / Auto-pruned by system / Replaced by better rule\n- Behavior: EXCLUDED from context / Kept for historical analysis / Cannot receive new feedback\n- Display: Hidden by default, available in archive\n- Example: 'Use class components' (outdated after hooks migration)\n\n## MATURITY: Progressive Trust Within 'active' State (4 Levels)\n\n### maturity: 'candidate' | 'established' | 'proven' | 'deprecated'\n\n#### candidate\n- Definition: New active rule still proving itself\n- Criteria: 0-2 helpful marks, active state\n- Confidence: LOW - use with caution\n- Behavior: Included in context but ranked lower / Higher scrutiny in validation / Susceptible to quick retirement if harmful\n- Promotion: Becomes 'established' at 3 helpful marks\n- Example: 'Use Zod schemas for API validation' (1 helpful, 0 harmful)\n\n#### established\n- Definition: Solid track record, reliable guidance\n- Criteria: 3+ helpful marks / Helpful:harmful ratio \u003e 5:1 / Active state\n- Confidence: MEDIUM-HIGH\n- Behavior: Normal context inclusion / Standard decay rates / Trusted for most situations\n- Promotion: Becomes 'proven' at 5+ helpful marks with strong ratio\n- Example: 'Use vitest for unit tests' (7 helpful, 1 harmful)\n\n#### proven\n- Definition: Battle-tested, high-confidence guidance\n- Criteria: 5+ helpful marks / Helpful:harmful ratio \u003e 10:1 OR 10+ helpful with ratio \u003e 5:1 / Active state\n- Confidence: VERY HIGH\n- Behavior: Highest priority in context ranking / Slower decay rate (extended half-life) / Strong resistance to retirement / Candidate for pinning\n- Example: 'Run tests before committing' (15 helpful, 0 harmful)\n\n#### deprecated\n- Definition: RETIRED state synonym for backward compatibility\n- Mapping: maturity === 'deprecated' implies state === 'retired'\n- Usage: Legacy field, prefer checking state instead\n\n## Promotion Tracking\n\n### promotedAt: string | undefined\n- Purpose: Timestamp when rule was promoted from candidate to established\n- Format: ISO 8601 (e.g., '2025-12-07T14:30:00Z')\n- Usage: Calculate time in established/proven state / Analyze promotion velocity / Audit trail for rule evolution\n- Set: When maturity transitions from 'candidate' to 'established'\n\n## State vs Maturity Matrix\n\nState | Maturity | Context? | Meaning\ndraft | N/A | No | Awaiting validation\nactive | candidate | Yes (low priority) | New, unproven\nactive | established | Yes (normal) | Solid, reliable\nactive | proven | Yes (high priority) | Battle-tested\nretired | deprecated | No | No longer valid\n\n## Automatic Transitions\n\nState Transitions:\n- draft -\u003e active: Pass validation OR manual promotion\n- active -\u003e retired: Exceed harmful threshold OR manual deprecation\n- retired -\u003e active: Manual resurrection (rare)\n\nMaturity Transitions (within active state):\n- candidate -\u003e established: Reach 3 helpful marks with good ratio\n- established -\u003e proven: Reach 5 helpful marks with excellent ratio\n- * -\u003e deprecated: State transitions to retired\n\n## Examples\n\nNew Draft Rule: { state: 'draft', maturity: 'candidate', promotedAt: undefined }\n\nActive Candidate: { state: 'active', maturity: 'candidate', promotedAt: undefined, helpfulCount: 1, harmfulCount: 0 }\n\nEstablished Rule: { state: 'active', maturity: 'established', promotedAt: '2025-11-15T10:00:00Z', helpfulCount: 5, harmfulCount: 1 }\n\nProven Rule: { state: 'active', maturity: 'proven', promotedAt: '2025-10-01T08:00:00Z', helpfulCount: 12, harmfulCount: 0 }\n\nRetired Rule: { state: 'retired', maturity: 'deprecated', retiredAt: '2025-12-01T12:00:00Z', helpfulCount: 2, harmfulCount: 5, retirementReason: 'Exceeded harmful threshold' }\n\n## Acceptance Criteria\n- state enum with 3 values\n- maturity enum with 4 values\n- promotedAt optional timestamp field\n- State transition logic documented\n- Maturity promotion thresholds defined\n- Examples for all state/maturity combos\n- JSDoc explaining orthogonal nature\n- Auto-transition functions implemented","notes":"Releasing - types.ts under concurrent modification by another agent working on Part 4","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:59.687575-05:00","updated_at":"2025-12-07T20:04:56.088101-05:00","closed_at":"2025-12-07T20:04:17.283026-05:00"}
{"id":"cass_memory_system-33w3","title":"[Unit Tests] playbook.ts - All playbook management functions","description":"## Unit Tests: playbook.ts - All Playbook Management Functions\n\n### Test Categories\n\n#### 1. loadPlaybook()\n- Loads valid YAML playbook files\n- Returns empty playbook for missing file\n- Parses all field types (bullets, meta, toxic)\n- Handles YAML syntax errors gracefully\n\n#### 2. savePlaybook()\n- Writes playbook to YAML format\n- Preserves all fields correctly\n- Creates parent directories\n- Atomic write (temp file + rename)\n\n#### 3. Bullet Management\n- addBullet() appends to correct section\n- removeBullet() by content match\n- updateBullet() modifies in place\n- findBullet() searches all sections\n\n#### 4. findSimilarBullet()\n- Returns null for empty playbook\n- Finds exact content matches\n- Finds semantically similar bullets\n- Respects similarity threshold\n- Returns most similar when multiple matches\n\n#### 5. isDuplicateBullet()\n- True for exact duplicates\n- True for near-duplicates above threshold\n- False for distinct content\n- Handles empty playbook\n\n#### 6. mergeBullets()\n- Combines bullets from two playbooks\n- Deduplicates based on content\n- Preserves scores from higher-confidence source\n- Merges toxic lists\n\n#### 7. exportToMarkdown()\n- Generates readable markdown\n- Includes all sections\n- Formats scores as percentages\n- Sorts by confidence descending\n\n#### 8. Scope Matching\n- matchesScope() with exact matches\n- matchesScope() with glob patterns\n- matchesScope() with workspace filters\n- getScopedBullets() filters correctly\n\n### Test Data Requirements\n- Sample playbook YAML files\n- Bullets with various confidence scores\n- Multiple scope configurations","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:23:26.671304-05:00","updated_at":"2025-12-07T21:49:40.723578-05:00","closed_at":"2025-12-07T21:49:15.753034-05:00","dependencies":[{"issue_id":"cass_memory_system-33w3","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2025-12-07T20:31:04.60793-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-33w3","depends_on_id":"cass_memory_system-p4mv","type":"blocks","created_at":"2025-12-07T20:31:04.732235-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-33w3","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2025-12-07T20:31:08.013554-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-35y","title":"[Decay] getEffectiveScore - Combined score with harmful weighting","description":"Calculate effective score with harmful events weighted 4× more than helpful, confidence decay based on recency, and maturity bonus for proven rules.\n\nCOMPLETE IMPLEMENTATION:\n```typescript\n/**\n * Calculate effective score with:\n * 1. Harmful events weighted 4× more than helpful\n * 2. Confidence decay based on recency\n * 3. Maturity bonus for proven rules\n */\nfunction getEffectiveScore(bullet: PlaybookBullet): number {\n  const HARMFUL_MULTIPLIER = 4;  // One harmful = 4× one helpful\n\n  const decayedHelpful = getDecayedScore(\n    bullet.helpfulEvents,\n    bullet.confidenceDecayHalfLifeDays\n  );\n  const decayedHarmful = getDecayedScore(\n    bullet.harmfulEvents,\n    bullet.confidenceDecayHalfLifeDays\n  );\n\n  const baseScore = decayedHelpful - (HARMFUL_MULTIPLIER * decayedHarmful);\n\n  // Maturity bonus\n  const maturityMultiplier = {\n    candidate: 0.5,\n    established: 1.0,\n    proven: 1.5,\n    deprecated: 0\n  }[bullet.maturity];\n\n  return baseScore * maturityMultiplier;\n}\n```\n\nRATIONALE:\n- HARMFUL_MULTIPLIER = 4: One mistake is more costly than one success. A rule that's helpful 4 times but harmful once is still dangerous.\n- Maturity bonus: Proven rules get 1.5× multiplier, candidates get 0.5×\n- Deprecated rules always score 0 (frozen)\n\nSCORING EXAMPLES:\n1. Rule with 8 recent helpful, 0 harmful, proven maturity:\n   - decayedHelpful ≈ 8.0, decayedHarmful = 0\n   - baseScore = 8 - 0 = 8\n   - effectiveScore = 8 × 1.5 = 12.0\n\n2. Rule with 4 helpful, 1 harmful, established maturity:\n   - baseScore = 4 - (4 × 1) = 0\n   - effectiveScore = 0 × 1.0 = 0 (neutral)\n\n3. Rule with 5 old helpful (180 days), 1 recent harmful, candidate:\n   - decayedHelpful ≈ 1.25 (5 × 0.25)\n   - decayedHarmful ≈ 1.0\n   - baseScore = 1.25 - 4 = -2.75\n   - effectiveScore = -2.75 × 0.5 = -1.375 (at risk)\n\nDEPENDENCIES:\n- Requires getDecayedScore() function\n- Requires PlaybookBullet type with:\n  - helpfulEvents: FeedbackEvent[]\n  - harmfulEvents: FeedbackEvent[]\n  - confidenceDecayHalfLifeDays: number\n  - maturity: BulletMaturity\n\nUSED BY:\n- checkForPromotion()\n- checkForDemotion()\n- analyzeScoreDistribution()\n- stats command","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:45:00.667082-05:00","updated_at":"2025-12-07T20:04:56.099739-05:00","closed_at":"2025-12-07T20:04:13.691552-05:00"}
{"id":"cass_memory_system-37p9","title":"[E2E] Learning Loop - Accumulate → Curate → Extend Cycle","description":"## Target: E2E test of full ACE learning loop\n\n### Scenario: Complete Learning Cycle\n\n```\nDay 1: Agent works, creates session\nDay 2: Session imported to diary\nDay 3: Reflect analyzes sessions\nDay 3: Suggestions become bullets\nDay 4: New context uses learned bullets\nDay 5: User marks bullets helpful/harmful\nDay 6: Curate prunes low-scoring bullets\n```\n\n### Test Script:\n\n```typescript\ndescribe('E2E: ACE Learning Loop', () =\u003e {\n  it('full cycle test', async () =\u003e {\n    // Setup\n    const env = await createTestEnvironment();\n    log('Test environment created');\n\n    // Day 1: Create mock session data\n    log('Day 1: Creating session data');\n    await createMockSession(env, {\n      patterns: ['Always handle Promise rejections', 'Use const over let'],\n      timestamp: daysAgo(5)\n    });\n    log('Session created with 2 patterns');\n\n    // Day 2: Import to diary\n    log('Day 2: Importing sessions');\n    const importResult = await runCLI(['diary', '--import', sessionPath, '--json'], { env });\n    log('Import result:', importResult.stdout);\n\n    // Day 3: Reflect\n    log('Day 3: Running reflection');\n    const reflectResult = await runCLI(['reflect', '--json'], { env });\n    log('Reflect found:', JSON.parse(reflectResult.stdout).suggestions.length, 'suggestions');\n\n    // Apply suggestions\n    log('Applying suggestions to playbook');\n    await runCLI(['playbook', '--apply-suggestions', '--json'], { env });\n\n    // Day 4: Context includes new bullets\n    log('Day 4: Testing context');\n    const context = await runCLI(['context', 'Promise error handling', '--json'], { env });\n    const bullets = JSON.parse(context.stdout).bullets;\n    log('Context returned', bullets.length, 'bullets');\n    expect(bullets.some(b =\u003e b.content.includes('Promise'))).toBe(true);\n\n    // Day 5: Feedback\n    log('Day 5: Adding feedback');\n    await runCLI(['mark', bullets[0].id, 'helpful', '--json'], { env });\n    await runCLI(['mark', bullets[1].id, 'harmful', '--json'], { env });\n    log('Marked bullets helpful/harmful');\n\n    // Day 6: Curate\n    log('Day 6: Running curation');\n    const curateResult = await runCLI(['curate', '--json'], { env });\n    log('Curation result:', curateResult.stdout);\n\n    // Verify harmful bullet removed or deprioritized\n    const finalContext = await runCLI(['context', 'Promise', '--json'], { env });\n    log('Final context:', finalContext.stdout);\n  });\n});\n```\n\n### Detailed Logging:\n- State of playbook after each step\n- Scores at each stage\n- Decision points explained","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-07T20:31:13.904591-05:00","updated_at":"2025-12-07T20:31:13.904591-05:00","dependencies":[{"issue_id":"cass_memory_system-37p9","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:39.304511-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-37p9","depends_on_id":"cass_memory_system-zc1d","type":"blocks","created_at":"2025-12-07T20:32:39.600077-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-37p9","depends_on_id":"cass_memory_system-ke2x","type":"blocks","created_at":"2025-12-07T20:33:05.77076-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-3hrk","title":"[CLI:reflect] findUnprocessedSessions - Get sessions to process","description":"Helper function to discover unprocessed sessions for reflection.\n\nFunction signature:\n```typescript\nasync function findUnprocessedSessions(\n  processedLog: ProcessedLog,\n  options: ReflectOptions,\n  config: Config\n): Promise\u003cstring[]\u003e\n```\n\nImplementation steps:\n1. Call `cass timeline --days N --json` to get session list\n2. Parse JSON output to extract session paths\n3. Filter out already-processed sessions:\n   - Load processed.log from memory directory\n   - Check each session path against log\n4. Apply agent filter if --agent specified:\n   - Match against session metadata (claude/cursor/aider/etc)\n5. Apply maxSessions limit (default: 20)\n6. Return array of session paths to process\n\nProcessedLog format:\n```\n{sessionId}\\t{timestamp}\\t{sessionPath}\\t{deltasProposed}\\t{deltasApplied}\n```\n\nEdge cases:\n- Handle missing processed.log (first run)\n- Handle malformed session paths\n- Handle sessions without agent metadata\n- Respect timeline errors gracefully\n\nReturn value:\nArray of absolute paths to session files, e.g.:\n[\"/Users/x/.claude/sessions/session-001.jsonl\", ...]","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:49:42.684823-05:00","updated_at":"2025-12-07T21:13:03.890298-05:00","closed_at":"2025-12-07T21:12:44.994282-05:00"}
{"id":"cass_memory_system-3l7","title":"Phase 4: Polish \u0026 Integration","description":"# EPIC: Polish \u0026 Integration\n\n## Purpose\nProduction-ready release: audit capabilities, AGENTS.md export, comprehensive\nerror handling, binary compilation, and documentation.\n\n## Background \u0026 Reasoning\nFor cass-memory to be adopted by teams, it needs:\n1. Audit capabilities to verify agents follow playbook rules\n2. Easy export to AGENTS.md/CLAUDE.md formats agents already read\n3. Tombstone/deprecated pattern support for gradual deprecation\n4. Cross-platform binaries for easy distribution\n5. Comprehensive documentation and examples\n\n## Key Deliverables\n1. `cass-memory audit --days N` - Check sessions for rule violations\n2. `cass-memory project --format agents.md` - Export to agent config\n3. Deprecated patterns/tombstone mechanism\n4. Binary compilation for Linux/macOS/Windows\n5. README.md with usage examples\n6. AGENTS.md template for memory protocol\n\n## Additional Commands from Plan\n- `cass-memory top` - Show top-performing bullets\n- `cass-memory stale` - List bullets needing refresh\n- `cass-memory why \u003cid\u003e` - Explain bullet provenance\n- `cass-memory similar \u003cid\u003e` - Find related bullets\n\n## Future Enhancements (Post-MVP)\n- MCP server mode for direct agent integration\n- Team playbooks with merge/conflict resolution\n- Visualization of playbook evolution\n- Pattern detection across sessions\n- Auto-reflection hooks (post-session triggers)\n- Conflict detection between bullets\n\n## Dependencies\n- Requires Phase 3 completion (semantic search, stats)","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-07T16:16:42.78245-05:00","updated_at":"2025-12-07T16:16:42.78245-05:00","dependencies":[{"issue_id":"cass_memory_system-3l7","depends_on_id":"cass_memory_system-y8o","type":"blocks","created_at":"2025-12-07T16:25:25.759026-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-3l7.1","title":"Audit Command: cass-memory audit","description":"# Feature: Audit Command\n\n## Purpose\nCheck recent sessions for playbook rule violations. Helps identify:\n- Rules that agents are ignoring\n- Rules that may be unclear or hard to follow\n- Opportunities for training/documentation\n\n## Usage\n```bash\ncass-memory audit --days 7 --json\ncass-memory audit --session ~/.claude/sessions/abc.jsonl\ncass-memory audit --severity high\n```\n\n## Process Flow\n```\n1. Load recent sessions from cass\n2. For each session, check against playbook rules\n3. LLM identifies potential violations\n4. Classify severity and suggest improvements\n```\n\n## Implementation\n```typescript\nasync function auditCommand(flags: AuditFlags): Promise\u003cvoid\u003e {\n  const config = await loadConfig();\n  const playbook = await loadMergedPlaybook(config);\n  \n  // Get sessions to audit\n  const sessions = flags.session\n    ? [flags.session]\n    : await getRecentSessions(config.cassPath, flags.days || 7);\n  \n  const violations: AuditViolation[] = [];\n  \n  for (const sessionPath of sessions) {\n    const content = await cassExport(sessionPath, \"markdown\", config.cassPath);\n    if (!content) continue;\n    \n    // LLM audit\n    const result = await runAudit(\n      AuditOutputSchema,\n      content,\n      formatRulesForAudit(playbook.bullets.filter(b =\u003e !b.deprecated)),\n      config\n    );\n    \n    violations.push(...result.violations.map(v =\u003e ({\n      ...v,\n      sessionPath\n    })));\n  }\n  \n  // Filter by severity if requested\n  const filtered = flags.severity\n    ? violations.filter(v =\u003e v.severity === flags.severity)\n    : violations;\n  \n  output({\n    sessionsAudited: sessions.length,\n    totalViolations: filtered.length,\n    violations: filtered,\n    summary: summarizeViolations(filtered)\n  }, formatAuditResult, flags);\n}\n```\n\n## Violation Schema\n```typescript\ninterface AuditViolation {\n  bulletId: string;\n  bulletContent: string;\n  sessionPath: string;\n  evidence: string;        // Quote from session\n  severity: \"low\" | \"medium\" | \"high\";\n  suggestion?: string;     // How to improve\n}\n```\n\n## Output Example\n```\n╭─────────────────────────────────────────────────────────────╮\n│                    AUDIT RESULTS                            │\n├─────────────────────────────────────────────────────────────┤\n│ Sessions audited: 5                                         │\n│ Violations found: 3                                         │\n│                                                             │\n│ HIGH SEVERITY (1):                                          │\n│   [b-abc123] \"Always run tests before committing\"           │\n│   Session: ~/.claude/sessions/xyz.jsonl                     │\n│   Evidence: \"Committed changes without running test suite\"  │\n│                                                             │\n│ MEDIUM SEVERITY (2):                                        │\n│   [b-def456] \"Use TypeScript strict mode\"                   │\n│   Session: ~/.cursor/sessions/abc.jsonl                     │\n│   Evidence: \"Added // @ts-ignore to bypass type error\"      │\n╰─────────────────────────────────────────────────────────────╯\n```","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-07T16:25:08.126872-05:00","updated_at":"2025-12-07T20:34:28.846535-05:00","closed_at":"2025-12-07T20:34:13.67535-05:00","dependencies":[{"issue_id":"cass_memory_system-3l7.1","depends_on_id":"cass_memory_system-3l7","type":"parent-child","created_at":"2025-12-07T16:25:08.128675-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-3l7.1","depends_on_id":"cass_memory_system-5eh.9","type":"blocks","created_at":"2025-12-07T16:25:25.844795-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-3l7.1","depends_on_id":"cass_memory_system-5eh.8","type":"blocks","created_at":"2025-12-07T16:25:25.932005-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-3l7.1","depends_on_id":"cass_memory_system-5eh.4","type":"blocks","created_at":"2025-12-07T16:25:26.02106-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-3l7.2","title":"Project Command: Export to AGENTS.md","description":"# Feature: Project Command (Export to AGENTS.md)\n\n## Purpose\nExport playbook to agent-readable formats (AGENTS.md, CLAUDE.md).\nThis is how accumulated knowledge gets into the agent's context.\n\n## Usage\n```bash\ncass-memory project --format agents.md --output ./AGENTS.md\ncass-memory project --format claude.md --top 30\ncass-memory project --category testing,debugging\n```\n\n## Output Formats\n\n### AGENTS.md Format\n```markdown\n## Memory System: cass-memory\n\nBefore starting complex tasks, retrieve context:\n\\`\\`\\`bash\ncass-memory context \"\u003ctask\u003e\" --json\n\\`\\`\\`\n\n### Top Rules by Category\n\n#### Testing (8 rules)\n- [b-abc123] For React hooks, test effects separately with renderHook\n- [b-def456] Mock external APIs at the service layer, not in tests\n- ...\n\n#### Debugging (5 rules)\n- [b-ghi789] Enable DEBUG=auth:* for authentication issues\n- ...\n\n### Memory Protocol\n1. PRE-FLIGHT: Run `cass-memory context` before non-trivial tasks\n2. REFERENCE: Cite bullet IDs when following rules\n3. FEEDBACK: Mark bullets helpful/harmful as you work\n```\n\n### CLAUDE.md Format (Condensed)\n```markdown\n# Project Rules (via cass-memory)\n\nTesting:\n• Test React hooks with renderHook, effects separately [b-abc123]\n• Mock APIs at service layer [b-def456]\n\nDebugging:\n• Use DEBUG=auth:* for auth issues [b-ghi789]\n```\n\n## Implementation\n```typescript\nasync function projectCommand(flags: ProjectFlags): Promise\u003cvoid\u003e {\n  const config = await loadConfig();\n  const playbook = await loadMergedPlaybook(config);\n  \n  // Filter and sort bullets\n  const bullets = playbook.bullets\n    .filter(b =\u003e !b.deprecated \u0026\u0026 b.state !== \"retired\")\n    .filter(b =\u003e !flags.category || flags.category.includes(b.category))\n    .sort((a, b) =\u003e getEffectiveScore(b, config) - getEffectiveScore(a, config))\n    .slice(0, flags.top || 50);\n  \n  // Group by category\n  const byCategory = groupBy(bullets, b =\u003e b.category);\n  \n  // Generate output\n  const content = flags.format === \"agents.md\"\n    ? generateAgentsMd(byCategory, playbook.deprecatedPatterns)\n    : generateClaudeMd(byCategory);\n  \n  if (flags.output) {\n    await writeFile(flags.output, content);\n    console.log(`Exported to ${flags.output}`);\n  } else {\n    console.log(content);\n  }\n}\n```\n\n## Category Sorting\nCategories are sorted by total effective score of their bullets,\nso the most impactful categories appear first.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-07T16:25:08.353916-05:00","updated_at":"2025-12-08T13:52:48.669736-05:00","closed_at":"2025-12-08T13:52:48.669736-05:00","dependencies":[{"issue_id":"cass_memory_system-3l7.2","depends_on_id":"cass_memory_system-3l7","type":"parent-child","created_at":"2025-12-07T16:25:08.354826-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-3l7.2","depends_on_id":"cass_memory_system-5eh.8","type":"blocks","created_at":"2025-12-07T16:25:26.102059-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-3l7.2","depends_on_id":"cass_memory_system-5eh.6","type":"blocks","created_at":"2025-12-07T16:25:26.171665-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-3l7.3","title":"Binary Compilation + Distribution","description":"# Feature: Binary Compilation + Distribution\n\n## Purpose\nCompile cass-memory to standalone binaries for easy distribution.\nUsers shouldn't need Bun installed to use the tool.\n\n## Build Targets\n- Linux x64: dist/cass-memory-linux-x64\n- macOS ARM64: dist/cass-memory-darwin-arm64\n- macOS x64: dist/cass-memory-darwin-x64\n- Windows x64: dist/cass-memory-windows-x64.exe\n\n## Build Commands\n```json\n{\n  \"scripts\": {\n    \"build\": \"bun build src/cass-memory.ts --compile --outfile dist/cass-memory\",\n    \"build:all\": \"npm run build:linux \u0026\u0026 npm run build:macos-arm \u0026\u0026 npm run build:macos-x64 \u0026\u0026 npm run build:windows\",\n    \"build:linux\": \"bun build src/cass-memory.ts --compile --target=bun-linux-x64 --outfile dist/cass-memory-linux-x64\",\n    \"build:macos-arm\": \"bun build src/cass-memory.ts --compile --target=bun-darwin-arm64 --outfile dist/cass-memory-darwin-arm64\",\n    \"build:macos-x64\": \"bun build src/cass-memory.ts --compile --target=bun-darwin-x64 --outfile dist/cass-memory-darwin-x64\",\n    \"build:windows\": \"bun build src/cass-memory.ts --compile --target=bun-windows-x64 --outfile dist/cass-memory-windows-x64.exe\"\n  }\n}\n```\n\n## Binary Size Considerations\n- Base Bun runtime: ~50MB\n- Application code: ~200KB\n- Dependencies: ~5MB (mostly AI SDK)\n- Total: ~55MB per binary\n\n## Distribution Options\n1. GitHub Releases (primary)\n2. Homebrew formula (macOS)\n3. npm/bun global install (for developers)\n\n## Installation Instructions\n```bash\n# macOS (Homebrew)\nbrew install cass-memory\n\n# Direct download\ncurl -L https://github.com/org/cass-memory/releases/latest/download/cass-memory-darwin-arm64 -o cass-memory\nchmod +x cass-memory\nsudo mv cass-memory /usr/local/bin/\n\n# npm/bun\nbun install -g cass-memory\n```","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-07T16:25:09.629265-05:00","updated_at":"2025-12-07T20:29:16.321796-05:00","closed_at":"2025-12-07T20:28:47.535625-05:00","dependencies":[{"issue_id":"cass_memory_system-3l7.3","depends_on_id":"cass_memory_system-3l7","type":"parent-child","created_at":"2025-12-07T16:25:09.630419-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-3l7.3","depends_on_id":"cass_memory_system-5eh.10","type":"blocks","created_at":"2025-12-07T16:25:26.253012-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-3l7.4","title":"Documentation: README.md + Examples","description":"# Feature: Documentation\n\n## Purpose\nComprehensive documentation for users and contributors.\n\n## Files to Create\n\n### README.md\n```markdown\n# cass-memory\n\nAgent-agnostic reflection and memory system for coding agents.\nImplements the ACE (Agentic Context Engineering) framework.\n\n## Quick Start\n\n\\`\\`\\`bash\n# Install\nbrew install cass-memory  # or download binary\n\n# Initialize\ncass-memory init\n\n# Get context before a task\ncass-memory context \"Fix authentication timeout\" --json\n\n# Mark rules as helpful/harmful\ncass-memory mark b-abc123 --helpful\ncass-memory mark b-def456 --harmful --reason \"Caused test failures\"\n\n# Run reflection on recent sessions\ncass-memory reflect --days 7\n\n# Check playbook health\ncass-memory stats\ncass-memory doctor\n\\`\\`\\`\n\n## How It Works\n\ncass-memory implements three memory layers:\n\n1. **Episodic Memory** (cass): Raw session logs from all agents\n2. **Working Memory** (Diary): Structured session summaries\n3. **Procedural Memory** (Playbook): Distilled rules with feedback tracking\n\n## Configuration\n\n\\`\\`\\`bash\n# Set your LLM provider\nexport ANTHROPIC_API_KEY=sk-ant-...\n# or\nexport OPENAI_API_KEY=sk-...\n\n# Configure\ncass-memory config --provider anthropic --model claude-sonnet-4-20250514\n\\`\\`\\`\n\n## Integration\n\nAdd to your AGENTS.md or CLAUDE.md:\n\\`\\`\\`\ncass-memory project --format agents.md \u003e\u003e AGENTS.md\n\\`\\`\\`\n\n## Commands\n\n| Command | Description |\n|---------|-------------|\n| init | Initialize configuration |\n| context | Get pre-task context |\n| diary | Generate diary from session |\n| reflect | Run reflection pipeline |\n| mark | Record feedback |\n| forget | Permanently block pattern |\n| stats | Show playbook health |\n| doctor | System health check |\n| audit | Check for violations |\n| project | Export to AGENTS.md |\n\\`\\`\\`\n\n### Examples Directory\n- examples/basic-workflow.md\n- examples/team-setup.md\n- examples/ci-integration.md\n```","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-07T16:25:10.905798-05:00","updated_at":"2025-12-07T20:44:14.836547-05:00","closed_at":"2025-12-07T20:42:52.3961-05:00","dependencies":[{"issue_id":"cass_memory_system-3l7.4","depends_on_id":"cass_memory_system-3l7","type":"parent-child","created_at":"2025-12-07T16:25:10.906922-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-3l7.4","depends_on_id":"cass_memory_system-3l7.1","type":"blocks","created_at":"2025-12-07T16:25:26.323742-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-3l7.4","depends_on_id":"cass_memory_system-3l7.2","type":"blocks","created_at":"2025-12-07T16:25:26.39861-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-3pb","title":"[Playbook] updateBulletCounter - Increment helpful/harmful count","description":"## Function Signature\n```typescript\nfunction updateBulletCounter(\n  playbook: Playbook,\n  bulletId: string,\n  type: \"helpful\" | \"harmful\"\n): void\n```\n\n## Purpose\n**DEPRECATED**: Legacy function to increment helpful/harmful counters without timestamp tracking.\n\n## Deprecation Notice\nThis function is maintained for backward compatibility only. **New code should use recordFeedbackEvent()** instead.\n\n## Why Deprecated?\n- No timestamp tracking → cannot calculate confidence decay\n- No event history → cannot analyze feedback patterns\n- No session attribution → cannot trace feedback source\n- Prevents effective confidence scoring\n\n## Implementation\n```typescript\nconst bullet = findBullet(playbook, bulletId);\nif (!bullet) return;\n\nif (type === \"helpful\") {\n  bullet.helpfulCount++;\n} else {\n  bullet.harmfulCount++;\n}\nbullet.updatedAt = now();\n```\n\n## Migration Path\nReplace:\n```typescript\nupdateBulletCounter(playbook, bulletId, \"helpful\");\n```\n\nWith:\n```typescript\nrecordFeedbackEvent(playbook, bulletId, \"helpful\", {\n  timestamp: new Date().toISOString(),\n  sessionId: currentSessionId,\n  context: \"user marked as helpful\"\n});\n```\n\n## Removal Timeline\n- **Current**: Maintained for compatibility\n- **Future**: Will be removed in schema v3\n- **Action**: Migrate all callers to recordFeedbackEvent()\n\n## Dependencies\n- findBullet()\n\n## Related Functions\n- recordFeedbackEvent() - modern replacement\n- calculateEffectiveScore() - requires events, not just counts","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:56.393319-05:00","updated_at":"2025-12-07T20:23:31.470595-05:00","closed_at":"2025-12-07T20:23:04.924032-05:00"}
{"id":"cass_memory_system-3tt","title":"[Playbook] findBullet - Find bullet by ID","description":"## Function Signature\n```typescript\nfunction findBullet(playbook: Playbook, bulletId: string): PlaybookBullet | undefined\n```\n\n## Purpose\nFind a bullet in the playbook by its unique ID. Simple lookup utility used by all mutation operations.\n\n## Implementation\n```typescript\nreturn playbook.bullets.find(b =\u003e b.id === bulletId);\n```\n\n## Return Value\n- **Found**: Returns the PlaybookBullet object\n- **Not found**: Returns undefined\n\n## Usage Scenarios\n1. Before updating bullet fields\n2. Before recording feedback events\n3. Before deprecating a bullet\n4. Before pinning/unpinning\n5. Validation that bullet exists\n\n## Implementation Notes\n- Simple array.find() operation\n- O(n) complexity - acceptable for typical playbook sizes\n- No error throwing - returns undefined for not found\n- Caller should handle undefined case\n\n## Common Pattern\n```typescript\nconst bullet = findBullet(playbook, bulletId);\nif (!bullet) {\n  throw new Error(`Bullet not found: ${bulletId}`);\n}\n// ... perform operation on bullet\n```\n\n## Dependencies\n- None (pure function)\n\n## Related Functions\n- updateBulletCounter() - uses this to find bullet\n- recordFeedbackEvent() - uses this to find bullet\n- deprecateBullet() - uses this to find bullet\n- pinBullet() - uses this to find bullet","notes":"Existing playbook helper implementations already present; no code changes made. Released reservation; feel free to take over.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:49.607871-05:00","updated_at":"2025-12-07T18:57:45.657411-05:00","closed_at":"2025-12-07T18:57:35.446769-05:00"}
{"id":"cass_memory_system-3yb","title":"[Cass] cassExpand - Get context around a line","description":"Implement cassExpand() to get context around a specific line.\n\n## Signature\n```typescript\nasync function cassExpand(\n  sessionPath: string, \n  lineNumber: number, \n  contextLines = 3,\n  cassPath = \"cass\"\n): Promise\u003cstring | null\u003e\n```\n\n## CLI Command\n`cass expand \"{sessionPath}\" -n {lineNumber} -C {contextLines} --json`\n\n## Implementation\n- Use execFile() to run expand command\n- Return expanded context as string\n- Return null on error\n\n## Error Handling\n- Return null if session not found\n- Return null if line number out of range\n- No retries (expand is deterministic)\n\n## Parameters\n- sessionPath: Full path to session file\n- lineNumber: Target line (1-indexed)\n- contextLines: Lines before/after target (default: 3)\n\n## Output\nReturns context window around target line:\n```\n35: Previous line 3\n36: Previous line 2  \n37: Previous line 1\n38: \u003e\u003e\u003e TARGET LINE \u003c\u003c\u003c\n39: Next line 1\n40: Next line 2\n41: Next line 3\n```\n\n## Usage\nUsed to get surrounding context for search hits:\n```typescript\nconst hits = await cassSearch(\"bug fix\");\nfor (const hit of hits) {\n  const context = await cassExpand(hit.sessionPath, hit.lineNumber, 5);\n  console.log(context);\n}\n```\n\n## Exit Codes\n- 0: Success\n- 4: Session or line not found","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:00.936811-05:00","updated_at":"2025-12-07T18:48:03.184794-05:00","closed_at":"2025-12-07T18:44:41.305872-05:00"}
{"id":"cass_memory_system-41k","title":"[Cass] cassCapabilities - Get cass feature support","description":"Implement cassCapabilities() to check what features cass CLI supports.\n\n## Signature\n```typescript\nasync function cassCapabilities(\n  cassPath = \"cass\"\n): Promise\u003cRecord\u003cstring, boolean\u003e\u003e\n```\n\n## CLI Command\n`cass capabilities --json`\n\n## Implementation\n- Use execFile() to run capabilities command\n- Parse JSON output\n- Return feature availability map\n- Return empty object on error (assume no features)\n\n## Error Handling\n- Return {} if command not supported (old cass version)\n- Return {} on parse error\n- Log at debug level\n\n## Output Structure\n```json\n{\n  \"search\": true,\n  \"timeline\": true,\n  \"export\": true,\n  \"expand\": true,\n  \"semantic_search\": false,\n  \"streaming\": false\n}\n```\n\n## Purpose\nVersion-dependent feature detection. Use to:\n- Gracefully degrade on older cass versions\n- Enable new features when available\n- Show appropriate error messages\n\n## Usage\n```typescript\nconst caps = await cassCapabilities();\n\nif (caps.semantic_search) {\n  // Use new semantic search API\n  await cassSemanticSearch(query);\n} else {\n  // Fallback to keyword search\n  await cassSearch(query);\n}\n\nif (!caps.timeline) {\n  console.error(\"Timeline feature requires cass \u003e= 2.0\");\n  return;\n}\n```\n\n## Exit Codes\n- 0: Success\n- 2: Command not supported (old version)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:03.681228-05:00","updated_at":"2025-12-07T18:48:03.186423-05:00","closed_at":"2025-12-07T18:45:13.342707-05:00"}
{"id":"cass_memory_system-41r","title":"[LLM] validateApiKey - Basic format validation","description":"Function signature:\nfunction validateApiKey(provider: string): void\n\nBasic format validation for API keys:\n- Check env var exists\n- Warn if format looks wrong:\n  * OpenAI keys start with 'sk-'\n  * Anthropic keys start with 'sk-ant-'\n  * Google keys have different format patterns\n\nImplementation notes:\n- Non-blocking - just warnings for potentially invalid keys\n- Does not make actual API calls to validate\n- Helps catch common mistakes like:\n  * Using wrong key for wrong provider\n  * Copying key incorrectly (missing prefix)\n  * Using placeholder/example keys\n\nWarning message example: 'Warning: OpenAI API key does not start with sk- - this may be incorrect'","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:51.033883-05:00","updated_at":"2025-12-07T18:48:03.187942-05:00","closed_at":"2025-12-07T18:45:21.490729-05:00"}
{"id":"cass_memory_system-43v","title":"[Playbook] recordFeedbackEvent - Record timestamped feedback","description":"## Function Signature\n```typescript\nfunction recordFeedbackEvent(\n  playbook: Playbook,\n  bulletId: string,\n  type: \"helpful\" | \"harmful\",\n  event: FeedbackEvent\n): void\n```\n\n## Purpose\nRecord timestamped feedback events for bullets. **CRITICAL** for confidence decay calculation and promotion logic.\n\n## FeedbackEvent Structure\n```typescript\ninterface FeedbackEvent {\n  timestamp: string;      // ISO 8601\n  sessionId: string;      // Source session\n  context?: string;       // Why this feedback was given\n}\n```\n\n## Implementation Steps\n1. Find bullet by ID\n2. Push event to helpfulEvents or harmfulEvents array\n3. Update aggregate helpfulCount or harmfulCount\n4. If helpful: update lastValidatedAt to event.timestamp\n5. Update bullet.updatedAt\n6. Check promotion criteria if helpful\n\n## Promotion Check (Helpful Events)\nIf helpfulCount reaches threshold:\n- **5+ helpful**: candidate → established\n- **10+ helpful**: established → proven\n- Never auto-promote if any harmful events exist\n\n## Why Events Matter\n**Timestamps enable confidence decay**:\n- Recent helpful events → high confidence\n- Old helpful events → decayed confidence\n- Events older than 2× half-life → minimal weight\n\nExample:\n- Half-life: 90 days\n- Helpful event from 90 days ago: 50% weight\n- Helpful event from 180 days ago: 25% weight\n- Helpful event from today: 100% weight\n\n## Implementation Notes\n- Always push to events array BEFORE incrementing count\n- Update lastValidatedAt only for helpful events\n- Preserve all event history (never truncate)\n- Check promotion after recording\n\n## Dependencies\n- findBullet()\n- Promotion logic\n\n## Related Functions\n- calculateEffectiveScore() - uses events for decay\n- updateBulletCounter() - deprecated version without events\n- promoteMaturity() - called if thresholds met","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:57.082772-05:00","updated_at":"2025-12-07T20:04:56.105146-05:00","closed_at":"2025-12-07T20:03:51.054315-05:00"}
{"id":"cass_memory_system-45ir","title":"Security and Reliability Hardening: Sanitization \u0026 LLM Fallback","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T21:06:52.600932-05:00","updated_at":"2025-12-07T21:06:57.058289-05:00","closed_at":"2025-12-07T21:06:57.058289-05:00"}
{"id":"cass_memory_system-4ae","title":"[Cass] cassIndex - Trigger index rebuild","description":"Implement cassIndex() to trigger cass index rebuild.\n\n## Signature\n```typescript\nasync function cassIndex(\n  cassPath = \"cass\", \n  options: { full?: boolean; incremental?: boolean } = {}\n): Promise\u003cvoid\u003e\n```\n\n## CLI Command\n`cass index [--full] [--incremental]`\n\n## Implementation\n- Use spawn() to show real-time progress to user\n- Set stdio: \"inherit\" to show indexing output\n- Build args array based on options\n- Reject promise on non-zero exit code\n\n## Error Handling\n- Throw error if exit code non-zero\n- Include stderr in error message\n- Let caller handle retry logic\n\n## Options\n- full: Rebuild entire index from scratch (for missing/corrupted index)\n- incremental: Update index with new sessions only (for routine maintenance)\n- No options: Default incremental rebuild\n\n## Usage\n```typescript\n// Full rebuild\nawait cassIndex(\"cass\", { full: true });\n\n// Incremental update\nawait cassIndex(\"cass\", { incremental: true });\n```\n\n## Exit Codes\n- 0: Index rebuilt successfully\n- Non-zero: Rebuild failed","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:55.24495-05:00","updated_at":"2025-12-07T19:00:00.645514-05:00","closed_at":"2025-12-07T18:59:59.00296-05:00"}
{"id":"cass_memory_system-4dt","title":"[Curator] handleHarmfulDelta - Record negative feedback","description":"Record negative feedback for playbook bullets.\n\nSignature:\nfunction handleHarmfulDelta(\n  playbook: Playbook,\n  delta: HarmfulDelta\n): { applied: boolean }\n\nProcess:\n1. Find bullet by ID\n   - If not found: return applied: false\n2. Create FeedbackEvent:\n   - timestamp: Date.now()\n   - sessionId: delta.sessionId\n   - reason: delta.reason (required - why was this harmful?)\n   - context: delta.context (optional)\n3. Push to bullet.harmfulEvents array\n4. Increment bullet.harmfulCount\n5. Update bullet.updatedAt\n6. Return applied: true\n\nImportant notes:\n- Does NOT immediately deprecate bullets\n- Does NOT check for auto-inversion here\n- Auto-inversion happens in post-processing (autoInvertHarmfulBullets)\n- This separation allows batching and prevents premature deprecation\n\nWhy separate harmful from deprecation?\n- Single harmful event may be context-specific\n- Need consistent negative pattern (multiple harmful events)\n- Auto-inversion requires threshold crossing (effectiveScore \u003c -pruneThreshold)\n\nHarmful feedback is EVIDENCE, not immediate action.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:44:58.717997-05:00","updated_at":"2025-12-07T21:14:16.238359-05:00","closed_at":"2025-12-07T21:14:08.886277-05:00"}
{"id":"cass_memory_system-4fj7","title":"[Critical] V1 Scope Gate - Define MVP Boundary","description":"# V1 Scope Gate - Define Clear MVP Boundary\n\n## The Problem\nCurrent bead set has 333 items with no clear V1/V2/V3 delineation.\nThis means:\n- No clear \"done\" point for v1\n- Risk of scope creep\n- Features compete for attention equally\n- Hard to ship anything\n\n## The Solution\nExplicitly tag every bead as v1, v2, or v3 with clear criteria.\n\n### V1 Criteria (MUST ship):\n- Zero-config works immediately\n- Basic cass search integration\n- Simple playbook (add/remove rules)\n- CLI commands for basic workflow\n- MCP server for agent integration\n- Cost controls (budget limits)\n- Privacy defaults (single-agent)\n\n### V1 Feature Set:\n```\nCOMMANDS (V1):\n  cm context \u003ctask\u003e     # Get relevant context\n  cm reflect            # Extract rules from sessions\n  cm mark \u003crule\u003e \u003cfeedback\u003e  # Manual feedback\n  cm playbook list      # Show rules\n  cm playbook add       # Add manual rule\n  cm playbook remove    # Remove rule\n  cm init               # Setup (optional)\n  cm status             # Health check\n\nMCP TOOLS (V1):\n  cm_context            # Get context\n  cm_feedback           # Record feedback\n  cm_outcome            # Record success/failure\n\nSTORAGE (V1):\n  ~/.cass-memory/playbook.json\n  ~/.cass-memory/diary/\n  ~/.cass-memory/config.json\n```\n\n### V2 Features (Post-MVP):\n- Semantic search (embeddings)\n- Cross-agent learning\n- Confidence decay algorithm\n- Automatic curation\n- LLM validation\n- Maturity levels\n- Starter playbooks\n- Rich diary schema\n\n### V3 Features (Future):\n- Team playbooks\n- Cloud sync\n- Analytics dashboard\n- IDE plugins\n- Custom LLM providers\n- Webhooks\n- API for integrations\n\n### V1 Definition of Done:\n- [ ] All v1 commands working\n- [ ] MCP server functional\n- [ ] Works without any setup\n- [ ] Works without LLM (degraded but functional)\n- [ ] Documentation for basic usage\n- [ ] \u003c5 minute time to first value\n\n## Why This Is Critical\n- Scope creep kills projects\n- \"Ship v1, then iterate\" is the way\n- Clear boundary enables focus\n- Users want working tool now, not perfect tool never","notes":"V1 Progress: Zero-config ✓, cass search ✓, playbook commands ✓, CLI commands ✓, graceful degradation ✓. Remaining: MCP server, cost controls, final polish.","status":"in_progress","priority":0,"issue_type":"task","created_at":"2025-12-07T17:14:12.058019-05:00","updated_at":"2025-12-07T20:33:19.159487-05:00"}
{"id":"cass_memory_system-4fx1","title":"[E2E] Design scenario matrix + logging spec","description":"Define end-to-end coverage matrix (init-\u003econtext-\u003ereflect-\u003emark-\u003eplaybook). Include success/degenerate modes (cass unavailable, LLM unavailable, bad config). Specify logging expectations (timestamps, command echo, inputs/outputs redaction), artifacts paths, and pass/fail gates.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:29:55.983477-05:00","updated_at":"2025-12-07T20:33:34.676411-05:00","closed_at":"2025-12-07T20:33:19.041289-05:00","dependencies":[{"issue_id":"cass_memory_system-4fx1","depends_on_id":"cass_memory_system-q3h2","type":"blocks","created_at":"2025-12-07T20:29:55.987818-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-4gw","title":"[Decay] checkForPromotion - Automatic maturity advancement","description":"Automatically advance bullets from candidate → established → proven based on effective score AND recent feedback activity.\n\nCOMPLETE IMPLEMENTATION:\n```typescript\n/**\n * Check if bullet qualifies for promotion to higher maturity level.\n * Promotion requires BOTH sufficient score AND recent helpful marks.\n */\nfunction checkForPromotion(bullet: PlaybookBullet): BulletMaturity {\n  const score = getEffectiveScore(bullet);\n  const recentHelpful = bullet.helpfulEvents.filter(e =\u003e\n    daysSince(e.timestamp) \u003c 30\n  ).length;\n\n  // candidate → established: score \u003e= 2 AND recent helpful\n  if (bullet.maturity === 'candidate' \u0026\u0026 score \u003e= 2 \u0026\u0026 recentHelpful \u003e= 1) {\n    return 'established';\n  }\n\n  // established → proven: score \u003e= 5 AND multiple recent helpful\n  if (bullet.maturity === 'established' \u0026\u0026 score \u003e= 5 \u0026\u0026 recentHelpful \u003e= 2) {\n    return 'proven';\n  }\n\n  return bullet.maturity;\n}\n\n// Helper function\nfunction daysSince(timestamp: string): number {\n  const eventTime = new Date(timestamp).getTime();\n  const now = Date.now();\n  return (now - eventTime) / (1000 * 60 * 60 * 24);\n}\n```\n\nPROMOTION CRITERIA:\n\nCandidate → Established:\n- Effective score \u003e= 2 (net positive after decay \u0026 harmful weighting)\n- At least 1 helpful mark in last 30 days (proves current relevance)\n\nEstablished → Proven:\n- Effective score \u003e= 5 (strong positive signal)\n- At least 2 helpful marks in last 30 days (consistent usage)\n\nWHY TWO REQUIREMENTS:\nWithout recency check, old rules with decayed scores could still promote. We want to ensure rules are CURRENTLY useful, not just historically useful.\n\nEXAMPLE SCENARIOS:\n\n1. QUALIFIES for candidate → established:\n   - 3 helpful marks in last week\n   - 0 harmful marks\n   - Effective score ≈ 1.5 (candidate maturity 0.5× multiplier)\n   - Has recent helpful ✓\n   - After promotion, score recalculated with 1.0× multiplier\n\n2. DOES NOT qualify for established → proven:\n   - 10 helpful marks from 6 months ago\n   - Decayed score ≈ 2.5\n   - Only 1 helpful in last 30 days (needs 2)\n   - Stays established until more recent usage\n\n3. RAPID promotion path:\n   - New rule marked helpful 3 times in week 1\n   - Promotes to established\n   - Marked helpful 3 more times in week 2\n   - Promotes to proven by day 14\n\nINTEGRATION:\n- Called by applyMaturityTransitions()\n- Called after each curate cycle\n- Pinned bullets can still be promoted\n- Returns new maturity level or current if no change\n\nDEPENDENCIES:\n- getEffectiveScore()\n- daysSince() helper\n- PlaybookBullet.maturity field","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:45:21.423759-05:00","updated_at":"2025-12-07T21:15:58.744156-05:00","closed_at":"2025-12-07T21:14:24.785174-05:00"}
{"id":"cass_memory_system-4hey","title":"[Foundation] Development workflow with hot reload","description":"Configure development workflow with hot reload for fast iteration during CASS Memory System development.\n\n## Context\nDevelopers need a fast feedback loop when working on CASS Memory System. Hot reload watches source files and automatically restarts the CLI when changes are detected, eliminating manual restart cycles.\n\n## Technical Specification\n\n### Development Commands:\n\n#### Primary Development Mode:\nbash\nbun run src/cass-memory.ts [command] [args]\n\n- Runs TypeScript source directly without compilation\n- Fast startup (~50ms)\n- Full TypeScript type checking\n- No build step required\n\n#### Hot Reload Mode:\nbash\nbun --watch run src/cass-memory.ts [command] [args]\n\n- Watches all files in src/\n- Automatically restarts on file changes\n- Preserves command arguments\n- Shows clear reload indicators\n\n#### Type Check Mode:\nbash\nbun run typecheck\n# or\ntsc --noEmit\n\n- Runs TypeScript compiler without emitting files\n- Reports type errors\n- Faster than full build\n- Run before commits\n\n#### Test Watch Mode:\nbash\nbun test --watch\n\n- Runs tests on file changes\n- Shows test results in real-time\n- Supports filtering by test name\n\n### Package.json Scripts:\njson\n{\n  \"scripts\": {\n    \"dev\": \"bun run src/cass-memory.ts\",\n    \"dev:watch\": \"bun --watch run src/cass-memory.ts\",\n    \"typecheck\": \"tsc --noEmit\",\n    \"typecheck:watch\": \"tsc --noEmit --watch\",\n    \"test\": \"bun test\",\n    \"test:watch\": \"bun test --watch\",\n    \"lint\": \"eslint src/\",\n    \"format\": \"prettier --write src/\"\n  }\n}\n\n\n### Workflow Examples:\n\n#### Develop a New Command:\nbash\n# Terminal 1: Hot reload\nbun --watch run src/cass-memory.ts doctor\n\n# Terminal 2: Type checking\nbun run typecheck:watch\n\n# Terminal 3: Tests\nbun test --watch\n\n\n#### Quick Iteration:\nbash\n# Run command, see output, make changes, repeat\nbun run src/cass-memory.ts status\n# Edit src/commands/status.ts\nbun run src/cass-memory.ts status  # See changes immediately\n\n\n#### Debug Workflow:\nbash\n# Add console.log() to src/llm.ts\nbun run src/cass-memory.ts reflect\n# See logs immediately, no rebuild\n\n\n### IDE Integration:\n\n#### VS Code tasks.json:\njson\n{\n  \"version\": \"2.0.0\",\n  \"tasks\": [\n    {\n      \"label\": \"Dev: Watch\",\n      \"type\": \"shell\",\n      \"command\": \"bun --watch run src/cass-memory.ts\",\n      \"problemMatcher\": []\n    },\n    {\n      \"label\": \"TypeCheck: Watch\",\n      \"type\": \"shell\",\n      \"command\": \"tsc --noEmit --watch\",\n      \"problemMatcher\": \"-watch\"\n    }\n  ]\n}\n\n\n#### VS Code launch.json:\njson\n{\n  \"version\": \"0.2.0\",\n  \"configurations\": [\n    {\n      \"name\": \"Debug CASS Memory\",\n      \"type\": \"bun\",\n      \"request\": \"launch\",\n      \"program\": \"/src/cass-memory.ts\",\n      \"args\": [\"doctor\"],\n      \"cwd\": \"\"\n    }\n  ]\n}\n\n\n### Development Best Practices:\n\n#### Before Starting Development:\nbash\nbun install          # Install dependencies\nbun run typecheck    # Verify clean state\n\n\n#### During Development:\n- Use bun --watch for hot reload\n- Keep typecheck running in separate terminal\n- Run tests frequently with bun test\n- Commit often with clear messages\n\n#### Before Committing:\nbash\nbun run typecheck    # No type errors\nbun test             # All tests pass\nbun run build        # Binary builds successfully\n./dist/cass-memory --version  # Binary works\n\n\n## Reasoning\n\n### Why Hot Reload:\n1. Faster Feedback: See changes in \u003c 1 second\n2. Flow State: Minimize context switching\n3. Rapid Prototyping: Try ideas quickly\n4. Debugging: Add logs without rebuilding\n\n### Why Bun for Development:\n1. Fast Startup: Bun starts TypeScript in ~50ms\n2. No Build Step: Run .ts files directly\n3. Built-in Watch: --watch flag included\n4. Hot Module Reload: Fast reloads\n\n### Why Separate Type Checking:\n1. Parallel Feedback: Types check while you run\n2. Editor Integration: See errors in IDE\n3. CI Validation: Same command in CI/local\n\n### Why Test Watch Mode:\n1. TDD Workflow: Write test, see it fail, make it pass\n2. Regression Detection: Catch breaks immediately\n3. Confidence: Know tests pass before commit\n\n### Why Not Nodemon/ts-node:\n1. Bun is Faster: Native TypeScript execution\n2. Simpler Stack: One runtime instead of three tools\n3. Better DX: Bun has better error messages\n4. Future-Proof: Bun is the target runtime\n\n## Acceptance Criteria\n\n- bun run src/cass-memory.ts executes CLI without build\n- bun --watch run src/cass-memory.ts reloads on file changes\n- bun run typecheck reports type errors\n- bun run typecheck:watch continuously checks types\n- bun test runs all tests\n- bun test --watch reruns tests on changes\n- Changes to src/ files trigger reload in \u003c 2 seconds\n- Type errors show in terminal and IDE\n- README documents development workflow\n- CONTRIBUTING.md explains setup for new developers\n\n## How This Serves the Universal Agent Memory System\n\nFast development workflow accelerates CASS Memory evolution:\n\n1. Faster Iteration: Developers can try ideas in seconds, not minutes\n2. Better Testing: Watch mode encourages TDD and comprehensive tests\n3. Lower Barrier: New contributors can start developing immediately\n4. Debugging: Quick feedback loop for fixing bugs\n5. Experimentation: Easy to prototype new features\n6. Quality: Type checking and tests run continuously\n7. Documentation: Clear workflow guides new developers\n\nWithout hot reload and fast development tools, contributing to CASS Memory would be slow and frustrating. Fast feedback loops enable rapid innovation and keep the project moving forward.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:49:02.593086-05:00","updated_at":"2025-12-07T20:29:16.324233-05:00","closed_at":"2025-12-07T20:27:55.937505-05:00"}
{"id":"cass_memory_system-4hmk","title":"[Validation] Test Agent Workflow End-to-End","description":"# Validate Agent Workflow End-to-End\n\n## Purpose\nAfter implementing changes, validate the full agent workflow works.\n\n## Test Scenarios\n\n### Scenario 1: Agent Discovery\n1. Agent has no prior knowledge of cass-memory\n2. Agent runs \\`cm quickstart\\`\n3. Verify agent can understand how to use the system\n\n### Scenario 2: Context Retrieval\n1. Create playbook with known rules\n2. Run \\`cm context \\\"related task\\\" --json\\`\n3. Verify output is:\n   - Under 500 tokens\n   - Contains relevant rules with IDs\n   - Parseable JSON\n\n### Scenario 3: Feedback Loop\n1. Use a rule during work\n2. Provide feedback (inline comment OR cm mark)\n3. Run reflection\n4. Verify feedback was recorded\n\n### Scenario 4: Blurb Sufficiency\n1. Read ONLY the AGENTS.md blurb\n2. Attempt to use cass-memory\n3. Verify blurb is sufficient for basic usage\n\n## Depends On\n- j7lc (README rewrite) - docs must be done\n- 2lit (Blurb) - blurb must exist\n- peoi (quickstart) - command must work\n- ziej (context output) - output must be optimized\n\n## Success Criteria\nAn agent with ZERO prior knowledge can:\n1. Learn the system from quickstart or blurb\n2. Get relevant context for a task\n3. Provide feedback on rules","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T12:48:20.746842-05:00","updated_at":"2025-12-08T13:22:36.101416-05:00","closed_at":"2025-12-08T13:22:36.101416-05:00","dependencies":[{"issue_id":"cass_memory_system-4hmk","depends_on_id":"cass_memory_system-j7lc","type":"blocks","created_at":"2025-12-08T12:48:48.577858-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-4hmk","depends_on_id":"cass_memory_system-2lit","type":"blocks","created_at":"2025-12-08T12:48:48.677854-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-4hmk","depends_on_id":"cass_memory_system-ziej","type":"blocks","created_at":"2025-12-08T12:48:48.773069-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-4hmk","depends_on_id":"cass_memory_system-peoi","type":"blocks","created_at":"2025-12-08T12:52:18.743514-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-4iv8","title":"[Testing:Integration] cass.test.ts - Cass integration tests","description":"// Skip if cass not available\nconst SKIP_CASS = !cassAvailable();\n\nTest cases:\n- cassAvailable: returns true when installed\n- cassSearch: returns array, filters work\n- cassTimeline: returns grouped data\n- Empty results handled gracefully\nRequires cass installed to run","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:36.671139-05:00","updated_at":"2025-12-07T22:42:25.426521-05:00","closed_at":"2025-12-07T22:38:38.399064-05:00"}
{"id":"cass_memory_system-4khw","title":"Unit Tests: Curator \u0026 Deduplication","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:23:02.173285-05:00","updated_at":"2025-12-07T22:06:57.864652-05:00","closed_at":"2025-12-07T22:06:57.864652-05:00"}
{"id":"cass_memory_system-4pm1","title":"Unit Tests: Scoring Logic","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:23:01.975906-05:00","updated_at":"2025-12-07T21:13:40.074577-05:00","closed_at":"2025-12-07T21:13:36.703079-05:00"}
{"id":"cass_memory_system-4sdv","title":"[Testing:LLM] Mocked LLM response tests","description":"Mock the AI SDK:\nconst mockGenerateObject = mock(() =\u003e ({\n  object: { ... }\n}));\nmock.module(\"ai\", () =\u003e ({ generateObject: mockGenerateObject }));\n\nTest cases:\n- extractDiary: returns structured diary\n- runReflector: generates deltas\n- runValidator: validates rules\n- Prompts include correct variables","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:38.445224-05:00","updated_at":"2025-12-08T02:31:13.144378-05:00","closed_at":"2025-12-08T02:31:13.144378-05:00"}
{"id":"cass_memory_system-4ua5","title":"[Impl] Add --robot Flag Convention (like cass)","description":"# Add --robot Flag Convention (like cass)\n\n## Purpose\ncass uses `--robot` as the primary flag for machine-readable output. We use `--json`. Should we add `--robot` as an alias for consistency across the agent tool ecosystem?\n\n## Current State\n- cass: `--robot` and `--json` both work\n- cm: `--json` only\n\n## Arguments For\n- Consistency with cass (agents learn one pattern)\n- `--robot` signals \"I am an agent\" not just \"give me JSON\"\n- Can add robot-specific behaviors (suppress warnings, etc.)\n\n## Arguments Against\n- `--json` is already standard\n- Adding aliases increases surface area\n- Not strictly necessary\n\n## Recommendation\nAdd `--robot` as an alias for `--json` plus:\n- Suppress INFO-level stderr messages\n- Ensure all output is parseable\n- Add `cm robot-docs` command (like cass)\n\n## Implementation\n- Add --robot flag to all commands that have --json\n- Make --robot = --json + quieter stderr\n- Add cm robot-docs command with topics:\n  - commands: all commands for agents\n  - schemas: JSON output schemas\n  - examples: copy-paste invocations\n  - guide: quick-start for agents\n\n## Deliverables\n- [ ] --robot flag on all relevant commands\n- [ ] cm robot-docs command\n- [ ] Documentation of robot mode behavior","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T12:47:52.262-05:00","updated_at":"2025-12-08T13:13:38.167641-05:00","closed_at":"2025-12-08T13:13:38.167641-05:00","dependencies":[{"issue_id":"cass_memory_system-4ua5","depends_on_id":"cass_memory_system-2bnu","type":"blocks","created_at":"2025-12-08T12:48:46.681826-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-4w3l","title":"[E2E] New User Onboarding - Fresh Install to First Context","description":"## Target: E2E test simulating new user experience\n\n### Scenario: First-Time User Setup\n\n```\nUser installs cass-memory\nUser runs init\nUser gets context for first task\nUser marks helpful bullet\nUser checks doctor\n```\n\n### Test Script:\n\n```typescript\ndescribe('E2E: New User Onboarding', () =\u003e {\n  let tempHome: string;\n  \n  beforeAll(async () =\u003e {\n    tempHome = await createIsolatedEnvironment();\n    log('Created isolated env:', tempHome);\n  });\n\n  it('step 1: init creates structure', async () =\u003e {\n    log('Starting: cm init');\n    const result = await runCLI(['init', '--json']);\n    \n    log('Exit code:', result.exitCode);\n    log('Stdout:', result.stdout);\n    log('Duration:', result.duration);\n    \n    expect(result.exitCode).toBe(0);\n    const output = JSON.parse(result.stdout);\n    expect(output.success).toBe(true);\n    expect(output.created).toContain('config.json');\n    \n    // Verify files exist\n    const configExists = await fileExists(join(tempHome, '.cass-memory/config.json'));\n    log('Config exists:', configExists);\n    expect(configExists).toBe(true);\n  });\n\n  it('step 2: context returns empty initially', async () =\u003e {\n    log('Starting: cm context');\n    const result = await runCLI(['context', 'test query', '--json']);\n    \n    log('Exit code:', result.exitCode);\n    log('Response:', result.stdout);\n    \n    const output = JSON.parse(result.stdout);\n    expect(output.bullets).toHaveLength(0);\n  });\n\n  // ... more steps\n});\n```\n\n### Logging Requirements:\n- Log every CLI invocation with full args\n- Log all stdout/stderr\n- Log timing for each step\n- Log file system state at checkpoints\n- Summary at end with pass/fail for each step\n\n### Cleanup:\n- Remove temp directories\n- Reset environment variables\n- Report any leaked resources","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-07T20:31:11.183941-05:00","updated_at":"2025-12-07T20:31:11.183941-05:00","dependencies":[{"issue_id":"cass_memory_system-4w3l","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:38.005989-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-4w3l","depends_on_id":"cass_memory_system-zc1d","type":"blocks","created_at":"2025-12-07T20:32:38.239073-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-4w3l","depends_on_id":"cass_memory_system-ke2x","type":"blocks","created_at":"2025-12-07T20:33:05.493239-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-4wv6","title":"Refactor lock.ts to use atomic mkdir","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T21:02:34.222705-05:00","updated_at":"2025-12-07T21:03:00.572127-05:00","closed_at":"2025-12-07T21:03:00.572127-05:00"}
{"id":"cass_memory_system-4y5j","title":"[Testing] package.json test scripts","description":"{\n  \"scripts\": {\n    \"test\": \"bun test\",\n    \"test:unit\": \"bun test tests/unit\",\n    \"test:integration\": \"bun test tests/integration\",\n    \"test:llm\": \"bun test tests/llm\",\n    \"test:e2e\": \"bash tests/e2e/commands.test.sh\",\n    \"test:property\": \"bun test tests/property\",\n    \"test:coverage\": \"bun test --coverage\",\n    \"test:watch\": \"bun test --watch\"\n  }\n}","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:51.480478-05:00","updated_at":"2025-12-08T14:16:44.050532-05:00","closed_at":"2025-12-08T14:16:44.050532-05:00"}
{"id":"cass_memory_system-4zf","title":"[Utils] truncate - Text truncation with ellipsis","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:45:14.481959-05:00","updated_at":"2025-12-07T20:24:20.339309-05:00","closed_at":"2025-12-07T20:24:03.858274-05:00","comments":[{"id":2,"issue_id":"cass_memory_system-4zf","author":"jemanuel","text":"## Function Signature\n```typescript\nfunction truncate(text: string, maxLength: number): string\n```\n\n## Implementation Details\n- Check if text.length \u003c= maxLength\n- If yes, return text unchanged\n- If no, return text.slice(0, maxLength - 3) + \"...\"\n- The -3 accounts for ellipsis length\n- Total output length will be exactly maxLength\n\n## Why This Matters\nUsed for preview text in UI output. Keeps display clean and consistent. Example: truncate(\"This is a very long bullet content\", 20) returns \"This is a very lo...\"\n\n## Edge Cases to Handle\n- maxLength \u003c 3 - handle gracefully, maybe return just \"...\" or throw\n- Empty string - return empty\n- maxLength exactly text length - return unchanged\n- Unicode characters - ensure slice doesn't break surrogate pairs\n- Newlines in text - may want to replace with space first","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-52q","title":"[Cass] safeCassSearch - Search with automatic error recovery","description":"Implement safeCassSearch() wrapper with automatic error recovery.\n\n## Signature\n```typescript\nasync function safeCassSearch(\n  query: string, \n  options: CassSearchOptions = {},\n  cassPath = \"cass\"\n): Promise\u003cCassHit[]\u003e\n```\n\n## Implementation Flow\n1. Check cassAvailable() - return [] if cass not installed\n2. Check cassNeedsIndex() - rebuild if needed\n3. Call cassSearch() with provided options\n4. Return results or [] on any failure\n\n## Error Handling\n- Never throws exceptions\n- Always returns array (empty on error)\n- Logs errors at appropriate level\n- Performs automatic recovery:\n  - Rebuilds index if missing\n  - Reduces limit on timeout\n  - Retries once after recovery\n\n## Purpose\nHigh-level wrapper for resilient search operations. Use this in:\n- reflect command\n- recall command  \n- remind command\n- Any user-facing search functionality\n\n## Usage\n```typescript\n// Safe to use without try/catch\nconst hits = await safeCassSearch(\"error handling\", { \n  limit: 10,\n  days: 30 \n});\n\nif (hits.length === 0) {\n  console.log(\"No results found\");\n} else {\n  processHits(hits);\n}\n```\n\n## vs cassSearch\n- cassSearch: Low-level, may throw, caller handles errors\n- safeCassSearch: High-level, never throws, auto-recovery","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:57.822142-05:00","updated_at":"2025-12-07T19:02:10.073029-05:00","closed_at":"2025-12-07T19:02:00.161383-05:00"}
{"id":"cass_memory_system-53cx","title":"Enhance scoring.ts unit tests to \u003e90% coverage","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T20:52:54.637908-05:00","updated_at":"2025-12-07T20:58:47.04935-05:00","closed_at":"2025-12-07T20:57:19.345389-05:00","dependencies":[{"issue_id":"cass_memory_system-53cx","depends_on_id":"cass_memory_system-u64s","type":"discovered-from","created_at":"2025-12-07T20:52:54.638892-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-5cxf","title":"E2E: Full Reflection Cycle","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:23:11.692549-05:00","updated_at":"2025-12-08T14:23:43.264254-05:00","closed_at":"2025-12-08T14:23:43.264254-05:00","dependencies":[{"issue_id":"cass_memory_system-5cxf","depends_on_id":"cass_memory_system-ejyo","type":"blocks","created_at":"2025-12-07T20:23:11.694599-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5cxf","depends_on_id":"cass_memory_system-l1ft","type":"blocks","created_at":"2025-12-07T20:23:11.696715-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-5eh","title":"Phase 1: Foundation + High-ROI Core","description":"# EPIC: Foundation + High-ROI Core\n\n## Purpose\nEstablish the core infrastructure and implement the highest-ROI features that provide immediate value. This phase creates the skeleton upon which all other features build.\n\n## Background \u0026 Reasoning\nThe ACE (Agentic Context Engineering) framework emphasizes three key innovations:\n1. **Generator** - Pre-task context hydration\n2. **Reflector** - LLM-powered insight extraction  \n3. **Curator** - Deterministic delta merging (NO LLM rewriting)\n\nThis phase implements the Generator (context command) and foundational types needed for all subsequent phases.\n\n## Priority Features (from ROI analysis)\n- P1: Confidence decay + event timestamps (20× impact)\n- P2: Structured JSON context output (10× impact)\n- P4: Effective score (4× harmful multiplier) (5× impact)\n- P10: State lifecycle draft/active/retired (10× impact)\n- P12: Secret sanitization (∞ security-critical)\n- P14: Kind enum categorization (3× impact)\n\n## Key Deliverables\n1. `cass-memory init` - Initialize configuration and playbook\n2. `cass-memory context --json` - Pre-flight task hydration\n3. Complete type system with all enhancements\n4. cass integration wrapper with error handling\n5. Secret sanitization pipeline\n\n## Architecture Decisions\n- Use Bun for all JS/TS operations (per AGENTS.md rules)\n- Vercel AI SDK for LLM provider abstraction\n- Zod for runtime type validation and LLM structured output\n- YAML for playbook storage (human-readable, git-friendly)\n\n## Success Criteria\n- An agent can run `cass-memory context \"task\"` and receive relevant bullets\n- Bullets have proper decay-adjusted scores\n- No secrets leak into stored diary entries or playbook\n- Configuration cascades from global to repo-level\n\n## Dependencies\nNone - this is the foundation phase","status":"in_progress","priority":0,"issue_type":"epic","created_at":"2025-12-07T16:16:01.370891-05:00","updated_at":"2025-12-07T19:56:31.219986-05:00"}
{"id":"cass_memory_system-5eh.1","title":"Project Setup: Bun + TypeScript + Dependencies","description":"# Feature: Project Setup\n\n## Purpose\nInitialize the project with Bun, TypeScript, and all required dependencies.\n\n## Technical Decisions\n- **Runtime**: Bun (per AGENTS.md: \"Use bun for everything JS/TS\")\n- **LLM SDK**: Vercel AI SDK (supports OpenAI, Anthropic, Google)\n- **Validation**: Zod (structured LLM output, runtime type safety)\n- **YAML**: yaml package (for playbook read/write)\n- **Output**: chalk (terminal colors for human-readable output)\n\n## Files to Create\n1. `package.json` - Dependencies, scripts, bin entry\n2. `tsconfig.json` - TypeScript configuration\n3. `src/` directory structure\n\n## Package.json Specifics\n```json\n{\n  \"name\": \"cass-memory\",\n  \"version\": \"0.1.0\",\n  \"type\": \"module\",\n  \"bin\": { \"cass-memory\": \"./dist/cass-memory.js\" },\n  \"scripts\": {\n    \"dev\": \"bun run src/cass-memory.ts\",\n    \"build\": \"bun build src/cass-memory.ts --compile --outfile dist/cass-memory\",\n    \"typecheck\": \"tsc --noEmit\",\n    \"test\": \"bun test\"\n  },\n  \"dependencies\": {\n    \"ai\": \"^4.0.0\",\n    \"@ai-sdk/openai\": \"^1.0.0\",\n    \"@ai-sdk/anthropic\": \"^1.0.0\", \n    \"@ai-sdk/google\": \"^1.0.0\",\n    \"zod\": \"^3.23.0\",\n    \"yaml\": \"^2.3.0\",\n    \"chalk\": \"^5.3.0\"\n  },\n  \"devDependencies\": {\n    \"@types/bun\": \"latest\",\n    \"typescript\": \"^5.0.0\"\n  }\n}\n```\n\n## Acceptance Criteria\n- `bun install` succeeds\n- `bun run dev --help` shows CLI help\n- `bun run typecheck` passes\n- Directory structure matches plan\n\n## No Dependencies\nThis is the first task.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T16:17:15.519346-05:00","updated_at":"2025-12-07T18:41:03.835938-05:00","closed_at":"2025-12-07T18:40:49.256987-05:00","dependencies":[{"issue_id":"cass_memory_system-5eh.1","depends_on_id":"cass_memory_system-5eh","type":"parent-child","created_at":"2025-12-07T16:17:15.521212-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-5eh.1.1","title":"[Setup] Create package.json with exact dependencies","description":"# Task: Create package.json\n\n## Exact File Content\n```json\n{\n  \"name\": \"cass-memory\",\n  \"version\": \"0.1.0\",\n  \"type\": \"module\",\n  \"description\": \"Agent-agnostic reflection and memory system implementing ACE framework\",\n  \"author\": \"Your Name\",\n  \"license\": \"MIT\",\n  \"bin\": {\n    \"cass-memory\": \"./dist/cass-memory.js\"\n  },\n  \"main\": \"./dist/cass-memory.js\",\n  \"scripts\": {\n    \"dev\": \"bun run src/cass-memory.ts\",\n    \"build\": \"bun build src/cass-memory.ts --compile --outfile dist/cass-memory\",\n    \"build:linux\": \"bun build src/cass-memory.ts --compile --target=bun-linux-x64 --outfile dist/cass-memory-linux-x64\",\n    \"build:macos-arm\": \"bun build src/cass-memory.ts --compile --target=bun-darwin-arm64 --outfile dist/cass-memory-darwin-arm64\",\n    \"build:macos-x64\": \"bun build src/cass-memory.ts --compile --target=bun-darwin-x64 --outfile dist/cass-memory-darwin-x64\",\n    \"build:windows\": \"bun build src/cass-memory.ts --compile --target=bun-windows-x64 --outfile dist/cass-memory-windows-x64.exe\",\n    \"build:all\": \"bun run build:linux \u0026\u0026 bun run build:macos-arm \u0026\u0026 bun run build:macos-x64 \u0026\u0026 bun run build:windows\",\n    \"typecheck\": \"tsc --noEmit\",\n    \"test\": \"bun test\",\n    \"test:watch\": \"bun test --watch\"\n  },\n  \"dependencies\": {\n    \"ai\": \"^4.0.0\",\n    \"@ai-sdk/openai\": \"^1.0.0\",\n    \"@ai-sdk/anthropic\": \"^1.0.0\",\n    \"@ai-sdk/google\": \"^1.0.0\",\n    \"zod\": \"^3.23.0\",\n    \"yaml\": \"^2.3.0\",\n    \"chalk\": \"^5.3.0\"\n  },\n  \"devDependencies\": {\n    \"@types/bun\": \"latest\",\n    \"typescript\": \"^5.0.0\"\n  },\n  \"engines\": {\n    \"bun\": \"\u003e=1.0.0\"\n  }\n}\n```\n\n## Why These Dependencies\n- **ai**: Vercel AI SDK - unified interface for LLM providers\n- **@ai-sdk/openai**: OpenAI provider (GPT-4, GPT-3.5)\n- **@ai-sdk/anthropic**: Anthropic provider (Claude models)\n- **@ai-sdk/google**: Google provider (Gemini models)\n- **zod**: Runtime type validation + LLM structured output\n- **yaml**: Parse/write YAML playbooks (human-readable, git-friendly)\n- **chalk**: Terminal colors for human-readable output\n\n## Acceptance Criteria\n- [ ] File created at project root\n- [ ] `bun install` completes without errors\n- [ ] All dependencies resolve correctly\n- [ ] `bun run dev --help` executes (even if shows placeholder)","notes":"package.json added per spec; bun install succeeded; bun run dev --help works.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:32:59.788546-05:00","updated_at":"2025-12-07T18:48:03.188564-05:00","closed_at":"2025-12-07T18:42:22.482223-05:00","dependencies":[{"issue_id":"cass_memory_system-5eh.1.1","depends_on_id":"cass_memory_system-5eh.1","type":"parent-child","created_at":"2025-12-07T16:32:59.789618-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-5eh.1.2","title":"[Setup] Create tsconfig.json for strict TypeScript","description":"# Task: Create tsconfig.json\n\n## Exact File Content\n```json\n{\n  \"compilerOptions\": {\n    \"target\": \"ESNext\",\n    \"module\": \"ESNext\",\n    \"moduleResolution\": \"bundler\",\n    \"lib\": [\"ESNext\"],\n    \"types\": [\"bun-types\"],\n    \"strict\": true,\n    \"skipLibCheck\": true,\n    \"noEmit\": true,\n    \"esModuleInterop\": true,\n    \"allowSyntheticDefaultImports\": true,\n    \"forceConsistentCasingInFileNames\": true,\n    \"resolveJsonModule\": true,\n    \"isolatedModules\": true,\n    \"verbatimModuleSyntax\": true,\n    \"noUnusedLocals\": true,\n    \"noUnusedParameters\": true,\n    \"noFallthroughCasesInSwitch\": true,\n    \"exactOptionalPropertyTypes\": true,\n    \"noImplicitReturns\": true,\n    \"noUncheckedIndexedAccess\": true\n  },\n  \"include\": [\"src/**/*.ts\"],\n  \"exclude\": [\"node_modules\", \"dist\"]\n}\n```\n\n## Why These Options\n- **strict: true**: Enables all strict type checking\n- **noUnusedLocals/Parameters**: Catch dead code\n- **noUncheckedIndexedAccess**: Force null checks on array access\n- **exactOptionalPropertyTypes**: Stricter optional property handling\n- **verbatimModuleSyntax**: Modern ESM handling\n\n## Acceptance Criteria\n- [ ] File created at project root\n- [ ] `bun run typecheck` passes with no errors\n- [ ] Strict mode catches type errors properly","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:33:01.022879-05:00","updated_at":"2025-12-07T18:41:03.843066-05:00","closed_at":"2025-12-07T18:40:40.297645-05:00","dependencies":[{"issue_id":"cass_memory_system-5eh.1.2","depends_on_id":"cass_memory_system-5eh.1","type":"parent-child","created_at":"2025-12-07T16:33:01.02374-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-5eh.1.3","title":"[Setup] Create src/ directory structure","description":"# Task: Create src/ Directory Structure\n\n## Directory Layout\n```\nsrc/\n├── cass-memory.ts    # Main CLI entry point\n├── types.ts          # All TypeScript interfaces + Zod schemas\n├── utils.ts          # Shared utility functions\n├── config.ts         # Configuration loading/saving\n├── cass.ts           # cass CLI wrapper\n├── sanitize.ts       # Secret sanitization\n├── scoring.ts        # Decay + effective score algorithms\n├── playbook.ts       # Playbook read/write/merge\n├── llm.ts            # LLM provider abstraction\n├── diary.ts          # Diary generation\n├── reflect.ts        # Reflector pipeline\n├── validate.ts       # Scientific validation\n├── curate.ts         # Deterministic delta application\n└── commands/         # Command implementations\n    ├── init.ts\n    ├── context.ts\n    ├── diary.ts\n    ├── reflect.ts\n    ├── mark.ts\n    ├── forget.ts\n    ├── doctor.ts\n    ├── stats.ts\n    ├── validate.ts\n    ├── audit.ts\n    └── project.ts\n```\n\n## File Stubs\nEach file should start with a minimal stub:\n```typescript\n// src/types.ts\nexport {}; // Placeholder\n\n// src/utils.ts\nexport {}; // Placeholder\n// etc.\n```\n\n## Acceptance Criteria\n- [ ] All directories created\n- [ ] All file stubs created\n- [ ] `bun run typecheck` passes (empty files are valid)\n- [ ] Import structure works: `import { x } from \"./types\"`","notes":"Waiting for FuchsiaBear reservation on src/**; skeleton appears present. Ready to resume when available.","status":"blocked","priority":0,"issue_type":"task","created_at":"2025-12-07T16:33:02.373506-05:00","updated_at":"2025-12-07T18:48:03.189694-05:00","dependencies":[{"issue_id":"cass_memory_system-5eh.1.3","depends_on_id":"cass_memory_system-5eh.1","type":"parent-child","created_at":"2025-12-07T16:33:02.374515-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-5eh.10","title":"CLI Scaffolding: src/cass-memory.ts","description":"# Feature: CLI Scaffolding (src/cass-memory.ts)\n\n## Purpose\nMain CLI entry point with command parsing, help text, and routing to\ncommand handlers.\n\n## CLI Structure\n```\ncass-memory \u003ccommand\u003e [options]\n\nCommands:\n  init              Initialize configuration and playbook\n  context \u003ctask\u003e    Get relevant context for a task (Phase 1)\n  diary \u003cpath\u003e      Generate structured diary from a session (Phase 2)\n  reflect           Run reflection cycle on recent sessions (Phase 2)\n  validate \u003crule\u003e   Validate proposed rule against history (Phase 3)\n  curate            Apply deltas to playbook (Phase 2)\n  mark \u003cid\u003e         Record bullet usage (helpful/harmful) (Phase 2)\n  forget \u003cid\u003e       Permanently block a pattern (Phase 2)\n  audit             Check sessions for rule violations (Phase 4)\n  playbook          Manage playbook entries (Phase 2)\n  project           Export playbook to AGENTS.md (Phase 4)\n  stats             Show playbook health metrics (Phase 3)\n  doctor            Check system health (Phase 2)\n\nGlobal Options:\n  --json            Output in JSON format\n  --verbose         Enable verbose logging\n  --config \u003cpath\u003e   Use custom config file\n  --help            Show help\n  --version         Show version\n```\n\n## Implementation Approach\nUse simple argument parsing (no heavy dependencies):\n```typescript\nconst args = process.argv.slice(2);\nconst command = args[0];\nconst flags = parseFlags(args.slice(1));\n\nswitch (command) {\n  case \"init\": return initCommand(flags);\n  case \"context\": return contextCommand(args[1], flags);\n  // ...\n  default: showHelp();\n}\n```\n\n## Global Flag Handling\n```typescript\ninterface GlobalFlags {\n  json: boolean;\n  verbose: boolean;\n  config?: string;\n  help: boolean;\n  version: boolean;\n}\n\nfunction parseFlags(args: string[]): GlobalFlags \u0026 Record\u003cstring, any\u003e;\n```\n\n## Output Formatting\n```typescript\n// JSON output (for agents)\nfunction outputJson(data: any): void {\n  console.log(JSON.stringify(data, null, 2));\n}\n\n// Human output (for developers)\nfunction outputHuman(data: any, formatter: (d: any) =\u003e string): void {\n  console.log(formatter(data));\n}\n\n// Auto-select based on --json flag\nfunction output(data: any, formatter?: (d: any) =\u003e string, flags?: GlobalFlags): void {\n  if (flags?.json) outputJson(data);\n  else if (formatter) outputHuman(data, formatter);\n  else console.log(data);\n}\n```\n\n## Error Handling\n- Exit code 0: Success\n- Exit code 1: User error (bad input, missing file)\n- Exit code 2: System error (cass unavailable, API error)\n- Always output errors to stderr","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T16:19:51.077755-05:00","updated_at":"2025-12-07T19:10:47.884958-05:00","closed_at":"2025-12-07T19:04:27.470657-05:00","dependencies":[{"issue_id":"cass_memory_system-5eh.10","depends_on_id":"cass_memory_system-5eh","type":"parent-child","created_at":"2025-12-07T16:19:51.078389-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.10","depends_on_id":"cass_memory_system-5eh.7","type":"blocks","created_at":"2025-12-07T16:20:12.453245-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.10","depends_on_id":"cass_memory_system-5eh.3","type":"blocks","created_at":"2025-12-07T16:20:12.53561-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-5eh.11","title":"Init Command: cass-memory init","description":"# Feature: Init Command\n\n## Purpose\nInitialize cass-memory for first-time users:\n1. Create directory structure\n2. Create default config\n3. Create empty playbook\n4. Verify cass availability\n5. Offer to run initial index\n\n## Usage\n```bash\ncass-memory init [--force] [--json]\n```\n\n## Behavior\n```typescript\nasync function initCommand(flags: InitFlags): Promise\u003cvoid\u003e {\n  // 1. Check if already initialized\n  const configExists = await fileExists(\"~/.cass-memory/config.json\");\n  if (configExists \u0026\u0026 !flags.force) {\n    error(\"Already initialized. Use --force to reinitialize.\");\n    return;\n  }\n  \n  // 2. Create directories\n  await ensureDir(\"~/.cass-memory/diary\");\n  await ensureDir(\"~/.cass-memory/reflections\");\n  await ensureDir(\"~/.cass-memory/embeddings\");\n  await ensureDir(\"~/.cass-memory/cost\");\n  \n  // 3. Create default config\n  const config = getDefaultConfig();\n  await saveConfig(config);\n  \n  // 4. Create empty playbook\n  const playbook = createEmptyPlaybook(\"global\");\n  await savePlaybook(playbook, config.playbookPath);\n  \n  // 5. Check cass availability\n  const cassOk = cassAvailable(config.cassPath);\n  if (!cassOk) {\n    warn(\"cass is not available. Some features will not work.\");\n    warn(\"Install cass: https://github.com/your/cass\");\n  }\n  \n  // 6. Output result\n  output({\n    success: true,\n    configPath: expandPath(\"~/.cass-memory/config.json\"),\n    playbookPath: expandPath(config.playbookPath),\n    cassAvailable: cassOk\n  }, formatInitResult, flags);\n}\n```\n\n## Directory Structure Created\n```\n~/.cass-memory/\n├── config.json           # Tool configuration\n├── playbook.yaml         # Global playbook (empty)\n├── diary/                # Diary entries (empty)\n├── reflections/          # Reflection logs\n├── embeddings/           # Embedding cache (Phase 3)\n└── cost/                 # LLM cost tracking\n```\n\n## Output Formats\n\n### JSON (--json)\n```json\n{\n  \"success\": true,\n  \"configPath\": \"/Users/x/.cass-memory/config.json\",\n  \"playbookPath\": \"/Users/x/.cass-memory/playbook.yaml\",\n  \"cassAvailable\": true\n}\n```\n\n### Human-readable\n```\n✓ Created ~/.cass-memory/config.json\n✓ Created ~/.cass-memory/playbook.yaml\n✓ Created directories: diary/, reflections/, embeddings/\n✓ cass available: yes\n\ncass-memory initialized successfully!\n\nNext steps:\n  cass-memory context \"your task\" --json  # Get context for a task\n  cass-memory doctor                       # Check system health\n```","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T16:19:52.268384-05:00","updated_at":"2025-12-07T19:29:08.544343-05:00","closed_at":"2025-12-07T19:28:59.910741-05:00","dependencies":[{"issue_id":"cass_memory_system-5eh.11","depends_on_id":"cass_memory_system-5eh","type":"parent-child","created_at":"2025-12-07T16:19:52.269692-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.11","depends_on_id":"cass_memory_system-5eh.10","type":"blocks","created_at":"2025-12-07T16:20:12.618451-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.11","depends_on_id":"cass_memory_system-5eh.7","type":"blocks","created_at":"2025-12-07T16:20:12.704297-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.11","depends_on_id":"cass_memory_system-5eh.8","type":"blocks","created_at":"2025-12-07T16:20:12.776772-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.11","depends_on_id":"cass_memory_system-5eh.4","type":"blocks","created_at":"2025-12-07T16:20:12.858635-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-5eh.12","title":"Context Command: cass-memory context (P2 - Generator)","description":"# Feature: Context Command (The Generator)\n\n## Purpose\nThe \"Generator\" phase of ACE: retrieve relevant context BEFORE starting a task.\nThis is the primary interface for agents to access accumulated knowledge.\n\n## Usage\n```bash\ncass-memory context \"Fix authentication timeout bug\" --json\ncass-memory context \"Add dark mode support\" --top 10 --days 30\n```\n\n## Process Flow\n```\n1. Parse task description\n2. Generate search keywords (LLM or heuristic)\n3. Score playbook bullets by relevance\n4. Query cass for relevant history\n5. Check deprecated patterns for warnings\n6. Format output (JSON or human)\n```\n\n## Implementation\n```typescript\nasync function contextCommand(task: string, flags: ContextFlags): Promise\u003cvoid\u003e {\n  const config = await loadConfig();\n  const playbook = await loadMergedPlaybook(config);\n  \n  // 1. Extract keywords from task\n  const keywords = extractKeywords(task);\n  \n  // 2. Score and filter bullets\n  const scoredBullets = playbook.bullets\n    .filter(b =\u003e !b.deprecated \u0026\u0026 b.state !== \"retired\")\n    .map(b =\u003e ({\n      ...b,\n      relevanceScore: scoreBulletRelevance(b.content, b.tags, keywords),\n      effectiveScore: getEffectiveScore(b, config)\n    }))\n    .filter(b =\u003e b.relevanceScore \u003e 0)\n    .sort((a, b) =\u003e (b.relevanceScore * b.effectiveScore) - (a.relevanceScore * a.effectiveScore))\n    .slice(0, flags.top || config.maxBulletsInContext);\n  \n  // 3. Query cass for history\n  const cassHits = await safeCassSearch(keywords.join(\" \"), {\n    limit: flags.history || config.maxHistoryInContext,\n    days: flags.days || config.sessionLookbackDays\n  }, config.cassPath);\n  \n  // 4. Check deprecated patterns\n  const warnings = checkDeprecatedPatterns(task, playbook.deprecatedPatterns);\n  \n  // 5. Format output\n  const result: ContextResult = {\n    task,\n    bullets: scoredBullets.map(b =\u003e ({\n      id: b.id,\n      content: b.content,\n      category: b.category,\n      kind: b.kind,\n      relevanceScore: b.relevanceScore,\n      effectiveScore: b.effectiveScore\n    })),\n    history: cassHits,\n    warnings,\n    formattedPrompt: formatContextPrompt(scoredBullets, cassHits, warnings)\n  };\n  \n  output(result, formatContextHuman, flags);\n}\n```\n\n## JSON Output Format (P2)\n```json\n{\n  \"task\": \"Fix authentication timeout bug\",\n  \"bullets\": [\n    {\n      \"id\": \"b-abc123\",\n      \"content\": \"For auth timeout issues, check session TTL in config...\",\n      \"category\": \"debugging\",\n      \"kind\": \"workflow_rule\",\n      \"relevanceScore\": 8.5,\n      \"effectiveScore\": 12.3\n    }\n  ],\n  \"history\": [\n    {\n      \"source_path\": \"~/.claude/sessions/abc.jsonl\",\n      \"line_number\": 142,\n      \"agent\": \"claude\",\n      \"snippet\": \"Fixed auth timeout by increasing session TTL...\",\n      \"score\": 0.85\n    }\n  ],\n  \"warnings\": [\n    \"Deprecated: AuthHandler - use AuthService from @/lib/auth\"\n  ],\n  \"formattedPrompt\": \"## PLAYBOOK CONTEXT\\n...\"\n}\n```\n\n## Human Output Format\n```\n═══════════════════════════════════════════════════════════════\nCONTEXT FOR: Fix authentication timeout bug\n═══════════════════════════════════════════════════════════════\n\nRELEVANT PLAYBOOK RULES (5 bullets):\n\n[b-abc123] debugging/workflow_rule (score: 12.3)\n  For auth timeout issues, check session TTL in config first.\n  Set TTL to match your expected session duration.\n\n[b-def456] debugging/stack_pattern (score: 8.7)\n  When debugging timeouts, enable DEBUG=auth:* for verbose logs.\n\nHISTORICAL CONTEXT (3 sessions):\n\n1. ~/.claude/sessions/abc.jsonl:142 (claude, 2 days ago)\n   \"Fixed auth timeout by increasing session TTL from 3600 to 7200\"\n\n⚠️ WARNINGS:\n  • Deprecated: AuthHandler - use AuthService from @/lib/auth\n\nSUGGESTED SEARCHES:\n  cass search \"auth timeout session\" --days 30\n  cass search \"TTL configuration\" --agent claude\n```","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T16:19:52.707712-05:00","updated_at":"2025-12-07T19:29:08.54476-05:00","closed_at":"2025-12-07T19:28:50.742628-05:00","dependencies":[{"issue_id":"cass_memory_system-5eh.12","depends_on_id":"cass_memory_system-5eh","type":"parent-child","created_at":"2025-12-07T16:19:52.708943-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.12","depends_on_id":"cass_memory_system-5eh.10","type":"blocks","created_at":"2025-12-07T16:20:12.924502-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.12","depends_on_id":"cass_memory_system-5eh.8","type":"blocks","created_at":"2025-12-07T16:20:13.002126-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.12","depends_on_id":"cass_memory_system-5eh.4","type":"blocks","created_at":"2025-12-07T16:20:13.07105-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.12","depends_on_id":"cass_memory_system-5eh.6","type":"blocks","created_at":"2025-12-07T16:20:13.144343-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.12","depends_on_id":"cass_memory_system-5eh.5","type":"blocks","created_at":"2025-12-07T16:20:13.21074-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-5eh.2","title":"Type System: Complete TypeScript Interfaces + Zod Schemas","description":"# Feature: Type System (src/types.ts)\n\n## Purpose\nDefine all TypeScript interfaces and Zod schemas that form the contract for\nthe entire system. This is the most critical file - everything depends on it.\n\n## Key Data Models\n\n### PlaybookBullet (Enhanced)\n```typescript\ninterface PlaybookBullet {\n  // Identity\n  id: string;                    // \"b-{timestamp36}-{random}\"\n  \n  // Scope\n  scope: \"global\" | \"workspace\";\n  workspace?: string;\n  \n  // Content\n  category: string;\n  content: string;               // 10-500 chars\n  searchPointer?: string;        // Optional cass query\n  \n  // Kind (NEW - P14)\n  kind: \"project_convention\" | \"stack_pattern\" | \"workflow_rule\" | \"anti_pattern\";\n  \n  // State Lifecycle (NEW - P10)\n  state: \"draft\" | \"active\" | \"retired\";\n  \n  // Tracking with decay (NEW - P1)\n  feedbackEvents: FeedbackEvent[];  // Timestamped events\n  \n  // Legacy counts (computed from feedbackEvents)\n  helpfulCount: number;\n  harmfulCount: number;\n  \n  // Lifecycle timestamps\n  createdAt: string;\n  updatedAt: string;\n  deprecated: boolean;\n  replacedBy?: string;\n  deprecationReason?: string;\n  \n  // Provenance\n  sourceSessions: string[];\n  sourceAgents: string[];\n  \n  // Tagging\n  tags: string[];\n  \n  // Computed (optional, cached)\n  embedding?: number[];\n}\n```\n\n### FeedbackEvent (NEW - P1)\n```typescript\ninterface FeedbackEvent {\n  type: \"helpful\" | \"harmful\";\n  timestamp: string;              // ISO 8601\n  sessionPath?: string;\n  reason?: string;                // For harmful\n  decayedValue?: number;          // Cached after decay calculation\n}\n```\n\n### DiaryEntry\n- id, sessionPath\n- timestamp, agent, workspace, duration\n- status: success | failure | mixed\n- accomplishments, decisions, challenges, preferences, keyLearnings\n- relatedSessions (cross-agent enrichment)\n- tags, searchAnchors\n\n### Delta Types\n- add, helpful, harmful, replace, deprecate, merge\n\n### Configuration\n- Provider settings (openai/anthropic/google)\n- Path settings (playbookPath, diaryDir)\n- Thresholds (dedup, prune, maxIterations)\n- Feature flags\n\n## Zod Schemas\nAll interfaces must have corresponding Zod schemas for:\n1. Runtime validation\n2. LLM structured output (generateObject)\n3. YAML parsing validation\n\n## Acceptance Criteria\n- All types from plan implemented\n- Zod schemas match interfaces\n- Export all types for use across modules\n- TSDoc comments on complex types","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T16:17:16.768077-05:00","updated_at":"2025-12-07T18:48:03.190304-05:00","closed_at":"2025-12-07T18:43:51.864498-05:00","dependencies":[{"issue_id":"cass_memory_system-5eh.2","depends_on_id":"cass_memory_system-5eh","type":"parent-child","created_at":"2025-12-07T16:17:16.768997-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.2","depends_on_id":"cass_memory_system-5eh.1","type":"blocks","created_at":"2025-12-07T16:20:11.467488-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-5eh.3","title":"Utility Functions: src/utils.ts","description":"# Feature: Utility Functions (src/utils.ts)\n\n## Purpose\nShared utility functions used across all modules. Extracted to avoid duplication\nand ensure consistent behavior.\n\n## Function Categories\n\n### Path Utilities\n- `expandPath(p)` - Expand ~ to homedir\n- `ensureDir(dir)` - Create directory recursively\n- `fileExists(path)` - Check file existence\n\n### Content Hashing \u0026 Deduplication\n- `hashContent(content)` - SHA256 hash for content comparison\n- `jaccardSimilarity(a, b)` - Token-based similarity (0-1)\n- `tokenize(text)` - Split text into searchable tokens\n\n### ID Generation\n- `generateBulletId()` - \"b-{timestamp36}-{random}\"\n- `generateDiaryId(sessionPath)` - \"diary-{hash}\"\n\n### Date/Time Utilities\n- `now()` - ISO 8601 timestamp\n- `daysAgo(n)` - Date n days in the past\n- `formatRelativeTime(iso)` - \"2 days ago\", \"3 weeks ago\"\n\n### Text Utilities\n- `extractKeywords(text)` - Extract searchable keywords (stopwords removed)\n- `truncate(text, maxLen)` - Truncate with \"...\"\n\n### Scoring\n- `scoreBulletRelevance(content, tags, keywords)` - Keyword-based relevance score\n\n### Logging\n- `log(msg, verbose)` - Conditional stderr logging\n- `error(msg)` - Error logging to stderr\n\n## Design Decisions\n- All functions are pure where possible\n- No side effects except logging\n- Consistent error handling\n\n## Testing Notes\nThese utilities should have unit tests since they're foundational.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T16:17:55.017717-05:00","updated_at":"2025-12-07T18:48:03.191899-05:00","closed_at":"2025-12-07T18:45:45.316556-05:00","dependencies":[{"issue_id":"cass_memory_system-5eh.3","depends_on_id":"cass_memory_system-5eh","type":"parent-child","created_at":"2025-12-07T16:17:55.018825-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.3","depends_on_id":"cass_memory_system-5eh.2","type":"blocks","created_at":"2025-12-07T16:20:11.552947-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-5eh.4","title":"cass Integration Wrapper: src/cass.ts","description":"# Feature: cass Integration Wrapper (src/cass.ts)\n\n## Purpose\nRobust wrapper around the cass CLI for searching, exporting, and managing\nagent session history. Handles errors gracefully with automatic recovery.\n\n## Functions to Implement\n\n### Health \u0026 Availability\n- `cassAvailable(cassPath)` - Check if cass is in PATH\n- `cassNeedsIndex(cassPath)` - Check if index needs rebuild\n\n### Index Management\n- `cassIndex(cassPath, opts)` - Run full or incremental index rebuild\n\n### Search\n- `cassSearch(query, opts, cassPath)` - Execute search, return hits\n- `safeCassSearch(query, opts, cassPath)` - With automatic error recovery\n\n### Export \u0026 View\n- `cassExport(sessionPath, format, cassPath)` - Export session to markdown/json\n- `cassExpand(sessionPath, lineNum, context, cassPath)` - Get context around line\n\n### Stats\n- `cassStats(cassPath)` - Get overall cass statistics\n- `cassTimeline(days, cassPath)` - Get session timeline\n\n## Error Handling (CRITICAL)\nThe cass CLI has specific exit codes that we must handle:\n- 0: success\n- 2: usage_error (non-retryable)\n- 3: index_missing (retryable: rebuild index)\n- 4: not_found (non-retryable)\n- 5: idempotency_mismatch (non-retryable)\n- 9: unknown (non-retryable)\n- 10: timeout (retryable: reduce limit)\n\n## Implementation Details\n- Use execSync for synchronous calls (simpler, avoids callback hell)\n- maxBuffer: 50MB (cass can return large results)\n- Default timeout: 30s per search\n- Always use --robot flag for machine-readable JSON output\n\n## Example Usage\n```typescript\nconst hits = await safeCassSearch(\"authentication error\", {\n  limit: 10,\n  days: 30,\n  agent: [\"claude\", \"cursor\"]\n});\n```","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T16:17:56.366967-05:00","updated_at":"2025-12-07T18:53:18.24189-05:00","closed_at":"2025-12-07T18:48:29.25231-05:00","dependencies":[{"issue_id":"cass_memory_system-5eh.4","depends_on_id":"cass_memory_system-5eh","type":"parent-child","created_at":"2025-12-07T16:17:56.367838-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.4","depends_on_id":"cass_memory_system-5eh.2","type":"blocks","created_at":"2025-12-07T16:20:11.627164-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.4","depends_on_id":"cass_memory_system-5eh.3","type":"blocks","created_at":"2025-12-07T16:20:11.706207-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-5eh.5","title":"Secret Sanitization Pipeline (P12 - Security Critical)","description":"# Feature: Secret Sanitization (SECURITY CRITICAL)\n\n## Purpose\nPrevent secrets (API keys, tokens, passwords, private keys) from being stored\nin diary entries, playbook bullets, or any persistent storage.\n\n## Risk Assessment\n- **Impact**: Critical - leaked secrets could compromise systems\n- **Likelihood**: High - agent sessions often contain env vars, configs\n- **Priority**: P12 rated ∞ (security-critical, non-negotiable)\n\n## High-Yield Patterns to Detect\n```typescript\nconst SECRET_PATTERNS = [\n  // AWS\n  { pattern: /AKIA[0-9A-Z]{16}/g, replacement: \"[AWS_ACCESS_KEY]\" },\n  { pattern: /[A-Za-z0-9/+=]{40}(?=\\s|$|\")/g, replacement: \"[AWS_SECRET_KEY]\" },\n  \n  // Generic API keys/tokens\n  { pattern: /Bearer\\s+[A-Za-z0-9\\-\\._~\\+\\/]+=*/g, replacement: \"[BEARER_TOKEN]\" },\n  { pattern: /api[_-]?key[\"\\s:=]+[\"']?[A-Za-z0-9\\-_]{20,}[\"']?/gi, replacement: \"[API_KEY]\" },\n  { pattern: /token[\"\\s:=]+[\"']?[A-Za-z0-9\\-_]{20,}[\"']?/gi, replacement: \"[TOKEN]\" },\n  \n  // Private keys\n  { pattern: /-----BEGIN.*PRIVATE KEY-----[\\s\\S]+?-----END.*PRIVATE KEY-----/g, replacement: \"[PRIVATE_KEY]\" },\n  \n  // Passwords\n  { pattern: /password[\"\\s:=]+[\"'][^\"']{8,}[\"']/gi, replacement: 'password=\"[REDACTED]\"' },\n  \n  // GitHub tokens\n  { pattern: /ghp_[A-Za-z0-9]{36}/g, replacement: \"[GITHUB_PAT]\" },\n  { pattern: /github_pat_[A-Za-z0-9_]{22,}/g, replacement: \"[GITHUB_PAT]\" },\n  \n  // Slack tokens\n  { pattern: /xox[baprs]-[A-Za-z0-9-]+/g, replacement: \"[SLACK_TOKEN]\" },\n  \n  // Database URLs with credentials\n  { pattern: /(postgres|mysql|mongodb):\\/\\/[^:]+:[^@]+@/gi, replacement: \"$1://[USER]:[PASS]@\" }\n];\n```\n\n## Sanitization Points (WHERE to apply)\n1. After cassExport(), before passing to LLM\n2. Before writing DiaryEntry to disk\n3. Before storing content in PlaybookBullet\n4. In context output (already sanitized if stored sanitized)\n\n## Configuration\n```json\n{\n  \"sanitization\": {\n    \"enabled\": true,\n    \"extraPatterns\": [\"INTERNAL_[A-Z_]+_KEY\"]\n  }\n}\n```\n\n## API\n```typescript\nfunction sanitize(text: string, config: SanitizationConfig): string\n```\n\n## Testing Requirements\n- Test each pattern category\n- Test that sanitization is idempotent\n- Test edge cases (partial matches, nested patterns)\n- Verify no false positives on common code patterns","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T16:17:56.611313-05:00","updated_at":"2025-12-07T18:59:22.349637-05:00","closed_at":"2025-12-07T18:59:16.767629-05:00","dependencies":[{"issue_id":"cass_memory_system-5eh.5","depends_on_id":"cass_memory_system-5eh","type":"parent-child","created_at":"2025-12-07T16:17:56.612015-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.5","depends_on_id":"cass_memory_system-5eh.3","type":"blocks","created_at":"2025-12-07T16:20:11.773389-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-5eh.6","title":"Confidence Decay + Effective Score Algorithms (P1, P4)","description":"# Feature: Confidence Decay + Effective Score Algorithms\n\n## Purpose\nImplement the highest-ROI feature (20× impact): confidence decay based on\nevent timestamps. Old feedback matters less than recent feedback, preventing\n\"fossilization\" where stale rules persist indefinitely.\n\n## The Problem Being Solved\nWithout decay:\n- A rule marked helpful 50 times 2 years ago stays \"proven\" forever\n- Even if it's now causing problems, its historical weight dominates\n- The playbook becomes fossilized with outdated rules\n\nWith decay:\n- Recent feedback (last 30 days) has full weight\n- Older feedback decays exponentially (half-life: 90 days)\n- Rules must continue proving useful to maintain high scores\n\n## Decay Algorithm\n```typescript\nfunction calculateDecayedValue(\n  event: FeedbackEvent,\n  now: Date,\n  halfLifeDays: number = 90\n): number {\n  const eventDate = new Date(event.timestamp);\n  const ageMs = now.getTime() - eventDate.getTime();\n  const ageDays = ageMs / (1000 * 60 * 60 * 24);\n  \n  // Exponential decay: value = 1 * (0.5)^(age/halfLife)\n  const decayFactor = Math.pow(0.5, ageDays / halfLifeDays);\n  return decayFactor;\n}\n\nfunction getDecayedCounts(bullet: PlaybookBullet, config: Config): {\n  decayedHelpful: number;\n  decayedHarmful: number;\n} {\n  const now = new Date();\n  let decayedHelpful = 0;\n  let decayedHarmful = 0;\n  \n  for (const event of bullet.feedbackEvents) {\n    const decayed = calculateDecayedValue(event, now, config.decayHalfLifeDays);\n    if (event.type === \"helpful\") decayedHelpful += decayed;\n    else decayedHarmful += decayed;\n  }\n  \n  return { decayedHelpful, decayedHarmful };\n}\n```\n\n## Effective Score Algorithm (P4 - 4× harmful multiplier)\n```typescript\nfunction getEffectiveScore(bullet: PlaybookBullet, config: Config): number {\n  const { decayedHelpful, decayedHarmful } = getDecayedCounts(bullet, config);\n  \n  // Key insight: harmful feedback weighs 4× more than helpful\n  // This surfaces problematic rules FAST\n  const rawScore = decayedHelpful - (4 * decayedHarmful);\n  \n  // Maturity multiplier (proven rules get slight boost)\n  const maturityMultiplier = {\n    draft: 0.8,\n    active: 1.0,\n    proven: 1.2,\n    retired: 0.1\n  }[bullet.state] || 1.0;\n  \n  return rawScore * maturityMultiplier;\n}\n```\n\n## Why 4× Harmful Multiplier?\n- A rule that helps 3 times but hurts once is NET NEGATIVE\n- This matches intuition: one bad recommendation erodes trust\n- Forces rules to be consistently helpful, not just occasionally useful\n\n## Maturity State Calculation\n```typescript\nfunction calculateMaturityState(bullet: PlaybookBullet, config: Config): State {\n  const { decayedHelpful, decayedHarmful } = getDecayedCounts(bullet, config);\n  const total = decayedHelpful + decayedHarmful;\n  const harmfulRatio = total \u003e 0 ? decayedHarmful / total : 0;\n  \n  // Transitions\n  if (bullet.deprecated) return \"retired\";\n  if (harmfulRatio \u003e 0.3) return \"retired\";  // Too harmful\n  if (total \u003c 3) return \"draft\";              // Not enough data\n  if (decayedHelpful \u003e= 10 \u0026\u0026 harmfulRatio \u003c 0.1) return \"proven\";\n  return \"active\";\n}\n```\n\n## Configuration\n```json\n{\n  \"scoring\": {\n    \"decayHalfLifeDays\": 90,\n    \"harmfulMultiplier\": 4,\n    \"minFeedbackForActive\": 3,\n    \"minHelpfulForProven\": 10,\n    \"maxHarmfulRatioForProven\": 0.1\n  }\n}\n```","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T16:18:47.062937-05:00","updated_at":"2025-12-07T18:48:03.193769-05:00","closed_at":"2025-12-07T18:44:45.078432-05:00","dependencies":[{"issue_id":"cass_memory_system-5eh.6","depends_on_id":"cass_memory_system-5eh","type":"parent-child","created_at":"2025-12-07T16:18:47.063676-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.6","depends_on_id":"cass_memory_system-5eh.2","type":"blocks","created_at":"2025-12-07T16:20:11.844066-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-5eh.7","title":"Configuration Management: Load/Save/Cascade","description":"# Feature: Configuration Management\n\n## Purpose\nHandle configuration loading, saving, and cascading from global to repo-level.\n\n## Configuration Locations (in priority order)\n1. CLI flags (highest priority)\n2. `.cass/config.yaml` (repo-level)\n3. `~/.cass-memory/config.json` (user-level)\n4. Built-in defaults (lowest priority)\n\n## Config Schema\n```typescript\ninterface Config {\n  // Schema version for migrations\n  schema_version: number;\n  \n  // LLM Provider\n  provider: \"openai\" | \"anthropic\" | \"google\";\n  model: string;\n  \n  // Paths\n  playbookPath: string;\n  diaryDir: string;\n  cassPath: string;\n  \n  // Reflection settings\n  maxReflectorIterations: number;  // 1-3\n  dedupSimilarityThreshold: number; // 0.0-1.0\n  pruneHarmfulThreshold: number;    // Auto-prune if harmful \u003e N\n  \n  // Context settings\n  maxBulletsInContext: number;\n  maxHistoryInContext: number;\n  \n  // Scoring settings\n  decayHalfLifeDays: number;\n  harmfulMultiplier: number;\n  \n  // Session settings\n  sessionLookbackDays: number;\n  validationLookbackDays: number;\n  \n  // Feature flags\n  validationEnabled: boolean;\n  autoReflect: boolean;\n  enrichWithCrossAgent: boolean;\n  semanticSearchEnabled: boolean;\n  \n  // Sanitization\n  sanitization: {\n    enabled: boolean;\n    extraPatterns: string[];\n  };\n  \n  // Logging\n  verbose: boolean;\n  jsonOutput: boolean;\n}\n```\n\n## Functions to Implement\n```typescript\n// Load config with cascading priority\nasync function loadConfig(cliOverrides?: Partial\u003cConfig\u003e): Promise\u003cConfig\u003e;\n\n// Save config (only to user-level)\nasync function saveConfig(config: Config): Promise\u003cvoid\u003e;\n\n// Get default config\nfunction getDefaultConfig(): Config;\n\n// Merge configs (used internally)\nfunction mergeConfigs(...configs: Partial\u003cConfig\u003e[]): Config;\n\n// Validate config against schema\nfunction validateConfig(config: unknown): Config;\n```\n\n## YAML Normalization\nAccept both snake_case and camelCase in YAML, always emit camelCase:\n```typescript\nfunction normalizeYamlKeys(obj: any): any {\n  // snake_case → camelCase\n  // e.g., \"helpful_count\" → \"helpfulCount\"\n}\n```","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T16:18:48.457336-05:00","updated_at":"2025-12-07T18:58:39.661538-05:00","closed_at":"2025-12-07T18:58:38.521139-05:00","dependencies":[{"issue_id":"cass_memory_system-5eh.7","depends_on_id":"cass_memory_system-5eh","type":"parent-child","created_at":"2025-12-07T16:18:48.458502-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.7","depends_on_id":"cass_memory_system-5eh.2","type":"blocks","created_at":"2025-12-07T16:20:11.912673-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.7","depends_on_id":"cass_memory_system-5eh.3","type":"blocks","created_at":"2025-12-07T16:20:11.987946-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-5eh.8","title":"Playbook YAML Read/Write: src/playbook.ts","description":"# Feature: Playbook YAML Read/Write (src/playbook.ts)\n\n## Purpose\nHandle all playbook operations: loading, saving, creating new playbooks,\nand cascading global + repo-level playbooks.\n\n## Playbook File Format\n```yaml\nschema_version: 2\nname: \"project-playbook\"\ndescription: \"Auto-generated from cass-memory reflections\"\n\nmetadata:\n  createdAt: \"2025-12-01T00:00:00Z\"\n  lastReflection: \"2025-12-07T10:00:00Z\"\n  totalReflections: 42\n  totalSessionsProcessed: 156\n\ndeprecatedPatterns:\n  - pattern: \"AuthHandler\"\n    deprecatedAt: \"2025-10-01\"\n    reason: \"Moved to AuthService v2\"\n    replacement: \"Use AuthService from @/lib/auth\"\n\nbullets:\n  - id: \"b-1a2b3c4d-x7y8\"\n    category: \"testing\"\n    scope: \"global\"\n    kind: \"stack_pattern\"\n    state: \"proven\"\n    content: |\n      For React hooks, test returned values and effects separately\n      using renderHook from @testing-library/react-hooks\n    searchPointer: \"cass search 'react hook testing renderHook'\"\n    feedbackEvents:\n      - type: \"helpful\"\n        timestamp: \"2025-12-05T09:00:00Z\"\n        sessionPath: \"~/.claude/sessions/abc.jsonl\"\n    helpfulCount: 8\n    harmfulCount: 1\n    tags: [\"react\", \"testing\", \"hooks\"]\n    sourceSessions:\n      - \"~/.claude/projects/app/session-001.jsonl:142\"\n    sourceAgents: [\"claude\", \"cursor\"]\n    createdAt: \"2025-11-15T14:30:00Z\"\n    updatedAt: \"2025-12-05T09:00:00Z\"\n```\n\n## Functions to Implement\n```typescript\n// Load single playbook from path\nasync function loadPlaybook(path: string): Promise\u003cPlaybook\u003e;\n\n// Load merged playbook (global + repo)\nasync function loadMergedPlaybook(config: Config): Promise\u003cPlaybook\u003e;\n\n// Save playbook to path\nasync function savePlaybook(playbook: Playbook, path: string): Promise\u003cvoid\u003e;\n\n// Create empty playbook\nfunction createEmptyPlaybook(name?: string): Playbook;\n\n// Merge two playbooks (for cascading)\nfunction mergePlaybooks(global: Playbook, repo: Playbook | null): Playbook;\n\n// Find bullet by ID\nfunction findBullet(playbook: Playbook, id: string): PlaybookBullet | undefined;\n\n// Add bullet to playbook (with dedup check)\nfunction addBullet(playbook: Playbook, bullet: NewBulletData): PlaybookBullet;\n\n// Update bullet\nfunction updateBullet(playbook: Playbook, id: string, updates: Partial\u003cPlaybookBullet\u003e): boolean;\n```\n\n## Cascading Logic (\"Memory as Code\")\nWhen in a git repo with `.cass/playbook.yaml`:\n1. Load global playbook from ~/.cass-memory/playbook.yaml\n2. Load repo playbook from .cass/playbook.yaml\n3. Merge with repo taking precedence for same-ID bullets\n4. Filter out toxic bullets from both levels\n5. Return merged playbook\n\nThis enables \"team brain\" - new developers inherit project rules automatically.\n\n## Toxic Bullet Filtering\n```typescript\nconst globalToxic = await loadToxicLog(\"~/.cass-memory/toxic_bullets.log\");\nconst repoToxic = await loadToxicLog(\"./.cass/toxic.log\");\nmerged.bullets = merged.bullets.filter(b =\u003e\n  !isSemanticallyToxic(b.content, [...globalToxic, ...repoToxic])\n);\n```","notes":"Reserved src/playbook.ts; implementing load/save/merge cascade, fixing schema mismatches.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T16:18:49.646748-05:00","updated_at":"2025-12-07T19:00:55.144954-05:00","closed_at":"2025-12-07T19:00:47.925634-05:00","dependencies":[{"issue_id":"cass_memory_system-5eh.8","depends_on_id":"cass_memory_system-5eh","type":"parent-child","created_at":"2025-12-07T16:18:49.647737-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.8","depends_on_id":"cass_memory_system-5eh.2","type":"blocks","created_at":"2025-12-07T16:20:12.059588-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.8","depends_on_id":"cass_memory_system-5eh.3","type":"blocks","created_at":"2025-12-07T16:20:12.142259-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.8","depends_on_id":"cass_memory_system-5eh.6","type":"blocks","created_at":"2025-12-07T16:20:12.210115-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-5eh.9","title":"LLM Provider Abstraction: src/llm.ts","description":"# Feature: LLM Provider Abstraction (src/llm.ts)\n\n## Purpose\nAbstract LLM interactions using Vercel AI SDK, supporting multiple providers\n(OpenAI, Anthropic, Google) with a unified interface.\n\n## Why Vercel AI SDK?\n1. Provider-agnostic: Same code works with any provider\n2. Structured output: generateObject with Zod schemas\n3. Streaming: Built-in support (useful for future MCP server)\n4. Type safety: Full TypeScript support\n\n## Provider Setup\n```typescript\nimport { createOpenAI } from \"@ai-sdk/openai\";\nimport { createAnthropic } from \"@ai-sdk/anthropic\";\nimport { createGoogleGenerativeAI } from \"@ai-sdk/google\";\nimport { generateObject, generateText } from \"ai\";\n\nfunction getModel(config: Config) {\n  const apiKey = getApiKeyFromEnv(config.provider);\n  \n  switch (config.provider) {\n    case \"openai\": return createOpenAI({ apiKey })(config.model);\n    case \"anthropic\": return createAnthropic({ apiKey })(config.model);\n    case \"google\": return createGoogleGenerativeAI({ apiKey })(config.model);\n  }\n}\n```\n\n## Environment Variables\n- `OPENAI_API_KEY` for OpenAI\n- `ANTHROPIC_API_KEY` for Anthropic\n- `GOOGLE_GENERATIVE_AI_API_KEY` for Google\n\n## Functions to Implement\n\n### Structured Output (for reflection pipeline)\n```typescript\nasync function extractDiary\u003cT\u003e(\n  schema: z.ZodSchema\u003cT\u003e,\n  sessionContent: string,\n  metadata: SessionMetadata,\n  config: Config\n): Promise\u003cT\u003e;\n\nasync function runReflector\u003cT\u003e(\n  schema: z.ZodSchema\u003cT\u003e,\n  diary: DiaryEntry,\n  existingBullets: string,\n  cassHistory: string,\n  iteration: number,\n  config: Config\n): Promise\u003cT\u003e;\n\nasync function runValidator\u003cT\u003e(\n  schema: z.ZodSchema\u003cT\u003e,\n  proposedRule: string,\n  evidence: string,\n  config: Config\n): Promise\u003cT\u003e;\n```\n\n### Text Generation (for context)\n```typescript\nasync function generateContext(\n  task: string,\n  bullets: string,\n  history: string,\n  deprecatedPatterns: string,\n  config: Config\n): Promise\u003cstring\u003e;\n\nasync function generateSearchQueries(\n  task: string,\n  config: Config\n): Promise\u003cstring[]\u003e;\n```\n\n## Prompt Templates\nDefined in PROMPTS constant:\n- `PROMPTS.diary` - Extract structured diary from session\n- `PROMPTS.reflector` - Generate delta proposals\n- `PROMPTS.validator` - Validate rules against evidence\n- `PROMPTS.context` - Generate pre-task briefing\n- `PROMPTS.audit` - Check session for rule violations\n\n## Error Handling\n- Rate limit handling with exponential backoff\n- Token limit checking before sending\n- Graceful degradation if API unavailable","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T16:19:49.140355-05:00","updated_at":"2025-12-07T18:59:22.353027-05:00","closed_at":"2025-12-07T18:58:39.559647-05:00","dependencies":[{"issue_id":"cass_memory_system-5eh.9","depends_on_id":"cass_memory_system-5eh","type":"parent-child","created_at":"2025-12-07T16:19:49.141377-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.9","depends_on_id":"cass_memory_system-5eh.2","type":"blocks","created_at":"2025-12-07T16:20:12.286016-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5eh.9","depends_on_id":"cass_memory_system-5eh.7","type":"blocks","created_at":"2025-12-07T16:20:12.369566-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-5iw","title":"[Utils] ensureDir - Recursive directory creation","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:44:46.30019-05:00","updated_at":"2025-12-07T20:22:21.018357-05:00","closed_at":"2025-12-07T20:21:29.446378-05:00","comments":[{"id":3,"issue_id":"cass_memory_system-5iw","author":"jemanuel","text":"## Function Signature\n```typescript\nasync function ensureDir(dir: string): Promise\u003cvoid\u003e\n```\n\n## Implementation Details\n- Expand path using expandPath() first\n- Use fs.promises.mkdir(expandedPath, { recursive: true })\n- Handle EEXIST error gracefully (directory already exists)\n- Throw other errors (permission denied, invalid path, etc.)\n\n## Why This Matters\nUsed before writing any file to ensure parent directories exist. Prevents ENOENT errors when writing to nested paths like \"~/.cass-memory/sessions/2024/session.md\". The recursive option creates all parent directories in one call.\n\n## Edge Cases to Handle\n- Directory already exists - should succeed silently\n- Parent directory doesn't exist - create entire path\n- Permission denied - should throw with helpful message\n- Invalid path characters - should throw\n- Empty string - should throw or handle gracefully\n- Path is a file, not directory - mkdir will fail, let it throw","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-5l2","title":"[LLM] PROMPTS.audit - Rule violation detection prompt","description":"Prompt template for rule violation detection:\n\nVariables: {sessionSummary}, {rules}\n\nInstructions:\n- Identify clear violations where session contradicted playbook rule\n- Only report CLEAR violations, not minor deviations\n- For each violation provide: bulletId, evidence quote, severity assessment\n\nOutput schema:\n{\n  violations: Array\u003c{\n    bulletId: string,\n    evidence: string,\n    severity: 'low' | 'medium' | 'high'\n  }\u003e\n}\n\n---\n\nTemperature: 0.3 (consistency)\nUsed in audit workflows to detect when agents ignore playbook guidance.\n\nThis feeds into the HARMFUL delta mechanism - if rules are consistently violated, they may be wrong or poorly worded.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:56.106782-05:00","updated_at":"2025-12-07T18:55:28.717782-05:00","closed_at":"2025-12-07T18:55:03.549276-05:00"}
{"id":"cass_memory_system-5oro","title":"[Unit] playbook.ts - CRUD Operations \u0026 Merging (Part 1)","description":"## Target: src/playbook.ts (697 LOC) - ZERO CURRENT COVERAGE\n\n### Part 1: Basic CRUD Operations\n\n1. **createEmptyPlaybook()** - Factory function\n   - Returns valid PlaybookSchema object\n   - Has empty bullets array\n   - Has metadata fields initialized\n\n2. **loadPlaybook(path)** - Load from disk\n   - Valid YAML file → parsed playbook\n   - Missing file → null or error\n   - Invalid YAML → graceful error\n   - Empty file → empty playbook or error\n   - File with BOM handling\n   - Permission denied → appropriate error\n\n3. **savePlaybook(playbook, path)** - Save to disk\n   - Writes valid YAML\n   - Creates parent directories if needed\n   - Atomic write (temp file + rename)\n   - Preserves existing file permissions\n   - Handles concurrent access (file locking)\n\n4. **addBullet(playbook, bullet)** - Add new bullet\n   - Bullet added to array\n   - ID generated if missing\n   - Validates bullet schema\n   - Duplicate ID handling\n\n5. **updateBullet(playbook, id, updates)** - Update existing\n   - Finds by ID and updates\n   - Returns updated playbook\n   - Missing ID → error or no-op\n   - Partial updates work correctly\n   - feedbackEvents merge properly\n\n6. **removeBullet(playbook, id)** - Remove bullet\n   - Removes by ID\n   - Returns updated playbook\n   - Missing ID → no-op or error\n   - Cascading effects (if any)\n\n### File I/O Patterns:\n- Test with real temp files (no mocks)\n- Use bun's temp directory APIs\n- Clean up after tests\n- Test concurrent operations","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:27:49.322438-05:00","updated_at":"2025-12-08T14:00:46.990204-05:00","closed_at":"2025-12-08T14:00:46.990204-05:00","dependencies":[{"issue_id":"cass_memory_system-5oro","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:15.495388-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5oro","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:32:59.064513-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-5ss3","title":"[Docs] LICENSE file","description":"Create LICENSE file for the project.\n\nRecommended: MIT License\n- Permissive and widely used\n- Compatible with most projects\n- Allows commercial use\n- Simple and clear\n\nLicense text:\nMIT License\n\nCopyright (c) 2025 [Your Name/Organization]\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\n[Full MIT license text]\n\nInclude copyright notice in:\n- LICENSE file\n- README.md footer\n- Source file headers (optional)\n\nAlternative licenses to consider: Apache 2.0, BSD 3-Clause","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:45.349116-05:00","updated_at":"2025-12-07T20:44:14.84327-05:00","closed_at":"2025-12-07T20:43:24.25586-05:00"}
{"id":"cass_memory_system-5szc","title":"[Unit] Commands - init.ts, context.ts, doctor.ts","description":"## Target: src/commands/*.ts - CLI Commands (Part 1)\n\n### init.ts Tests:\n\n1. **initCommand(options)** - Global initialization\n   - Creates ~/.cass-memory/ structure\n   - Creates config.json\n   - Creates playbook.yaml\n   - --force flag reinitializes\n   - --json flag outputs JSON\n   - Already initialized message\n\n2. **initRepoCommand(options)** - Repo initialization\n   - Creates .cass/ in git repo\n   - Creates repo playbook.yaml\n   - Creates toxic.log\n   - --force flag for reinit\n   - Not in git repo → error\n\n### context.ts Tests:\n\n1. **contextCommand(query, options)** - Main context\n   - Returns context for query\n   - Scope filtering works\n   - Limit parameter works\n   - --json output valid\n   - No results case\n\n2. **buildContextResult(bullets, query)** - Result building\n   - Formats context properly\n   - Includes metadata\n   - Scores included\n\n### doctor.ts Tests:\n\n1. **doctorCommand(options)** - Health check\n   - Checks all components\n   - Reports issues clearly\n   - --json output structured\n   - Exit code reflects health\n   - Suggests fixes\n\n### CLI Testing Pattern:\n- Capture stdout/stderr\n- Test exit codes\n- Use temp directories\n- Clean up after tests","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:29:16.660059-05:00","updated_at":"2025-12-08T14:25:16.143051-05:00","closed_at":"2025-12-08T14:25:16.143051-05:00","dependencies":[{"issue_id":"cass_memory_system-5szc","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:20.282145-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5szc","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:33:02.108897-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5szc","depends_on_id":"cass_memory_system-1w95","type":"blocks","created_at":"2025-12-07T20:33:18.312966-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-5szc","depends_on_id":"cass_memory_system-anqj","type":"blocks","created_at":"2025-12-07T20:33:18.44551-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-5wrs","title":"[CLI:init] createDefaultConfig - Generate config.json","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:31.21189-05:00","updated_at":"2025-12-07T21:13:03.893118-05:00","closed_at":"2025-12-07T21:12:21.868169-05:00"}
{"id":"cass_memory_system-5zf","title":"[Security] Sanitization audit logging","description":"Implement sanitization audit logging to track when secrets are redacted.\n\nRequirements:\n1. When sanitization replaces something, log count of replacements\n2. NEVER log actual secrets or matched text\n3. Log format: \"[sanitize] Replaced N potential secrets in \u003ccontext\u003e\"\n4. Make logging optional via config flag\n\nLog levels:\n- INFO: Summary of replacements (\"Replaced 3 potential secrets\")\n- DEBUG: Which pattern types matched (\"Replaced: 2 AWS keys, 1 Bearer token\")\n- NEVER: Actual secret values or surrounding context\n\nExample logs:\n```\n[sanitize] Replaced 3 potential secrets in session-abc123\n[sanitize] Patterns matched: AWS_ACCESS_KEY(1), BEARER_TOKEN(2)\n[sanitize] No secrets detected in session-xyz789\n```\n\nConfiguration:\n```json\n{\n  \"sanitization\": {\n    \"enabled\": true,\n    \"auditLog\": true,  // Enable audit logging\n    \"auditLevel\": \"info\"  // \"info\" or \"debug\"\n  }\n}\n```\n\nPurpose:\n- Understand what's being caught\n- Verify sanitization is working\n- Debug pattern effectiveness\n- Compliance/security auditing\n\nPriority: 0 (Security Critical - P12)","notes":"Implemented audit logging for sanitization; added auditLog/auditLevel config defaults and schema; sanitize now counts replacements and logs summary/debug without exposing secrets.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:53.427417-05:00","updated_at":"2025-12-07T19:10:47.885719-05:00","closed_at":"2025-12-07T19:09:55.835319-05:00"}
{"id":"cass_memory_system-5zt","title":"[Diary] extractDiaryFields - LLM structured extraction","description":"Use LLM to extract structured diary fields from raw session content.\n\nFunction Signature:\nasync function extractDiaryFields(\n  sessionContent: string,\n  metadata: { sessionPath: string; agent: string; workspace?: string },\n  config: Config\n): Promise\u003cDiaryExtraction\u003e\n\nExtraction Schema (DiaryExtractionSchema):\n- status: 'success' | 'failure' | 'mixed' - Overall session outcome\n- accomplishments: string[] - What was completed/achieved\n- decisions: string[] - Design choices and rationale\n- challenges: string[] - Problems encountered and how addressed\n- preferences: string[] - User style and preference revelations\n- keyLearnings: string[] - Reusable insights and patterns\n- suggestedTags: string[] - Topic/domain tags for categorization\n\nProcess:\n1. Load diary prompt from PROMPTS.diary\n2. Inject session content and metadata into prompt\n3. Call LLM with structured output mode\n4. Validate response against DiaryExtractionSchema\n5. Return structured extraction\n\nKey Features:\n- Structured output guarantees valid schema\n- Rich prompt engineering for quality extraction\n- Metadata context improves accuracy\n- Configurable LLM model selection\n- Schema validation for type safety\n\nPrompt Engineering:\n- Extract actionable insights, not raw transcription\n- Focus on reusable knowledge over session details\n- Identify patterns in user preferences\n- Categorize by meaningful topics\n\nOutput:\nReturns DiaryExtraction object with all fields populated per schema.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:09.944826-05:00","updated_at":"2025-12-07T21:48:01.788774-05:00","closed_at":"2025-12-07T21:47:32.740073-05:00"}
{"id":"cass_memory_system-60ts","title":"[CLI] reflect command - Full reflection cycle","description":"Entry point for the reflect command that runs the full reflection cycle.\n\nCommand signature:\n```bash\ncass-memory reflect [options]\n\nOptions:\n  --days N           Look back N days (default: 7)\n  --max-sessions N   Max sessions to process (default: 20)\n  --agent AGENTS     Filter by agent (comma-separated)\n  --dry-run          Show deltas without applying\n  --json             Output as JSON\n```\n\nImplementation flow:\n1. Find unprocessed sessions (within day range, agent filter)\n2. For each session:\n   - Generate diary entry\n   - Run reflector to get deltas\n   - Run validator on add deltas\n3. Batch curate all validated deltas\n4. Update processed log\n5. Display results (deltas proposed/applied)\n\nThe reflect command orchestrates: find sessions → diary → reflect → validate → curate\n\nDependencies:\n- findUnprocessedSessions()\n- processSession()\n- batchCurate()\n- updateProcessedLog()\n- ProcessedLog management\n- Output formatting (human-readable and JSON)\n\nOutput format:\n```\nProcessed 12 sessions\n- 8 deltas proposed\n- 5 deltas applied after validation\n- 3 deltas rejected (low confidence)\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:49:20.259235-05:00","updated_at":"2025-12-07T20:50:01.813341-05:00","closed_at":"2025-12-07T20:49:51.277819-05:00"}
{"id":"cass_memory_system-646b","title":"Unit tests for cass.ts - Main orchestration","description":"Complete unit test coverage for cass.ts:\n- Main CLI orchestration logic\n- Command dispatch\n- Config loading and merging\n- Error handling at top level\n- Exit code handling\n- spawnSync integration points\nNO MOCKS - use real command invocations with fixtures","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:25:46.378265-05:00","updated_at":"2025-12-08T14:16:37.970218-05:00","closed_at":"2025-12-08T14:16:37.970218-05:00","dependencies":[{"issue_id":"cass_memory_system-646b","depends_on_id":"cass_memory_system-ai52","type":"blocks","created_at":"2025-12-07T20:28:09.836677-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-65cx","title":"[Testing:Integration] playbook-persistence.test.ts - Save/load tests","description":"Use temp directory for isolation:\nbeforeEach: create temp dir\nafterEach: rm temp dir\n\nTest cases:\n- Save and load roundtrip\n- Creates new if not exists\n- Handles corrupt YAML (backup + recreate)\n- Preserves all fields through cycle","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:37.63706-05:00","updated_at":"2025-12-08T02:11:04.909507-05:00","closed_at":"2025-12-08T02:11:04.909507-05:00"}
{"id":"cass_memory_system-65lf","title":"[CLI:reflect] batchCurate - Apply all validated deltas","description":"Aggregate and apply validated deltas from multiple sessions.\n\nFunction signature:\n```typescript\nfunction batchCurate(\n  playbook: Playbook,\n  allDeltas: PlaybookDelta[],\n  config: Config\n): CurationResult\n```\n\nImplementation:\n1. Aggregate deltas from all processed sessions:\n   - Combine validated deltas from each processSession() call\n   - Deduplicate similar deltas (same content/intent)\n   - Group by operation type (add/remove/modify)\n\n2. Run curator on aggregated deltas:\n   - Curator makes final decisions on what to apply\n   - Considers: playbook size limits, maturity rules, conflicts\n   - Returns accepted and rejected deltas\n\n3. Apply accepted deltas to playbook:\n   - For 'add': create new bullets (as candidates)\n   - For 'remove': deprecate or delete bullets\n   - For 'modify': update bullet fields\n   - Update playbook timestamps\n\n4. Return CurationResult:\n   ```typescript\n   {\n     applied: PlaybookDelta[];\n     rejected: PlaybookDelta[];\n     playbook: Playbook;  // updated\n     stats: {\n       totalProposed: number;\n       totalApplied: number;\n       byOperation: { add: number; remove: number; modify: number; }\n     }\n   }\n   ```\n\nDry-run mode:\n- If --dry-run flag: skip actual application\n- Return what *would* be applied\n- Don't save playbook changes\n\nThis is the final step before updating the processed log.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:50:05.765118-05:00","updated_at":"2025-12-07T21:13:03.894649-05:00","closed_at":"2025-12-07T21:12:44.998586-05:00"}
{"id":"cass_memory_system-65n","title":"[Validator] findDiaryBySession - Correlate session with diary","description":"$(cat /tmp/fix_65n.txt)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:44:55.776907-05:00","updated_at":"2025-12-07T22:23:09.069193-05:00","closed_at":"2025-12-07T22:23:09.069193-05:00"}
{"id":"cass_memory_system-699","title":"[Validator] generateValidationReport - Detailed validation output","description":"Implement the generateValidationReport function - Create comprehensive validation reports for audit and transparency.\n\nSIGNATURE:\n```typescript\nfunction generateValidationReport(\n  proposedRule: string,\n  gateResult: EvidenceGateResult,\n  llmResult?: ValidationResult\n): ValidationReport\n```\n\nVALIDATION REPORT TYPE:\n```typescript\ninterface ValidationReport {\n  proposedRule: string;\n  verdict: \"ACCEPT\" | \"REJECT\" | \"ACCEPT_WITH_CAUTION\";\n  confidence: number;         // 0.0 to 1.0\n  evidence: Array\u003c{\n    sessionPath: string;\n    agent: string;\n    supports: boolean;        // Does this evidence support the rule?\n    snippet: string;\n  }\u003e;\n  gateResult: EvidenceGateResult;\n  llmResult?: ValidationResult;\n  reason: string;             // Combined reasoning\n  refinedRule?: string;       // If LLM suggests improvement\n  timestamp: string;\n  metadata: {\n    sessionCount: number;\n    successCount: number;\n    failureCount: number;\n    llmUsed: boolean;\n  };\n}\n```\n\nREPORT GENERATION LOGIC:\n1. Combine gate result and LLM result\n2. Determine final verdict:\n   - Gate failed → REJECT\n   - Gate passed + LLM INVALID → REJECT\n   - Gate passed + LLM VALID → ACCEPT\n   - Gate passed + LLM VALID_WITH_CAUTION → ACCEPT_WITH_CAUTION\n   - Gate passed + no LLM (strong evidence) → ACCEPT\n3. Calculate confidence score\n4. Format evidence with support indicators\n5. Combine reasoning from gate and LLM\n6. Include metadata for debugging\n\nCONFIDENCE CALCULATION:\n```typescript\nif (gateResult.successCount \u003e= 5 \u0026\u0026 gateResult.failureCount === 0) {\n  confidence = 0.95;  // High confidence, no LLM needed\n} else if (llmResult) {\n  confidence = llmResult.confidence;\n} else {\n  confidence = 0.5;  // Default for edge cases\n}\n```\n\nOUTPUT FORMATS:\n- JSON: Full structured report\n- Markdown: Human-readable summary\n- CLI: Colored terminal output with verdict\n\nWHY THIS MATTERS:\n- Provides audit trail for all validation decisions\n- Makes scientific method transparent\n- Helps debug validation logic\n- Builds trust in automated rule acceptance\n\nDEPENDENCIES:\n- EvidenceGateResult type\n- ValidationResult type\n- CassHit type\n\nLOCATION:\n- src/validator/report.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:44:56.952411-05:00","updated_at":"2025-12-08T14:28:28.544679-05:00","closed_at":"2025-12-08T14:28:28.544679-05:00"}
{"id":"cass_memory_system-69v","title":"[Foundation] package.json with exact dependency versions","description":"Create package.json with exact dependency versions and build configuration for the CASS Memory System CLI tool.\n\n## Context\nThe CASS Memory System requires a well-defined package.json that supports cross-platform binary compilation, ESM modules, and integration with multiple LLM providers through the Vercel AI SDK.\n\n## Technical Specification\n\n### Dependencies:\n- ai@^4.0.0 - Vercel AI SDK core for provider-agnostic LLM integration\n- @ai-sdk/openai@^1.0.0 - OpenAI provider (GPT-4, GPT-3.5)\n- @ai-sdk/anthropic@^1.0.0 - Anthropic provider (Claude models)\n- @ai-sdk/google@^1.0.0 - Google provider (Gemini models)\n- zod@^3.23.0 - Runtime type validation for structured LLM outputs\n- yaml@^2.3.0 - YAML parsing for playbook and config files\n- chalk@^5.3.0 - Terminal output styling for user-friendly CLI\n\n### DevDependencies:\n- @types/bun@latest - TypeScript types for Bun runtime\n- typescript@^5.0.0 - TypeScript compiler for type checking\n\n### Scripts:\n- dev: bun run src/cass-memory.ts - Development mode with hot reload\n- build: bun build src/cass-memory.ts --compile --outfile dist/cass-memory - Build for current platform\n- build:all: Build for linux, macos, and windows\n- build:linux: bun build src/cass-memory.ts --compile --target=linux-x64 --outfile dist/cass-memory-linux\n- build:macos: bun build src/cass-memory.ts --compile --target=darwin-arm64 --outfile dist/cass-memory-macos\n- build:windows: bun build src/cass-memory.ts --compile --target=windows-x64 --outfile dist/cass-memory-windows.exe\n- typecheck: tsc --noEmit - Type checking without compilation\n- test: bun test - Run test suite\n\n### Configuration:\n- type: module - Enable ES modules\n- bin: cass-memory -\u003e ./dist/cass-memory.js - CLI entry point\n- name: cass-memory\n- version: 0.1.0 - Initial version\n- private: true - Not published to npm (distributed as binary)\n\n## Reasoning\n\n### Why Vercel AI SDK:\n1. Provider Agnostic: Single interface for OpenAI, Anthropic, Google - users choose their preferred LLM\n2. Structured Output: Native Zod integration for reliable structured responses (critical for playbook rule extraction)\n3. Streaming Support: Real-time output for long-running operations\n4. TypeScript-First: Excellent type safety and IntelliSense\n5. Active Development: Well-maintained with regular updates\n\n### Why Bun:\n1. Single Binary: Bun can compile TypeScript to standalone executables\n2. Fast: Native speed for file operations and process management\n3. Built-in TypeScript: No transpilation needed during development\n4. Cross-platform: Compile once, run anywhere\n\n### Why ESM:\n1. Modern Standard: ES modules are the future of JavaScript\n2. Better Tree Shaking: Smaller bundle sizes\n3. AI SDK Requirement: Vercel AI SDK v4 requires ESM\n\n## Acceptance Criteria\n\n- package.json exists in project root\n- All dependencies listed with correct versions\n- All devDependencies listed\n- All build scripts present and functional\n- type: module is set\n- bin entry points to correct file\n- bun install works without errors\n- bun run dev starts development mode\n- bun run build creates executable binary\n- bun run typecheck passes with no errors\n\n## How This Serves the Universal Agent Memory System\n\nThe package.json is the foundation contract for the entire CASS Memory System. It ensures:\n\n1. Multi-Provider Support: Agents can use any LLM provider their organization prefers\n2. Reliable Distribution: Compiled binaries mean no dependency hell for end users\n3. Type Safety: Zod validation ensures LLM outputs conform to expected schemas\n4. Developer Experience: Clear scripts and tooling enable rapid iteration\n5. Cross-Platform: Agents on any OS can use CASS Memory System\n\nWithout proper dependency management, the system cannot reliably integrate with LLMs or provide consistent behavior across environments.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:21.842607-05:00","updated_at":"2025-12-07T20:11:39.80838-05:00","closed_at":"2025-12-07T20:11:36.645512-05:00"}
{"id":"cass_memory_system-6jdf","title":"[Foundation] Define .cass/ repo-level directory structure","description":"Define and implement the .cass/ repository-level directory structure for project-specific CASS Memory System data.\n\n## Context\nThe .cass/ directory contains project-specific memory that is committed to version control and shared with the entire team. This enables 'memory as code' - the team's collective knowledge about the project is versioned alongside the codebase.\n\n## Technical Specification\n\n### Directory Structure:\n.cass/\n├── playbook.yaml            # Project-specific playbook (shared with team)\n├── config.yaml              # Project-level configuration overrides\n└── toxic.log                # Project-level blocked patterns\n\n### File Specifications:\n\n#### playbook.yaml (Project Playbook):\n- Project-specific rules that apply to this repository only\n- Merged with user's global playbook (~/.cass-memory/playbook.yaml)\n- Project rules take precedence over global rules\n- Categories: PROJECT_SETUP, BUILD, TEST, DEPLOY, ARCHITECTURE, etc.\n- Each bullet has:\n  - content: The rule itself\n  - context: When/why this rule applies\n  - priority: 0-10 (higher = more important)\n  - state: PROVEN, TESTING, CANDIDATE\n  - created_at: ISO timestamp\n  - created_by: User/agent who added it\n  - tags: [backend, frontend, ci, etc.]\n\nExample:\nyaml\nbullets:\n  - content: Always run tests with --coverage flag\n    context: Team requires 80% coverage for all PRs\n    priority: 9\n    state: PROVEN\n    created_at: 2025-12-01T10:00:00Z\n    created_by: cass-memory\n    tags: [test, ci]\n  \n  - content: Use Bun instead of npm for package management\n    context: Project uses Bun for faster installs and built-in TypeScript support\n    priority: 10\n    state: PROVEN\n    created_at: 2025-12-01T10:00:00Z\n    created_by: cass-memory\n    tags: [setup, deps]\n\n\n#### config.yaml (Project Configuration):\n- Overrides for project-specific settings\n- Does NOT contain API keys (those stay in ~/.cass-memory/config.json)\n- Can specify:\n  - preferred_model: Override user's default model for this project\n  - enable_curation: Project-level curation toggle\n  - evidence_threshold: Custom threshold for this project\n  - excluded_paths: Paths to ignore in reflections (e.g., generated/, vendor/)\n  - custom_categories: Project-specific bullet categories\n\nExample:\nyaml\npreferred_model: gpt-4  # This project uses GPT-4 for complex reasoning\nenable_curation: true\nevidence_threshold: 5\nexcluded_paths:\n  - generated/\n  - vendor/\n  - node_modules/\ncustom_categories:\n  - ARCHITECTURE\n  - API_DESIGN\n  - DATABASE\n\n\n#### toxic.log (Project Blocklist):\n- Newline-delimited list of blocked bullet content\n- Project-specific patterns to block\n- Committed to git so entire team blocks same patterns\n- Case-insensitive matching\n- Merged with user's global toxic_bullets.log\n\nExample:\ntext\nAlways use var for variables\nDisable all linting rules\nSkip writing tests for this file\n\n\n## Reasoning\n\n### Why .cass/ (Hidden Directory):\n1. Unix Convention: Hidden directories for metadata\n2. Doesn't Clutter: Not visible in normal directory listings\n3. Tool Convention: Like .git/, .github/, .vscode/\n\n### Why playbook.yaml in Git:\n1. Memory as Code: Team knowledge is versioned\n2. Shared Learning: New team members inherit project wisdom\n3. Code Review: Changes to playbook go through PR review\n4. Reproducibility: Same rules apply to all developers\n5. Time Travel: git log shows how project knowledge evolved\n\n### Why config.yaml Separate from config.json:\n1. Security: config.json (global) has API keys, never committed\n2. Team Settings: config.yaml (repo) has project settings, always committed\n3. Overrides: Repo settings override user settings\n\n### Why toxic.log in Git:\n1. Team Safety: Everyone blocks the same bad patterns\n2. Onboarding: New devs see what NOT to do\n3. Historical Record: Track why certain patterns were blocked\n4. Consistency: Entire team learns from mistakes\n\n### Why Project Playbook Takes Precedence:\n1. Specificity: Project needs override general preferences\n2. Team Alignment: Everyone follows project standards\n3. Flexibility: Users keep their personal rules for other projects\n\n## Acceptance Criteria\n\n- .cass/ directory is created on cass-memory init (repo mode)\n- playbook.yaml created with empty bullets array\n- config.yaml created with sensible defaults (or omitted if no overrides)\n- toxic.log created as empty file\n- .cass/ directory is NOT in .gitignore (should be committed)\n- Helper functions in utils.ts: resolveRepoDir(), ensureRepoStructure()\n- Playbook loading merges global + repo playbooks (repo takes precedence)\n- Config loading merges global + repo configs (repo takes precedence)\n- Toxic patterns merged from both global and repo logs\n- cass-memory doctor verifies .cass/ structure\n\n## How This Serves the Universal Agent Memory System\n\nThe .cass/ directory enables team-level memory sharing:\n\n1. Memory as Code: Team knowledge is versioned alongside code\n2. Collective Learning: Entire team benefits from lessons learned\n3. Onboarding: New team members inherit project wisdom immediately\n4. Consistency: All agents follow same project-specific rules\n5. Code Review: Memory changes go through same review process as code\n6. Time Travel: git history shows evolution of team knowledge\n7. Multi-Agent Coordination: Multiple agents share same memory layer\n\nThis is the key innovation that makes CASS Memory a universal system - memory persists not just per user, but per project, and is versioned in git like any other critical project artifact.\n\nWithout repo-level playbooks, teams would constantly reinvent the wheel, onboarding would be slow, and agents would have inconsistent behavior across team members.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:47:57.98691-05:00","updated_at":"2025-12-07T20:21:09.19667-05:00","closed_at":"2025-12-07T20:21:03.05494-05:00"}
{"id":"cass_memory_system-6ob","title":"[Playbook] findSimilarBullet - Find most similar existing bullet","description":"## Function Signature\n```typescript\nfunction findSimilarBullet(\n  bullets: PlaybookBullet[],\n  content: string,\n  threshold: number\n): { found: boolean; bullet?: PlaybookBullet; similarity?: number }\n```\n\n## Purpose\nFind the most similar existing bullet above a threshold. Returns similarity score for logging and decision-making.\n\n## Algorithm\n1. Filter out deprecated bullets\n2. Calculate similarity for ALL non-deprecated bullets\n3. Find bullet with highest similarity\n4. If highest \u003e= threshold:\n   - Return { found: true, bullet, similarity }\n5. Else:\n   - Return { found: false }\n\n## Difference from isDuplicateBullet\n- **isDuplicateBullet**: Returns first match, boolean check, prevents duplicates\n- **findSimilarBullet**: Returns highest match, includes score, suggests similar\n\n## Return Value Usage\n```typescript\nconst result = findSimilarBullet(bullets, newContent, 0.7);\nif (result.found) {\n  console.log(`Found similar bullet (${result.similarity.toFixed(2)}): ${result.bullet.content}`);\n  // Ask user: merge, replace, or add anyway?\n}\n```\n\n## Threshold Selection\n- **High threshold (0.85+)**: Only very similar bullets\n- **Medium threshold (0.70-0.85)**: Suggest as related\n- **Low threshold (0.50-0.70)**: Broad similarity search\n\n## Implementation Notes\n- Must search ALL bullets to find highest\n- Skip deprecated bullets (outdated)\n- Include similarity score in result\n- Useful for merge suggestions\n\n## Usage Scenarios\n1. **Interactive add**: Show similar bullets to user\n2. **Merge suggestions**: Find candidates for combining\n3. **Search**: Find bullets related to query\n4. **Analytics**: Measure playbook clustering\n\n## Dependencies\n- jaccardSimilarity() utility function\n\n## Related Functions\n- isDuplicateBullet() - simpler boolean check\n- findMergeCandidates() - finds multiple similar groups\n- getBulletsByCategory() - category-based filtering","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:00.773781-05:00","updated_at":"2025-12-07T20:02:06.300218-05:00","closed_at":"2025-12-07T20:01:55.424422-05:00"}
{"id":"cass_memory_system-6syf","title":"[Critical] Fix types.ts to match scoring.ts and cass.ts requirements","description":"","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-07T18:47:34.297635-05:00","updated_at":"2025-12-07T18:53:18.24423-05:00","closed_at":"2025-12-07T18:48:14.675127-05:00"}
{"id":"cass_memory_system-6u3","title":"[Utils] truncateForContext - Large content truncation for LLM","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:45:16.512693-05:00","updated_at":"2025-12-07T21:48:01.792191-05:00","closed_at":"2025-12-07T21:46:53.434325-05:00","comments":[{"id":4,"issue_id":"cass_memory_system-6u3","author":"jemanuel","text":"## Function Signature\n```typescript\nfunction truncateForContext(text: string, maxChars: number): string\n```\n\n## Implementation Details\n- Check if text.length \u003c= maxChars\n- If yes, return text unchanged\n- If no, truncate and append informative message:\n  - text.slice(0, maxChars) + \"\\n\\n[... truncated for context limit ...]\"\n- Use \\n\\n for clear separation\n- Message explains WHY truncated (not just \"...\")\n\n## Why This Matters\nUsed before sending session content to LLM to avoid token limits. Typical maxChars might be 100,000 (roughly 25k tokens). Clear message helps LLM understand context was truncated.\n\n## Edge Cases to Handle\n- Very small maxChars - ensure message fits or adjust\n- Empty string - return empty\n- Exactly at limit - return unchanged\n- Multiple sessions concatenated - truncate whole string, not per session\n- Preserve important content at start (don't truncate from middle)","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-70sd","title":"[Unit Tests] config.ts - Configuration loading and merging","description":"## Unit Tests: config.ts - Configuration Loading and Merging\n\n### Test Categories\n\n#### 1. loadGlobalConfig()\n- Returns default config when ~/.cass/config.yaml missing\n- Parses valid YAML with all fields\n- Handles partial configs (missing optional fields)\n- Logs warning for malformed YAML but returns defaults\n\n#### 2. loadRepoConfig()\n- Returns null when .cass/config.yaml missing\n- Parses valid repo config\n- Respects working directory parameter\n- Handles nested playbook_paths array\n\n#### 3. mergeConfigs()\n- Global config provides base values\n- Repo config overrides global values\n- Nested objects merge correctly (llm settings)\n- Arrays concatenate (playbook_paths)\n- Explicit nulls in repo override global values\n- Empty repo config returns global unchanged\n\n#### 4. findRepoRoot()\n- Finds .cass directory in current path\n- Walks up directory tree to find .cass\n- Returns undefined at filesystem root\n- Handles symlinked directories\n\n#### 5. Edge Cases\n- Unicode content in YAML files\n- Very large config files\n- Read-only file permissions\n- Config with unknown keys (forward compatibility)\n\n### Test Data Requirements\n- Sample config YAML files in test/fixtures/configs/\n- Both valid and malformed examples\n- Configs with various merge scenarios","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:23:23.219085-05:00","updated_at":"2025-12-07T22:19:23.813898-05:00","closed_at":"2025-12-07T22:19:23.813898-05:00","dependencies":[{"issue_id":"cass_memory_system-70sd","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2025-12-07T20:31:04.23662-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-70sd","depends_on_id":"cass_memory_system-p4mv","type":"blocks","created_at":"2025-12-07T20:31:04.369118-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-70sd","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2025-12-07T20:31:07.779792-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-72k","title":"[Validator] runLLMValidation - Scientific validation via LLM","description":"Implement the runLLMValidation function - Scientific validation via LLM using historical evidence.\n\nSIGNATURE:\n```typescript\nasync function runLLMValidation(\n  proposedRule: string,\n  history: CassHit[],\n  config: Config\n): Promise\u003cValidationResult\u003e\n```\n\nVALIDATION RESULT:\n```typescript\ninterface ValidationResult {\n  verdict: \"VALID\" | \"INVALID\" | \"VALID_WITH_CAUTION\";\n  confidence: number;          // 0.0 to 1.0\n  reason: string;              // LLM explanation\n  evidence: string[];          // Citations from history\n  refinedRule?: string;        // Optional improved wording\n}\n```\n\nUSES PROMPTS.validator TEMPLATE:\n```\nYou are a scientific validator for agent playbook rules.\n\nPROPOSED RULE:\n{proposedRule}\n\nHISTORICAL EVIDENCE:\n{formattedEvidence}\n\nTASK:\nAnalyze whether this rule is supported by the historical evidence.\nConsider:\n- Does the evidence show this pattern worked?\n- Are there counter-examples (failures)?\n- Is the rule too generic or too specific?\n- Is the wording actionable?\n\nRESPOND WITH:\n- VALID: Strong evidence supports this rule\n- INVALID: Evidence contradicts or doesn't support this rule\n- VALID_WITH_CAUTION: Some support but concerns exist\n\nInclude:\n1. Your verdict\n2. Confidence score (0.0-1.0)\n3. Reasoning based on evidence\n4. Optional refined wording if the concept is valid but phrasing needs work\n```\n\nVALIDATION CRITERIA:\n- Pattern appears in successful sessions\n- Few or no counter-examples in failed sessions\n- Rule is specific and actionable\n- Rule is not overly generic\n- Wording is clear and unambiguous\n\nWHY THIS MATTERS:\n- Provides deep analysis beyond simple counting\n- Can identify nuanced patterns humans might miss\n- Suggests improvements to rule wording\n- Adds scientific rigor to rule acceptance\n\nDEPENDENCIES:\n- formatEvidenceForLLM() - Format cass hits for prompt\n- PROMPTS.validator - Validation prompt template\n- LLM API (OpenAI, Anthropic, etc.)\n- CassHit type\n\nLOCATION:\n- src/validator/llm-validation.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:44:53.067317-05:00","updated_at":"2025-12-08T14:28:28.537337-05:00","closed_at":"2025-12-08T14:28:28.537337-05:00"}
{"id":"cass_memory_system-75lr","title":"[Docs] Installation instructions for all platforms","description":"Document installation methods for all platforms with clear, tested instructions.\n\nMethods:\n1. Pre-built binaries (recommended):\n   - macOS (arm64): curl -L https://github.com/.../cass-memory-darwin-arm64 -o cass-memory \u0026\u0026 chmod +x cass-memory\n   - macOS (x64): Same for darwin-x64\n   - Linux (x64): curl for linux-x64\n   - Windows: Download .exe from releases\n   \n2. From source:\n   - git clone https://github.com/.../cass-memory.git\n   - cd cass-memory\n   - bun install\n   - bun run build\n   - Binary in dist/\n   \n3. Global install (npm/bun):\n   - bun install -g cass-memory\n   - OR: npm install -g cass-memory\n\nPrerequisites: \n- cass CLI installed and configured\n- API key for LLM provider (OpenAI/Anthropic)\n\nVerification:\n- cass-memory --version\n- cass-memory doctor (health check)\n\nInclude troubleshooting for common install issues","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:26.553392-05:00","updated_at":"2025-12-07T20:42:52.110776-05:00","closed_at":"2025-12-07T20:41:54.658812-05:00"}
{"id":"cass_memory_system-79k5","title":"[Tracking] ProcessedLog class - Track processed sessions","description":"Class implementation:\n```typescript\nclass ProcessedLog {\n  private entries: Map\u003cstring, ProcessedEntry\u003e;\n  private logPath: string;\n\n  constructor(logPath: string);\n  async load(): Promise\u003cvoid\u003e;\n  async save(): Promise\u003cvoid\u003e;\n  isProcessed(sessionPath: string): boolean;\n  markProcessed(entry: ProcessedEntry): void;\n  getUnprocessedSessions(allSessions: string[]): string[];\n}\n```\n\nPurpose: Tracks which sessions have been reflected on to avoid duplicate processing\n\nMethods:\n- load(): Read TSV file into entries map\n- save(): Write entries map to TSV file (atomically)\n- isProcessed(): Check if sessionPath exists in entries\n- markProcessed(): Add new entry to map\n- getUnprocessedSessions(): Filter out already-processed sessions\n\nUsed by `cm reflect` to identify new sessions needing reflection.\nSeparate logs per workspace or global scope.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:50:31.118371-05:00","updated_at":"2025-12-07T20:51:07.789067-05:00","closed_at":"2025-12-07T20:51:02.502011-05:00"}
{"id":"cass_memory_system-7dlg","title":"[E2E] Implement CLI smoke: init-\u003econtext-\u003emark-\u003eplaybook (no cass/LLM)","description":"Automate minimal e2e script (Bun) that runs cm init, cm context 'hello', cm mark b-demo helpful, cm playbook list with assertions. Run with cass/LLM disabled to verify offline/degraded path. Emit structured log (JSONL) per step.","notes":"Improved e2e-smoke robustness: uses node to extract bullet id, exits if missing; portable timestamps already set.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:30:05.007227-05:00","updated_at":"2025-12-08T14:02:35.808639-05:00","closed_at":"2025-12-08T14:02:35.808639-05:00","dependencies":[{"issue_id":"cass_memory_system-7dlg","depends_on_id":"cass_memory_system-4fx1","type":"blocks","created_at":"2025-12-07T20:30:05.010622-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-7g0","title":"[Playbook] deprecateBullet - Mark bullet as deprecated","description":"## Function Signature\n```typescript\nfunction deprecateBullet(\n  playbook: Playbook,\n  bulletId: string,\n  reason: string,\n  replacedBy?: string\n): void\n```\n\n## Purpose\nMark a bullet as deprecated/retired. Used when rules become obsolete or are replaced by better rules.\n\n## Implementation Steps\n1. Find bullet by ID\n2. Set state: \"retired\"\n3. Set maturity: \"deprecated\"\n4. Set deprecationReason to provided reason\n5. Set replacedBy if provided (ID of replacement bullet)\n6. Set updatedAt to now()\n\n## Deprecation vs Deletion\n**Never delete bullets**:\n- Preserves history and context\n- Allows rollback if needed\n- Maintains source session references\n- Enables learning from past mistakes\n\nDeprecated bullets:\n- Excluded from active context\n- Shown in stats with deprecation reason\n- Can be searched for historical analysis\n\n## Common Deprecation Reasons\n- \"Superseded by more specific rule\"\n- \"No longer applicable to current architecture\"\n- \"Merged into {bulletId}\"\n- \"Contradicted by proven evidence\"\n- \"Too broad - split into multiple rules\"\n\n## Replacement Tracking\nIf replacedBy is provided:\n- Creates chain: old → new\n- Stats can show evolution\n- Prevents re-adding deprecated patterns\n\n## Usage Scenarios\n1. **Manual deprecation**: User runs `forget` command\n2. **Merge operation**: Old bullets point to merged result\n3. **Auto-prune**: Harmful bullets beyond threshold\n4. **Refactoring**: Rule split or restructuring\n\n## Dependencies\n- findBullet()\n\n## Related Functions\n- getActiveBullets() - filters out deprecated\n- findMergeCandidates() - may create deprecations\n- autoPrune() - deprecates harmful bullets","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:58.353949-05:00","updated_at":"2025-12-07T20:02:37.355037-05:00","closed_at":"2025-12-07T20:02:33.601254-05:00"}
{"id":"cass_memory_system-7hok","title":"[Critical] Privacy-First Cross-Agent - Opt-in with Clear Data Flow","description":"# Privacy-First Cross-Agent Enrichment\n\n## The Problem\nCurrent plan enables cross-agent learning by default. This means:\n- Claude Code sessions inform Cursor behavior\n- Personal coding patterns shared across tools\n- No clear visibility into what's being shared\n\nUsers may not want this. Privacy-conscious users will reject the tool entirely.\n\n## The Solution\nMake cross-agent COMPLETELY opt-in with explicit consent:\n\n### Default: Single-Agent Mode\n```typescript\nconst DEFAULT_CONFIG = {\n  crossAgent: {\n    enabled: false,  // OFF by default\n    consentGiven: false,\n    consentDate: null,\n    agents: []  // No agents enabled\n  }\n};\n```\n\n### Explicit Consent Flow:\n```bash\n$ cm init\n\nWelcome to CASS Memory System!\n\nCross-Agent Learning (Optional):\nCASS can learn from ALL your coding agents (Claude Code, Cursor, Codex, etc.)\nThis means patterns from one tool improve others.\n\nEnable cross-agent learning? [y/N]: n\n\nOK, running in single-agent mode.\nYou can enable later with: cm config set crossAgent.enabled true\n```\n\n### Data Flow Visibility:\n```bash\n$ cm privacy status\n\nCross-Agent Learning: DISABLED\nData shared: None\n\nIf enabled, these agents would contribute:\n  - Claude Code: 45 sessions\n  - Cursor: 12 sessions\n  - Codex: 3 sessions\n\nTo enable: cm config set crossAgent.enabled true\n```\n\n## Implementation Requirements\n- [ ] Default crossAgent.enabled = false\n- [ ] Consent prompt during init\n- [ ] `cm privacy` command suite\n- [ ] Per-agent enable/disable\n- [ ] Audit logging of data flow\n\n## Why This Is Critical\n- Privacy is non-negotiable for many users\n- Trust requires transparency\n- Opt-in \u003e Opt-out for sensitive features\n- Single-agent mode must be fully functional","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-07T17:14:04.803971-05:00","updated_at":"2025-12-07T17:53:14.716333-05:00"}
{"id":"cass_memory_system-7my","title":"[Types] PlaybookBullet Schema Part 5 - Provenance and Verification","description":"## Overview\nDefine provenance tracking and verification system for PlaybookBullet. Answers: Where did this rule come from? Why does it exist? How can we verify it's still valid?\n\n## Temporal Provenance\n\n### createdAt: string\n- Type: Required ISO 8601 timestamp\n- Purpose: When rule was first added to playbook\n- Usage: Calculate rule age / Audit rule creation timeline / Sort playbook by creation date\n- Example: '2025-12-07T14:30:00Z'\n- Immutable: Never changes after creation\n\n### updatedAt: string\n- Type: Required ISO 8601 timestamp\n- Purpose: When rule was last modified (content, state, feedback)\n- Usage: Detect stale rules (long time since update) / Track edit history / Trigger revalidation\n- Example: '2025-12-07T16:45:00Z'\n- Updates: On any field change (content, helpful marks, state transitions)\n\n## Protection from Auto-Pruning\n\n### pinned: boolean\n- Type: Boolean flag (default: false)\n- Purpose: Protect rule from automatic retirement/deletion\n- Behavior: Immune to harmful threshold pruning / Immune to low-confidence cleanup / Immune to deduplication merging / Still participates in feedback and decay\n- Use Cases: Critical security rules / Team mandates / Legal/compliance requirements\n- Override: Manual deletion still possible\n\n### pinnedReason: string | undefined\n- Type: Optional explanation\n- Purpose: Document WHY rule is protected\n- Required: Should be set when pinned = true\n- Examples: 'Security compliance requirement' / 'Team mandate from 2025-11-01 standup' / 'Critical bug prevention - see incident #1234'\n- Display: Shown with pinned indicator in UI\n\n## Source Tracking\n\n### sourceSessions: string[]\n- Type: Array of session file paths\n- Purpose: Which cass sessions contributed to creating this rule\n- Usage: Trace rule origins / Find supporting evidence / Link rules to historical work\n- Population: Added by reflector from analyzed sessions / Added by manual creation with --session flag\n- Example: ['/Users/dev/.cass/sessions/2025-12-07-auth-fix.jsonl', '/Users/dev/.cass/sessions/2025-12-05-token-validation.jsonl']\n\n### sourceAgents: string[]\n- Type: Array of agent identifiers\n- Purpose: Which agents contributed to creating this rule\n- Usage: Multi-agent collaboration tracking / Agent-specific rule analysis / Cross-agent pattern detection\n- Values: 'claude', 'codex', 'cursor', 'human', etc.\n- Example: ['claude', 'cursor'] (Rule emerged from Claude and Cursor sessions)\n\n## Reasoning and Derivation\n\n### reasoning: string | undefined\n- Type: Optional free-form explanation\n- Purpose: WHY this rule was created\n- Source: Generated by reflector or provided manually\n- Content: Problem it solves / Context of creation / Design rationale\n- Example: 'Created after authentication bypass incident. Multiple sessions showed confusion about JWT validation. This rule prevents insecure token handling.'\n\n### derivedFrom: object | undefined\n- Type: Optional structured provenance\n- Purpose: Detailed evidence trail from diary/sessions\n- Structure: { diaryIds: string[], keyEvidence: string[] }\n- Example: { diaryIds: ['diary-a3f8b2c1', 'diary-d9e4f7b2'], keyEvidence: ['Session showed JWT validation failure led to security bug', 'Team discussion confirmed need for centralized token validation'] }\n\n## Automated Verification\n\n### verification: object | undefined\n- Type: Optional verification specification\n- Purpose: Programmatic check that rule is still applicable\n- Structure: { type: 'regex' | 'file_exists' | 'cass_query', pattern: string, mode: 'exists' | 'absent' }\n\nVerification Types:\n\nregex - Check if code pattern exists/absent in codebase\nExample: { type: 'regex', pattern: 'TokenValidator', mode: 'exists' } (Fail if TokenValidator not found)\n\nfile_exists - Check if specific file/module exists\nExample: { type: 'file_exists', pattern: 'lib/auth.ts', mode: 'exists' } (Fail if file doesn't exist)\n\ncass_query - Check if cass search returns results\nExample: { type: 'cass_query', pattern: 'vitest configuration', mode: 'exists' } (Fail if no vitest usage found)\n\nVerification Workflow:\n1. Periodic Checks: Run during 'cass memory validate --all'\n2. On-Demand: Run 'cass memory verify \u003cbulletId\u003e'\n3. Results: PASS (update lastValidatedAt) or FAIL (suggest deprecation)\n4. Actions on Failure: Move to draft state / Add deprecation warning / Notify user\n\n## Complete Example\n\n{\n  createdAt: '2025-11-15T10:00:00Z',\n  updatedAt: '2025-12-07T14:30:00Z',\n  pinned: true,\n  pinnedReason: 'Critical security requirement per audit #2024-11',\n  sourceSessions: ['/Users/dev/.cass/sessions/2025-11-15-auth-refactor.jsonl', '/Users/dev/.cass/sessions/2025-11-20-token-validation.jsonl'],\n  sourceAgents: ['claude', 'cursor'],\n  reasoning: 'After security audit revealed JWT validation gaps, consolidated token validation into single service to prevent bypass attacks.',\n  derivedFrom: { diaryIds: ['diary-a3f8b2c1', 'diary-d9e4f7b2'], keyEvidence: ['Security audit found 3 instances of unsafe JWT handling', 'Team decision to centralize auth in TokenValidator service'] },\n  verification: { type: 'file_exists', pattern: 'lib/auth/TokenValidator.ts', mode: 'exists' }\n}\n\n## Use Cases\n- Security Compliance: Pin critical rules, verify dependencies, track audit trail\n- Team Collaboration: Show agent contributions, link to discussions, explain decisions\n- Maintenance: Detect outdated rules (verification fails), find stale rules (old updatedAt), protect important rules\n- Debugging: Trace rule origins, find supporting evidence, understand reasoning\n\n## Acceptance Criteria\n- createdAt required timestamp field\n- updatedAt required timestamp field\n- pinned boolean field (default false)\n- pinnedReason optional string field\n- sourceSessions array field\n- sourceAgents array field\n- reasoning optional string field\n- derivedFrom optional structured field\n- verification optional structured field\n- Verification runner implementation\n- Auto-update updatedAt on changes\n- Pin protection in prune logic\n- Examples for all verification types\n- JSDoc for all fields","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:01.583813-05:00","updated_at":"2025-12-07T20:10:22.239642-05:00","closed_at":"2025-12-07T20:09:41.249134-05:00"}
{"id":"cass_memory_system-7rz","title":"[Decay] checkForDemotion - Automatic maturity regression","description":"Automatically demote or deprecate bullets that accumulate harmful marks or whose scores decay into negative territory.\n\nCOMPLETE IMPLEMENTATION:\n```typescript\n/**\n * Check if bullet should be demoted or auto-deprecated.\n * Allows rules to 'fall' in maturity if they accumulate harmful marks.\n */\nfunction checkForDemotion(bullet: PlaybookBullet): BulletMaturity | 'auto-deprecate' {\n  const score = getEffectiveScore(bullet);\n\n  // If score goes negative, consider demotion\n  if (score \u003c 0 \u0026\u0026 !bullet.pinned) {\n    if (score \u003c -3) {\n      return 'auto-deprecate';  // Signals auto-deprecation\n    }\n    \n    // Demote proven → established, established → candidate\n    if (bullet.maturity === 'proven') return 'established';\n    if (bullet.maturity === 'established') return 'candidate';\n  }\n\n  return bullet.maturity;\n}\n```\n\nDEMOTION CRITERIA:\n\nEffective score \u003c 0 (negative):\n- proven → established\n- established → candidate\n- Pinned bullets are PROTECTED from demotion\n\nEffective score \u003c -3 (severely negative):\n- Any maturity → auto-deprecate\n- Signals bullet should be moved to deprecated state\n- Pinned bullets are PROTECTED\n\nWHY DEMOTION MATTERS:\nRules can become toxic over time as codebase evolves. A rule that was once helpful might now be harmful. Demotion provides graceful degradation before full deprecation.\n\nEXAMPLE SCENARIOS:\n\n1. DEMOTE proven → established:\n   - Was helpful 10 times last year (now decayed to ~2.5)\n   - Marked harmful 1 time recently\n   - Score = 2.5 - 4 = -1.5\n   - Proven maturity multiplier = 1.5\n   - Effective score = -1.5 × 1.5 = -2.25\n   - Demoted to established\n\n2. AUTO-DEPRECATE:\n   - 3 recent harmful marks\n   - 1 old helpful mark (decayed to 0.25)\n   - Score = 0.25 - (4 × 3) = -11.75\n   - Score \u003c -3 → auto-deprecate\n   - Bullet moved to deprecated state\n\n3. PINNED PROTECTION:\n   - Manually curated rule with pinned: true\n   - Score = -5 (would normally auto-deprecate)\n   - Returns current maturity (no change)\n   - Human review required via forget command\n\nINTEGRATION:\n- Called by applyMaturityTransitions()\n- Called after each curate cycle\n- Returns 'auto-deprecate' string (not BulletMaturity type) to signal deprecation\n- Pinned bullets bypass all automatic demotion\n\nPROTECTION MECHANISM:\nPinned bullets cannot be auto-demoted or auto-deprecated. This allows humans to override the algorithm for critical rules. Use sparingly.\n\nDEPENDENCIES:\n- getEffectiveScore()\n- PlaybookBullet.pinned field\n- PlaybookBullet.maturity field\n\nUSED BY:\n- applyMaturityTransitions()\n- Auto-deprecation workflow","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:45:47.886037-05:00","updated_at":"2025-12-07T21:15:58.746793-05:00","closed_at":"2025-12-07T21:14:24.786727-05:00"}
{"id":"cass_memory_system-7s8","title":"[Foundation] package.json with exact dependency versions","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:02.758403-05:00","updated_at":"2025-12-07T16:49:20.676779-05:00","closed_at":"2025-12-07T16:49:20.676779-05:00"}
{"id":"cass_memory_system-7yy","title":"[Diary] extractSessionMetadata - Parse path for agent/workspace","description":"Extract agent and workspace metadata from session file paths.\n\nFunction Signature:\nfunction extractSessionMetadata(sessionPath: string): { agent: string; workspace?: string }\n\nSupported Path Patterns:\n- ~/.claude/projects/{workspace}/session-*.jsonl → agent: 'claude', workspace extracted\n- ~/.cursor/state.vscdb:* → agent: 'cursor', no workspace\n- ~/.codex/sessions/*.jsonl → agent: 'codex', no workspace\n- ~/.aider.chat/*.md → agent: 'aider', no workspace\n- Unknown paths → agent: 'unknown', no workspace\n\nAlgorithm:\n1. Normalize path (resolve ~, resolve symlinks)\n2. Match against known agent patterns using regex\n3. Extract workspace from path if pattern includes it\n4. Return { agent, workspace } metadata object\n\nKey Features:\n- Pattern-based agent detection\n- Workspace extraction from hierarchical paths\n- Graceful handling of unknown agents\n- Path normalization for consistency\n\nUse Cases:\n- Categorizing sessions by agent in diary entries\n- Cross-agent session discovery\n- Agent-specific behavior customization\n- Statistics and reporting by agent type\n\nOutput:\nReturns metadata object with agent name (required) and workspace (optional).","notes":"Implementing extractSessionMetadata and wiring into diary generation","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:55.946799-05:00","updated_at":"2025-12-07T21:48:01.80953-05:00","closed_at":"2025-12-07T21:47:30.340236-05:00"}
{"id":"cass_memory_system-7zbj","title":"[CLI] forget command - Permanently block toxic rule","description":"Implements the main entry point for the 'cass-memory forget' command - the nuclear option for permanently blocking toxic rules.\n\nCOMMAND SYNTAX:\n```bash\ncass-memory forget \u003cbullet-id\u003e [options]\n\nOptions:\n  --reason TEXT      Why this rule is toxic (required)\n  --invert           Convert to anti-pattern instead of just blocking\n  --global           Add to global toxic log (default: repo-level)\n```\n\nPURPOSE:\nProvides a safety mechanism to permanently block rules that caused production issues or demonstrated harmful patterns. Once forgotten, similar rules will be automatically rejected during future extraction.\n\nUSE CASES:\n- Rule caused production incident\n- Rule represents outdated/dangerous practice\n- Rule conflicts with security policy\n- Rule was proven fundamentally wrong\n\nIMPLEMENTATION REQUIREMENTS:\n1. Parse command-line arguments\n2. Validate bullet-id exists in playbook\n3. Require --reason (cannot be empty)\n4. Add entry to toxic_bullets.log\n5. Mark bullet as deprecated in playbook\n6. If --invert: create anti-pattern version\n7. Generate embedding for semantic blocking\n\nWORKFLOW:\n1. Confirm action with user (destructive)\n2. Add to toxic log (with reason, timestamp)\n3. Update playbook status to deprecated\n4. If --invert: create new anti-pattern bullet\n5. Rebuild semantic index if using embeddings\n\nSAFETY:\n- Require explicit confirmation for destructive action\n- Log all forget actions with audit trail\n- Support undo via toxic log inspection\n- Warn if forgetting high-score bullets\n\nDEPENDENCIES:\n- Toxic log storage (toxic_bullets.log)\n- Playbook update utilities\n- Embedding generation (optional)\n- Anti-pattern creation (if --invert)\n\nSUCCESS CRITERIA:\n- Toxic log updated with hash and embedding\n- Playbook marks bullet as deprecated\n- Future similar rules blocked automatically\n- Audit trail complete and reversible","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:52:23.375969-05:00","updated_at":"2025-12-07T21:14:16.239779-05:00","closed_at":"2025-12-07T21:13:39.472323-05:00"}
{"id":"cass_memory_system-81t","title":"[Utils] daysAgo - Calculate past date","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:45:02.020032-05:00","updated_at":"2025-12-07T20:24:20.343337-05:00","closed_at":"2025-12-07T20:24:03.870255-05:00","comments":[{"id":5,"issue_id":"cass_memory_system-81t","author":"jemanuel","text":"## Function Signature\n```typescript\nfunction daysAgo(days: number): Date\n```\n\n## Implementation Details\n- Create new Date() object\n- Use setDate(getDate() - days) to subtract days\n- Return Date object (not string)\n- Handles month/year boundaries automatically\n\n## Why This Matters\nUsed for filtering sessions by age (sessionLookbackDays config). Returns Date object for easy comparison with other dates. JavaScript Date handles edge cases like going back across month/year boundaries.\n\n## Edge Cases to Handle\n- Negative days - returns future date (allowed)\n- Zero days - returns today\n- Very large numbers - Date handles this\n- Fractional days - Date.setDate handles fractional values\n- DST transitions - handled by Date","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-81x","title":"[Curator] autoInvertHarmfulBullets - Batch inversion check","description":"Post-processing phase that automatically inverts bullets with consistently negative feedback.\n\nSignature:\nfunction autoInvertHarmfulBullets(\n  playbook: Playbook,\n  pruneThreshold: number\n): InversionReport[]\n\nAlgorithm:\n1. Initialize inversions array\n2. For each active bullet in playbook:\n   a. Skip if bullet.pinned === true\n   b. Skip if bullet.maturity === 'deprecated'\n   c. Skip if bullet.kind === 'anti_pattern'\n   d. Calculate effectiveScore = helpfulCount - harmfulCount\n   e. If effectiveScore \u003c -pruneThreshold:\n      - Create anti-pattern using invertToAntiPattern(bullet)\n      - Add anti-pattern to playbook.bullets\n      - Deprecate original bullet:\n        * state: 'retired'\n        * maturity: 'deprecated'\n        * deprecationReason: 'auto-inverted due to consistent negative feedback'\n        * replacedBy: anti-pattern ID\n      - Create InversionReport:\n        * originalId: bullet.id\n        * originalContent: bullet.content\n        * antiPatternId: antiPattern.id\n        * antiPatternContent: antiPattern.content\n      - Add to inversions array\n3. Return inversions\n\nWhen does auto-inversion trigger?\n- Default pruneThreshold: 3\n- Bullet needs net -3 score (e.g., 0 helpful, 3 harmful)\n- Consistent pattern across sessions\n- Not a single-session fluke\n\nWhy this matters:\n- Converts mistakes into institutional knowledge\n- Prevents deletion of learning opportunities\n- Creates explicit anti-pattern section in playbook\n- Maintains accountability and history\n\nThis is called AFTER all deltas are processed in curatePlaybook.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:45:05.550937-05:00","updated_at":"2025-12-08T14:28:58.364449-05:00","closed_at":"2025-12-08T14:28:58.364449-05:00"}
{"id":"cass_memory_system-87l","title":"[Reflector] extractSearchAnchors - Generate SEO for agents","description":"function extractSearchAnchors(diary: DiaryExtraction): string[]\n\n\"SEO for agents\" - terms optimized for future search:\n- Combine key terms from all diary fields\n- Include technical terms, error messages, file patterns\n- Limit to 10-15 anchors\n\nEXTRACTION STRATEGY:\n1. From accomplishments: action verbs + tech terms\n2. From challenges: error types + problem domains\n3. From keyLearnings: concepts + patterns\n4. From decisions: technology names + approaches\n\nEXAMPLES:\n- \"React Testing Library\"\n- \"async/await\"\n- \"JWT authentication\"\n- \"CORS configuration\"\n- \"TypeScript generics\"\n\nFILTERING:\n- Remove common words (the, a, and, etc.)\n- Remove duplicates\n- Prioritize technical terms\n- Include version numbers if present\n\nPURPOSE:\nThese help future context searches find this diary\n\nALGORITHM:\n1. Extract noun phrases from all fields\n2. Score by technical relevance\n3. Sort by score\n4. Take top 15\n\nUsed when saving diary to cass","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:58.975745-05:00","updated_at":"2025-12-07T20:17:10.474283-05:00","closed_at":"2025-12-07T20:16:53.932452-05:00"}
{"id":"cass_memory_system-8dxr","title":"Integration Tests Epic - Pipeline integration tests","description":"Integration tests for multi-component pipelines.\nTests real interactions between modules without mocks.\nCovers: Curator pipeline, Reflector pipeline, Full ACE pipeline.\nMust use real fixtures, real file I/O, real LLM calls (with test API key).\nDetailed logging at each pipeline stage for debugging.","status":"in_progress","priority":2,"issue_type":"epic","created_at":"2025-12-07T20:26:02.099716-05:00","updated_at":"2025-12-08T00:18:38.607876-05:00","dependencies":[{"issue_id":"cass_memory_system-8dxr","depends_on_id":"cass_memory_system-u64s","type":"blocks","created_at":"2025-12-07T20:27:58.273899-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-8ift","title":"[Test] Unit: playbook.ts - CRUD and bullet management","description":"# Unit Tests for playbook.ts\n\n## Functions to Test\n\n### loadPlaybook(path)\nTest Cases:\n- Valid YAML file → returns Playbook object\n- Empty file → returns default playbook\n- Missing file → creates default playbook\n- Invalid YAML → throws with helpful error\n- Schema validation failure → throws with details\n- File with deprecated patterns → loads correctly\n\n### savePlaybook(playbook, path)\nTest Cases:\n- Saves valid playbook to file\n- Creates parent directories if needed\n- Overwrites existing file\n- Uses atomic write (temp file + rename)\n- Preserves YAML formatting\n\n### addBullet(playbook, data, sourceSession)\nTest Cases:\n- Adds bullet with generated ID\n- Sets createdAt/updatedAt timestamps\n- Adds to sourceSessions array\n- Extracts agent from sourceSession path\n- Validates content length\n- Returns updated playbook (immutable)\n\n### findBullet(playbook, id)\nTest Cases:\n- Finds existing bullet by ID\n- Returns undefined for missing ID\n- Case-sensitive ID matching\n\n### deprecateBullet(playbook, bulletId, reason)\nTest Cases:\n- Sets deprecated = true\n- Sets deprecatedAt timestamp\n- Sets deprecationReason\n- Adds to deprecatedPatterns list\n- Returns undefined for missing bullet\n\n### getBulletsByCategory(playbook, category)\nTest Cases:\n- Returns bullets matching category\n- Empty array for no matches\n- Case-sensitive matching\n\n### findSimilarBullet(playbook, content, threshold)\nTest Cases:\n- Finds exact match\n- Finds similar content (Jaccard similarity)\n- Returns null below threshold\n- Handles empty playbook\n\n### isDuplicateBullet(playbook, content)\nTest Cases:\n- True for exact duplicate\n- True for very similar content\n- False for unique content\n\n### recordFeedbackEvent(playbook, bulletId, type, sessionPath, reason?)\nTest Cases:\n- Adds event to feedbackEvents array\n- Updates helpfulCount/harmfulCount\n- Handles harmful reason field\n- Returns updated playbook\n\n## Test Approach\n- Use withTempDir for file operations\n- Use createTestPlaybook for setup\n- Verify file contents after writes","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T20:23:40.892472-05:00","updated_at":"2025-12-07T21:52:36.556364-05:00","closed_at":"2025-12-07T21:52:36.556364-05:00","dependencies":[{"issue_id":"cass_memory_system-8ift","depends_on_id":"cass_memory_system-ai52","type":"blocks","created_at":"2025-12-07T20:28:10.098944-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-8mb","title":"[Security] verifySanitization - Test sanitization effectiveness","description":"Implement verifySanitization() to test sanitization effectiveness.\n\nFunction signature:\n```typescript\nfunction verifySanitization(text: string): {\n  containsPotentialSecrets: boolean;\n  warnings: string[];\n}\n```\n\nImplementation:\n1. Run patterns in DETECT mode (test, don't replace)\n2. Return warnings about potential missed secrets\n3. Check for common secret indicators not caught by patterns\n\nDetection heuristics:\n- Look for \"key=\", \"token=\", \"password=\" with non-redacted values\n- Check for long base64 strings (40+ chars)\n- Detect PEM headers without [PRIVATE_KEY] replacement\n- Find Bearer tokens that weren't caught\n\nExample usage:\n```typescript\nconst text = \"API_KEY=[API_KEY] secret=abc123\";\nconst result = verifySanitization(text);\n// result.containsPotentialSecrets = true\n// result.warnings = [\"Found potential secret: 'secret=abc123'\"]\n```\n\nUsed in:\n- doctor command for self-test\n- Development/debug mode to verify sanitization\n- Testing to ensure patterns are working\n\nPriority: 0 (Security Critical - P12)","notes":"Added verifySanitization heuristics plus pattern detection in src/sanitize.ts","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:52.739713-05:00","updated_at":"2025-12-07T18:53:18.247538-05:00","closed_at":"2025-12-07T18:52:28.113214-05:00"}
{"id":"cass_memory_system-8nsd","title":"[Critical] MCP Server is P1 Not P3 - Agent Integration First","description":"# MCP Server Priority Elevation: P3 → P1\n\n## The Problem\nCurrent plan has MCP server as P3 (future/nice-to-have).\nThis is BACKWARDS. MCP integration is HOW agents will use CASS.\n\nWithout MCP:\n- Users must manually run `cm context` before each task\n- Agents can't automatically benefit from memory\n- Integration is friction-heavy\n\nWith MCP:\n- Claude Code auto-receives context on task start\n- Zero manual intervention required\n- Memory is seamlessly integrated\n\n## The Solution\nElevate MCP server to P1 priority. Build it alongside CLI.\n\n### MCP Server Provides:\n```typescript\n// Tool: Get context for a task\nmcpServer.tool(\"cm_context\", {\n  description: \"Get relevant rules and history for a task\",\n  parameters: { task: \"string\" },\n  handler: async ({ task }) =\u003e {\n    const context = await generateContext(task);\n    return formatForAgent(context);\n  }\n});\n\n// Tool: Record session outcome\nmcpServer.tool(\"cm_record_outcome\", {\n  description: \"Record that a task succeeded or failed\",\n  parameters: { \n    sessionId: \"string\",\n    outcome: \"success | failure | partial\",\n    rulesUsed: \"string[]\"\n  },\n  handler: async (params) =\u003e {\n    await recordOutcome(params);\n    return { recorded: true };\n  }\n});\n```\n\n### Agent Integration Flow:\n```\n1. Agent starts task\n2. Agent calls cm_context MCP tool\n3. CASS returns relevant rules + history\n4. Agent includes in system prompt\n5. Agent completes task\n6. Agent calls cm_record_outcome\n7. CASS updates confidence scores\n```\n\n### Minimal MCP Server (V1):\n```typescript\nconst TOOLS = [\n  \"cm_context\",     // Get context for task\n  \"cm_feedback\",    // Record helpful/harmful\n  \"cm_outcome\"      // Record session success/failure\n];\n\nconst RESOURCES = [\n  \"cm://playbook\",  // Current rules\n  \"cm://diary\"      // Recent diary entries\n];\n```\n\n## Why This Is Critical\n- MCP is the PRIMARY interface for agents\n- CLI is for humans to manage/debug\n- Without MCP, agents can't self-serve memory","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T17:14:10.23724-05:00","updated_at":"2025-12-07T21:49:40.72571-05:00","closed_at":"2025-12-07T21:49:32.157999-05:00"}
{"id":"cass_memory_system-8okk","title":"[Design] Minimal AGENTS.md Blurb Specification","description":"# Minimal AGENTS.md Blurb Specification\n\n## Purpose\nDesign the ready-to-paste blurb that humans add to their AGENTS.md files. This blurb teaches agents how to use cass-memory and must be:\n\n1. **Self-contained**: Agent understands everything from just this blurb\n2. **Minimal**: Under 60 lines (ideally 40-50)\n3. **Actionable**: Clear protocol, not just documentation\n4. **Copy-paste ready**: No customization needed\n\n## Reference Examples\n\nThe cass blurb (coding_agent_session_search) is ~45 lines and includes:\n- What it does (1-2 sentences)\n- Critical warning (don't run bare `cass`)\n- Quick start commands (4-5 examples)\n- Why to use it (3 bullet points)\n- Key flags table\n- Output contract (stdout/stderr/exit codes)\n\n## Design Constraints\n\n**Must Include:**\n- What cass-memory does (persistent memory for agents)\n- The ONE essential command: `cm context \"\u003ctask\u003e\" --json`\n- How to provide feedback (simplest possible mechanism)\n- Protocol summary (START/WORK/END)\n- Exit code contract\n\n**Should Include:**\n- 2-3 common flags\n- Brief explanation of rule IDs\n- Note that learning is automatic\n\n**Must NOT Include:**\n- Human-operator commands (init, reflect, etc.)\n- Verbose explanations\n- ASCII art or decorative elements\n- Optional/advanced features\n\n## Deliverables\n- [ ] Draft blurb text\n- [ ] Review against reference examples\n- [ ] Validate fits in ~50 lines","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T12:46:31.564087-05:00","updated_at":"2025-12-08T13:13:28.10334-05:00","closed_at":"2025-12-08T13:13:28.10334-05:00","dependencies":[{"issue_id":"cass_memory_system-8okk","depends_on_id":"cass_memory_system-2bnu","type":"blocks","created_at":"2025-12-08T12:48:44.454159-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-8oy","title":"[Curator] isToxic - Check against toxic bullet log","description":"$(cat /tmp/fix_8oy.txt)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:45:03.932369-05:00","updated_at":"2025-12-07T21:15:58.747577-05:00","closed_at":"2025-12-07T21:14:48.472074-05:00"}
{"id":"cass_memory_system-8pf9","title":"[CLI:forget] invertAndForget - Convert to anti-pattern","description":"Implements the invertAndForget function that converts a toxic rule into an anti-pattern.\n\nFUNCTION SIGNATURE:\n```typescript\nasync function invertAndForget(\n  playbook: Playbook,\n  bulletId: string,\n  reason: string\n): Promise\u003c{ deprecatedId: string; antiPatternId: string }\u003e\n```\n\nPURPOSE:\nInstead of just blocking a toxic rule, this creates a permanent anti-pattern to actively teach against the harmful behavior. Useful for common mistakes that need explicit warning.\n\nWORKFLOW:\n1. Retrieve original bullet from playbook\n2. Mark original as deprecated (keep for history)\n3. Create new anti-pattern bullet with inverted content\n4. Add original to toxic log with invertedTo reference\n5. Return both IDs for tracking\n\nANTI-PATTERN TRANSFORMATION:\nOriginal: \"Cache API responses in localStorage for performance\"\nAnti-Pattern: \"AVOID: Caching API responses in localStorage without expiration/size limits\"\n\nRules:\n- Prefix with \"AVOID: \" marker\n- Add specific context about WHY it's harmful\n- Reference the reason in bullet metadata\n- Link back to original bullet ID\n\nIMPLEMENTATION REQUIREMENTS:\n1. Load original bullet content\n2. Generate anti-pattern content:\n   - Add \"AVOID: \" prefix\n   - Enhance with context from reason\n   - Preserve original category/tags\n3. Create new bullet with type=antiPattern\n4. Update original bullet:\n   - Set maturity=deprecated\n   - Add deprecationReason\n   - Link to anti-pattern ID\n5. Add to toxic log with invertedTo field\n6. Persist both changes atomically\n\nMETADATA LINKAGE:\nOriginal bullet:\n```json\n{\n  \"id\": \"abc-123\",\n  \"maturity\": \"deprecated\",\n  \"deprecatedAt\": \"2025-01-15T10:30:00Z\",\n  \"deprecationReason\": \"Caused production incident - see antiPatternId\",\n  \"antiPatternId\": \"xyz-789\"\n}\n```\n\nAnti-pattern bullet:\n```json\n{\n  \"id\": \"xyz-789\",\n  \"type\": \"antiPattern\",\n  \"content\": \"AVOID: Caching API responses...\",\n  \"originalBulletId\": \"abc-123\",\n  \"reason\": \"Security vulnerability...\"\n}\n```\n\nERROR HANDLING:\n- Bullet not found → error\n- Bullet already deprecated → warn and skip\n- Anti-pattern already exists → error\n\nDEPENDENCIES:\n- Playbook update utilities\n- Anti-pattern creation logic\n- Toxic log (addToToxicLog)\n- Atomic transaction support\n\nSUCCESS CRITERIA:\n- Original marked deprecated with proper linkage\n- New anti-pattern created and indexed\n- Toxic log contains both IDs\n- Changes persisted atomically\n- Future sessions show anti-pattern in PITFALLS section","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:52:59.256992-05:00","updated_at":"2025-12-07T20:58:47.055577-05:00","closed_at":"2025-12-07T20:58:08.677612-05:00"}
{"id":"cass_memory_system-8pqd","title":"Unit tests for reflect.ts - Reflector iteration logic","description":"Complete unit test coverage for reflect.ts:\n- shouldExitEarly() with all 3 exit conditions\n- MAX_DELTAS boundary testing (19, 20, 21 deltas)\n- Multi-iteration reflection accumulation\n- Delta deduplication within iterations\n- Stats tracking (newPatterns, mergedPatterns, antiPatterns)\n- Config-driven maxReflectorIterations\n- Empty session handling\n- Large session handling (many deltas)\nNO MOCKS - use real diary/playbook fixtures","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:25:15.922343-05:00","updated_at":"2025-12-07T22:02:33.682666-05:00","closed_at":"2025-12-07T22:02:33.682666-05:00","dependencies":[{"issue_id":"cass_memory_system-8pqd","depends_on_id":"cass_memory_system-ai52","type":"blocks","created_at":"2025-12-07T20:28:08.275449-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-8tpz","title":"[Integration] Context Pipeline - Full Flow Tests","description":"## Target: Integration tests for context retrieval pipeline\n\n### Test Scenarios:\n\n1. **Basic Context Flow**\n   - Initialize cass-memory\n   - Add bullets to playbook\n   - Query for context\n   - Verify relevant bullets returned\n\n2. **Scoring Integration**\n   - Bullets with different feedback history\n   - Query returns highest-scored first\n   - Decay affects ordering\n   - Recent feedback weighted higher\n\n3. **Scope Filtering Integration**\n   - Global and project-scoped bullets\n   - Query with specific scope\n   - Only matching scope returned\n   - Wildcard scope handling\n\n4. **CASS Integration (when available)**\n   - If cass installed, include results\n   - Merge CASS and playbook results\n   - Deduplicate appropriately\n   - Ranking across sources\n\n5. **LLM Enhancement (when available)**\n   - If API key present, enhance context\n   - Verify prompt construction\n   - Handle API errors gracefully\n   - Timeout handling\n\n6. **Empty/Edge Cases**\n   - No matching bullets\n   - Query matches everything\n   - Very long query\n   - Special characters in query\n\n### Performance Logging:\n- Time for each pipeline stage\n- Number of candidates at each stage\n- Final result count\n- Memory usage if large","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:30:10.195659-05:00","updated_at":"2025-12-08T14:27:02.240376-05:00","closed_at":"2025-12-08T14:27:02.240376-05:00","dependencies":[{"issue_id":"cass_memory_system-8tpz","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:33.936271-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-8tpz","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:32:34.072861-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-8tpz","depends_on_id":"cass_memory_system-zc1d","type":"blocks","created_at":"2025-12-07T20:33:03.970457-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-8v4","title":"[Reflector] hashDelta - Deterministic delta hashing","description":"function hashDelta(delta: PlaybookDelta): string\n\nHash based on:\n- delta.type\n- For \"add\": content hash\n- For \"helpful\": bulletId\n- For \"harmful\": bulletId\n- For \"replace\": bulletId + newContent hash\n- For \"deprecate\": bulletId\n\nIMPLEMENTATION:\n```typescript\nswitch (delta.type) {\n  case 'add':\n    return hash(delta.content + delta.category)\n  case 'helpful':\n  case 'harmful':\n  case 'deprecate':\n    return hash(delta.bulletId + delta.type)\n  case 'replace':\n    return hash(delta.bulletId + delta.newContent)\n}\n```\n\nWHY DETERMINISTIC:\n- Same delta = same hash\n- Enables Set-based deduplication\n- Works across iterations\n\nHASH FUNCTION:\nUse crypto.createHash('sha256') for consistency\n\nUsed in deduplicateDeltas()","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:55.651509-05:00","updated_at":"2025-12-07T19:00:55.14864-05:00","closed_at":"2025-12-07T19:00:43.923846-05:00"}
{"id":"cass_memory_system-8vr","title":"[Generator] extractBulletReasoning - Get creation context","description":"Extract reasoning/origin story for why a playbook bullet exists.\n\nSIGNATURE:\nfunction extractBulletReasoning(bullet: PlaybookBullet): string\n\nPURPOSE:\nProvide context about HOW and WHY a rule was created. Helps the agent understand the origin story and gives more weight to the guidance.\n\nSOURCES (in priority order):\n1. bullet.reasoning (if explicitly set)\n2. bullet.derivedFrom.keyEvidence (if derived from session)\n3. Fallback: From {agent} session on {date}\n\nLOGIC:\nCheck reasoning field first, then keyEvidence, then fallback to session metadata, finally return No reasoning available if nothing found.\n\nEXAMPLE OUTPUTS:\n1. Explicit: Learned when JWT expiry caused silent auth failures in production\n2. Key evidence: Debugging session showed token refresh interval was too short\n3. Fallback: From claude session on 2025-11-15\n4. No data: No reasoning available\n\nFIELD STRUCTURE:\nbullet.derivedFrom contains sessionPath, timestamp, keyEvidence, extractedBy\n\nUSE CASE:\nHelps agent understand: This rule exists because we hit this bug before, This was learned from a successful fix, This came from a painful debugging session\n\nDISPLAY:\nAppears in context markdown after score and last helpful time, provides memorable context about why the rule was created.\n\nTRUNCATION:\nIf reasoning exceeds 200 chars, truncate with ellipsis. Preserve first sentence if possible.\n\nVALUE:\nContext with reasoning is much more valuable than bare rules. Example: Use async/await for DB calls - blocking calls in event loop caused 5s latencies in production explains WHY and provides memorable context.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:03.754093-05:00","updated_at":"2025-12-07T20:07:53.560324-05:00","closed_at":"2025-12-07T20:07:48.613285-05:00"}
{"id":"cass_memory_system-92jv","title":"[E2E Tests] CLI init command - project initialization","description":"## E2E Test: CLI init Command - Project Initialization\n\n### Test Scenario\nTest the `cm init` command creates proper project structure\n\n### Test Steps\n\n#### 1. Fresh Init\n- Create empty temp directory\n- Run `cm init`\n- Verify .cass/ directory created\n- Verify config.yaml created with defaults\n- Verify playbook.yaml created (empty)\n\n#### 2. Init with Options\n- Run `cm init --provider anthropic --model claude-3-5-sonnet`\n- Verify config has specified provider/model\n- Verify other defaults preserved\n\n#### 3. Init Idempotent\n- Run init twice in same directory\n- Second run should not overwrite existing config\n- Should warn about existing initialization\n\n#### 4. Init in Nested Directory\n- Create nested project structure\n- Run init in subdirectory\n- Verify creates local .cass (not in parent)\n\n### Verbose Logging\n- Log: 'Initializing cass-memory in \u003cpath\u003e'\n- Log: 'Creating .cass directory...'\n- Log: 'Writing default config.yaml...'\n- Log: 'Writing empty playbook.yaml...'\n- Log: 'Initialization complete'\n\n### Error Cases\n- Read-only directory (should fail gracefully)\n- Existing corrupt config (should warn, not overwrite)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:24:31.109699-05:00","updated_at":"2025-12-07T22:38:33.961498-05:00","closed_at":"2025-12-07T22:38:22.59193-05:00","dependencies":[{"issue_id":"cass_memory_system-92jv","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2025-12-07T20:31:24.707414-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-92jv","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2025-12-07T20:31:24.835276-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-92xd","title":"[Unit Tests] cass.ts - Cass binary integration functions","description":"## Unit Tests: cass.ts - Cass Binary Integration Functions\n\n### Test Categories\n\n#### 1. cassAvailable()\n- Returns true when cass binary exists\n- Returns false when cass not in PATH\n- Handles timeout gracefully\n- Uses 'cass health' check\n\n#### 2. cassNeedsIndex()\n- Returns true for INDEX_MISSING exit code\n- Returns false for healthy index\n- Handles timeout\n- Treats unknown errors as needing rebuild\n\n#### 3. cassIndex()\n- Calls cass index command\n- Supports --full flag\n- Supports --incremental flag\n- Returns promise that resolves on success\n- Rejects on non-zero exit\n\n#### 4. cassSearch()\n- Parses JSON output correctly\n- Handles --robot flag\n- Passes limit, days, agent options\n- Validates hits against CassHitSchema\n- Returns empty array for NOT_FOUND\n\n#### 5. safeCassSearch()\n- Returns empty array when cass unavailable\n- Rebuilds index on INDEX_MISSING\n- Reduces limit on TIMEOUT\n- Logs appropriate warnings\n\n#### 6. cassExport()\n- Exports session to markdown/json/text\n- Handles NOT_FOUND gracefully\n- Returns null on error\n\n#### 7. cassExpand()\n- Expands context around line number\n- Passes context lines parameter\n- Returns null on error\n\n#### 8. cassTimeline()\n- Parses timeline JSON structure\n- Returns groups with sessions\n- Handles empty timeline\n\n#### 9. findUnprocessedSessions()\n- Filters against processed set\n- Respects agent filter\n- Respects maxSessions limit\n\n### Test Approach\n- Mock cass binary responses via fixtures\n- Test error handling paths\n- Verify command line argument construction\n- Use child_process mock for unit tests\n\n### Note on Integration\n- Full integration tests require actual cass binary\n- Unit tests focus on parsing and error handling","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:24:08.958254-05:00","updated_at":"2025-12-07T22:23:05.829647-05:00","closed_at":"2025-12-07T22:23:05.829647-05:00","dependencies":[{"issue_id":"cass_memory_system-92xd","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2025-12-07T20:31:05.778692-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-92xd","depends_on_id":"cass_memory_system-p4mv","type":"blocks","created_at":"2025-12-07T20:31:05.894753-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-92xd","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2025-12-07T20:31:09.393103-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-931","title":"[Generator] buildContextResult - Assemble final output","description":"Assemble final ContextResult from all gathered components.\n\nSIGNATURE:\nfunction buildContextResult(task: string, rules: ScoredBullet[], antiPatterns: ScoredBullet[], history: CassHit[], warnings: string[]): ContextResult\n\nPURPOSE:\nCombine all context components into a structured JSON output optimized for agent consumption. This is what gets returned to the LLM as the 'mission briefing'.\n\nOUTPUT STRUCTURE:\n{\n  task: string,                    // Original task description\n  relevantBullets: Array\u003c{         // Top-scored rules\n    id: string,\n    content: string,\n    category: string,\n    type: string,\n    maturity: number,\n    effectiveScore: number,\n    lastHelpful: string,           // Formatted timestamp\n    reasoning: string              // Why this rule exists\n  }\u003e,\n  antiPatterns: Array\u003c{            // Pitfalls to avoid\n    id: string,\n    content: string,\n    type: 'anti-pattern',\n    effectiveScore: number\n  }\u003e,\n  historySnippets: Array\u003c{         // Relevant past sessions\n    sessionPath: string,\n    agent: string,\n    snippet: string,\n    relevance: number\n  }\u003e,\n  deprecatedWarnings: string[],    // Warnings about old patterns\n  suggestedCassQueries: string[]   // Human-readable search suggestions\n}\n\nTRANSFORMATIONS:\n- rules/antiPatterns → Extract only needed fields (strip internal metadata)\n- lastHelpful → formatLastHelpful(bullet) for human readability\n- reasoning → extractBulletReasoning(bullet) for context\n- history → Map to simpler structure (remove line numbers, etc)\n- suggestedCassQueries → generateSuggestedQueries(task, keywords)\n\nFIELD DESCRIPTIONS:\n- maturity: Confidence score (0-100) based on event count\n- effectiveScore: Net helpful score with decay\n- lastHelpful: 'Never' or relative time ('2 days ago')\n- reasoning: Origin story of the rule\n\nSORTING:\n- relevantBullets: Already sorted by finalScore\n- antiPatterns: Already sorted by finalScore\n- historySnippets: Already sorted by relevance\n\nSIZE LIMITS:\n- relevantBullets: config.maxBulletsInContext (default 10)\n- antiPatterns: config.maxBulletsInContext (default 10)\n- historySnippets: config.maxHistorySnippets (default 10)\n\nThis structure is designed to be directly embeddable in LLM context.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:59.484609-05:00","updated_at":"2025-12-07T20:06:29.944025-05:00","closed_at":"2025-12-07T20:06:23.733329-05:00"}
{"id":"cass_memory_system-94c5","title":"[Tracking] Workspace-specific processed log","description":"Purpose: Separate processed session logs per workspace for workspace-scoped reflection\n\nFile path pattern: ~/.cass-memory/reflections/ws-{hash}.processed.log\n\nHash generation:\n- hash = first 8 characters of SHA256(workspace absolute path)\n- Example: /Users/dev/myapp → SHA256 → a1b2c3d4 → ws-a1b2c3d4.processed.log\n\nThis keeps workspace sessions separate from global sessions.\n\nImplementation:\n```typescript\nfunction getWorkspaceLogPath(workspacePath: string): string {\n  const hash = crypto.createHash('sha256')\n    .update(workspacePath)\n    .digest('hex')\n    .substring(0, 8);\n  return path.join(\n    os.homedir(),\n    '.cass-memory',\n    'reflections',\n    `ws-${hash}.processed.log`\n  );\n}\n```\n\nFormat: Same TSV format as global.processed.log\nBenefits:\n- Workspace-specific reflection history\n- Independent processing of workspace vs global sessions\n- Easy cleanup when workspace deleted","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:00.368578-05:00","updated_at":"2025-12-07T22:07:14.675289-05:00","closed_at":"2025-12-07T22:07:14.675289-05:00"}
{"id":"cass_memory_system-95b","title":"[Utils] now - Current ISO 8601 timestamp","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:45:01.127777-05:00","updated_at":"2025-12-07T20:24:20.345943-05:00","closed_at":"2025-12-07T20:24:03.877633-05:00","comments":[{"id":6,"issue_id":"cass_memory_system-95b","author":"jemanuel","text":"## Function Signature\n```typescript\nfunction now(): string\n```\n\n## Implementation Details\n- Returns new Date().toISOString()\n- Format: \"2024-01-15T14:30:00.000Z\"\n- Always UTC timezone\n- ISO 8601 standard format\n\n## Why This Matters\nConsistent timestamp format throughout system. Used for createdAt, updatedAt, lastUsedAt fields. ISO 8601 is sortable lexicographically and parseable by all date libraries.\n\n## Edge Cases to Handle\n- None - Date.toISOString() is very robust\n- Milliseconds always included (3 decimal places)\n- Always ends with Z (UTC indicator)","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-9jgu","title":"[E2E] Team Workflow - Repo Setup and Collaboration","description":"## Target: E2E test simulating team usage\n\n### Scenario: Team Setting Up Shared Rules\n\n```\nLead creates git repo\nLead runs init --repo\nLead adds project rules to .cass/playbook.yaml\nLead commits and pushes\nDev clones repo\nDev runs cm doctor (sees repo rules)\nDev gets context (uses merged rules)\n```\n\n### Test Script:\n\n```typescript\ndescribe('E2E: Team Workflow', () =\u003e {\n  let repoDir: string;\n  let cloneDir: string;\n\n  it('step 1: lead creates repo with .cass/', async () =\u003e {\n    repoDir = await createTempGitRepo();\n    log('Created repo:', repoDir);\n    \n    const result = await runCLI(['init', '--repo', '--json'], { cwd: repoDir });\n    log('Init result:', result.stdout);\n    \n    expect(result.exitCode).toBe(0);\n    \n    // Add custom rule\n    await runCLI(['playbook', '--add', 'Always use TypeScript strict mode', '--scope', 'project:test'], { cwd: repoDir });\n    log('Added project rule');\n    \n    // Commit\n    await execAsync('git add .cass/ \u0026\u0026 git commit -m \"Add cass config\"', { cwd: repoDir });\n    log('Committed .cass/');\n  });\n\n  it('step 2: dev clones and sees rules', async () =\u003e {\n    cloneDir = await cloneRepo(repoDir);\n    log('Cloned to:', cloneDir);\n    \n    const doctor = await runCLI(['doctor', '--json'], { cwd: cloneDir });\n    log('Doctor result:', doctor.stdout);\n    \n    const output = JSON.parse(doctor.stdout);\n    expect(output.repoPlaybook).toBe(true);\n  });\n\n  it('step 3: context includes repo rules', async () =\u003e {\n    const context = await runCLI(['context', 'typescript config', '--json'], { cwd: cloneDir });\n    log('Context result:', context.stdout);\n    \n    const output = JSON.parse(context.stdout);\n    expect(output.bullets.some(b =\u003e b.content.includes('TypeScript strict'))).toBe(true);\n  });\n});\n```\n\n### Logging:\n- Full git command output\n- File contents at each step\n- Merge resolution details","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-07T20:31:12.508002-05:00","updated_at":"2025-12-07T20:31:12.508002-05:00","dependencies":[{"issue_id":"cass_memory_system-9jgu","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:38.455069-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-9jgu","depends_on_id":"cass_memory_system-zc1d","type":"blocks","created_at":"2025-12-07T20:32:39.028162-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-9jgu","depends_on_id":"cass_memory_system-ke2x","type":"blocks","created_at":"2025-12-07T20:33:05.638636-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-9n7f","title":"[Tracking] ProcessedEntry type - Session processing record","description":"Type definition:\n```typescript\ninterface ProcessedEntry {\n  id: string;              // Unique entry ID (diary-{uuid})\n  sessionPath: string;     // Original session path (absolute or provider-specific)\n  processedAt: string;     // ISO 8601 timestamp\n  diaryId?: string;        // Generated diary ID (if diary was created)\n  deltasProposed: number;  // How many deltas reflector proposed\n  deltasApplied: number;   // How many passed validation + curation\n}\n```\n\nField details:\n- id: Unique identifier for this processing event\n- sessionPath: Original session file/database path\n  * Claude: ~/.claude/projects/{name}/session-{id}.jsonl\n  * Cursor: ~/.cursor/state.vscdb:session-{id}\n  * Aider: .aider.input.history\n- processedAt: When reflection happened (for audit trail)\n- diaryId: Optional diary entry ID (may not create diary if no insights)\n- deltasProposed: LLM suggested this many changes\n- deltasApplied: Only this many made it through validation\n\nUsed to populate ProcessedLog entries and track reflection effectiveness.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:50:41.792015-05:00","updated_at":"2025-12-07T21:00:31.31293-05:00","closed_at":"2025-12-07T21:00:29.263047-05:00"}
{"id":"cass_memory_system-9ni","title":"[Types] FeedbackEvent - Individual feedback with timestamp for decay","description":"## Overview\nDefine the FeedbackEvent type - the foundational data structure enabling time-based confidence decay. Each event represents a single instance of helpful/harmful feedback with timestamp.\n\n## Purpose\nThis type is CRITICAL for the confidence decay algorithm. Unlike simple counters, event-level tracking enables:\n1. Recency weighting - Recent feedback matters more than old feedback\n2. Decay calculation - Exponential decay based on time since event\n3. Trend analysis - Detect if rule is improving/degrading over time\n4. Provenance - Track which sessions triggered feedback\n\n## Schema Fields\n\n### Required\n- timestamp: string (ISO 8601 format) - When feedback occurred\n  - Example: '2025-12-07T14:30:00Z'\n  - Used for decay calculation: effectiveScore = baseScore * exp(-λ * age)\n  - λ = ln(2) / halfLifeDays\n\n### Optional\n- sessionPath: string | undefined - Which cass session triggered this feedback\n  - Links feedback to specific work session\n  - Enables session-level analysis (which sessions benefit from which rules)\n  - Example: '/path/to/cass/sessions/2025-12-07-auth-fix.jsonl'\n\n- reason: HarmfulReason | undefined - For harmful events only\n  - Structured categorization of WHY rule failed\n  - Enables pattern detection (e.g., 'mostly fails due to wrong_context')\n  - See HarmfulReason type for enum values\n\n- context: string | undefined - Free-form explanation\n  - Human-readable description of feedback\n  - Example: 'Rule helped avoid authentication bug by suggesting token validation'\n  - Used in audit reports and debugging\n\n## Usage Examples\n\n### Helpful Event\nconst helpfulEvent: FeedbackEvent = { timestamp: '2025-12-07T14:30:00Z', sessionPath: '/path/to/session.jsonl', context: 'Rule prevented duplicate API call' }\n\n### Harmful Event\nconst harmfulEvent: FeedbackEvent = { timestamp: '2025-12-06T10:15:00Z', sessionPath: '/path/to/session.jsonl', reason: 'caused_bug', context: 'Rule suggested wrong import path for new codebase structure' }\n\n## Integration Points\n- Stored in PlaybookBullet.helpfulEvents and PlaybookBullet.harmfulEvents arrays\n- Used by confidence decay algorithm in scoring/ranking\n- Analyzed in stats command for trend detection\n- Displayed in audit reports with timeline visualization\n\n## Acceptance Criteria\n- TypeScript interface with all 4 fields\n- timestamp is required, others optional\n- reason field typed as HarmfulReason enum\n- JSDoc explaining decay algorithm usage\n- Example usage in documentation","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:55.964583-05:00","updated_at":"2025-12-07T19:00:11.696665-05:00","closed_at":"2025-12-07T19:00:08.734999-05:00"}
{"id":"cass_memory_system-9qcu","title":"[CLI:validate] formatValidationReport - Human-readable output","description":"Format ValidationReport for human consumption.\n\nFunction signature:\n```typescript\nfunction formatValidationReport(\n  report: ValidationReport,\n  options: { verbose?: boolean }\n): string\n```\n\nValidationReport structure:\n```typescript\ninterface ValidationReport {\n  proposedRule: string;\n  verdict: 'accept' | 'reject' | 'unclear';\n  confidence: number;  // 0-1\n  evidence: Evidence[];\n  reason: string;\n  stats: {\n    sessionsScanned: number;\n    supporting: number;\n    contradicting: number;\n    neutral: number;\n  }\n}\n\ninterface Evidence {\n  sessionPath: string;\n  classification: 'supports' | 'contradicts' | 'neutral';\n  excerpt: string;\n  timestamp: string;\n}\n```\n\nOutput format:\n```\nPROPOSED RULE: \"{proposedRule}\"\n\nVERDICT: {✓ ACCEPT | ✗ REJECT | ? UNCLEAR} (confidence: {0.XX})\n\nEVIDENCE:\n- [{classification}] {sessionPath}\n  \"{excerpt}\"\n  {timestamp}\n{... more evidence ...}\n\nREASON: {reason}\n\nSTATISTICS:\n- Sessions scanned: {N}\n- Supporting: {N}\n- Contradicting: {N}\n- Neutral: {N}\n```\n\nFormatting rules:\n- Verdict symbols: ✓ (accept), ✗ (reject), ? (unclear)\n- Confidence as 2 decimal places\n- Truncate session paths to last 2 components if verbose=false\n- Show max 5 evidence items unless verbose=true\n- Color coding (if terminal supports):\n  - Green for accept/supports\n  - Red for reject/contradicts\n  - Yellow for unclear/neutral\n\nThis makes validation results easy to read and actionable.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:50:44.421676-05:00","updated_at":"2025-12-07T21:13:40.078253-05:00","closed_at":"2025-12-07T21:13:35.845183-05:00"}
{"id":"cass_memory_system-9qi4","title":"[ErrorHandling] setupGracefulShutdown - Handle SIGINT/SIGTERM","description":"Register signal handlers for graceful shutdown on interruption.\n\nFunction signature:\nfunction setupGracefulShutdown(): void\n\nImplementation:\nRegister handlers for:\n- SIGINT (Ctrl+C)\n- SIGTERM (system termination)\n\nCleanup actions on shutdown:\n- Release all acquired locks\n- Save any pending playbook changes\n- Flush buffers and close file handles\n- Log shutdown event\n- Exit with appropriate code (130 for SIGINT)\n\nExecution flow:\n1. User presses Ctrl+C\n2. SIGINT handler triggered\n3. Set global abort flag\n4. Perform cleanup\n5. Log 'Operation cancelled by user'\n6. Exit with code 130\n\nPrevents data corruption and orphaned locks on interruption.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:56.274073-05:00","updated_at":"2025-12-07T22:47:03.898067-05:00","closed_at":"2025-12-07T22:46:24.131649-05:00"}
{"id":"cass_memory_system-9ruj","title":"Epic: Comprehensive Test Coverage","description":"# Epic: Comprehensive Test Coverage\n\n## Goal\nAchieve comprehensive test coverage for cass-memory with:\n1. **Unit tests** - Pure function tests WITHOUT mocks/fakes\n2. **Integration tests** - Cross-module tests with real dependencies\n3. **E2E tests** - Full CLI tests with detailed logging\n\n## Philosophy: No Mocks Where Possible\n- Test REAL behavior, not mocked behavior\n- Use actual file I/O with temp directories\n- Use actual YAML parsing/serialization\n- Only mock external services (LLM APIs) when absolutely necessary\n- Prefer integration tests over unit tests with mocks\n\n## Structure\n1. Test Infrastructure (fixtures, helpers, logging)\n2. Unit Tests - Per-module (scoring, playbook, config, etc.)\n3. Integration Tests - Cross-module (curator pipeline, reflect pipeline)\n4. E2E Tests - Full CLI commands with logging\n\n## Success Criteria\n- All exported functions have tests\n- All CLI commands have e2e tests\n- Test output includes detailed logging for debugging\n- No flaky tests (deterministic)\n- Tests run in \u003c30 seconds total","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-07T20:21:29.725254-05:00","updated_at":"2025-12-08T00:17:18.11364-05:00","closed_at":"2025-12-08T00:17:00.757879-05:00"}
{"id":"cass_memory_system-9s5","title":"[Reflector] validateReflectorOutput - Schema validation","description":"function validateReflectorOutput(output: unknown): PlaybookDelta[]\n\n- Parse with ReflectorOutputSchema\n- Filter out malformed deltas\n- Ensure bulletIds exist for helpful/harmful/replace/deprecate\n- Log warnings for invalid deltas\n- Return valid deltas only\n\nVALIDATION STEPS:\n1. Parse JSON (if string)\n2. Validate against Zod schema\n3. For each delta:\n   - Verify required fields present\n   - For helpful/harmful/replace/deprecate: verify bulletId exists\n   - For add: verify content and category\n   - For replace: verify newContent\n4. Collect valid deltas\n5. Log warnings for invalid ones\n6. Return valid deltas\n\nSCHEMA (Zod):\n```typescript\nconst PlaybookDeltaSchema = z.discriminatedUnion('type', [\n  z.object({ type: z.literal('add'), content: z.string(), category: z.string() }),\n  z.object({ type: z.literal('helpful'), bulletId: z.string() }),\n  z.object({ type: z.literal('harmful'), bulletId: z.string() }),\n  z.object({ type: z.literal('replace'), bulletId: z.string(), newContent: z.string() }),\n  z.object({ type: z.literal('deprecate'), bulletId: z.string() })\n])\n```\n\nERROR HANDLING:\n- Malformed JSON: log error, return []\n- Invalid delta: log warning, skip delta\n- Missing bulletId: log error, skip delta\n\nUsed in reflectOnSession()","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:01.329012-05:00","updated_at":"2025-12-07T18:53:18.248035-05:00","closed_at":"2025-12-07T18:53:11.092086-05:00"}
{"id":"cass_memory_system-9sp","title":"[Diary] generateDiary - Main diary generation","description":"Main diary generation function that orchestrates the entire diary creation process.\n\nFunction Signature:\nasync function generateDiary(sessionPath: string, config: Config): Promise\u003cDiaryEntry\u003e\n\nProcess Flow:\n1. Export session content via cass command\n2. Sanitize content to remove secrets/sensitive data\n3. Extract metadata (agent, workspace) from session path\n4. Use LLM extraction to get structured diary fields\n5. Query cass for related sessions (cross-agent enrichment)\n6. Assemble complete DiaryEntry object\n7. Save diary to diary directory\n8. Return the generated diary\n\nKey Features:\n- Central orchestration of all diary generation steps\n- Error handling with graceful degradation\n- Cross-agent session discovery for context\n- Persistent storage in diary directory\n\nDependencies:\n- exportSessionSafe for content retrieval\n- extractSessionMetadata for path parsing\n- extractDiarySafe for LLM extraction\n- enrichWithRelatedSessions for cross-agent context\n- saveDiaryEntry for persistence\n\nOutput:\nReturns complete DiaryEntry with all fields populated, including related sessions and metadata.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:41.674408-05:00","updated_at":"2025-12-08T13:59:07.247433-05:00","closed_at":"2025-12-08T13:59:07.247433-05:00"}
{"id":"cass_memory_system-9stx","title":"[Unit] scoring.ts - Decay Algorithm \u0026 Score Computation","description":"## Target: src/scoring.ts (157 LOC) - ZERO CURRENT COVERAGE\n\n### Functions to Test:\n\n1. **computeDecayedScore(feedbackEvents, options)** - Core decay algorithm\n   - Single helpful event → positive score\n   - Single harmful event → negative score\n   - Multiple events → aggregated score\n   - Old events decay more than recent events\n   - 90-day half-life verification\n   - Empty events array → 0 or baseline\n   - Events at exact half-life boundary\n   - Events from future (edge case)\n\n2. **calculateHalfLife(event, baseHalfLife)** - Half-life calculation\n   - Default 90-day half-life\n   - Custom half-life values\n   - Boundary conditions\n\n3. **scoreWithContext(bullet, queryContext)** - Contextual scoring\n   - Scope match bonus\n   - Keyword overlap bonus\n   - Recency bonus\n   - Combined factors\n   - Missing context gracefully handled\n\n4. **rankBullets(bullets, query, options)** - Bullet ranking\n   - Sort by score descending\n   - Ties broken consistently\n   - Empty array → empty array\n   - Single bullet → single result\n   - Limit parameter respected\n\n5. **normalizeScores(bullets)** - Score normalization\n   - Scores in 0-1 range\n   - Max score becomes 1\n   - Min score becomes 0\n   - All same scores → all equal\n\n### Mathematical Properties to Verify:\n- Decay is exponential, not linear\n- Score(t) = Score(0) * 0.5^(t/halfLife)\n- Helpful and harmful don't simply cancel\n- Temporal ordering affects result\n\n### Test Data Patterns:\n- Use fixed timestamps, not Date.now()\n- Create event generators for various scenarios\n- Verify floating-point edge cases","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:27:47.579668-05:00","updated_at":"2025-12-07T21:57:20.803278-05:00","closed_at":"2025-12-07T21:57:20.803278-05:00","dependencies":[{"issue_id":"cass_memory_system-9stx","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:15.323057-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-9stx","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:32:58.922273-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-9ui","title":"[Cass] cassAvailable - Check if cass is installed and working","description":"Implement cassAvailable() to check if cass CLI is installed and functional.\n\n## Signature\n```typescript\nfunction cassAvailable(cassPath = \"cass\"): boolean\n```\n\n## CLI Command\n`cass health`\n\n## Implementation\n- Use execSync() with 200ms timeout\n- Set stdio: \"pipe\" to suppress output\n- Return true if exit code 0\n- Return false on any error (timeout, non-zero exit, not found)\n- Catch and suppress all exceptions\n\n## Error Handling\n- No exceptions thrown - always returns boolean\n- Logs error at debug level only\n- Safe to call frequently without performance impact\n\n## Usage\nCalled before any cass operation to fail fast:\n```typescript\nif (!cassAvailable()) {\n  console.error(\"cass CLI not found\");\n  return null;\n}\n```\n\n## Exit Codes\n- 0: cass is healthy and available\n- Any other: cass unavailable or not working","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:53.647353-05:00","updated_at":"2025-12-07T18:53:18.248467-05:00","closed_at":"2025-12-07T18:49:54.115493-05:00"}
{"id":"cass_memory_system-a0k1","title":"[CLI:playbook] stats - Playbook statistics","description":"Display playbook health and statistics.\n\nCommand signature:\n```bash\ncass-memory playbook stats [--json]\n```\n\nImplementation:\n1. Load playbook\n2. Calculate statistics:\n   - Total bullets by scope (global/workspace)\n   - Distribution by maturity\n   - Distribution by category\n   - Top performers (highest scores)\n   - At-risk bullets (low scores, old age)\n   - Deprecated count\n   - Time-based metrics\n\nOutput format:\n```\nPLAYBOOK STATISTICS\n\nOverview:\n  Total bullets: 42\n  Global: 35\n  Workspace-scoped: 7\n  Deprecated: 3\n\nMaturity Distribution:\n  Proven: 5 (12%)\n  Accepted: 18 (43%)\n  Candidates: 19 (45%)\n\nCategory Distribution:\n  best-practice: 15\n  tools: 12\n  workflow: 8\n  pitfall: 5\n  patterns: 2\n\nTop Performers (highest scores):\n  1. b-abc123 (0.95) - Always run tests before committing\n  2. b-def456 (0.92) - Use TypeScript strict mode\n  3. b-ghi789 (0.88) - Prefer composition over inheritance\n\nAt Risk (need attention):\n  1. b-jkl012 (0.32, 120 days old) - Use jQuery for DOM manipulation\n     → Low score, may need deprecation\n  2. b-mno345 (0.41, 90 days old) - Avoid async/await\n     → Contradicted by recent evidence\n\nHealth Score: 78/100\n  ✓ Good maturity distribution\n  ✓ Active curation (last update: 2 days ago)\n  ⚠ 2 bullets at risk\n  ✓ No duplicate content detected\n```\n\nStatistics calculated:\n- Maturity distribution (percentages)\n- Category breakdown\n- Top 5 highest scores\n- Bottom 5 scores with age (at-risk)\n- Overall health score (0-100)\n- Last update timestamp\n- Duplicates detection (similar content)\n\nHealth score factors:\n- Maturity pyramid (more proven than candidates = good)\n- Recent updates (active curation)\n- Low at-risk count\n- No duplicates\n- Balanced category distribution\n\nThis provides quick playbook health check and actionable insights.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:52:56.170391-05:00","updated_at":"2025-12-07T20:58:47.058657-05:00","closed_at":"2025-12-07T20:57:54.378615-05:00"}
{"id":"cass_memory_system-a2y3","title":"[Semantic] findSemanticDuplicates - Embedding-based dedup","description":"Detect semantic duplicates for merge candidates.\n\nImplementation:\n```typescript\nasync function findSemanticDuplicates(\n  bullets: PlaybookBullet[],\n  threshold: number = 0.85\n): Promise\u003c{ pair: [string, string]; similarity: number }[]\u003e\n```\n\nProcess:\n1. Ensure all bullets have embeddings\n2. Compare all pairs (O(n²) but n is small)\n3. For each pair:\n   - Calculate cosine similarity\n   - If \u003e threshold, record as duplicate\n4. Return pairs sorted by similarity\n\nUse cases:\n- Stats command: Show merge candidates\n- Playbook cleanup: Identify duplicates\n- Quality assurance: Find redundant rules\n\nExample output:\n```typescript\n[\n  {\n    pair: [\"b-123\", \"b-456\"],\n    similarity: 0.94,\n    bullets: [\n      \"Use async/await for all DB calls\",\n      \"Always use async/await when calling database\"\n    ]\n  },\n  {\n    pair: [\"b-789\", \"b-012\"],\n    similarity: 0.87,\n    bullets: [\n      \"Mock external APIs in tests\",\n      \"Use mocks for third-party services in unit tests\"\n    ]\n  }\n]\n```\n\nThreshold selection:\n- 0.95+: Almost identical (definite merge)\n- 0.85-0.95: Very similar (probable merge)\n- 0.75-0.85: Similar (review for merge)\n- \u003c0.75: Different enough to keep\n\nPerformance:\n- 100 bullets: ~500ms (4950 comparisons)\n- 500 bullets: ~12s (124750 comparisons)\n- Could optimize with clustering (future)\n\nPresented in stats command as:\n\"3 merge candidate pairs detected\"","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-07T16:49:47.408942-05:00","updated_at":"2025-12-07T17:14:56.303716-05:00","comments":[{"id":7,"issue_id":"cass_memory_system-a2y3","author":"jemanuel","text":"Detect semantic duplicates for merge candidates.\n\nImplementation:\n```typescript\nasync function findSemanticDuplicates(\n  bullets: PlaybookBullet[],\n  threshold: number = 0.85\n): Promise\u003c{ pair: [string, string]; similarity: number }[]\u003e\n```\n\nProcess:\n1. Ensure all bullets have embeddings\n2. Compare all pairs (O(n²) but n is small)\n3. For each pair:\n   - Calculate cosine similarity\n   - If \u003e threshold, record as duplicate\n4. Return pairs sorted by similarity\n\nUse cases:\n- Stats command: Show merge candidates\n- Playbook cleanup: Identify duplicates\n- Quality assurance: Find redundant rules\n\nExample output:\n```typescript\n[\n  {\n    pair: [\"b-123\", \"b-456\"],\n    similarity: 0.94,\n    bullets: [\n      \"Use async/await for all DB calls\",\n      \"Always use async/await when calling database\"\n    ]\n  },\n  {\n    pair: [\"b-789\", \"b-012\"],\n    similarity: 0.87,\n    bullets: [\n      \"Mock external APIs in tests\",\n      \"Use mocks for third-party services in unit tests\"\n    ]\n  }\n]\n```\n\nThreshold selection:\n- 0.95+: Almost identical (definite merge)\n- 0.85-0.95: Very similar (probable merge)\n- 0.75-0.85: Similar (review for merge)\n- \u003c0.75: Different enough to keep\n\nPerformance:\n- 100 bullets: ~500ms (4950 comparisons)\n- 500 bullets: ~12s (124750 comparisons)\n- Could optimize with clustering (future)\n\nPresented in stats command as:\n\"3 merge candidate pairs detected\"","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-a3y4","title":"[Semantic] EmbeddingCache type - Cached embeddings storage","description":"Cache structure for storing pre-computed embeddings.\n\nFile: ~/.cass-memory/embeddings/bullets.json\n\nStructure:\n```typescript\ninterface EmbeddingCache {\n  version: string;           // Cache format version\n  model: string;             // Model used (for invalidation)\n  bullets: Record\u003cstring, {\n    contentHash: string;     // Hash of content when computed\n    embedding: number[];     // 384-dimensional vector\n    computedAt: string;      // ISO timestamp\n  }\u003e;\n}\n```\n\nInvalidation logic:\n- If content hash changed → recompute\n- If model changed → recompute all\n- If cache version changed → rebuild cache\n\nCache benefits:\n- Embeddings computed once\n- Startup time: ~50ms vs ~300ms\n- Model stays loaded in memory\n\nCache size:\n- 100 bullets × 384 dims × 8 bytes = ~300KB\n- Negligible disk space\n- Fast to load/save\n\nExample:\n```json\n{\n  \"version\": \"1.0\",\n  \"model\": \"Xenova/all-MiniLM-L6-v2\",\n  \"bullets\": {\n    \"b-abc123\": {\n      \"contentHash\": \"sha256:...\",\n      \"embedding\": [0.123, -0.456, ...],\n      \"computedAt\": \"2025-12-07T10:00:00Z\"\n    }\n  }\n}\n```","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-07T16:49:32.970005-05:00","updated_at":"2025-12-07T17:14:56.932408-05:00","comments":[{"id":8,"issue_id":"cass_memory_system-a3y4","author":"jemanuel","text":"Cache structure for storing pre-computed embeddings.\n\nFile: ~/.cass-memory/embeddings/bullets.json\n\nStructure:\n```typescript\ninterface EmbeddingCache {\n  version: string;           // Cache format version\n  model: string;             // Model used (for invalidation)\n  bullets: Record\u003cstring, {\n    contentHash: string;     // Hash of content when computed\n    embedding: number[];     // 384-dimensional vector\n    computedAt: string;      // ISO timestamp\n  }\u003e;\n}\n```\n\nInvalidation logic:\n- If content hash changed → recompute\n- If model changed → recompute all\n- If cache version changed → rebuild cache\n\nCache benefits:\n- Embeddings computed once\n- Startup time: ~50ms vs ~300ms\n- Model stays loaded in memory\n\nCache size:\n- 100 bullets × 384 dims × 8 bytes = ~300KB\n- Negligible disk space\n- Fast to load/save\n\nExample:\n```json\n{\n  \"version\": \"1.0\",\n  \"model\": \"Xenova/all-MiniLM-L6-v2\",\n  \"bullets\": {\n    \"b-abc123\": {\n      \"contentHash\": \"sha256:...\",\n      \"embedding\": [0.123, -0.456, ...],\n      \"computedAt\": \"2025-12-07T10:00:00Z\"\n    }\n  }\n}\n```","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-a4g","title":"[Utils] formatRelativeTime - Human-readable relative time","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:45:11.043941-05:00","updated_at":"2025-12-07T20:24:20.348698-05:00","closed_at":"2025-12-07T20:24:03.865919-05:00","comments":[{"id":9,"issue_id":"cass_memory_system-a4g","author":"jemanuel","text":"## Function Signature\n```typescript\nfunction formatRelativeTime(isoDate: string): string\n```\n\n## Implementation Details\n- Parse isoDate to Date object\n- Calculate difference from now in milliseconds\n- Convert to days: Math.floor(diff / (1000 * 60 * 60 * 24))\n- Return string based on days:\n  - 0 days: \"today\"\n  - 1 day: \"yesterday\"\n  - 2-6 days: \"N days ago\"\n  - 7-29 days: \"N weeks ago\" (divide by 7, round)\n  - 30+ days: \"N months ago\" (divide by 30, round)\n\n## Why This Matters\nUsed in human-readable output (not JSON mode). Makes timestamps easier to understand at a glance. \"2 days ago\" is clearer than \"2024-01-13T14:30:00.000Z\".\n\n## Edge Cases to Handle\n- Future dates - return \"in the future\" or handle as 0 days\n- Invalid ISO string - throw error\n- Very old dates - \"N months ago\" can get large, consider \"N years ago\" for 365+ days","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-afjz","title":"[Design] Low-Friction Feedback Mechanism","description":"# Design: Inline Feedback Comment Format\n\n## Purpose\nDecide on the EXACT format for inline feedback comments that agents can use.\nThis unblocks y1d4 (implementation) with a clear specification.\n\n## Decision Needed\nWhat regex pattern should we parse from session logs?\n\n## Proposed Format\n\\`\\`\\`\n// [cass: helpful b-xyz123]\n// [cass: helpful b-xyz123] reason text here\n// [cass: harmful b-abc456] this advice didn't work\n# [cass: helpful b-xyz] (support # for non-JS)\n\\`\\`\\`\n\n## Regex Pattern\n\\`\\`\\`\n\\[cass:\\s*(helpful|harmful)\\s+(b-[a-z0-9]+)\\](?:\\s+(.+))?\n\\`\\`\\`\n\n## Questions to Decide\n1. Is this format clear enough for agents to use?\n2. Should we support other comment styles (/* */, --, etc.)?\n3. How do we handle multi-line reasons?\n4. What about false positives in code that contains literal \\\"[cass:\\\"?\n\n## Deliverable\n- Documented format specification\n- Regex pattern for implementation\n- Edge case handling rules\n\n## NO BLOCKERS\nThis task can start immediately. The format decision doesn't depend on other analysis.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T12:47:48.819946-05:00","updated_at":"2025-12-08T13:19:54.269958-05:00","closed_at":"2025-12-08T13:19:54.269958-05:00","dependencies":[{"issue_id":"cass_memory_system-afjz","depends_on_id":"cass_memory_system-2bnu","type":"blocks","created_at":"2025-12-08T12:48:44.659636-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-ai52","title":"[Test] Infrastructure: Fixtures, Helpers, Logging","description":"# Test Infrastructure Epic\n\n## Overview\nBuild foundational test infrastructure that enables comprehensive, readable tests with excellent debugging capabilities.\n\n## Components\n\n### 1. Test Fixtures (test/fixtures/)\n- Sample playbook YAML files (empty, minimal, complex)\n- Sample diary entries (success, failure, mixed)\n- Sample session exports (various agents)\n- Sample config files (default, custom)\n\n### 2. Test Helpers (test/helpers/)\n- createTempDir() - Create isolated temp directory for test\n- cleanupTempDir() - Remove temp directory after test\n- createTestPlaybook() - Generate playbook with configurable bullets\n- createTestDiary() - Generate diary entry with configurable fields\n- createTestConfig() - Generate config with sensible defaults\n- assertBulletMatches() - Deep equality for bullet comparison\n\n### 3. Test Logger (test/helpers/logger.ts)\n- Structured logging during test execution\n- Log levels: DEBUG, INFO, WARN, ERROR\n- Timestamp each log entry\n- Capture and display on test failure\n- Option to write to file for CI analysis\n\n### 4. Test Reporter\n- Custom Bun test reporter for detailed output\n- Show test duration per test\n- Show file I/O operations\n- Highlight slow tests (\u003e100ms)\n\n## Acceptance Criteria\n- [ ] Fixtures directory with sample data\n- [ ] Helper functions exported from test/helpers/index.ts\n- [ ] Logger captures all test activity\n- [ ] Tests can opt-in to detailed logging\n- [ ] CI-friendly output format","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-07T20:21:54.216703-05:00","updated_at":"2025-12-07T20:41:38.370056-05:00","closed_at":"2025-12-07T20:41:15.698358-05:00"}
{"id":"cass_memory_system-ajkn","title":"[Analysis] Audit Current Command Set for Agent Usability","description":"# Audit Current Command Set for Agent Usability\n\n## Purpose\nReview every `cm` command and categorize it by who should use it and when.\n\n## Current Commands (from README)\n- `cm init` - Initialize configuration\n- `cm context \u003ctask\u003e` - Get relevant rules + history\n- `cm mark \u003crule\u003e \u003cfeedback\u003e` - Record helpful/harmful\n- `cm playbook` - List, add, remove rules\n- `cm stats` - Playbook health metrics\n- `cm doctor` - System health check\n- `cm reflect` - Extract rules from sessions\n- `cm audit` - Check for rule violations\n- `cm project` - Export playbook formats\n- `cm serve` - MCP server mode\n\n## Categorization Framework\n\n**Agent-Essential** (agents call these directly, frequently):\n- Must be dead simple\n- Output must be LLM-optimized\n- Should \"just work\" with minimal flags\n\n**Agent-Occasional** (agents might call, but not routine):\n- Still needs good ergonomics\n- Can have more options\n\n**Automated** (should be run by hooks, not agents):\n- Agents shouldn't need to remember to call these\n- Background processing\n\n**Human-Only** (operators use for setup/monitoring):\n- Can be more complex\n- Rich human-readable output is fine\n\n## Deliverables\n- [ ] Categorized command list with justification\n- [ ] Recommendations for command changes (simplify, deprecate, merge)\n- [ ] List of commands that need output format improvements","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T12:46:31.349758-05:00","updated_at":"2025-12-08T13:13:28.019727-05:00","closed_at":"2025-12-08T13:13:28.019727-05:00"}
{"id":"cass_memory_system-alcn","title":"[CLI:reflect] updateProcessedLog - Track processed sessions","description":"Record processed sessions to prevent reprocessing.\n\nFunction signature:\n```typescript\nasync function updateProcessedLog(\n  log: ProcessedLog,\n  entries: ProcessedEntry[]\n): Promise\u003cvoid\u003e\n```\n\nImplementation:\n1. Load existing processed.log:\n   - File location: ${memoryDir}/processed.log\n   - Tab-delimited format\n   - Create if doesn't exist\n\n2. Add new entries:\n   - Each entry represents one processed session\n   - Format: {id}\\t{timestamp}\\t{sessionPath}\\t{deltasProposed}\\t{deltasApplied}\\n\n   - Example: sess-abc123\\t2025-01-15T10:30:00Z\\t/Users/x/.claude/sessions/001.jsonl\\t5\\t3\n\n3. Write to disk:\n   - Append mode (don't overwrite)\n   - Atomic write (temp file + rename)\n   - Ensure proper permissions\n\nProcessedEntry type:\n```typescript\ninterface ProcessedEntry {\n  id: string;              // session ID\n  timestamp: string;       // ISO 8601\n  sessionPath: string;     // absolute path\n  deltasProposed: number;  // from reflector\n  deltasApplied: number;   // from curator\n}\n```\n\nProcessedLog class:\n```typescript\nclass ProcessedLog {\n  private entries: Map\u003cstring, ProcessedEntry\u003e;\n  \n  load(): Promise\u003cvoid\u003e\n  has(sessionPath: string): boolean\n  add(entry: ProcessedEntry): void\n  save(): Promise\u003cvoid\u003e\n}\n```\n\nThe log prevents duplicate processing and provides audit trail.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:50:18.282321-05:00","updated_at":"2025-12-07T21:13:03.895961-05:00","closed_at":"2025-12-07T21:12:44.99713-05:00"}
{"id":"cass_memory_system-ank","title":"[Diary] loadDiaryEntry - Read from disk","description":"Read and validate diary entry from disk.\n\nFunction Signature:\nasync function loadDiaryEntry(diaryPath: string): Promise\u003cDiaryEntry\u003e\n\nProcess:\n1. Verify file exists at diaryPath\n2. Read file contents as UTF-8 string\n3. Parse JSON string to object\n4. Validate against DiaryEntrySchema using Zod\n5. Return validated DiaryEntry\n\nValidation Features:\n- Type checking for all fields\n- Required field validation\n- Date format validation for timestamp\n- Array content validation\n- Status enum validation (success/failure/mixed)\n\nError Handling:\n- FileNotFoundError if path doesn't exist\n- JSONParseError if invalid JSON\n- SchemaValidationError if missing/invalid fields\n- Detailed error messages for debugging\n\nSchema Migration:\n- If old diary version detected, apply migration\n- Add default values for new optional fields\n- Preserve backward compatibility\n\nKey Features:\n- Full schema validation ensures type safety\n- Detailed validation errors for debugging\n- Migration support for schema evolution\n- UTF-8 encoding handling\n\nUse Cases:\n- Loading diary for evidence correlation\n- Reading diaries for stats computation\n- Fetching diary for display in UI\n- Validating diary integrity\n\nOutput:\nReturns fully validated DiaryEntry object ready for use.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:46:09.388329-05:00","updated_at":"2025-12-07T20:11:16.248993-05:00","closed_at":"2025-12-07T20:11:10.583918-05:00"}
{"id":"cass_memory_system-anqj","title":"[Unit] utils.ts - Pure Function Tests (Part 1: Path \u0026 File Utilities)","description":"# [Unit] utils.ts - Path \u0026 File Utilities\n\n## Functions to Test (test/utils.path.test.ts)\n\n### expandPath(p: string)\n- [ ] Expand ~ to home directory\n- [ ] Expand relative paths to absolute\n- [ ] Handle already-absolute paths (no change)\n- [ ] Handle empty string\n- [ ] Handle paths with spaces\n- [ ] Handle Windows-style paths (if applicable)\n\n### resolveRepoDir(startDir?: string)\n- [ ] Find .git directory walking up\n- [ ] Return null when not in git repo\n- [ ] Handle nested git repos\n- [ ] Handle startDir parameter\n\n### resolveGlobalDir()\n- [ ] Return ~/.cass-memory\n- [ ] Expand ~ correctly\n\n### ensureDir(dir: string)\n- [ ] Create directory if not exists\n- [ ] No-op if already exists\n- [ ] Create nested directories\n- [ ] Handle permission errors gracefully\n\n### fileExists(path: string)\n- [ ] Return true for existing file\n- [ ] Return false for non-existent\n- [ ] Return false for directory\n- [ ] Handle permission errors\n\n### atomicWrite(filePath: string, content: string)\n- [ ] Write to temp then rename\n- [ ] Set correct permissions (0o600)\n- [ ] Clean up temp on failure\n- [ ] Handle directory not exists\n\n## Test Approach\n- Use real file system with temp directories\n- beforeAll: create temp dir\n- afterAll: cleanup temp dir\n- Each test isolated to subdirectory\n\n## Expected: 25+ test cases","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:24:22.127287-05:00","updated_at":"2025-12-07T20:49:23.467571-05:00","closed_at":"2025-12-07T20:49:20.49843-05:00","dependencies":[{"issue_id":"cass_memory_system-anqj","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:13.634601-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-anqj","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:32:56.288616-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-anri","title":"Reflect writes to repo playbook when present","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T22:17:51.718977-05:00","updated_at":"2025-12-07T22:18:00.236824-05:00","closed_at":"2025-12-07T22:18:00.236824-05:00","dependencies":[{"issue_id":"cass_memory_system-anri","depends_on_id":"cass_memory_system-u64s","type":"discovered-from","created_at":"2025-12-07T22:17:51.720392-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-apt","title":"[Cass] cassSearch - Execute cass search with options","description":"Implement cassSearch() to execute cass search with comprehensive options.\n\n## Signature\n```typescript\ninterface CassSearchOptions {\n  limit?: number;\n  days?: number;\n  agent?: string;\n  workspace?: string;\n  fields?: string;\n  maxTokens?: number;\n  highlight?: boolean;\n  timeout?: number;\n}\n\ninterface CassHit {\n  sessionPath: string;\n  lineNumber: number;\n  content: string;\n  timestamp?: string;\n  score?: number;\n}\n\nasync function cassSearch(\n  query: string, \n  options: CassSearchOptions = {},\n  cassPath = \"cass\"\n): Promise\u003cCassHit[]\u003e\n```\n\n## CLI Command\n`cass search \"{query}\" --robot [--limit N] [--days N] [--agent A] [--workspace W] [--fields F] [--max-tokens N] [--highlight] [--timeout N]`\n\n## Implementation\n- Build command with all provided options\n- Use execFile() with maxBuffer: 50MB for large results\n- Parse JSON output from --robot flag\n- Return array of CassHit objects\n\n## Error Handling\nCheck exit code and handle intelligently:\n- Exit 0: Success, parse and return hits\n- Exit 3: Index missing - rebuild index, then retry once\n- Exit 10: Timeout - reduce limit by 50%, retry once\n- Exit 4: Not found - return empty array\n- Other errors: Log and return empty array\n\n## Options Details\n- limit: Max hits to return (default: 10)\n- days: Only search last N days\n- agent: Filter by agent name (e.g., \"claude-code\")\n- workspace: Filter by workspace path\n- fields: Comma-separated fields to search\n- maxTokens: Truncate results to N tokens\n- highlight: Include highlighting markers in results\n- timeout: Command timeout in seconds\n\n## Usage\n```typescript\nconst hits = await cassSearch(\"bug fix\", { \n  limit: 20, \n  days: 7, \n  agent: \"claude-code\" \n});\n```","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:57.153732-05:00","updated_at":"2025-12-07T19:02:10.078585-05:00","closed_at":"2025-12-07T19:02:00.15937-05:00"}
{"id":"cass_memory_system-ar2","title":"[Curator] invertToAntiPattern - Convert harmful rule to pitfall","description":"Convert a harmful bullet into an anti-pattern (learning from mistakes).\n\nSignature:\nfunction invertToAntiPattern(bullet: PlaybookBullet): PlaybookBullet\n\nKEY INNOVATION: Instead of deleting harmful rules, INVERT them to preserve learning.\n\nProcess:\n1. Create new bullet with inverted semantics:\n   - content: Prefix with 'AVOID: ' or 'DON\\'T: '\n   - Example: 'Use any type' → 'AVOID: Using any type without explicit reason'\n   \n2. Set bullet fields:\n   - type: 'anti-pattern'\n   - kind: 'anti_pattern'\n   - category: same as original\n   - maturity: 'candidate' (starts fresh)\n   - state: 'active'\n   \n3. Preserve provenance:\n   - source: copy from original\n   - originalId: link back to harmful bullet\n   - createdAt: current timestamp\n   - derivedFrom: original bullet ID\n   \n4. Reset feedback (fresh start):\n   - helpfulCount: 0\n   - harmfulCount: 0\n   - helpfulEvents: []\n   - harmfulEvents: []\n   \n5. Return new anti-pattern bullet\n\nWhy inversion matters:\n- Preserves WHAT NOT TO DO\n- Prevents future developers from making same mistake\n- Converts negative experience into positive guidance\n- Maintains complete learning history\n\nExample transformation:\nOriginal (harmful): 'Always use any type for flexibility'\nAnti-pattern: 'AVOID: Using any type without explicit reason. Prefer specific types for type safety.'\n\nThe anti-pattern must earn trust like any other candidate bullet.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:45:04.707658-05:00","updated_at":"2025-12-07T21:14:16.240924-05:00","closed_at":"2025-12-07T21:14:09.899034-05:00"}
{"id":"cass_memory_system-b5q","title":"[Security] compileExtraPatterns - User pattern compilation","description":"Implement compileExtraPatterns() to convert user pattern strings to RegExp objects.\n\nFunction signature:\n```typescript\nfunction compileExtraPatterns(patterns: string[]): RegExp[]\n```\n\nImplementation requirements:\n1. Parse string patterns into RegExp objects\n2. Add 'gi' flags automatically (global, case-insensitive)\n3. Catch and warn on invalid regex syntax\n4. Return only valid patterns (skip invalid ones)\n\nError handling:\n- Log warning for invalid patterns: \"[sanitize] Invalid regex pattern: \u003cpattern\u003e\"\n- Continue processing remaining patterns\n- Never throw - return partial results\n\nExample:\n```typescript\nconst patterns = [\n  \"INTERNAL_[A-Z_]+_KEY\",\n  \"[invalid(regex\",  // syntax error\n  \"MY_SECRET_\\\\w+\"\n];\nconst compiled = compileExtraPatterns(patterns);\n// Returns: [/INTERNAL_[A-Z_]+_KEY/gi, /MY_SECRET_\\w+/gi]\n// Logs: \"[sanitize] Invalid regex pattern: [invalid(regex\"\n```\n\nCalled at startup to pre-compile user patterns from config.\n\nPriority: 0 (Security Critical - P12)","notes":"Implemented compileExtraPatterns in src/sanitize.ts with gi flags, error handling, and warnings","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:51.253402-05:00","updated_at":"2025-12-07T18:53:18.249516-05:00","closed_at":"2025-12-07T18:52:23.874542-05:00"}
{"id":"cass_memory_system-b82i","title":"E2E Tests Epic - CLI command end-to-end tests","description":"End-to-end tests for all CLI commands.\nTests complete user workflows from command invocation to output.\nReal subprocess execution with bun run.\nReal file I/O and realistic fixture directories.\nDetailed structured logging for debugging test failures.\nCommands to test: context, mark, playbook, stats, doctor, reflect, init","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-07T20:26:46.908302-05:00","updated_at":"2025-12-08T00:45:23.491637-05:00","closed_at":"2025-12-08T00:45:23.491637-05:00","dependencies":[{"issue_id":"cass_memory_system-b82i","depends_on_id":"cass_memory_system-8dxr","type":"blocks","created_at":"2025-12-07T20:28:00.443753-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-b8bp","title":"[Test] Fixtures: Sample diary entries","description":"Create test/fixtures/diaries/ with:\n\n1. success-diary.yaml - Successful session with accomplishments\n2. failure-diary.yaml - Failed session with challenges\n3. mixed-diary.yaml - Session with mixed outcomes\n4. rich-diary.yaml - All fields populated (relatedSessions, searchAnchors, etc.)\n5. minimal-diary.yaml - Only required fields\n6. multi-agent-diary.yaml - Related sessions from different agents\n\nEach should:\n- Be valid against DiaryEntrySchema\n- Have realistic timestamps\n- Include realistic session paths\n- Cover the 5 structured content arrays (accomplishments, decisions, challenges, preferences, keyLearnings)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:22:16.201911-05:00","updated_at":"2025-12-07T21:13:03.897506-05:00","closed_at":"2025-12-07T21:12:43.941401-05:00"}
{"id":"cass_memory_system-b96","title":"[Generator] generateSuggestedQueries - Follow-up search suggestions","description":"Generate human-readable cass search suggestions for follow-up investigation.\n\nSIGNATURE:\nfunction generateSuggestedQueries(task: string, keywords: string[]): string[]\n\nPURPOSE:\nProvide ready-to-run cass commands that the user can execute to dig deeper if the provided context isn't sufficient. Helps with iterative investigation.\n\nOUTPUT:\nArray of 3-5 formatted cass command strings\n\nFORMAT:\n'cass search \"{query}\" --days {days} [--agent {agent}]'\n\nEXAMPLE:\nTask: 'Fix authentication timeout bug'\nKeywords: ['authentication', 'timeout', 'token', 'session', 'jwt']\n\nOutput: [\n  'cass search \"authentication timeout\" --days 30',\n  'cass search \"token refresh\" --days 60',\n  'cass search \"session expiry\" --agent claude',\n  'cass search \"jwt validation error\" --days 90'\n]\n\nQUERY GENERATION STRATEGY:\n1. Use top 2-3 keyword combinations from keywords array\n2. Add task-derived queries (extract noun phrases)\n3. Vary --days parameter (30, 60, 90) for different time scopes\n4. Include --agent filter if config.preferredAgent is set\n5. Prioritize error/problem-oriented queries ('error', 'fix', 'bug')\n\nIMPLEMENTATION NOTES:\n- Escape quotes in query strings\n- Limit to 5 suggestions (avoid overwhelming)\n- Include at least one broad query (first keyword only)\n- Include at least one specific query (multi-keyword phrase)\n\nUSE CASE:\nUser receives context but wants to explore more:\n'The context you provided is helpful, but I want to see more examples of token refresh handling.'\n→ They can run: cass search \"token refresh\" --days 60\n\nINTEGRATION:\nThese queries appear at the end of markdown output under '### Dig Deeper' section\nAlso included in JSON output for programmatic access\n\nALTERNATIVE NAMES:\n- 'Suggested Searches'\n- 'Follow-up Queries'\n- 'Explore More'","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:00.569423-05:00","updated_at":"2025-12-07T20:04:56.113182-05:00","closed_at":"2025-12-07T20:03:40.649191-05:00"}
{"id":"cass_memory_system-b96v","title":"[CLI] mark command - Record bullet feedback","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:41.369847-05:00","updated_at":"2025-12-07T21:12:17.521594-05:00","closed_at":"2025-12-07T21:12:13.739773-05:00"}
{"id":"cass_memory_system-bb9","title":"[Cass] findUnprocessedSessions - Get sessions not yet reflected on","description":"Implement findUnprocessedSessions() to get sessions not yet reflected on.\n\n## Signature\n```typescript\ninterface ProcessedLog {\n  processedSessions: Set\u003cstring\u003e;\n  lastProcessedAt?: string;\n}\n\nasync function findUnprocessedSessions(\n  processedLog: ProcessedLog,\n  options: { days?: number; agents?: string[] },\n  cassPath = \"cass\"\n): Promise\u003cstring[]\u003e\n```\n\n## Implementation Flow\n1. Call cassTimeline(days) to get recent sessions\n2. Extract all session paths from timeline groups\n3. Filter out paths already in processedLog.processedSessions\n4. Optionally filter by agent names\n5. Return unprocessed session paths\n\n## Error Handling\n- Return empty array if timeline fails\n- Handle missing timeline gracefully\n- Log filtering progress at debug level\n\n## Parameters\n- processedLog: Tracks which sessions have been reflected on\n- options.days: How far back to look (default: 7)\n- options.agents: Filter by agent names (e.g., [\"claude-code\"])\n\n## Algorithm\n```typescript\nconst timeline = await cassTimeline(options.days || 7);\nconst allSessions = timeline.groups.flatMap(g =\u003e \n  g.sessions.map(s =\u003e s.path)\n);\n\nlet unprocessed = allSessions.filter(path =\u003e \n  \\!processedLog.processedSessions.has(path)\n);\n\nif (options.agents) {\n  unprocessed = unprocessed.filter(path =\u003e {\n    const session = timeline.groups\n      .flatMap(g =\u003e g.sessions)\n      .find(s =\u003e s.path === path);\n    return options.agents.includes(session?.agent);\n  });\n}\n\nreturn unprocessed;\n```\n\n## Usage\nCore function for reflect command:\n```typescript\nconst processedLog = loadProcessedLog();\nconst unprocessed = await findUnprocessedSessions(\n  processedLog, \n  { days: 7, agents: [\"claude-code\"] }\n);\n\nfor (const sessionPath of unprocessed) {\n  await reflectOnSession(sessionPath);\n  processedLog.processedSessions.add(sessionPath);\n}\n\nsaveProcessedLog(processedLog);\n```","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:04.582356-05:00","updated_at":"2025-12-07T20:10:22.243784-05:00","closed_at":"2025-12-07T20:09:23.214984-05:00"}
{"id":"cass_memory_system-bbb","title":"[Utils] hashContent - Normalized content hashing for deduplication","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:44:48.046449-05:00","updated_at":"2025-12-07T20:24:27.269804-05:00","closed_at":"2025-12-07T20:24:24.584913-05:00","comments":[{"id":10,"issue_id":"cass_memory_system-bbb","author":"jemanuel","text":"## Function Signature\n```typescript\nfunction hashContent(content: string): string\n```\n\n## Implementation Details\n- Normalize content:\n  - Convert to lowercase\n  - Collapse multiple whitespace to single space\n  - Trim leading/trailing whitespace\n- Create SHA-256 hash using crypto.createHash('sha256')\n- Update hash with normalized content\n- Return first 16 characters of hex digest\n\n## Why This Matters\nCritical for exact duplicate detection in curator. Normalization ensures \"Test Content\" and \"test  content\" produce same hash, catching duplicates that differ only in formatting. Used in deduplication pass before semantic similarity check.\n\n## Edge Cases to Handle\n- Empty string - returns hash of empty string\n- Only whitespace - normalized to empty, returns hash of empty\n- Very long content - SHA-256 handles any size\n- Unicode characters - ensure proper encoding (UTF-8)\n- Newlines and tabs - collapsed to single space by normalization","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-bcj","title":"[Generator] executeSearchPlan - Parallel cass searches","description":"Parallel execution of cass searches with deduplication.\n\nSIGNATURE:\nasync function executeSearchPlan(queries: string[], config: Config): Promise\u003cCassHit[]\u003e\n\nPURPOSE:\nExecute all generated queries against cass in parallel, combine results, deduplicate, and return top hits sorted by relevance score.\n\nFLOW:\n1. Map queries to cass search promises with config.sessionLookbackDays\n2. Execute all with Promise.all (parallel for speed)\n3. Flatten results into single array\n4. Deduplicate by source_path + line_number (same snippet from multiple queries)\n5. Sort by relevance score descending\n6. Return top N results (config.maxHistorySnippets or default 10)\n\nCASS SEARCH PARAMETERS:\n- limit: 5 per query\n- days: config.sessionLookbackDays (default 90)\n- agent: config.preferredAgent (optional filter)\n\nDEDUPLICATION LOGIC:\nTwo hits are duplicates if:\n  hit1.source_path === hit2.source_path \u0026\u0026 hit1.line_number === hit2.line_number\nKeep the one with higher relevance score.\n\nRESULT SHAPE:\nArray\u003c{\n  session_path: string,\n  agent: string,\n  snippet: string,\n  relevance: number,\n  source_path: string,\n  line_number: number\n}\u003e\n\nERROR HANDLING:\n- If cass binary not found, throw error (caught by generateTaskContext)\n- If individual query fails, log warning but continue with other queries\n- Return empty array if all queries fail","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:54.025102-05:00","updated_at":"2025-12-07T18:59:44.041487-05:00","closed_at":"2025-12-07T18:59:33.686488-05:00"}
{"id":"cass_memory_system-be2","title":"[Decay] analyzeScoreDistribution - Playbook health metrics","description":"Analyze the distribution of effective scores across all bullets in a playbook. Provides health metrics showing how many rules are excellent, good, neutral, or at-risk. Used by stats command to show playbook quality.\n\nCOMPLETE IMPLEMENTATION:\n```typescript\n/**\n * Analyze score distribution across all bullets.\n * Provides playbook health metrics and identifies problematic rules.\n */\nfunction analyzeScoreDistribution(bullets: PlaybookBullet[]): {\n  excellent: number;      // score \u003e 10\n  good: number;          // score 5-10\n  neutral: number;       // score 0-5\n  atRisk: number;        // score \u003c 0\n  distribution: number[]; // histogram buckets\n  avgScore: number;\n  medianScore: number;\n  totalBullets: number;\n} {\n  const scores = bullets.map(b =\u003e getEffectiveScore(b));\n  \n  // Category counts\n  const excellent = scores.filter(s =\u003e s \u003e 10).length;\n  const good = scores.filter(s =\u003e s \u003e 5 \u0026\u0026 s \u003c= 10).length;\n  const neutral = scores.filter(s =\u003e s \u003e= 0 \u0026\u0026 s \u003c= 5).length;\n  const atRisk = scores.filter(s =\u003e s \u003c 0).length;\n\n  // Histogram: buckets from -5 to 15 in steps of 2\n  const buckets = Array(11).fill(0);\n  scores.forEach(score =\u003e {\n    const bucketIndex = Math.min(10, Math.max(0, Math.floor((score + 5) / 2)));\n    buckets[bucketIndex]++;\n  });\n\n  // Statistics\n  const avgScore = scores.reduce((sum, s) =\u003e sum + s, 0) / scores.length;\n  const sorted = [...scores].sort((a, b) =\u003e a - b);\n  const medianScore = scores.length % 2 === 0\n    ? (sorted[scores.length / 2 - 1] + sorted[scores.length / 2]) / 2\n    : sorted[Math.floor(scores.length / 2)];\n\n  return {\n    excellent,\n    good,\n    neutral,\n    atRisk,\n    distribution: buckets,\n    avgScore: Math.round(avgScore * 100) / 100,\n    medianScore: Math.round(medianScore * 100) / 100,\n    totalBullets: bullets.length\n  };\n}\n```\n\nSCORE CATEGORIES:\n\nExcellent (score \u003e 10):\n- Highly proven rules with strong positive signal\n- Typically proven maturity with 8+ helpful, 0 harmful\n- Core playbook rules that define best practices\n\nGood (score 5-10):\n- Solid established or proven rules\n- Consistent positive feedback\n- Reliable guidance with few issues\n\nNeutral (score 0-5):\n- New candidates or low-feedback rules\n- Neither strongly positive nor negative\n- May need more time to prove value\n\nAt Risk (score \u003c 0):\n- Rules with harmful marks outweighing helpful\n- Candidates for demotion or deprecation\n- Need review - may be toxic or obsolete\n\nHISTOGRAM BUCKETS:\n```\nBucket 0: score \u003c -5\nBucket 1: -5 to -3\nBucket 2: -3 to -1\nBucket 3: -1 to 1\nBucket 4: 1 to 3\nBucket 5: 3 to 5\nBucket 6: 5 to 7\nBucket 7: 7 to 9\nBucket 8: 9 to 11\nBucket 9: 11 to 13\nBucket 10: score \u003e 13\n```\n\nUSAGE IN STATS COMMAND:\n```typescript\nconst analysis = analyzeScoreDistribution(playbook.bullets);\n\nconsole.log('📊 Playbook Health Report');\nconsole.log(`Total rules: ${analysis.totalBullets}`);\nconsole.log(`Excellent (\u003e10): ${analysis.excellent} (${pct(analysis.excellent)}%)`);\nconsole.log(`Good (5-10): ${analysis.good} (${pct(analysis.good)}%)`);\nconsole.log(`Neutral (0-5): ${analysis.neutral} (${pct(analysis.neutral)}%)`);\nconsole.log(`At Risk (\u003c0): ${analysis.atRisk} (${pct(analysis.atRisk)}%)`);\nconsole.log(`Average score: ${analysis.avgScore}`);\nconsole.log(`Median score: ${analysis.medianScore}`);\n\n// ASCII histogram\nconsole.log('\\nScore Distribution:');\nanalysis.distribution.forEach((count, i) =\u003e {\n  const scoreRange = `${i*2-5} to ${i*2-3}`;\n  const bar = '█'.repeat(Math.floor(count / 2));\n  console.log(`${scoreRange.padEnd(10)} ${bar} (${count})`);\n});\n```\n\nEXAMPLE OUTPUT:\n```\n📊 Playbook Health Report\nTotal rules: 42\nExcellent (\u003e10): 8 (19%)\nGood (5-10): 15 (36%)\nNeutral (0-5): 16 (38%)\nAt Risk (\u003c0): 3 (7%)\nAverage score: 6.23\nMedian score: 5.50\n\nScore Distribution:\n-5 to -3   ██ (2)\n-3 to -1   █ (1)\n-1 to 1    ████ (4)\n1 to 3     ████████ (8)\n3 to 5     ██████ (6)\n5 to 7     ██████████ (10)\n7 to 9     ████ (4)\n9 to 11    ████ (4)\n11 to 13   ██ (2)\n\u003e13        █ (1)\n```\n\nHEALTH INDICATORS:\n\nHealthy Playbook:\n- 60%+ in good/excellent\n- \u003c10% at risk\n- Median score \u003e 5\n- Distribution skews right (positive)\n\nWarning Signs:\n- 20%+ at risk\n- Median score \u003c 2\n- Many rules in -3 to 1 range\n- Few or no excellent rules\n\nCritical Issues:\n- 50%+ at risk\n- Average score \u003c 0\n- Distribution skews left (negative)\n- Indicates playbook decay or mismatch with codebase\n\nDEPENDENCIES:\n- getEffectiveScore()\n- PlaybookBullet array\n\nUSED BY:\n- stats command\n- Playbook health dashboard (future)\n- Automated alerts (future)\n- Quality metrics API (future)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:46:59.865436-05:00","updated_at":"2025-12-07T21:01:42.014808-05:00","closed_at":"2025-12-07T21:01:38.708285-05:00"}
{"id":"cass_memory_system-bjz","title":"[LLM] llmWithRetry - Exponential backoff retry wrapper","description":"Function signature:\nasync function llmWithRetry\u003cT\u003e(\n  operation: () =\u003e Promise\u003cT\u003e,\n  operationName: string\n): Promise\u003cT\u003e\n\nConfiguration:\n- maxRetries: 3\n- baseDelayMs: 1000\n- maxDelayMs: 30000\n- retryableErrors: ['rate_limit_exceeded', 'server_error', 'timeout', 'overloaded']\n\nLogic:\n1. Try operation\n2. If error thrown:\n   a. Check if error type is retryable\n   b. If yes and retries \u003c maxRetries:\n      - Calculate delay: min(baseDelayMs * 2^attempt, maxDelayMs)\n      - Log retry attempt with delay\n      - Wait\n      - Retry operation\n   c. If not retryable or max retries exceeded, throw error\n3. Return result on success\n\nLogging example:\n'LLM operation extractDiary failed (rate_limit_exceeded). Retrying in 2000ms... (attempt 2/3)'\n\nUse this wrapper around all LLM operations for resilience against transient failures.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:46:09.625399-05:00","updated_at":"2025-12-07T20:12:11.77578-05:00","closed_at":"2025-12-07T20:11:45.044058-05:00"}
{"id":"cass_memory_system-bm7","title":"[Reflector] getIterationNote - Context for subsequent iterations","description":"function getIterationNote(iteration: number): string\n\n- iteration 0: empty string\n- iteration 1+: \"This is iteration {N+1}. Focus on insights you may have missed in previous passes. Consider edge cases, anti-patterns, and subtle preferences.\"\n\nPURPOSE:\nHelps LLM find additional insights on subsequent passes\n\nEXAMPLES:\n- iteration 0: \"\" (first pass is broad)\n- iteration 1: \"This is iteration 2. Focus on insights you may have missed in previous passes. Consider edge cases, anti-patterns, and subtle preferences.\"\n- iteration 2: \"This is iteration 3. Focus on insights you may have missed in previous passes. Consider edge cases, anti-patterns, and subtle preferences.\"\n\nWHY THIS WORKS:\n- Iteration 0: LLM finds obvious patterns\n- Iteration 1+: Prompt guides LLM to look deeper\n- Specific guidance: \"edge cases, anti-patterns, subtle preferences\"\n\nIMPLEMENTATION:\n```typescript\nif (iteration === 0) return ''\nreturn `This is iteration ${iteration + 1}. Focus on insights you may have missed in previous passes. Consider edge cases, anti-patterns, and subtle preferences.`\n```\n\nUsed in buildReflectorPrompt()","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:00.16202-05:00","updated_at":"2025-12-07T20:04:57.012226-05:00","closed_at":"2025-12-07T20:04:55.552238-05:00"}
{"id":"cass_memory_system-bor","title":"[LLM] PROMPTS.validator - Scientific validation prompt","description":"Full prompt template for scientific validation:\n\nPROPOSED RULE: '{proposedRule}'\n\nHISTORICAL EVIDENCE FROM CASS (last 90 days):\n{evidence}\n\nINSTRUCTIONS:\nAnalyze whether the evidence supports or contradicts this rule.\n\nCriteria:\n- INVALID: Evidence shows this pattern FAILED multiple times\n- INVALID: Rule is too generic/obvious to be useful\n- VALID: Evidence supports it OR is neutral\n- Consider refining the wording if evidence suggests improvements\n\nBe specific in your reasoning, citing session paths when relevant.\n\n---\n\nGPT Pro innovation - validate against historical data before accepting.\n\nTemperature: 0.2 (low for consistency)\nUsed in runValidator function.\n\nThis is the scientific method applied to playbook rules - test hypotheses against empirical data from cass sessions.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:53.957778-05:00","updated_at":"2025-12-07T18:55:28.721934-05:00","closed_at":"2025-12-07T18:54:50.567929-05:00"}
{"id":"cass_memory_system-bpzd","title":"[MCP:Future] serve command - Start MCP server","description":"Implement serve command to start MCP server:\n\n```bash\ncass-memory serve [options]\n\nOptions:\n  --port N         HTTP port (default: stdio)\n  --stdio          Use stdio transport (default)\n```\n\nStarts the MCP server for agent connection. Default is stdio transport for local communication, but can optionally run on HTTP port for remote connections.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:49:36.007573-05:00","updated_at":"2025-12-07T21:04:25.959207-05:00","closed_at":"2025-12-07T21:04:17.059197-05:00"}
{"id":"cass_memory_system-bq3a","title":"[Semantic] scoreBulletsEnhanced - Keyword + semantic scoring","description":"Enhanced bullet scoring combining keyword matching with semantic similarity.\n\nImplementation:\n```typescript\nasync function scoreBulletsEnhanced(\n  bullets: PlaybookBullet[],\n  task: string,\n  config: Config\n): Promise\u003cScoredBullet[]\u003e\n```\n\nSteps:\n1. Keyword scoring (fast, existing)\n2. Get task embedding\n3. For each bullet:\n   - Load or compute bullet embedding\n   - Calculate cosine similarity\n4. Combined score: 40% keyword + 60% semantic\n5. Final: combined × effective score × maturity multiplier\n6. Sort and return\n\nWhy hybrid scoring:\n- Keywords catch exact matches\n- Semantics catch conceptual matches\n- Combined provides best relevance\n\nExample:\nTask: \"fix authentication bug\"\n- Keyword match: \"auth\" → score 2\n- Semantic match: \"login session handling\" → similarity 0.82\n- Combined: (2 * 0.4) + (8.2 * 0.6) = 5.72\n\nPerformance:\n- 100 bullets: ~300ms (including embeddings)\n- With cache: ~50ms (embeddings pre-computed)\n\nConfig:\n- semanticSearchEnabled: true/false\n- semanticWeight: 0.6 (adjustable)","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-07T16:49:30.813559-05:00","updated_at":"2025-12-07T17:14:57.053823-05:00","comments":[{"id":11,"issue_id":"cass_memory_system-bq3a","author":"jemanuel","text":"Enhanced bullet scoring combining keyword matching with semantic similarity.\n\nImplementation:\n```typescript\nasync function scoreBulletsEnhanced(\n  bullets: PlaybookBullet[],\n  task: string,\n  config: Config\n): Promise\u003cScoredBullet[]\u003e\n```\n\nSteps:\n1. Keyword scoring (fast, existing)\n2. Get task embedding\n3. For each bullet:\n   - Load or compute bullet embedding\n   - Calculate cosine similarity\n4. Combined score: 40% keyword + 60% semantic\n5. Final: combined × effective score × maturity multiplier\n6. Sort and return\n\nWhy hybrid scoring:\n- Keywords catch exact matches\n- Semantics catch conceptual matches\n- Combined provides best relevance\n\nExample:\nTask: \"fix authentication bug\"\n- Keyword match: \"auth\" → score 2\n- Semantic match: \"login session handling\" → similarity 0.82\n- Combined: (2 * 0.4) + (8.2 * 0.6) = 5.72\n\nPerformance:\n- 100 bullets: ~300ms (including embeddings)\n- With cache: ~50ms (embeddings pre-computed)\n\nConfig:\n- semanticSearchEnabled: true/false\n- semanticWeight: 0.6 (adjustable)","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-btx8","title":"[Integration] Playbook Merging - Global + Repo Combination","description":"## Target: Integration tests for playbook merging\n\n### Test Scenarios:\n\n1. **Basic Merge**\n   - Global playbook with 3 bullets\n   - Repo playbook with 2 bullets\n   - Merged result has 5 bullets\n   - No ID conflicts\n\n2. **Override Merge**\n   - Global bullet ID: 'proj-a1b2'\n   - Repo bullet same ID, different content\n   - Repo content wins\n   - Metadata merged appropriately\n\n3. **FeedbackEvents Merge**\n   - Global bullet with 2 helpful events\n   - Repo bullet same ID with 1 harmful event\n   - Merged has all 3 events\n   - Chronological order preserved\n\n4. **Scope-Based Filtering**\n   - Global bullets with scope: 'global'\n   - Repo bullets with scope: 'project:myrepo'\n   - Query with project scope\n   - Only relevant bullets returned\n\n5. **Pinned Bullet Handling**\n   - Global has pinned bullet\n   - Repo has unpinned version\n   - Pinned status preserved\n   - Or: repo can unpin?\n\n6. **Empty Playbook Edge Cases**\n   - Global empty, repo has content\n   - Repo empty, global has content\n   - Both empty\n   - One missing, one exists\n\n### Test Setup:\n```typescript\n// Create temp git repo with .cass/\n// Create temp ~/.cass-memory/\n// Run merge operation\n// Verify results\n```\n\n### Detailed Logging:\n- Source of each bullet\n- Conflict resolution decisions\n- Timing information","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:30:07.298726-05:00","updated_at":"2025-12-08T14:27:02.232536-05:00","closed_at":"2025-12-08T14:27:02.232536-05:00","dependencies":[{"issue_id":"cass_memory_system-btx8","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:33.605036-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-btx8","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:32:33.799312-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-btx8","depends_on_id":"cass_memory_system-zc1d","type":"blocks","created_at":"2025-12-07T20:33:03.722616-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-by51","title":"[CLI] why command - Show bullet origin evidence","description":"Implements the 'cass-memory why' command to show the origin evidence for a specific bullet.\n\nCOMMAND SYNTAX:\n```bash\ncass-memory why \u003cbullet-id\u003e [options]\n\nArguments:\n  bullet-id      The bullet ID to explain\n\nOptions:\n  --verbose      Show full session transcripts\n  --json         Output as JSON\n```\n\nPURPOSE:\nAnswers \"Why was this rule learned?\" by showing the original reasoning, source sessions, evidence quotes, and diary entries that contributed to creating this bullet.\n\nOUTPUT FORMAT (Terminal):\n```\nWHY WAS THIS RULE LEARNED?\n===========================\n\nBullet: abc-123\nContent: \"Use React.memo for expensive renders\"\nCategory: Performance | Maturity: proven\nCreated: 2024-11-15 (83 days ago)\n\nORIGINAL REASONING:\n  Agent noticed repeated performance issues with re-rendering in\n  session 45a3b. Pattern of wrapping expensive components in React.memo\n  led to 3x speedup. Validated across 2 subsequent sessions.\n\nSOURCE SESSIONS (3):\n  1. Session 45a3b (2024-11-15): Performance optimization\n     \"Wrapped DataTable in React.memo, renders dropped from 120ms to 40ms\"\n     \n  2. Session 6f2c9 (2024-11-18): Similar pattern applied\n     \"Used same memo pattern for ChartWidget, similar improvement\"\n     \n  3. Session 8d1e4 (2024-11-22): Validation\n     \"React.memo approach confirmed effective for list components\"\n\nKEY EVIDENCE QUOTES:\n  • \"massive performance improvement after memoization\"\n  • \"prevents unnecessary re-renders when props unchanged\"\n  • \"measured 3x speedup on heavy components\"\n\nDIARY ENTRIES:\n  2024-11-15: \"Learned to wrap expensive renders in React.memo\"\n  2024-11-18: \"React.memo pattern continues to be effective\"\n\nFEEDBACK HISTORY (8 helpful, 0 harmful):\n  2024-11-20: Marked helpful (session 7a4d2)\n  2024-11-25: Marked helpful (session 9c3e1)\n  2024-12-01: Marked helpful (session 2f5b8)\n  ... (5 more)\n\nCURRENT STATUS:\n  Score: 12.4 (proven)\n  Last applied: 2 days ago\n  Effectiveness: Very high\n```\n\nIMPLEMENTATION REQUIREMENTS:\n\n1. Load bullet by ID from playbook\n2. Retrieve original reasoning/justification\n3. Find source sessions (sessions that contributed to this bullet)\n4. Extract evidence quotes from source sessions\n5. Find related diary entries by date range\n6. Show feedback history\n7. Display current status\n\nDATA SOURCES:\n\nBullet Metadata:\n```typescript\ninterface Bullet {\n  id: string;\n  content: string;\n  reasoning?: string;  // Original LLM reasoning\n  sourceSessions?: string[];  // Session IDs that led to this\n  evidence?: string[];  // Key quotes\n  createdAt: string;\n  feedback: FeedbackEvent[];\n}\n```\n\nSession Lookup:\n- Query cass for sessions by ID\n- Extract relevant conversation snippets\n- Show context around evidence\n\nDiary Lookup:\n- Find entries within ±7 days of creation\n- Match by keywords from bullet content\n- Show contributing diary insights\n\nVERBOSE MODE:\nWith --verbose flag:\n- Show full session transcripts\n- Include all evidence (not just key quotes)\n- Show complete diary entries\n- Display LLM's full reasoning chain\n\nJSON OUTPUT:\n```json\n{\n  \"bullet\": {\n    \"id\": \"abc-123\",\n    \"content\": \"Use React.memo for expensive renders\",\n    \"score\": 12.4,\n    \"maturity\": \"proven\"\n  },\n  \"reasoning\": \"Agent noticed repeated performance...\",\n  \"sourceSessions\": [\n    {\n      \"id\": \"45a3b\",\n      \"date\": \"2024-11-15\",\n      \"summary\": \"Performance optimization\",\n      \"evidenceQuote\": \"Wrapped DataTable in React.memo...\"\n    }\n  ],\n  \"evidence\": [\n    \"massive performance improvement after memoization\",\n    ...\n  ],\n  \"diaryEntries\": [\n    {\n      \"date\": \"2024-11-15\",\n      \"content\": \"Learned to wrap expensive renders...\"\n    }\n  ],\n  \"feedbackHistory\": [...]\n}\n```\n\nUSE CASES:\n- Understanding why a rule was created\n- Validating bullet relevance\n- Debugging incorrect rules\n- Auditing learning process\n- Building trust in the system\n\nEDGE CASES:\n- Bullet has no source sessions → show reasoning only\n- Source sessions deleted/pruned → show warning\n- No evidence available → show creation metadata\n- Very old bullet → warn if cass index pruned\n\nDEPENDENCIES:\n- Playbook loader\n- Cass session retrieval\n- Diary loader\n- Text highlighting/formatting\n- Date utilities\n\nSUCCESS CRITERIA:\n- Complete provenance chain shown\n- Evidence is compelling and relevant\n- Easy to understand why rule was created\n- Helps validate or question bullet accuracy\n- Performance \u003c2 seconds even with verbose mode","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:57:48.117272-05:00","updated_at":"2025-12-08T13:34:26.08333-05:00","closed_at":"2025-12-08T13:34:26.08333-05:00"}
{"id":"cass_memory_system-c0t","title":"[Validator] formatEvidenceForLLM - Structure hits for prompt","description":"Implement the formatEvidenceForLLM function - Structure cass hits for LLM validation prompt.\n\nSIGNATURE:\n```typescript\nfunction formatEvidenceForLLM(hits: CassHit[], maxHits: number = 10): string\n```\n\nFORMAT EACH HIT:\n```\nSession: {source_path}\nAgent: {agent}\nStatus: {diary_status}  // if available\nSnippet: {snippet}\n---\n```\n\nEXAMPLE OUTPUT:\n```\nSession: ~/.cass/sessions/2024-01-15-api-refactor.md\nAgent: claude-opus-4\nStatus: success\nSnippet: Implemented strict TypeScript checks with noImplicitAny enabled. This caught 12 type errors before they reached production.\n---\n\nSession: ~/.cass/sessions/2024-01-20-auth-bug.md\nAgent: claude-sonnet-3.5\nStatus: success\nSnippet: TypeScript strict mode flagged incorrect token type assumption, preventing security vulnerability.\n---\n\nSession: ~/.cass/sessions/2024-02-01-migration.md\nAgent: claude-opus-4\nStatus: failure\nSnippet: Attempted to add strict mode but broke existing codebase. Reverted changes.\n---\n```\n\nLOGIC:\n1. Sort hits by relevance score (if available)\n2. Take top maxHits (default 10)\n3. For each hit:\n   - Extract session path\n   - Get agent name\n   - Correlate with diary for status\n   - Format snippet (truncate if \u003e 200 chars)\n4. Join with separator (---)\n5. Return formatted string\n\nTRUNCATION:\n- If snippet \u003e 200 chars, truncate and add \"...\"\n- If total output \u003e 4000 chars, reduce maxHits\n- Ensure LLM prompt stays within token limits\n\nWHY THIS MATTERS:\n- Provides structured evidence for LLM analysis\n- Includes success/failure context from diaries\n- Makes validation transparent and auditable\n- Optimizes token usage while preserving signal\n\nDEPENDENCIES:\n- CassHit type\n- findDiaryBySession() - For status correlation\n\nLOCATION:\n- src/validator/format-evidence.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:44:54.766002-05:00","updated_at":"2025-12-07T20:53:50.963484-05:00","closed_at":"2025-12-07T20:53:11.23325-05:00"}
{"id":"cass_memory_system-c16i","title":"[ErrorHandling] acquireLock/releaseLock - Prevent concurrent access","description":"Implement file-based locking to prevent concurrent access issues.\n\nFunction signatures:\nfunction acquireLock(lockDir: string, operation: string): { \n  acquired: boolean;\n  holder?: { pid: number; operation: string; timestamp: number }\n}\nfunction releaseLock(lockDir: string): void\n\nImplementation:\n- Lock file: {lockDir}/cass-memory.lock\n- Lock file contains JSON: { pid, operation, timestamp }\n- Check if lock is stale (\u003e30 seconds old)\n- Verify holder process is still alive (kill -0 on Unix)\n- If stale or process dead, acquire lock\n- If active lock exists, return holder info\n- Auto-release on process exit\n\nPrevents race conditions when multiple processes access playbook or sessions.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:23.763732-05:00","updated_at":"2025-12-07T21:13:03.898211-05:00","closed_at":"2025-12-07T21:12:45.860803-05:00"}
{"id":"cass_memory_system-c2aa","title":"[E2E Tests] Playbook merge - global plus repo playbooks","description":"## E2E Test: Playbook Merge - Global Plus Repo Playbooks\n\n### Test Scenario\nTest merging bullets from multiple playbook sources\n\n### Test Steps\n\n#### 1. Global + Repo Merge\n- Global playbook: 3 bullets\n- Repo playbook: 2 bullets\n- Verify all 5 bullets available\n- No duplicates\n\n#### 2. Deduplication\n- Global: 'Use TypeScript' (conf: 0.7)\n- Repo: 'Use TypeScript' (conf: 0.9)\n- Verify single bullet kept\n- Higher confidence preserved\n\n#### 3. Scope Priority\n- Global bullet: scope='*'\n- Repo bullet: scope='src/**'\n- Verify repo-scoped takes precedence in src/\n- Global applies elsewhere\n\n#### 4. Toxic List Merge\n- Global toxic: ['eval', 'any']\n- Repo toxic: ['console.log']\n- Verify all toxic items merged\n\n#### 5. Load Order\n- Test explicit playbook_paths array\n- Verify later files override earlier\n- Verify missing files skipped gracefully\n\n### Verbose Logging\n- Log: 'Loading playbooks from N paths'\n- Log: 'Loading: \u003cpath1\u003e'\n- Log: 'Loaded M bullets from \u003cpath1\u003e'\n- Log: 'Loading: \u003cpath2\u003e'\n- Log: 'Loaded K bullets from \u003cpath2\u003e'\n- Log: 'Merging playbooks...'\n- Log: 'Deduplicating: removed X duplicates'\n- Log: 'Final playbook: Y bullets, Z toxic'\n\n### Conflict Resolution\n- Same content, different confidence: keep higher\n- Same content, different scope: keep more specific\n- Same content, different maturity: keep higher","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:24:55.303965-05:00","updated_at":"2025-12-08T01:24:28.400734-05:00","closed_at":"2025-12-08T01:24:28.400734-05:00","dependencies":[{"issue_id":"cass_memory_system-c2aa","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2025-12-07T20:31:26.442454-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-c2aa","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2025-12-07T20:31:26.575062-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-c2aa","depends_on_id":"cass_memory_system-p4mv","type":"blocks","created_at":"2025-12-07T20:31:26.705383-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-c2aa","depends_on_id":"cass_memory_system-33w3","type":"blocks","created_at":"2025-12-07T20:31:28.691417-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-c72","title":"[Utils] tokenize - Text tokenization for similarity","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:44:57.420862-05:00","updated_at":"2025-12-07T20:24:20.351673-05:00","closed_at":"2025-12-07T20:24:03.884095-05:00","comments":[{"id":12,"issue_id":"cass_memory_system-c72","author":"jemanuel","text":"## Function Signature\n```typescript\nfunction tokenize(text: string): string[]\n```\n\n## Implementation Details\n- Convert to lowercase: text.toLowerCase()\n- Replace non-alphanumeric with space: text.replace(/[^a-z0-9]+/g, ' ')\n- Split on whitespace: split(/\\s+/)\n- Filter tokens shorter than 3 chars: filter(t =\u003e t.length \u003e= 3)\n- Return array of tokens\n\n## Why This Matters\nInternal helper for jaccardSimilarity and extractKeywords. Consistent tokenization ensures similarity calculations are reliable. Filtering short tokens removes noise like \"a\", \"an\", \"is\".\n\n## Edge Cases to Handle\n- Empty string - return []\n- Only punctuation - return []\n- Numbers - included as tokens\n- Mixed case - normalized to lowercase\n- Multiple spaces/tabs - collapsed by split\n- Unicode characters - replace with space (non-ASCII)","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-c7p7","title":"[Semantic] cosineSimilarity - Vector similarity calculation","description":"Calculate cosine similarity between two embedding vectors.\n\nImplementation:\n```typescript\nfunction cosineSimilarity(a: number[], b: number[]): number {\n  let dot = 0, normA = 0, normB = 0;\n  for (let i = 0; i \u003c a.length; i++) {\n    dot += a[i] * b[i];\n    normA += a[i] * a[i];\n    normB += b[i] * b[i];\n  }\n  return dot / (Math.sqrt(normA) * Math.sqrt(normB));\n}\n```\n\nMath:\n- Dot product divided by product of magnitudes\n- For normalized vectors: just dot product\n- Range: [-1, 1] (text embeddings typically [0, 1])\n- Higher = more similar\n\nPerformance:\n- O(n) where n = dimension count (384)\n- ~0.01ms for 384-dimensional vectors\n- No external dependencies\n\nInterpretation:\n- 0.9-1.0: Very similar (potential duplicates)\n- 0.7-0.9: Related content\n- 0.5-0.7: Somewhat related\n- \u003c0.5: Unrelated\n\nUsed by:\n- Semantic bullet scoring\n- Duplicate detection\n- Similar bullet search","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-07T16:49:29.634174-05:00","updated_at":"2025-12-07T17:14:57.17303-05:00","comments":[{"id":13,"issue_id":"cass_memory_system-c7p7","author":"jemanuel","text":"Calculate cosine similarity between two embedding vectors.\n\nImplementation:\n```typescript\nfunction cosineSimilarity(a: number[], b: number[]): number {\n  let dot = 0, normA = 0, normB = 0;\n  for (let i = 0; i \u003c a.length; i++) {\n    dot += a[i] * b[i];\n    normA += a[i] * a[i];\n    normB += b[i] * b[i];\n  }\n  return dot / (Math.sqrt(normA) * Math.sqrt(normB));\n}\n```\n\nMath:\n- Dot product divided by product of magnitudes\n- For normalized vectors: just dot product\n- Range: [-1, 1] (text embeddings typically [0, 1])\n- Higher = more similar\n\nPerformance:\n- O(n) where n = dimension count (384)\n- ~0.01ms for 384-dimensional vectors\n- No external dependencies\n\nInterpretation:\n- 0.9-1.0: Very similar (potential duplicates)\n- 0.7-0.9: Related content\n- 0.5-0.7: Somewhat related\n- \u003c0.5: Unrelated\n\nUsed by:\n- Semantic bullet scoring\n- Duplicate detection\n- Similar bullet search","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-c8w5","title":"[Critical] Graceful Degradation - Work When Components Fail","description":"# Graceful Degradation - Work When Components Fail\n\n## The Problem\nCurrent plan assumes all components work:\n- cass (the search tool) is installed and working\n- LLM API is available\n- Playbook exists and is valid\n- Network is available\n\nReality: Components will fail. The system should degrade gracefully.\n\n## The Solution\nImplement progressive fallback for each component:\n\n### When cass (search) is unavailable:\n```typescript\nasync function getContext(task: string): Promise\u003cContext\u003e {\n  try {\n    const history = await cassSearch(task);\n    return { history, source: \"cass\" };\n  } catch (e) {\n    console.warn(\"cass unavailable, using playbook only\");\n    return { history: [], source: \"playbook-only\" };\n  }\n}\n```\n\n### When LLM is unavailable:\n```typescript\nasync function reflect(sessionPath: string): Promise\u003cvoid\u003e {\n  try {\n    const diary = await extractDiaryWithLLM(sessionPath);\n    await saveDiary(diary);\n  } catch (e) {\n    console.warn(\"LLM unavailable, using basic extraction\");\n    const diary = extractDiaryBasic(sessionPath);\n    await saveDiary(diary);\n  }\n}\n```\n\n### User Feedback:\n```bash\n$ cm context \"fix auth bug\"\n\n⚠️  Running in degraded mode (LLM unavailable)\n   - Context will use keyword matching only\n   - Run 'cm status --full' for details\n\n## Relevant Rules (3 found):\n...\n```\n\n### Degradation Levels:\n```typescript\nenum OperationMode {\n  FULL,         // All components working\n  NO_LLM,       // LLM unavailable - basic extraction\n  NO_CASS,      // cass unavailable - playbook only\n  OFFLINE,      // No network - cached only\n  MINIMAL       // Multiple failures - read-only mode\n}\n```\n\n## Why This Is Critical\n- Users will encounter failures\n- System shouldn't break completely when one thing fails\n- \"Works partially\" \u003e \"Crashes completely\"\n- Builds trust through resilience","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T17:16:44.544531-05:00","updated_at":"2025-12-07T20:22:31.734241-05:00","closed_at":"2025-12-07T20:22:29.94082-05:00"}
{"id":"cass_memory_system-c95r","title":"[Test Epic] Comprehensive Unit \u0026 E2E Test Coverage","description":"","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-07T20:23:31.482248-05:00","updated_at":"2025-12-07T20:23:31.482248-05:00","dependencies":[{"issue_id":"cass_memory_system-c95r","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:31:41.306373-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-c95r","depends_on_id":"cass_memory_system-ke2x","type":"blocks","created_at":"2025-12-07T20:31:41.410496-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-caug","title":"E2E test: 'cass init' command","description":"E2E test for 'cass init' CLI command:\n- Real subprocess execution via bun\n- Test initialization in empty directory\n- Verify created directory structure\n- Verify default playbook.yaml content\n- Verify config file creation\n- Test --force to reinitialize\n- Test error cases: already initialized, permission errors\n- Detailed logging: files created, content verification\nSetup: temp directory for each test case","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:27:22.601661-05:00","updated_at":"2025-12-08T14:04:05.803286-05:00","closed_at":"2025-12-08T14:04:05.803286-05:00","dependencies":[{"issue_id":"cass_memory_system-caug","depends_on_id":"cass_memory_system-8dxr","type":"blocks","created_at":"2025-12-07T20:28:34.244034-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-cdqp","title":"[CLI] project command - Export to AGENTS.md","description":"Implements the main entry point for the 'cass-memory project' command.\n\nCOMMAND SYNTAX:\n```bash\ncass-memory project [options]\n\nOptions:\n  --format FORMAT    agents.md, claude.md, or raw (default: agents.md)\n  --output PATH      Output file path (default: stdout)\n  --top N            Top N bullets per category (default: all)\n  --show-counts      Include helpful counts in output (default: true)\n```\n\nPURPOSE:\nExports the playbook to agent-readable formats for integration with AI coding assistants. The primary format is AGENTS.md which provides a structured view of rules organized by category with effectiveness metrics.\n\nIMPLEMENTATION REQUIREMENTS:\n1. Parse command-line options\n2. Load current playbook from storage\n3. Route to appropriate formatter based on --format flag\n4. Handle output (file or stdout)\n5. Apply filters (top N, scope, etc.)\n\nOUTPUT FORMATS:\n- agents.md: Markdown format with categories and ranked bullets\n- claude.md: Claude-specific format with context sections\n- raw: JSON export of full playbook data\n\nDEPENDENCIES:\n- Playbook loader\n- Format renderers (formatAgentsMd, formatClaudeMd)\n- Config system for defaults\n\nSUCCESS CRITERIA:\n- Command exports valid markdown/JSON\n- Filters (top N) work correctly\n- Counts reflect current effectiveness scores\n- Output is immediately usable by AI assistants","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:20.748309-05:00","updated_at":"2025-12-08T01:25:58.506461-05:00","closed_at":"2025-12-08T01:25:58.506461-05:00"}
{"id":"cass_memory_system-cg1l","title":"[CLI:mark] validateBulletId - Check ID format and existence","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:43.245502-05:00","updated_at":"2025-12-07T21:12:17.523413-05:00","closed_at":"2025-12-07T21:12:13.746064-05:00"}
{"id":"cass_memory_system-ck9","title":"[Playbook] getActiveBullets - Get non-deprecated bullets","description":"## Function Signature\n```typescript\nfunction getActiveBullets(playbook: Playbook): PlaybookBullet[]\n```\n\n## Purpose\nGet all non-deprecated bullets from the playbook. Most common filtering operation for context generation.\n\n## Implementation\n```typescript\nreturn playbook.bullets.filter(b =\u003e \n  b.state !== \"retired\" \u0026\u0026 \n  b.maturity !== \"deprecated\"\n);\n```\n\n## Active vs Deprecated\n**Active bullets**:\n- state: \"draft\" or \"active\" (not \"retired\")\n- maturity: \"candidate\", \"established\", or \"proven\" (not \"deprecated\")\n- Used in agent context\n- Subject to feedback and promotion\n\n**Deprecated bullets**:\n- state: \"retired\"\n- maturity: \"deprecated\"\n- Excluded from context\n- Kept for historical record\n\n## Usage Frequency\nThis is one of the MOST frequently called functions:\n- Every context generation: getActiveBullets()\n- Every markdown export: getActiveBullets()\n- Every stats calculation: getActiveBullets()\n- Every search: getActiveBullets()\n\n## Performance Considerations\n- Simple filter operation: O(n)\n- Consider caching for repeated calls\n- Most playbooks have \u003c 100 bullets\n- Filter is fast enough for real-time use\n\n## Return Value\n```typescript\nPlaybookBullet[]  // Unsorted - caller should sort as needed\n```\n\n## Common Post-Processing\n```typescript\n// Sort by effective score\nconst active = getActiveBullets(playbook)\n  .sort((a, b) =\u003e calculateEffectiveScore(b) - calculateEffectiveScore(a));\n\n// Group by category\nconst byCategory = groupBy(getActiveBullets(playbook), \"category\");\n\n// Top N rules\nconst topRules = getActiveBullets(playbook)\n  .sort(byScore)\n  .slice(0, 10);\n```\n\n## Dependencies\n- None (pure function)\n\n## Related Functions\n- getBulletsByCategory() - filtered active bullets\n- exportToMarkdown() - uses this for export\n- generateContext() - uses this for LLM context\n- calculatePlaybookStats() - uses this for metrics","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:12.297655-05:00","updated_at":"2025-12-07T20:07:53.562766-05:00","closed_at":"2025-12-07T20:07:09.578012-05:00"}
{"id":"cass_memory_system-clne","title":"[Test] Fixtures: Sample session exports","description":"Create test/fixtures/sessions/ with:\n\n1. claude-session.jsonl - Claude format session\n2. cursor-session.jsonl - Cursor format session  \n3. codex-session.jsonl - Codex format session\n4. short-session.jsonl - \u003c10 lines\n5. long-session.jsonl - 100+ lines\n6. sensitive-session.jsonl - Contains secrets that should be sanitized\n\nEach JSONL file should:\n- Follow actual agent session format\n- Be parseable by cass export simulation\n- Include realistic tool calls, code snippets\n- Have identifiable agent patterns","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:22:16.025181-05:00","updated_at":"2025-12-07T21:13:03.900946-05:00","closed_at":"2025-12-07T21:12:43.946726-05:00"}
{"id":"cass_memory_system-cnk1","title":"[Unit] utils.ts - Pure Function Tests (Part 3: Keyword \u0026 Scoring Utilities)","description":"## Target: src/utils.ts - Part 3: Keyword, Scoring \u0026 Formatting Utilities\n\n### Functions to Test:\n1. **extractKeywords(text)** - Extract meaningful keywords\n   - Basic: 'The quick brown fox' → ['quick', 'brown', 'fox']\n   - Stop words removed: 'the', 'a', 'is', etc.\n   - Code identifiers: 'getUserById' → ['get', 'user', 'by', 'id'] or ['getUserById']\n   - Deduplication: repeated words → single entry\n   - Case normalization\n   - Minimum word length filtering\n   - Empty/whitespace input\n\n2. **normalizeScore(score, min, max)** - Normalize to 0-1 range\n   - Value in range → proportional result\n   - Value at min → 0\n   - Value at max → 1\n   - Value below min → 0 or clamped\n   - Value above max → 1 or clamped\n   - min === max edge case\n\n3. **formatLastHelpful(bullet)** - Format last helpful date\n   - Empty bullet → 'Never'\n   - No feedbackEvents → 'Never'\n   - Has helpful event → formatted date\n   - Multiple events → most recent\n   - Invalid date handling\n\n4. **formatRelativeTime(date)** - Relative time strings\n   - Just now (\u003c 1 min)\n   - Minutes ago\n   - Hours ago\n   - Days ago\n   - Weeks ago\n   - Months ago\n   - Years ago\n   - Future dates handling\n\n5. **warn(msg)** / **log(msg, verbose)** - Logging utilities\n   - Basic output\n   - Verbose flag respected\n   - Color formatting (if applicable)\n\n### Test File Already Exists:\n- test/format-last-helpful.test.ts has 1 test\n- EXPAND to cover all edge cases\n- Add tests for other functions in same category\n\n### Test Patterns:\n- Date mocking NOT needed - use fixed dates in test data\n- Test all boundary conditions\n- Verify stop word list coverage","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:24:28.434951-05:00","updated_at":"2025-12-07T21:56:12.046678-05:00","closed_at":"2025-12-07T21:56:12.046678-05:00","dependencies":[{"issue_id":"cass_memory_system-cnk1","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:13.932748-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-cnk1","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:32:56.637246-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-cry","title":"[LLM] getApiKey - Environment variable resolution","description":"Function signature:\nfunction getApiKey(provider: string): string\n\nEnvironment variable mapping:\n- openai → OPENAI_API_KEY\n- anthropic → ANTHROPIC_API_KEY\n- google → GOOGLE_GENERATIVE_AI_API_KEY\n\nImplementation requirements:\n- Throw descriptive error if missing with suggestion to set env var\n- Error message should specify which env var is needed for the requested provider\n\nExample error: 'ANTHROPIC_API_KEY environment variable not found. Set it with: export ANTHROPIC_API_KEY=sk-ant-...'\n\nThis is the foundation for all LLM operations - must fail fast with clear guidance.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:49.059302-05:00","updated_at":"2025-12-07T18:48:03.199078-05:00","closed_at":"2025-12-07T18:44:53.77844-05:00"}
{"id":"cass_memory_system-crz","title":"[LLM] runReflector - Delta generation","description":"Function signature:\nasync function runReflector\u003cT extends z.ZodSchema\u003e(\n  schema: T,\n  diary: DiaryEntry,\n  existingBullets: string,\n  cassHistory: string,\n  iteration: number,\n  config: Config\n): Promise\u003cz.infer\u003cT\u003e\u003e\n\nImplementation:\n1. Build prompt from PROMPTS.reflector template\n2. Substitute variables:\n   - status, accomplishments, decisions, challenges, preferences, keyLearnings (from diary)\n   - existingBullets (current playbook rules)\n   - cassHistory (relevant sessions from cass)\n   - iterationNote (if iteration \u003e 1, remind to focus on novel insights)\n3. Call generateObject with:\n   - schema: provided Zod schema (deltas array)\n   - temperature: 0.5 (slightly higher for creativity)\n4. Return deltas array\n\nUsed by: reflect command to generate playbook updates.\n\nNote: May be called multiple times (iterations) to get more deltas - iteration param tracks this.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:59.17579-05:00","updated_at":"2025-12-07T20:11:16.255594-05:00","closed_at":"2025-12-07T20:11:02.18352-05:00"}
{"id":"cass_memory_system-csi8","title":"[Testing] tests/setup.ts - Global test setup","description":"import { beforeAll, afterAll } from \"bun:test\";\n\nbeforeAll(() =\u003e {\n  process.env.CASS_MEMORY_TEST = \"1\";\n  process.env.CASS_MEMORY_VERBOSE = \"0\";\n});\n\nafterAll(() =\u003e {\n  delete process.env.CASS_MEMORY_TEST;\n});","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:50.603056-05:00","updated_at":"2025-12-08T14:06:16.064736-05:00","closed_at":"2025-12-08T14:06:16.064736-05:00"}
{"id":"cass_memory_system-ct1","title":"[LLM] generateContext - Pre-task briefing generation","description":"Function signature:\nasync function generateContext(\n  task: string,\n  bullets: string,\n  history: string,\n  deprecatedPatterns: string,\n  config: Config\n): Promise\u003cstring\u003e\n\nImplementation:\n1. Build prompt from PROMPTS.context template\n2. Substitute variables:\n   - task: what the agent is about to do\n   - bullets: relevant playbook rules\n   - history: relevant sessions from cass\n   - deprecatedPatterns: patterns to avoid\n3. Call generateText (not generateObject - free-form output) with:\n   - temperature: 0.3\n   - maxTokens: 2000\n4. Return formatted text briefing\n\nOutput format (structured for agent consumption):\n- Relevant rules (with IDs for citation)\n- Historical solutions (with session paths)\n- Warnings about deprecated patterns\n- Suggested search queries\n\nUsed by: hydrate command before agent starts work.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:46:02.02945-05:00","updated_at":"2025-12-07T20:11:16.256956-05:00","closed_at":"2025-12-07T20:11:14.539987-05:00"}
{"id":"cass_memory_system-cvuv","title":"Implement context usage logging","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T01:09:22.314413-05:00","updated_at":"2025-12-08T01:10:53.485701-05:00","closed_at":"2025-12-08T01:10:53.485701-05:00"}
{"id":"cass_memory_system-cy6","title":"[Utils] jaccardSimilarity - Token-based similarity for deduplication","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:44:49.576174-05:00","updated_at":"2025-12-07T20:24:20.353913-05:00","closed_at":"2025-12-07T20:24:03.890526-05:00","comments":[{"id":14,"issue_id":"cass_memory_system-cy6","author":"jemanuel","text":"## Function Signature\n```typescript\nfunction jaccardSimilarity(a: string, b: string): number\n```\n\n## Implementation Details\n- Tokenize both strings using tokenize() helper\n- Create sets from token arrays: setA = new Set(tokensA)\n- Calculate intersection size: |A ∩ B| = tokens in both sets\n- Calculate union size: |A ∪ B| = total unique tokens\n- Return |A ∩ B| / |A ∪ B|\n- Handle division by zero: if union is empty, return 0\n\n## Why This Matters\nUsed for semantic deduplication when hash doesn't match but content is similar. Threshold 0.85 recommended for \"near duplicate\" detection. Catches cases like \"Fix bug in parser\" vs \"Fixed parser bug\" which have different hashes but high similarity.\n\n## Edge Cases to Handle\n- Empty strings - return 0 (no similarity)\n- One empty, one not - return 0\n- Identical strings - return 1.0\n- No common tokens - return 0\n- All tokens common - return 1.0\n- Very different lengths - similarity will naturally be lower","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-d06","title":"[Security] Sanitization config schema","description":"Define the sanitization configuration schema in config.json.\n\nSchema:\n```typescript\nsanitization: {\n  enabled: boolean;           // Global kill switch for sanitization\n  extraPatterns: string[];    // Additional regex patterns (user-defined)\n}\n```\n\nExample config.json:\n```json\n{\n  \"sanitization\": {\n    \"enabled\": true,\n    \"extraPatterns\": [\n      \"INTERNAL_[A-Z_]+_KEY\",\n      \"MY_COMPANY_SECRET_\\\\w+\",\n      \"ACME_CORP_[A-Za-z0-9]{16}\"\n    ]\n  }\n}\n```\n\nPurpose:\n- Allow users to add company-specific or project-specific patterns\n- Provide global on/off switch (enabled flag)\n- Patterns are strings that will be compiled to RegExp with 'gi' flags\n\nDefault config (if not specified):\n```json\n{\n  \"sanitization\": {\n    \"enabled\": true,\n    \"extraPatterns\": []\n  }\n}\n```\n\nPriority: 0 (Security Critical - P12)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:50.233383-05:00","updated_at":"2025-12-07T18:48:03.199779-05:00","closed_at":"2025-12-07T18:46:08.035639-05:00"}
{"id":"cass_memory_system-d1r","title":"[Diary] listRecentDiaries - Get diaries by age","description":"List diary entries modified within specified number of days.\n\nFunction Signature:\nasync function listRecentDiaries(\n  days: number,\n  config: Config\n): Promise\u003cDiaryEntry[]\u003e\n\nProcess:\n1. Calculate cutoff date: now - days\n2. List all files in diary directory\n3. Filter for JSON files matching diary filename pattern\n4. Check file modification time (mtime)\n5. Keep only files modified after cutoff\n6. Load each matching diary using loadDiaryEntry\n7. Sort by diary.timestamp descending (newest first)\n8. Return sorted array\n\nSorting:\n- Primary: timestamp descending (newest first)\n- Secondary: agent alphabetically (for same timestamp)\n\nError Handling:\n- Skip corrupted/unreadable diaries\n- Log warnings for skipped files\n- Never fail entire operation due to single bad file\n\nKey Features:\n- Time-based filtering for recency\n- Sorted results for consistency\n- Resilient to corrupted entries\n- Efficient file stat usage\n\nUse Cases:\n- Stats command: 'cass stats --days 7'\n- Recent activity summary\n- Trend analysis over time windows\n- Dashboard recent entries display\n\nExample Usage:\n// Get last week's diaries\nconst recentDiaries = await listRecentDiaries(7, config);\nconsole.log();\n\n// Get today's diaries\nconst todayDiaries = await listRecentDiaries(1, config);\n\nPerformance:\n- O(n log n) due to sorting where n = matching diaries\n- File stat is fast (no content reading until filter passes)\n- Consider pagination for very large results\n\nOutput:\nReturns array of DiaryEntry objects sorted newest first.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:46:37.928906-05:00","updated_at":"2025-12-07T20:13:46.19546-05:00","closed_at":"2025-12-07T20:13:39.476994-05:00"}
{"id":"cass_memory_system-d6yl","title":"Enhance Doctor: Auto-fix and self-test","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T00:16:37.173901-05:00","updated_at":"2025-12-08T00:16:45.125599-05:00","closed_at":"2025-12-08T00:16:45.125599-05:00"}
{"id":"cass_memory_system-dke","title":"[Playbook] isDuplicateBullet - Semantic duplicate detection","description":"## Function Signature\n```typescript\nfunction isDuplicateBullet(\n  newContent: string,\n  existingBullets: PlaybookBullet[],\n  threshold: number = 0.85\n): { isDuplicate: boolean; matchingBullet?: PlaybookBullet }\n```\n\n## Purpose\nDetect semantic duplicates before adding new bullets. Prevents near-identical rules from cluttering the playbook.\n\n## Algorithm\n1. Filter out deprecated bullets (state === \"retired\")\n2. For each active bullet:\n   - Calculate jaccardSimilarity(newContent, bullet.content)\n   - If similarity \u003e= threshold: return match\n3. If no match found: return { isDuplicate: false }\n\n## Jaccard Similarity\n```typescript\njaccard(A, B) = |A ∩ B| / |A ∪ B|\n```\n- Tokenize both strings (split on whitespace/punctuation)\n- Calculate intersection size\n- Calculate union size\n- Return intersection / union\n\nRange: 0.0 (completely different) to 1.0 (identical)\n\n## Threshold Guidelines\n- **0.85 (default)**: Very similar, likely duplicate\n- **0.75**: Moderately similar, manual review needed\n- **0.90**: Almost identical, definitely duplicate\n\n## Example Duplicates (similarity \u003e 0.85)\n- \"Always run tests before committing\"\n- \"Run all tests before you commit\"\n→ Same meaning, different wording\n\n## Implementation Notes\n- Case-insensitive comparison\n- Ignore punctuation differences\n- Skip deprecated bullets (may be outdated versions)\n- Return first match (don't search all)\n\n## Usage Scenarios\n1. **Curator**: Check before adding extracted rule\n2. **Manual add**: Warn user if duplicate exists\n3. **Merge detection**: Find similar rules to combine\n\n## Dependencies\n- jaccardSimilarity() utility function\n\n## Related Functions\n- findSimilarBullet() - returns similarity score\n- findMergeCandidates() - uses similarity for grouping\n- addBullet() - should check duplicates first","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:44:59.274031-05:00","updated_at":"2025-12-07T20:26:00.896916-05:00","closed_at":"2025-12-07T20:25:12.11436-05:00"}
{"id":"cass_memory_system-dofz","title":"[Critical] Simplified Diary Schema for V1","description":"# Simplified Diary Schema for V1\n\n## The Problem\nCurrent DiaryEntry schema has 15+ fields including:\n- decisions, problems, solutions, tools, patterns\n- filesModified, filesByImpact, dependencies\n- architectureChanges, codeQuality, testingApproach\n- performanceConsiderations, securityNotes, technicalDebt\n\nThis is MASSIVELY over-engineered for v1. \nExtracting all this requires multiple LLM calls and complex prompts.\nMost fields will be empty most of the time.\n\n## The Solution\nStart with a minimal diary schema that covers 80% of value:\n\n### V1 Diary Schema (Minimal):\n```typescript\ninterface DiaryEntryV1 {\n  id: string;\n  sessionPath: string;\n  timestamp: Date;\n  \n  // Core fields only\n  summary: string;         // What happened in 1-2 sentences\n  outcome: \"success\" | \"partial\" | \"failure\" | \"unknown\";\n  \n  // Optional simple fields\n  task?: string;           // What was the user trying to do\n  keyInsight?: string;     // One key learning (if any)\n  filesChanged?: string[]; // Just the paths\n  \n  // Metadata\n  duration?: number;       // Seconds\n  agent: string;           // Which agent\n}\n```\n\n### Comparison:\n| V1 (Minimal) | Current Plan (Full) |\n|--------------|---------------------|\n| 7 fields | 18+ fields |\n| 1 LLM call | 3-5 LLM calls |\n| Simple extraction | Complex multi-step |\n| Fast (~2s) | Slow (~10s) |\n| Works local-only | Requires LLM |\n\n### V1 Extraction (No LLM Required):\n```typescript\nasync function extractDiaryV1(sessionPath: string): Promise\u003cDiaryEntryV1\u003e {\n  const session = await loadSession(sessionPath);\n  \n  return {\n    id: generateId(),\n    sessionPath,\n    timestamp: session.startTime,\n    \n    // Extract from session metadata (no LLM)\n    summary: session.title || \"Coding session\",\n    outcome: inferOutcome(session),  // From exit code, errors\n    task: session.userMessages[0]?.slice(0, 200),  // First user message\n    filesChanged: extractFilePaths(session),\n    duration: session.duration,\n    agent: session.agent\n  };\n}\n\nfunction inferOutcome(session: Session): Outcome {\n  if (session.exitCode === 0 \u0026\u0026 !session.hasErrors) return \"success\";\n  if (session.exitCode !== 0) return \"failure\";\n  if (session.hasErrors) return \"partial\";\n  return \"unknown\";\n}\n```\n\n### Upgrade Path to Full Schema:\n```typescript\n// V2 adds more fields (with LLM)\ninterface DiaryEntryV2 extends DiaryEntryV1 {\n  decisions?: string[];\n  patterns?: string[];\n  problems?: string[];\n}\n\n// V3 adds rich fields\ninterface DiaryEntryV3 extends DiaryEntryV2 {\n  architectureChanges?: ArchChange[];\n  testingApproach?: TestApproach;\n  // ... etc\n}\n\n// Migration is additive - old entries still valid\n```\n\n## Why This Is Critical\n- Simpler = faster to implement\n- Simpler = less LLM cost\n- Simpler = works offline\n- Simpler = fewer bugs\n- Can always add fields later (additive)\n- Full schema is over-engineering for v1","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T17:14:07.65785-05:00","updated_at":"2025-12-08T00:51:44.566781-05:00","closed_at":"2025-12-08T00:51:44.566781-05:00"}
{"id":"cass_memory_system-dpuu","title":"[CLI:context] parseTaskInput - Handle stdin and args","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:51:35.865376-05:00","updated_at":"2025-12-07T22:38:15.488087-05:00","closed_at":"2025-12-07T22:38:08.148852-05:00"}
{"id":"cass_memory_system-drrs","title":"[ErrorHandling] handleSessionExportFailure - Fallback parsing","description":"Implement fallback parsing when cass session export fails.\n\nFunction signature:\nasync function handleSessionExportFailure(\n  sessionPath: string,\n  error: Error\n): Promise\u003cstring | null\u003e\n\nImplementation:\n- If file exists but cass cannot export, try direct file parsing\n- For .jsonl: parse lines as JSON messages, extract content\n- For .json: parse as message array, extract content\n- For .md: return raw markdown as-is\n- Return null if file unreadable or unrecoverable\n\nFallback strategies:\n1. Try cass session export (primary)\n2. Parse file directly (fallback)\n3. Return null (graceful failure)\n\nThis ensures session data can be accessed even if cass has parsing issues.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:50:51.124946-05:00","updated_at":"2025-12-07T22:02:18.543863-05:00","closed_at":"2025-12-07T22:02:18.543863-05:00"}
{"id":"cass_memory_system-dvki","title":"[Unit Tests] lock.ts - File locking mechanisms","description":"## Unit Tests: lock.ts - File Locking Mechanisms\n\n### Test Categories\n\n#### 1. acquireLock()\n- Creates lock file on first acquisition\n- Returns lock handle with release function\n- Sets correct PID in lock file\n- Creates parent directories if needed\n- Respects timeout parameter\n\n#### 2. Lock Contention\n- Second acquire waits for release\n- Timeout triggers after specified ms\n- Stale lock detection (dead PID)\n- Lock file cleanup on stale detection\n\n#### 3. releaseLock()\n- Removes lock file on release\n- Idempotent (double-release safe)\n- Handles missing lock file gracefully\n- Cleans up empty parent directories\n\n#### 4. withLock() Higher-Order Function\n- Acquires before callback execution\n- Releases after callback completes\n- Releases on callback exception\n- Returns callback result\n- Propagates callback errors after release\n\n#### 5. Edge Cases\n- Process crash simulation (orphaned locks)\n- Concurrent acquires from same process\n- Lock file permissions issues\n- Network filesystem considerations (no atomicity)\n- Very long lock paths\n\n### Test Approach\n- Use real temp directories (no mocks)\n- Test concurrent access with Promise.all\n- Verify file existence/contents at each step\n- Use process.pid for PID verification","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:23:24.540366-05:00","updated_at":"2025-12-07T21:00:55.92073-05:00","closed_at":"2025-12-07T21:00:42.168484-05:00","dependencies":[{"issue_id":"cass_memory_system-dvki","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2025-12-07T20:31:04.492753-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-dvki","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2025-12-07T20:31:07.897075-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-dwew","title":"[Config] loadMergedPlaybook - Combine global + repo","description":"Function signature:\n```typescript\nasync function loadMergedPlaybook(config: Config): Promise\u003cPlaybook\u003e\n```\n\nSteps:\n1. Load global playbook (~/.cass-memory/playbook.yaml)\n2. Load repo playbook (./.cass/playbook.yaml) - may not exist\n3. Merge bullets:\n   - Same ID → repo wins\n   - Different IDs → keep both (dedupe by content)\n4. Load toxic logs from both levels\n5. Filter bullets against combined toxic log\n6. Return merged playbook\n\nEdge cases:\n- Repo playbook may not exist (use global only)\n- Both playbooks may have same bullet ID (repo wins)\n- Content-based deduplication to avoid semantic duplicates\n- Toxic log filtering happens AFTER merge\n\nReturns: Combined playbook with repo-level overrides applied","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:49:38.937664-05:00","updated_at":"2025-12-07T20:26:00.898763-05:00","closed_at":"2025-12-07T20:25:32.320932-05:00"}
{"id":"cass_memory_system-e21","title":"[Security] Sanitization application points documentation","description":"Document WHERE to apply the sanitize() function throughout the codebase.\n\nApplication points (in order of data flow):\n1. After cassExport, BEFORE passing to LLM (in diary generation)\n   - Raw session content from CASS is untrusted\n   - Must sanitize before LLM sees it\n\n2. Before writing DiaryEntry to disk\n   - Prevent secrets from persisting in diary files\n   - Apply sanitize() to entry.content\n\n3. Before storing content in PlaybookBullet\n   - Sanitize before creating bullet objects\n   - Apply to bullet.content and bullet.evidence\n\n4. In context output (should already be sanitized if stored sanitized)\n   - Defense in depth: verify sanitization at output time\n   - Shouldn't find anything if earlier stages worked\n\nGOLDEN RULE: NEVER pass unsanitized session content to LLM or disk\n\nImplementation checklist:\n- [ ] Sanitize in diary generation flow\n- [ ] Sanitize before DiaryEntry persistence\n- [ ] Sanitize before PlaybookBullet creation\n- [ ] Add verification at context output\n\nPriority: 0 (Security Critical - P12)","notes":"Added sanitization application points under README Security/Secret Sanitization; communicated to agents. No sanitize.ts changes to avoid conflict with WhiteCat reservation.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:49.167852-05:00","updated_at":"2025-12-07T18:48:03.200679-05:00","closed_at":"2025-12-07T18:45:48.046117-05:00"}
{"id":"cass_memory_system-e63w","title":"[Docs] Architecture documentation - How it works","description":"Document system architecture and how cass-memory works internally.\n\nTopics to cover:\n- Three-layer memory model with diagram (Diary → Playbook → Project)\n- ACE pipeline: Generator → Reflector → Validator → Curator\n- Data flow diagrams showing session → diary → playbook → project\n- Schema explanations for each data structure\n- Why deterministic curation matters (reproducibility, auditability)\n- Confidence decay algorithm explanation\n- Semantic classification system\n- Evidence-based decision making\n\nInclude visual diagrams (ASCII art or mermaid.js) and concrete examples","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:30.515929-05:00","updated_at":"2025-12-08T02:38:27.298678-05:00","closed_at":"2025-12-08T02:38:27.298678-05:00"}
{"id":"cass_memory_system-e8x","title":"[Playbook] loadPlaybook - Load and validate playbook from YAML","description":"## Function Signature\n```typescript\nasync function loadPlaybook(config: Config): Promise\u003cPlaybook\u003e\n```\n\n## Purpose\nLoad and validate playbook from YAML file. Handles missing files, corruption, and schema validation with automatic recovery.\n\n## Algorithm\n1. Expand playbookPath from config\n2. Check if file exists\n3. If not exists: create empty playbook and return\n4. Read file content\n5. If empty: create new playbook and return\n6. Parse YAML content\n7. Normalize keys (snake_case → camelCase for compatibility)\n8. Validate with PlaybookSchema.safeParse()\n9. If invalid: backup to .backup.{timestamp} and create new\n10. Return validated playbook\n\n## Error Handling\n- **ENOENT**: File doesn't exist → create empty\n- **EACCES**: Permission denied → throw error\n- **Parse errors**: YAML syntax errors → backup and recreate\n- **Validation errors**: Schema mismatch → backup and recreate\n\n## Backup Strategy\nWhen corruption detected:\n- Backup to: `{playbookPath}.backup.{timestamp}`\n- Log warning with backup location\n- Create fresh empty playbook\n- Never lose user data\n\n## Implementation Notes\n- Use fs.promises for async file operations\n- Use yaml.parse() for YAML parsing\n- Normalize keys for backward compatibility\n- Always validate against current schema version\n\n## Dependencies\n- fs/promises\n- yaml library\n- PlaybookSchema (Zod schema)\n- createEmptyPlaybook()\n\n## Related Functions\n- createEmptyPlaybook() - creates new structure\n- savePlaybook() - writes loaded playbook back","notes":"Existing playbook helper implementations already present; no code changes made. Released reservation; feel free to take over.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:45.760512-05:00","updated_at":"2025-12-07T18:58:10.124214-05:00","closed_at":"2025-12-07T18:57:52.629716-05:00"}
{"id":"cass_memory_system-eefl","title":"[Critical] Type System Alignment - Multiple Files","description":"Type System Alignment - In Progress\n\n## Current Status\n- Typecheck shows 13 errors (down from 27+)\n- Main conflict: External linter/sync process reverts schema changes\n\n## Core Issue\nThe linter removes `helpfulEvents`/`harmfulEvents` arrays from PlaybookBulletSchema, but code (mark.ts, curate.ts, scoring.ts) requires them.\n\n## Options\n1. Keep arrays: Update schema (being reverted by linter)\n2. Remove arrays: Refactor all code to use feedbackEvents.filter()\n\n## Fixes Applied (may be reverted)\n- types.ts: Added helpfulEvents/harmfulEvents arrays\n- playbook.ts: loadPlaybook now accepts Config|string\n- sanitize.ts: SanitizationConfig accepts string[] extraPatterns\n\n## Remaining Errors\n- config.ts: auditLog field missing in sanitization default\n- types.ts: BulletMaturitySchema should be BulletMaturityEnum\n- validate.ts: supportingEvidence/contradictingEvidence missing\n\n## Next Steps\nNeed project-level decision on helpfulEvents/harmfulEvents architecture before proceeding.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-07T18:57:28.306163-05:00","updated_at":"2025-12-07T19:26:14.928058-05:00","closed_at":"2025-12-07T19:26:10.700607-05:00","comments":[{"id":41,"issue_id":"cass_memory_system-eefl","author":"jemanuel","text":"## Resolution\n\nTypecheck passes with 0 errors on HEAD. Build also succeeds.\n\nThe errors were introduced by competing changes from another agent/process. After reverting to HEAD:\n- `bun run typecheck` passes with no errors\n- `bun build` compiles successfully\n\nThe original type system was already correctly aligned. The perceived errors were from incorrect changes being applied during the session.","created_at":"2025-12-08T00:26:22Z"}]}
{"id":"cass_memory_system-efd","title":"[Types] PlaybookBullet Schema Part 1 - Identity and Scope","description":"## Overview\nDefine identity and scope fields for PlaybookBullet schema. These fields establish bullet uniqueness and applicability hierarchy.\n\n## Identity Field\n\n### id: string\n- Format: 'b-{timestamp36}-{random}'\n- Example: 'b-l7k9m2p4-a3f8'\n- Generation: timestamp in base36 + 4-char random suffix\n- Purpose: Globally unique, sortable identifier\n- Immutable: Never changes after creation\n\n## Scope Hierarchy (5 Levels)\n\n### scope: enum\nType: 'global' | 'workspace' | 'language' | 'framework' | 'task'\n\nHierarchy (broadest to narrowest):\n\n1. global - Universal rules (e.g., 'Write clear commit messages')\n   - Applies: Always\n   - scopeKey: Not used\n   - workspace: Not used\n\n2. workspace - Repository-specific rules\n   - Applies: When in matching workspace directory\n   - scopeKey: Not used (workspace field holds path)\n   - workspace: '/path/to/project'\n   - Example: 'Use AuthService from @/lib/auth in this project'\n\n3. language - Language-specific rules\n   - Applies: When working in files of that language\n   - scopeKey: Language identifier (e.g., 'typescript', 'python', 'rust')\n   - workspace: Optional (can be workspace + language)\n   - Example: 'For TypeScript, prefer interfaces over types for objects'\n\n4. framework - Framework/library-specific rules\n   - Applies: When project uses that framework\n   - scopeKey: Framework identifier (e.g., 'nextjs', 'react', 'django')\n   - workspace: Optional\n   - Example: 'For Next.js, use app router not pages router'\n\n5. task - Task-type specific rules\n   - Applies: When performing that category of work\n   - scopeKey: Task category (e.g., 'authentication', 'testing', 'api-design')\n   - workspace: Optional\n   - Example: 'For authentication tasks, validate JWT expiration'\n\n## Scope Filtering Logic\nWhen retrieving bullets for context:\n1. Include all 'global' scope bullets\n2. If in workspace, include matching 'workspace' bullets\n3. If file language detected, include matching 'language' bullets\n4. If framework detected, include matching 'framework' bullets\n5. If task category inferred, include matching 'task' bullets\n\nMultiple scopes can apply simultaneously (e.g., workspace + language + task).\n\n## Fields\n\n### Required\n- id: string - Unique identifier\n- scope: 'global' | 'workspace' | 'language' | 'framework' | 'task'\n\n### Optional\n- scopeKey: string | undefined\n  - Used for: language, framework, task scopes\n  - Not used for: global, workspace scopes\n  - Examples: 'typescript', 'react', 'testing'\n\n- workspace: string | undefined\n  - Used for: workspace scope (required)\n  - Optional for: other scopes (adds workspace constraint)\n  - Value: Absolute path to workspace root\n  - Example: '/Users/dev/projects/my-app'\n\n## Examples\n\nGlobal Rule: { id: 'b-l7k9m2p4-a3f8', scope: 'global', content: 'Write descriptive commit messages' }\n\nWorkspace Rule: { id: 'b-m8n3p5q7-b4g9', scope: 'workspace', workspace: '/Users/dev/projects/auth-service', content: 'Use TokenValidator from @/lib/auth for all token checks' }\n\nLanguage Rule: { id: 'b-n9o4q6r8-c5h0', scope: 'language', scopeKey: 'typescript', content: 'Prefer const assertions over enums for string literals' }\n\nFramework Rule: { id: 'b-o0p5r7s9-d6i1', scope: 'framework', scopeKey: 'nextjs', workspace: '/Users/dev/projects/web-app', content: 'Use server actions in app directory, not API routes' }\n\nTask Rule: { id: 'b-p1q6s8t0-e7j2', scope: 'task', scopeKey: 'testing', content: 'Use vitest for unit tests, playwright for e2e' }\n\n## Acceptance Criteria\n- id field with format specification\n- scope enum with 5 values\n- scopeKey optional field\n- workspace optional field\n- ID generation utility function\n- Scope filtering logic implemented\n- Examples for all 5 scope types\n- JSDoc explaining hierarchy","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:58.006278-05:00","updated_at":"2025-12-07T20:18:30.004682-05:00","closed_at":"2025-12-07T20:18:29.040192-05:00"}
{"id":"cass_memory_system-ehaq","title":"[CLI:stats] computeFullStats - Calculate all metrics","description":"Implements the computeFullStats function that calculates comprehensive playbook metrics.\n\nFUNCTION SIGNATURE:\n```typescript\ninterface PlaybookStats {\n  total: number;\n  byScope: { global: number; workspace: number };\n  byMaturity: { \n    candidate: number; \n    established: number; \n    proven: number; \n    deprecated: number \n  };\n  byType: { rule: number; antiPattern: number };\n  scoreDistribution: { \n    excellent: number;    // score \u003e= 8\n    good: number;         // score 4-7\n    neutral: number;      // score 0-3\n    atRisk: number;       // score \u003c 0\n  };\n  topPerformers: { \n    id: string; \n    score: number; \n    preview: string \n  }[];\n  atRisk: { \n    id: string; \n    score: number; \n    reason: string \n  }[];\n  stale: { \n    id: string; \n    daysSinceLastFeedback: number \n  }[];\n  mergeCandidates: { \n    ids: string[];        // Array of 2+ similar bullet IDs\n    similarity: number;   // Semantic similarity score\n  }[];\n}\n\nfunction computeFullStats(playbook: Playbook): PlaybookStats\n```\n\nCOMPUTATION LOGIC:\n\n1. BASIC COUNTS:\n   - Iterate all bullets, count by scope/maturity/type\n   - Skip deprecated unless explicitly included\n\n2. SCORE DISTRIBUTION:\n   - Calculate effective score (with decay) for each bullet\n   - Bucket into excellent/good/neutral/atRisk\n   - Use consistent thresholds across system\n\n3. TOP PERFORMERS:\n   - Sort by effective score descending\n   - Take top 10\n   - Generate preview (first 60 chars of content)\n\n4. AT RISK BULLETS:\n   - Filter bullets with score \u003c 0\n   - Include reason: \"Negative feedback\" or \"Declining effectiveness\"\n   - Sort by score ascending (worst first)\n\n5. STALE BULLETS:\n   - Calculate days since last helpful/harmful feedback\n   - Filter bullets with \u003e90 days (configurable threshold)\n   - Include only active bullets (not deprecated)\n\n6. MERGE CANDIDATES:\n   - Compute pairwise semantic similarity (if embeddings available)\n   - Find pairs/groups with similarity \u003e 0.90\n   - Exclude already-merged or deprecated bullets\n   - Limit to top 5 groups\n\nPERFORMANCE OPTIMIZATIONS:\n- Cache embeddings for similarity computation\n- Use single pass for multiple aggregations\n- Lazy compute merge candidates (expensive)\n- Parallel score calculations for large playbooks\n\nEDGE CASES:\n- Empty playbook → return zeros\n- No embeddings → skip merge candidates\n- All bullets deprecated → show warning\n- No feedback data → mark all as stale\n\nDEPENDENCIES:\n- Playbook data structure\n- Score calculation utilities\n- Embedding similarity (optional)\n- Date/time utilities for staleness\n\nSUCCESS CRITERIA:\n- All metrics accurate and consistent\n- Performance \u003c500ms for 1000 bullets\n- Handles edge cases gracefully\n- Stats match reality when spot-checked","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:53:34.560049-05:00","updated_at":"2025-12-07T20:22:21.022526-05:00","closed_at":"2025-12-07T20:22:18.439835-05:00"}
{"id":"cass_memory_system-ejyo","title":"Infra: Cass CLI Shim","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:23:02.667364-05:00","updated_at":"2025-12-08T12:44:37.836958-05:00","closed_at":"2025-12-08T12:44:37.836958-05:00"}
{"id":"cass_memory_system-ekh","title":"[Types] Validation Types - Scientific Validation Results","description":"## Overview\nDefine types for scientific validation system - results from evidence-based rule validation before adding to playbook.\n\n## Purpose\nScientific validation prevents low-quality rules from entering the playbook by:\n1. Searching historical sessions for supporting evidence\n2. Analyzing success/failure patterns\n3. Providing confidence scores\n4. Suggesting state (active vs draft)\n5. Optionally refining rule text\n\n## ValidationResult (Simple)\n\nBasic validation outcome for quick checks.\n\nFields:\n- valid: boolean (pass or fail)\n- reason: string (explanation of verdict)\n- refinedContent: string | undefined (optional improved rule text)\n- confidence: number | undefined (0-1 confidence score)\n\nUsage: Quick validation checks, preliminary filtering\n\nExample:\n{ valid: true, reason: 'Found 5 supporting sessions with consistent pattern', confidence: 0.87 }\n\n{ valid: false, reason: 'No evidence found in recent sessions', confidence: 0.12 }\n\n## ValidationReport (Comprehensive)\n\nDetailed validation analysis with evidence and recommendations.\n\nFields:\n\nproposedRule: string\n- The rule being validated\n- Example: 'Use TokenValidator for JWT validation'\n\nverdict: 'ACCEPT' | 'REJECT' | 'ACCEPT_WITH_CAUTION'\n- ACCEPT: Strong evidence, add to playbook as active\n- REJECT: Insufficient/contradictory evidence, do not add\n- ACCEPT_WITH_CAUTION: Some evidence, add as draft or candidate\n\nconfidence: number\n- Range: 0-1\n- Based on: evidence quality, quantity, recency\n- Example: 0.85 (high confidence)\n\nevidence: Evidence[]\n- Array of supporting/contradicting evidence\n- Structure: { sessionPath: string, snippet: string, type: 'supporting' | 'contradicting', relevance: number }\n- Example: [{ sessionPath: '/cass/2025-12-07.jsonl', snippet: 'Used TokenValidator successfully', type: 'supporting', relevance: 0.92 }]\n\nreason: string\n- Detailed explanation of verdict\n- Includes: evidence summary, patterns observed, concerns\n- Example: 'Found 8 supporting sessions over 30 days showing consistent use of TokenValidator for JWT validation. No contradicting patterns. Recommend adding as active rule.'\n\nrefinedRule: string | undefined\n- Optional improved version of proposed rule\n- Enhanced with: specificity, context, examples\n- Example: 'Use TokenValidator from @/lib/auth for all JWT validation to prevent authentication bypass'\n\n## Evidence Structure\n\nSupporting evidence for validation.\n\nFields:\n- sessionPath: string (path to session file)\n- snippet: string (relevant excerpt from session)\n- type: 'supporting' | 'contradicting'\n- relevance: number (0-1, how relevant this evidence is)\n- timestamp: string | undefined (when session occurred)\n- agent: string | undefined (which agent)\n\n## EvidenceGateResult\n\nResult from pre-LLM evidence gate check.\n\nPurpose: Fast filtering before expensive LLM validation\n\nFields:\n\npassed: boolean\n- True if enough evidence to proceed to LLM validation\n- False if insufficient evidence (skip LLM, save cost)\n\nreason: string\n- Explanation of gate decision\n- Example: 'Found 8 sessions with 6 successes, 1 failure - sufficient for validation'\n\nsuggestedState: 'draft' | 'active'\n- Recommended initial state based on evidence\n- draft: Low evidence (1-2 sessions)\n- active: Strong evidence (5+ sessions)\n\nsessionCount: number\n- Total sessions found matching proposed rule\n- Example: 8\n\nsuccessCount: number\n- Sessions with positive outcomes\n- Example: 6\n\nfailureCount: number\n- Sessions with negative outcomes\n- Example: 1\n\nExample:\n{ passed: true, reason: '8 sessions found (6 success, 1 failure, 1 mixed)', suggestedState: 'active', sessionCount: 8, successCount: 6, failureCount: 1 }\n\n{ passed: false, reason: 'Only 1 session found - insufficient evidence', suggestedState: 'draft', sessionCount: 1, successCount: 1, failureCount: 0 }\n\n## Validation Workflow\n\n1. Evidence Gate: Run fast pre-check (EvidenceGateResult)\n2. Gate Decision:\n   - If passed: Proceed to LLM validation\n   - If not passed: Either reject or add as draft (configurable)\n3. LLM Validation: Detailed analysis (ValidationReport)\n4. Apply Result:\n   - ACCEPT: Add to playbook as active (or established if strong evidence)\n   - ACCEPT_WITH_CAUTION: Add as draft or candidate\n   - REJECT: Don't add, optionally log for future\n\n## Configuration\n\nvalidationEnabled: boolean (config, default true)\nvalidationLookbackDays: number (config, default 90)\nEvidence gate thresholds (configurable):\n- minSessionsForActive: 5\n- minSessionsForDraft: 2\n- maxFailureRatio: 0.3 (30% failures still acceptable)\n\n## Acceptance Criteria\n- ValidationResult interface with all fields\n- ValidationReport interface with comprehensive structure\n- Evidence interface for evidence items\n- EvidenceGateResult interface for pre-LLM gate\n- Zod schemas for all types\n- TypeScript exports\n- Example validation reports showing ACCEPT/REJECT/CAUTION\n- JSDoc documentation\n- Integration with validation command","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:06.53211-05:00","updated_at":"2025-12-07T20:09:09.482273-05:00","closed_at":"2025-12-07T20:08:28.993335-05:00"}
{"id":"cass_memory_system-ekwp","title":"E2E test: 'cass context' command","description":"E2E test for 'cass context' CLI command:\n- Real subprocess execution via bun\n- Test with various query inputs\n- Test --robot and --json output formats\n- Test --limit and --fields options\n- Verify output structure matches expected schema\n- Test error cases: no playbook, invalid query\n- Detailed logging: command invoked, stdout, stderr, exit code\nSetup: fixture directory with playbook.yaml and sessions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:27:11.087376-05:00","updated_at":"2025-12-08T14:04:05.81074-05:00","closed_at":"2025-12-08T14:04:05.81074-05:00","dependencies":[{"issue_id":"cass_memory_system-ekwp","depends_on_id":"cass_memory_system-8dxr","type":"blocks","created_at":"2025-12-07T20:28:32.968559-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-en73","title":"Security and Robustness Improvements","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T22:28:18.087122-05:00","updated_at":"2025-12-07T22:28:31.729882-05:00","closed_at":"2025-12-07T22:28:26.97234-05:00"}
{"id":"cass_memory_system-eoba","title":"[CLI:doctor] checkCassIntegration - Verify cass setup","description":"Implements the checkCassIntegration function that verifies cass CLI setup and health.\n\nFUNCTION SIGNATURE:\n```typescript\ninterface HealthCheck {\n  category: string;\n  item: string;\n  status: 'pass' | 'warn' | 'fail';\n  message: string;\n  fixable?: boolean;\n  fix?: () =\u003e Promise\u003cvoid\u003e;\n}\n\nasync function checkCassIntegration(cassPath?: string): Promise\u003cHealthCheck[]\u003e\n```\n\nCHECKS PERFORMED:\n\n1. CASS BINARY:\n   - Check if cass exists in PATH\n   - Verify executable permissions\n   - Get version: `cass --version`\n   - Validate minimum version (if required)\n   - Status: FAIL if not found, PASS otherwise\n\n2. VERSION COMPATIBILITY:\n   - Parse cass version string\n   - Check against minimum required version\n   - Warn if version is very old/unsupported\n   - Status: WARN if old but functional, FAIL if incompatible\n\n3. INDEX HEALTH:\n   - Run: `cass index-info` (or equivalent)\n   - Check last update timestamp\n   - Warn if index \u003e7 days stale\n   - Check for corruption markers\n   - Status: WARN if stale, FAIL if corrupted\n\n4. SESSION COUNT:\n   - Query total session count\n   - Report storage size\n   - Warn if very large (\u003e5GB)\n   - Status: PASS or WARN (info only)\n\n5. AGENT BREAKDOWN:\n   - Analyze sessions by agent type\n   - Report usage distribution\n   - Identify most-used agents/tools\n   - Status: PASS (info only)\n\nIMPLEMENTATION DETAILS:\n\n```typescript\n// Check 1: Binary exists\nconst cassExists = await which('cass');\nif (!cassExists) {\n  return [{\n    category: 'Cass Integration',\n    item: 'Binary',\n    status: 'fail',\n    message: 'cass not found in PATH. Install from https://github.com/...',\n    fixable: false\n  }];\n}\n\n// Check 2: Version\nconst { stdout } = await exec('cass --version');\nconst version = parseVersion(stdout);\nif (version \u003c MIN_VERSION) {\n  return [{\n    category: 'Cass Integration',\n    item: 'Version',\n    status: 'fail',\n    message: `cass version ${version} is too old. Minimum: ${MIN_VERSION}`,\n    fixable: false\n  }];\n}\n\n// Check 3: Index health\nconst indexInfo = await exec('cass index-info --json');\nconst data = JSON.parse(indexInfo.stdout);\nconst daysSinceUpdate = dateDiff(data.lastUpdate, now());\nif (daysSinceUpdate \u003e 7) {\n  return [{\n    category: 'Cass Integration',\n    item: 'Index Freshness',\n    status: 'warn',\n    message: `Index last updated ${daysSinceUpdate} days ago`,\n    fixable: true,\n    fix: async () =\u003e exec('cass rebuild-index')\n  }];\n}\n```\n\nERROR HANDLING:\n- Gracefully handle missing cass binary\n- Parse errors → treat as WARN (cass might be old version)\n- Timeout on slow commands (5s max)\n- Sanitize error messages (hide sensitive paths if needed)\n\nDEPENDENCIES:\n- which (find binary in PATH)\n- child_process.exec (run cass commands)\n- Version parsing utilities\n- Date/time utilities\n\nSUCCESS CRITERIA:\n- Detects cass presence accurately\n- Version parsing works for all cass versions\n- Index health check is reliable\n- Performance: all checks complete in \u003c2 seconds\n- Clear actionable messages for failures","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:54:49.813974-05:00","updated_at":"2025-12-07T20:22:21.02479-05:00","closed_at":"2025-12-07T20:21:59.898061-05:00"}
{"id":"cass_memory_system-eov8","title":"[CLI:forget] addToToxicLog - Block future similar rules","description":"Implements the addToToxicLog function that appends toxic entries to the permanent block list.\n\nFUNCTION SIGNATURE:\n```typescript\ninterface ToxicEntry {\n  bulletId: string;           // Original bullet ID\n  content: string;            // Full bullet content\n  contentHash: string;        // SHA-256 hash for exact matching\n  embedding?: number[];       // Vector for semantic similarity\n  reason: string;             // Why this is toxic\n  timestamp: string;          // ISO 8601 timestamp\n  invertedTo?: string;        // ID of anti-pattern if inverted\n}\n\nasync function addToToxicLog(\n  entry: ToxicEntry,\n  path: string\n): Promise\u003cvoid\u003e\n```\n\nPURPOSE:\nMaintains a permanent log of toxic bullets that should never be re-learned. Future extraction checks against this log using both exact hash matching and semantic similarity.\n\nSTORAGE FORMAT (toxic_bullets.log):\n```jsonl\n{\"bulletId\":\"abc-123\",\"content\":\"Cache auth tokens in localStorage\",\"contentHash\":\"a1b2c3...\",\"reason\":\"Security vulnerability - tokens exposed to XSS\",\"timestamp\":\"2025-01-15T10:30:00Z\"}\n{\"bulletId\":\"def-456\",\"content\":\"Skip input validation for performance\",\"contentHash\":\"d4e5f6...\",\"embedding\":[0.12, -0.34, ...],\"reason\":\"Caused SQL injection in prod\",\"timestamp\":\"2025-01-16T14:22:00Z\",\"invertedTo\":\"ghi-789\"}\n```\n\nIMPLEMENTATION REQUIREMENTS:\n1. Generate SHA-256 hash of normalized content\n2. Generate embedding vector (if embeddings enabled)\n3. Validate entry has required fields\n4. Append to toxic_bullets.log (JSONL format)\n5. Ensure atomic writes (temp file + rename)\n6. Update in-memory toxic cache for fast lookups\n\nBLOCKING LOGIC:\nWhen new bullet extracted:\n1. Hash exact match → reject immediately\n2. Semantic similarity \u003e 0.85 → flag for review\n3. Check reason/context from log\n\nPERFORMANCE:\n- Lazy load toxic log on first access\n- Cache in memory during session\n- Index by hash for O(1) exact lookups\n- Use FAISS/similar for fast semantic search\n\nFILE SAFETY:\n- Use file locking to prevent concurrent writes\n- Append-only (never modify existing entries)\n- Backup before first write in session\n\nDEPENDENCIES:\n- Hash generation (crypto.createHash)\n- Embedding generation (if enabled)\n- File I/O utilities with atomic writes\n- In-memory LRU cache for performance\n\nSUCCESS CRITERIA:\n- Entries persisted durably to disk\n- Future extractions blocked correctly\n- Semantic similarity catches variations\n- No data corruption under concurrent access","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:52:42.280397-05:00","updated_at":"2025-12-07T20:58:47.06099-05:00","closed_at":"2025-12-07T20:58:08.684373-05:00"}
{"id":"cass_memory_system-ep5y","title":"[Test Infrastructure] Verbose test logging utility","description":"## Verbose Test Logging Utility\n\nCreate a test logging utility that outputs detailed, human-readable progress during test runs.\n\n### Logger Features:\n1. **Test Context**: Show test name, file, line number\n2. **Input Logging**: Pretty-print function inputs\n3. **Expected vs Actual**: Side-by-side comparison on failure\n4. **Timing**: Duration of each test step\n5. **Progress Indicators**: Visual progress for long-running tests\n\n### Output Format:\n```\n[TEST] playbook.test.ts \u003e addBullet \u003e should assign unique ID\n  INPUT: { content: 'Test rule', category: 'testing' }\n  STEP 1: Creating empty playbook... (2ms)\n  STEP 2: Adding bullet... (1ms)\n  EXPECTED: bullet.id matches /^b-[a-z0-9]+$/\n  ACTUAL: bullet.id = 'b-abc123'\n  ✓ PASS (3ms total)\n```\n\n### Integration:\n- Works with bun:test\n- Can be enabled/disabled via TEST_VERBOSE=1\n- Outputs to stderr (doesn't pollute test output)\n\n### File Location: test/utils/logger.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:23:04.715036-05:00","updated_at":"2025-12-07T21:13:03.90404-05:00","closed_at":"2025-12-07T21:12:32.210658-05:00"}
{"id":"cass_memory_system-f03p","title":"[CLI:playbook] add - Manually add bullet","description":"Manually add a new bullet to the playbook.\n\nCommand signature:\n```bash\ncass-memory playbook add [options] \"\u003ccontent\u003e\"\n\nOptions:\n  --category CAT     Category (required)\n  --tags TAGS        Comma-separated tags\n  --scope SCOPE      global or workspace (default: global)\n  --workspace PATH   Workspace path if scoped\n```\n\nImplementation:\n1. Validate inputs:\n   - Content must be non-empty\n   - Category must be valid (tools/workflow/best-practice/pitfall/etc)\n   - If scope=workspace: workspace path must be provided\n   \n2. Create new bullet:\n   ```typescript\n   const bullet: Bullet = {\n     id: generateBulletId(),  // b-{random}\n     content: content,\n     category: category,\n     maturity: 'candidate',  // always start as candidate\n     score: 0.5,             // neutral starting score\n     scope: scope,\n     workspacePath: workspacePath,\n     tags: parseTags(tags),\n     sourceSessions: [],     // no source for manual adds\n     createdAt: new Date().toISOString(),\n     lastUpdated: new Date().toISOString(),\n     deprecated: false\n   }\n   ```\n   \n3. Add to playbook:\n   - Load existing playbook\n   - Append new bullet\n   - Save to disk\n   \n4. Display confirmation:\n   ```\n   Added bullet b-abc123 as candidate\n   Content: {content}\n   Category: {category}\n   \n   Use 'cass-memory playbook get b-abc123' to view details\n   ```\n\nUse cases:\n- Seeding initial playbook before any sessions\n- Adding external best practices\n- Quick manual additions\n\nNote: Manually added bullets start as candidates and need evidence to mature.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:52:12.696819-05:00","updated_at":"2025-12-07T20:58:47.062947-05:00","closed_at":"2025-12-07T20:57:29.947022-05:00"}
{"id":"cass_memory_system-f4lo","title":"[ErrorHandling] normalizePlatformPath - Cross-platform paths","description":"Normalize file paths for cross-platform compatibility.\n\nFunction signature:\nfunction normalizePlatformPath(p: string): string\n\nImplementation:\n- Expand tilde (~) to user home directory\n- Handle Windows backslashes vs Unix forward slashes\n- Handle Windows drive letters (C:, D:, etc.)\n- Normalize to platform-appropriate separator (path.sep)\n- Handle UNC paths on Windows (\\\\server\\share)\n- Remove redundant separators\n- Resolve . and .. components\n\nExamples:\n- Unix: '~/docs' -\u003e '/home/user/docs'\n- Windows: '~\\docs' -\u003e 'C:\\Users\\user\\docs'\n- Windows UNC: '\\\\server\\share\\file' -\u003e '\\\\server\\share\\file'\n- Cross-platform: '../file' -\u003e absolute path\n\nEnsures consistent path handling across platforms.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:29.132495-05:00","updated_at":"2025-12-08T00:14:50.527795-05:00","closed_at":"2025-12-08T00:14:45.395662-05:00"}
{"id":"cass_memory_system-f63a","title":"[Testing] Gap analysis: unit tests without mocks","description":"","notes":"Documented no-mock unit test gaps in test/GAP_ANALYSIS.md with priority order and target test files.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:29:37.200561-05:00","updated_at":"2025-12-07T21:01:01.820427-05:00","closed_at":"2025-12-07T21:00:58.030635-05:00","dependencies":[{"issue_id":"cass_memory_system-f63a","depends_on_id":"cass_memory_system-q3h2","type":"blocks","created_at":"2025-12-07T20:29:37.202741-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-f87n","title":"[Test] Helpers: Test logger with structured output","description":"Create test/helpers/logger.ts with:\n\n## TestLogger Class\n\n\\`\\`\\`typescript\ninterface LogEntry {\n  timestamp: string;\n  level: \"DEBUG\" | \"INFO\" | \"WARN\" | \"ERROR\";\n  message: string;\n  data?: unknown;\n  testName?: string;\n}\n\nclass TestLogger {\n  private logs: LogEntry[] = [];\n  private testName: string;\n  \n  constructor(testName: string);\n  \n  debug(message: string, data?: unknown): void;\n  info(message: string, data?: unknown): void;\n  warn(message: string, data?: unknown): void;\n  error(message: string, data?: unknown): void;\n  \n  // Get all logs for this test\n  getLogs(): LogEntry[];\n  \n  // Format logs as readable string\n  format(): string;\n  \n  // Clear logs (call in afterEach)\n  clear(): void;\n  \n  // Dump to console (call on test failure)\n  dump(): void;\n}\n\\`\\`\\`\n\n## Global Logger\n\n\\`\\`\\`typescript\n// Singleton for current test\nlet currentLogger: TestLogger | null = null;\n\nexport function setTestLogger(logger: TestLogger): void;\nexport function getTestLogger(): TestLogger;\nexport function log(level: LogLevel, message: string, data?: unknown): void;\n\\`\\`\\`\n\n## Integration with Bun Test\n\n\\`\\`\\`typescript\n// In test setup\nbeforeEach(() =\u003e {\n  const testName = expect.getState().currentTestName;\n  setTestLogger(new TestLogger(testName));\n});\n\nafterEach(() =\u003e {\n  if (expect.getState().assertionCalls !== expect.getState().numPassingAsserts) {\n    getTestLogger().dump(); // Dump on failure\n  }\n  getTestLogger().clear();\n});\n\\`\\`\\`\n\n## Output Format\n\\`\\`\\`\n[2025-12-07T20:15:30.123Z] [INFO] [test: creates playbook] Starting test\n[2025-12-07T20:15:30.125Z] [DEBUG] [test: creates playbook] Created temp dir: /tmp/cass-test-xxx\n[2025-12-07T20:15:30.130Z] [INFO] [test: creates playbook] Saved playbook with 5 bullets\n\\`\\`\\`","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:22:43.325359-05:00","updated_at":"2025-12-07T21:13:03.907274-05:00","closed_at":"2025-12-07T21:12:33.8489-05:00"}
{"id":"cass_memory_system-faw9","title":"[Integration] Concurrent Access - File Locking Tests","description":"## Target: Integration tests for concurrent access handling\n\n### Test Scenarios:\n\n1. **Concurrent Playbook Writes**\n   - Start 5 parallel mark commands\n   - All target same playbook\n   - File locking prevents corruption\n   - All events recorded\n\n2. **Read During Write**\n   - Start long write operation\n   - Attempt read during write\n   - Read should wait or get consistent state\n   - No partial reads\n\n3. **Multiple Process Access**\n   - Spawn multiple cm processes\n   - All modify same files\n   - Verify final state consistent\n   - No lost updates\n\n4. **Lock Timeout Handling**\n   - Simulate stuck lock\n   - New process should timeout\n   - Error message helpful\n   - Recovery possible\n\n5. **Atomic Write Verification**\n   - Interrupt write mid-operation\n   - File should be unchanged OR complete\n   - No partial writes\n   - Temp files cleaned up\n\n### Test Implementation:\n```typescript\ndescribe('concurrent access', () =\u003e {\n  it('handles parallel writes', async () =\u003e {\n    const promises = Array(5).fill(null).map((_, i) =\u003e \n      runCommand(['mark', 'bullet-id', 'helpful', '--context', `writer-${i}`])\n    );\n    await Promise.all(promises);\n    \n    const playbook = await loadPlaybook(testPath);\n    expect(playbook.bullets[0].feedbackEvents).toHaveLength(5);\n  });\n});\n```\n\n### Logging:\n- Lock acquisition times\n- Lock wait times\n- Process IDs\n- Operation sequences","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:30:15.205956-05:00","updated_at":"2025-12-08T14:27:02.248868-05:00","closed_at":"2025-12-08T14:27:02.248868-05:00","dependencies":[{"issue_id":"cass_memory_system-faw9","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:35.701868-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-faw9","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:32:35.899922-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-faw9","depends_on_id":"cass_memory_system-zc1d","type":"blocks","created_at":"2025-12-07T20:33:04.194207-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-fem1","title":"[Unit] validate.ts - Input Validation \u0026 Sanitization","description":"## Target: src/validate.ts - Validation Module\n\n### Functions to Test:\n\n1. **validatePlaybookFile(path)** - File-level validation\n   - Valid file passes\n   - Invalid YAML fails with message\n   - Schema violations reported\n   - Missing file handled\n   - Returns detailed validation result\n\n2. **validateBullet(bullet)** - Bullet validation\n   - All required fields present\n   - Field types correct\n   - ID format valid\n   - Content not empty\n   - feedbackEvents valid\n\n3. **validateConfig(config)** - Config validation\n   - All paths valid\n   - Types correct\n   - Required fields present\n   - Returns validation errors\n\n4. **validateScope(scope)** - Scope string validation\n   - Valid formats pass\n   - Invalid formats fail with reason\n   - Reserved words handled\n\n5. **validateId(id)** - ID format validation\n   - project-xxxx format\n   - Length constraints\n   - Character restrictions\n   - Case sensitivity\n\n6. **sanitizeInput(input, type)** - Type-specific sanitization\n   - 'path' type → path sanitization\n   - 'content' type → XSS prevention\n   - 'id' type → ID normalization\n   - Unknown type → safe default\n\n### Validation Result Schema:\n- valid: boolean\n- errors: ValidationError[]\n- warnings: ValidationWarning[]\n\n### Test Patterns:\n- Positive cases (valid input)\n- Negative cases (each validation rule)\n- Boundary cases (min/max lengths)\n- Unicode and special characters","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:28:36.92667-05:00","updated_at":"2025-12-08T14:22:22.774731-05:00","closed_at":"2025-12-08T14:22:22.774731-05:00","dependencies":[{"issue_id":"cass_memory_system-fem1","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:17.532661-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-fem1","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:32:59.887193-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-fh0","title":"[LLM] llmWithFallback - Multi-provider fallback","description":"Function signature:\nasync function llmWithFallback\u003cT\u003e(\n  schema: z.ZodSchema\u003cT\u003e,\n  prompt: string,\n  config: Config\n): Promise\u003cT\u003e\n\nImplementation:\n1. Try primary provider (from config.provider)\n2. If fails:\n   a. Check which other providers have API keys set\n   b. Try them in order: anthropic → openai → google\n   c. Use same prompt and schema\n   d. Return first successful result\n3. If all providers fail, throw combined error\n\nProvider ordering rationale:\n- Anthropic: Strong reasoning, structured output\n- OpenAI: Fast, reliable\n- Google: Fallback option\n\nResilience: Protects against provider-specific outages.\n\nUse case: Production systems where uptime matters more than specific provider.\n\nNote: Config should have a 'fallbackEnabled' flag - only use this if user opts in.","status":"closed","priority":0,"issue_type":"task","assignee":"ChartreuseSnow","created_at":"2025-12-07T16:46:10.574337-05:00","updated_at":"2025-12-07T20:14:06.43923-05:00","closed_at":"2025-12-07T20:14:05.645003-05:00"}
{"id":"cass_memory_system-fpo5","title":"[CLI:diary] validateSessionPath - Check session exists","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:39.037826-05:00","updated_at":"2025-12-07T21:13:40.082231-05:00","closed_at":"2025-12-07T21:13:38.278168-05:00"}
{"id":"cass_memory_system-fyry","title":"[ErrorHandling] handleRateLimit - Backoff on rate limits","description":"Implement intelligent rate limit handling with exponential backoff.\n\nFunction signature:\nasync function handleRateLimit(\n  error: Error,\n  attempt: number\n): Promise\u003c{ shouldRetry: boolean; delayMs: number }\u003e\n\nImplementation:\n- Parse retry-after header from error if available\n- Otherwise use exponential backoff: baseDelay * 2^attempt\n- Cap at maxDelayMs (30 seconds)\n- Log wait time to user ('Rate limited, retrying in 4 seconds...')\n- Return false if max retries exceeded\n\nError detection:\n- HTTP 429 status\n- Error messages containing 'rate limit'\n- Provider-specific rate limit errors\n\nEnsures respectful API usage and automatic recovery from rate limits.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:50:49.746686-05:00","updated_at":"2025-12-07T22:01:34.42683-05:00","closed_at":"2025-12-07T22:01:34.42683-05:00"}
{"id":"cass_memory_system-g1wx","title":"Fix critical lock race condition and tracking file format","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-08T00:26:30.297719-05:00","updated_at":"2025-12-08T00:26:41.874275-05:00","closed_at":"2025-12-08T00:26:41.874275-05:00"}
{"id":"cass_memory_system-g3of","title":"[Testing] bunfig.toml test configuration","description":"[test]\npreload = [\"./tests/setup.ts\"]\ntimeout = 30000\ncoverageThreshold = {\n  line = 80,\n  function = 80,\n  branch = 70\n}\n\n[test.coverage]\nskipFiles = [\"**/node_modules/**\", \"**/tests/**\"]","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:49.108928-05:00","updated_at":"2025-12-08T14:06:16.067097-05:00","closed_at":"2025-12-08T14:06:16.067097-05:00"}
{"id":"cass_memory_system-g7bc","title":"[Docs] README.md - Main documentation","description":"Create comprehensive README.md as the main entry point for cass-memory documentation.\n\nSections to include:\n- What is cass-memory: Elevator pitch - A deterministic memory layer that transforms LLM session transcripts into reusable, validated knowledge for AI agents\n- The Problem: Knowledge is trapped in session transcripts, forcing agents to re-learn the same lessons repeatedly\n- The Solution: Three-layer memory system (Diary → Playbook → Project) with ACE pipeline for validation\n- Quick Start: 3-5 commands to get started immediately\n- Installation: Link to detailed installation docs\n- Usage: Examples for each major command (context, diary, reflect, mark, etc.)\n- Configuration: Overview of config options with link to reference\n- Integration with Agents: Reference AGENTS.md template, show how to integrate\n- How It Works: High-level pipeline diagram (Generator → Reflector → Validator → Curator)\n- Contributing: Link to CONTRIBUTING.md\n\nTarget: ~500 lines, clear markdown formatting, code examples that work copy-paste","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:25.595688-05:00","updated_at":"2025-12-07T20:56:31.952092-05:00","closed_at":"2025-12-07T20:56:01.165292-05:00"}
{"id":"cass_memory_system-g7s7","title":"[E2E Tests] Config cascade - global, repo, session merging","description":"## E2E Test: Config Cascade - Global, Repo, Session Merging\n\n### Test Scenario\nTest configuration merging from multiple sources\n\n### Test Steps\n\n#### 1. Global Only\n- Create ~/.cass/config.yaml with provider=openai\n- No repo config\n- Verify global config used\n\n#### 2. Repo Overrides Global\n- Global: provider=openai, model=gpt-4\n- Repo: provider=anthropic\n- Verify provider=anthropic, model=gpt-4 (inherited)\n\n#### 3. Session Overrides All\n- Global and repo configs exist\n- Pass --provider gemini via CLI\n- Verify CLI takes precedence\n\n#### 4. Nested Object Merging\n- Global: llm.temperature=0.5\n- Repo: llm.max_tokens=1000\n- Verify both settings merged\n\n#### 5. Array Handling\n- Global: playbook_paths=[~/.cass/global.yaml]\n- Repo: playbook_paths=[./.cass/repo.yaml]\n- Verify arrays concatenated (or replaced per design)\n\n#### 6. Default Values\n- No configs exist\n- Verify sensible defaults applied\n- Verify no crashes\n\n### Verbose Logging\n- Log: 'Loading global config from ~/.cass/config.yaml'\n- Log: 'Global config: {summary}'\n- Log: 'Loading repo config from .cass/config.yaml'\n- Log: 'Repo config: {summary}'\n- Log: 'Merging configs...'\n- Log: 'Final config: {summary}'\n\n### Edge Cases\n- Config with env var references\n- Config with relative paths\n- Missing global config dir","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:24:53.693572-05:00","updated_at":"2025-12-08T01:22:33.547915-05:00","closed_at":"2025-12-08T01:22:33.547915-05:00","dependencies":[{"issue_id":"cass_memory_system-g7s7","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2025-12-07T20:31:26.101929-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-g7s7","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2025-12-07T20:31:26.207651-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-g7s7","depends_on_id":"cass_memory_system-p4mv","type":"blocks","created_at":"2025-12-07T20:31:26.326113-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-g7s7","depends_on_id":"cass_memory_system-70sd","type":"blocks","created_at":"2025-12-07T20:31:28.574614-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-g81j","title":"[CLI] stale command - Bullets without recent feedback","description":"Implements the 'cass-memory stale' command to find bullets without recent feedback.\n\nCOMMAND SYNTAX:\n```bash\ncass-memory stale [options]\n\nOptions:\n  --days N       Stale threshold in days (default: 90)\n  --scope SCOPE  Filter by scope (global, workspace, all)\n  --json         Output as JSON\n```\n\nPURPOSE:\nIdentifies bullets that haven't received helpful/harmful feedback in N days. Useful for cleanup sessions and understanding which rules are no longer actively applied.\n\nOUTPUT FORMAT (Terminal):\n```\nSTALE BULLETS (no feedback in 90+ days)\n========================================\n\nFound 12 stale bullets:\n\n1. [123 days] abc-123: Use jQuery for DOM manipulation\n   Category: Frontend | Scope: global | Score: 2.1\n   Last feedback: 2024-10-05 (marked helpful)\n\n2. [98 days] def-456: Deploy on Fridays for quiet rollout\n   Category: DevOps | Scope: workspace | Score: -0.5\n   Last feedback: 2024-10-28 (marked harmful)\n\n3. [91 days] ghi-789: Store passwords in config file\n   Category: Security | Scope: global | Score: -3.2\n   Last feedback: 2024-11-01 (marked harmful)\n\n...\n\nRECOMMENDATIONS:\n  • Review these bullets for relevance\n  • Consider deprecating outdated practices (e.g., #1)\n  • Use 'cass-memory forget' for harmful rules (e.g., #3)\n  • Update content if still relevant but needs refresh\n```\n\nIMPLEMENTATION REQUIREMENTS:\n\n1. Load playbook from storage\n2. Calculate days since last feedback for each bullet\n3. Filter bullets with days \u003e= threshold (default 90)\n4. Filter by scope if specified\n5. Sort by days descending (most stale first)\n6. Display with context\n\nSTALENESS CALCULATION:\n```typescript\nfunction calculateStaleness(bullet: Bullet): number | null {\n  const feedbackEvents = bullet.feedback || [];\n  if (feedbackEvents.length === 0) {\n    // Use creation date as baseline\n    return daysSince(bullet.createdAt);\n  }\n  \n  const lastFeedback = feedbackEvents\n    .sort((a, b) =\u003e b.timestamp - a.timestamp)[0];\n  \n  return daysSince(lastFeedback.timestamp);\n}\n```\n\nDISPLAYED INFORMATION:\n- Days since last feedback\n- Bullet ID and content preview\n- Category and scope\n- Current effective score\n- Last feedback action (helpful or harmful)\n- Last feedback date\n\nRECOMMENDATIONS:\nAuto-generate recommendations based on patterns:\n- Very stale + negative score → suggest forget\n- Very stale + outdated tech → suggest deprecate\n- Moderate stale + good score → suggest review\n- Many stale bullets → suggest cleanup session\n\nFILTERS:\n- --days: customize staleness threshold\n- --scope: global, workspace, or all\n- Exclude deprecated bullets by default\n\nJSON OUTPUT:\n```json\n{\n  \"threshold\": 90,\n  \"count\": 12,\n  \"bullets\": [\n    {\n      \"id\": \"abc-123\",\n      \"daysSinceLastFeedback\": 123,\n      \"content\": \"Use jQuery for DOM manipulation\",\n      \"category\": \"Frontend\",\n      \"scope\": \"global\",\n      \"score\": 2.1,\n      \"lastFeedback\": {\n        \"action\": \"helpful\",\n        \"timestamp\": \"2024-10-05T14:22:00Z\"\n      }\n    },\n    ...\n  ]\n}\n```\n\nUSE CASES:\n- Quarterly cleanup sessions\n- Finding outdated practices\n- Identifying unused rules\n- Playbook health maintenance\n\nEDGE CASES:\n- Bullet never had feedback → use creation date\n- All bullets are stale → show warning\n- No stale bullets → congratulate user\n- Very young playbook → adjust recommendations\n\nDEPENDENCIES:\n- Playbook loader\n- Date calculation utilities\n- Terminal formatting (chalk)\n- Recommendation engine\n\nSUCCESS CRITERIA:\n- Accurate staleness calculation\n- Clear identification of cleanup candidates\n- Helpful recommendations\n- Performance \u003c500ms for 1000+ bullets\n- Actionable output for maintenance","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:57:16.703248-05:00","updated_at":"2025-12-08T13:31:59.729619-05:00","closed_at":"2025-12-08T13:31:59.729619-05:00"}
{"id":"cass_memory_system-gadx","title":"Harden cassSearch parsing for noisy outputs","description":"","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-08T02:16:09.051633-05:00","updated_at":"2025-12-08T02:16:15.827929-05:00","closed_at":"2025-12-08T02:16:15.827929-05:00"}
{"id":"cass_memory_system-gcnq","title":"[CLI:reflect] processSession - Full pipeline for one session","description":"Process a single session through the full reflection pipeline.\n\nFunction signature:\n```typescript\nasync function processSession(\n  sessionPath: string,\n  playbook: Playbook,\n  config: Config\n): Promise\u003c{\n  diary: DiaryEntry;\n  deltas: PlaybookDelta[];\n  validated: PlaybookDelta[];\n}\u003e\n```\n\nImplementation pipeline:\n1. Generate or load diary entry:\n   - Check if diary already exists for session\n   - If not: call diary generator (via diary command)\n   - If exists: load from diary directory\n   \n2. Run reflector:\n   - Pass diary entry and current playbook\n   - Get back array of PlaybookDelta objects\n   - Deltas include: adds, removes, modifies\n   \n3. Run validator on 'add' deltas:\n   - Filter deltas where operation = 'add'\n   - For each add delta:\n     - Call validator to check scientific support\n     - Only keep deltas with confidence \u003e= threshold\n   - Skip validation for remove/modify (curator handles)\n   \n4. Return results:\n   - Original diary entry\n   - All deltas (unvalidated)\n   - Validated deltas (subset)\n\nError handling:\n- If diary generation fails: skip session, log error\n- If reflector fails: skip session, log error\n- If validator fails: include delta anyway (fail open)\n\nThe validated deltas are aggregated across all sessions and passed to batchCurate for final application.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:49:54.433367-05:00","updated_at":"2025-12-07T21:13:03.908423-05:00","closed_at":"2025-12-07T21:12:45.000402-05:00"}
{"id":"cass_memory_system-gp8","title":"[Reflector] shouldExitEarly - Determine if more iterations needed","description":"function shouldExitEarly(\n  iteration: number,\n  deltasThisIteration: number,\n  totalDeltas: number,\n  config: Config\n): boolean\n\nExit early if:\n- No new deltas this iteration\n- Already have max deltas (20)\n- Iteration \u003e= maxReflectorIterations\n\nSaves LLM calls when early iterations capture everything\n\nLOGIC:\n```typescript\nif (deltasThisIteration === 0) return true\nif (totalDeltas \u003e= 20) return true\nif (iteration \u003e= config.maxReflectorIterations - 1) return true\nreturn false\n```\n\nWHY EARLY EXIT:\n1. No new deltas: LLM has exhausted insights\n2. Max deltas (20): diminishing returns, avoid overwhelming playbook\n3. Max iterations: hard limit to prevent infinite loops\n\nEXAMPLE SCENARIOS:\n- Iteration 0: 15 deltas → continue\n- Iteration 1: 0 deltas → exit (total: 15)\n- Iteration 0: 12 deltas → continue\n- Iteration 1: 8 deltas → exit (total: 20, hit max)\n- Iteration 2: 3 deltas → continue\n- Iteration 3: 2 deltas → exit (hit maxReflectorIterations)\n\nCONFIG:\n- maxReflectorIterations: default 3\n- maxDeltas: hardcoded 20\n\nOPTIMIZATION:\nEarly exit saves unnecessary LLM calls and reduces latency\n\nUsed in reflectOnSession() main loop","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:03.662093-05:00","updated_at":"2025-12-07T20:07:53.57005-05:00","closed_at":"2025-12-07T20:07:08.932345-05:00"}
{"id":"cass_memory_system-gpc7","title":"[MCP:Future] playbook resource definition","description":"Define playbook resource for MCP:\n\n```typescript\n{\n  uri: \"memory://playbook\",\n  name: \"Playbook\",\n  description: \"Current playbook with all bullets\",\n  mimeType: \"application/json\"\n}\n```\n\nReturns full playbook as a resource that agents can access directly.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:49:34.042517-05:00","updated_at":"2025-12-07T21:53:28.282744-05:00","closed_at":"2025-12-07T21:50:28.900094-05:00"}
{"id":"cass_memory_system-gr56","title":"[CLI] audit command - Check for rule violations","description":"Scan recent sessions for playbook rule violations.\n\nCommand signature:\n```bash\ncass-memory audit [options]\n\nOptions:\n  --days N           Scan sessions from last N days (default: 7)\n  --workspace PATH   Filter by workspace\n  --json             Output as JSON\n```\n\nPurpose:\nProactively check if recent coding sessions violated established playbook rules. Helps catch regressions and reinforces good practices.\n\nImplementation flow:\n1. Load current playbook (active bullets only)\n2. Get recent sessions:\n   - Call `cass timeline --days N --json`\n   - Filter by workspace if specified\n   \n3. Scan each session for violations:\n   - For each session:\n     - Export/summarize session content\n     - For each playbook bullet:\n       - LLM check: did this session violate this rule?\n       - If yes: record violation with evidence\n   \n4. Aggregate violations:\n   - Group by severity (derived from bullet maturity)\n   - Sort by session timestamp\n   \n5. Format and display:\n   - If --json: output AuditResult as JSON\n   - Else: format human-readable report\n   - Include actionable recommendations\n\nExample output:\n```\nAUDIT RESULTS (scanned 15 sessions)\n\nVIOLATIONS FOUND: 2\n\n1. [HIGH] Rule b-abc123: \"Always run tests before committing\"\n   Session: ~/.claude/.../session-001.jsonl\n   Evidence: Commit made without test run visible\n\n2. [MEDIUM] Rule b-def456: \"Use TypeScript strict mode\"\n   Session: ~/.cursor/.../session-xyz\n   Evidence: tsconfig.json has strict: false\n```\n\nThis helps maintain playbook adherence over time.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:50:59.73258-05:00","updated_at":"2025-12-07T21:13:03.909106-05:00","closed_at":"2025-12-07T21:12:30.958668-05:00"}
{"id":"cass_memory_system-gssx","title":"[Semantic] warmupEmbeddings - Pre-load model on init","description":"Pre-load embedding model during initialization for better UX.\n\nImplementation:\n```typescript\nasync function warmupEmbeddings(): Promise\u003cboolean\u003e {\n  try {\n    console.log(\"Warming up embedding model...\");\n    const embed = await getEmbedder();\n    \n    // Run test embedding to fully load model\n    await embed(\"test\", { pooling: \"mean\", normalize: true });\n    \n    console.log(\"Embedding model ready\");\n    return true;\n  } catch (error) {\n    console.warn(\"Could not warm up embeddings:\", error.message);\n    return false;\n  }\n}\n```\n\nWhy warm up:\n- First embedding is slow (~500ms model load)\n- Subsequent embeddings are fast (~3ms)\n- Better UX to load during init than during first query\n\nWhen to warm up:\n- During cass-memory init\n- Background async (non-blocking)\n- Before first context/stats command\n- After config change\n\nPerformance:\n- Warmup time: ~500ms (first time)\n- Warmup time: ~50ms (cached model)\n- Benefit: First query is instant\n\nUsage in CLI:\n```typescript\n// In main.ts\nasync function init() {\n  const config = await loadConfig();\n  \n  if (config.semanticSearchEnabled) {\n    // Do not await - let it warm up in background\n    warmupEmbeddings().catch(() =\u003e {\n      config.semanticSearchEnabled = false;\n    });\n  }\n}\n```\n\nAlternative: Lazy warmup\n- Do not warm up on init\n- Warm up on first semantic operation\n- Trade-off: Slower first command, faster startup\n\nConfig option:\n```yaml\nsemantic:\n  warmupOnInit: true  # Pre-load model\n  # vs\n  warmupOnInit: false  # Lazy load on first use\n```","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-07T16:49:49.949535-05:00","updated_at":"2025-12-07T17:14:55.881019-05:00","comments":[{"id":15,"issue_id":"cass_memory_system-gssx","author":"jemanuel","text":"Pre-load embedding model during initialization for better UX.\n\nImplementation:\n```typescript\nasync function warmupEmbeddings(): Promise\u003cboolean\u003e {\n  try {\n    console.log(\"Warming up embedding model...\");\n    const embed = await getEmbedder();\n    \n    // Run test embedding to fully load model\n    await embed(\"test\", { pooling: \"mean\", normalize: true });\n    \n    console.log(\"Embedding model ready\");\n    return true;\n  } catch (error) {\n    console.warn(\"Could not warm up embeddings:\", error.message);\n    return false;\n  }\n}\n```\n\nWhy warm up:\n- First embedding is slow (~500ms model load)\n- Subsequent embeddings are fast (~3ms)\n- Better UX to load during init than during first query\n\nWhen to warm up:\n- During cass-memory init\n- Background async (non-blocking)\n- Before first context/stats command\n- After config change\n\nPerformance:\n- Warmup time: ~500ms (first time)\n- Warmup time: ~50ms (cached model)\n- Benefit: First query is instant\n\nUsage in CLI:\n```typescript\n// In main.ts\nasync function init() {\n  const config = await loadConfig();\n  \n  if (config.semanticSearchEnabled) {\n    // Don't await - let it warm up in background\n    warmupEmbeddings().catch(() =\u003e {\n      config.semanticSearchEnabled = false;\n    });\n  }\n}\n```\n\nAlternative: Lazy warmup\n- Don't warm up on init\n- Warm up on first semantic operation\n- Trade-off: Slower first command, faster startup\n\nConfig option:\n```yaml\nsemantic:\n  warmupOnInit: true  # Pre-load model\n  # vs\n  warmupOnInit: false  # Lazy load on first use\n```","created_at":"2025-12-07T23:15:50Z"},{"id":16,"issue_id":"cass_memory_system-gssx","author":"jemanuel","text":"Pre-load embedding model during initialization for better UX.\n\nImplementation:\n```typescript\nasync function warmupEmbeddings(): Promise\u003cboolean\u003e {\n  try {\n    console.log(\"Warming up embedding model...\");\n    const embed = await getEmbedder();\n    \n    // Run test embedding to fully load model\n    await embed(\"test\", { pooling: \"mean\", normalize: true });\n    \n    console.log(\"Embedding model ready\");\n    return true;\n  } catch (error) {\n    console.warn(\"Could not warm up embeddings:\", error.message);\n    return false;\n  }\n}\n```\n\nWhy warm up:\n- First embedding is slow (~500ms model load)\n- Subsequent embeddings are fast (~3ms)\n- Better UX to load during init than during first query\n\nWhen to warm up:\n- During cm init\n- Background async (non-blocking)\n- Before first context/stats command\n- After config change\n\nPerformance:\n- Warmup time: ~500ms (first time)\n- Warmup time: ~50ms (cached model)\n- Benefit: First query is instant\n\nUsage in CLI:\n```typescript\n// In main.ts\nasync function init() {\n  const config = await loadConfig();\n  \n  if (config.semanticSearchEnabled) {\n    // Don't await - let it warm up in background\n    warmupEmbeddings().catch(() =\u003e {\n      config.semanticSearchEnabled = false;\n    });\n  }\n}\n```\n\nAlternative: Lazy warmup\n- Don't warm up on init\n- Warm up on first semantic operation\n- Trade-off: Slower first command, faster startup\n\nConfig option:\n```yaml\nsemantic:\n  warmupOnInit: true  # Pre-load model\n  # vs\n  warmupOnInit: false  # Lazy load on first use\n```","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-gwr","title":"[Validator] EvidenceGateResult type definition","description":"Define the EvidenceGateResult type for pre-LLM filter results.\n\nTypeScript Interface:\n```typescript\ninterface EvidenceGateResult {\n  passed: boolean;           // Whether the rule passes the evidence gate\n  reason: string;            // Human-readable explanation\n  suggestedState: \"draft\" | \"active\";  // Recommended lifecycle state\n  sessionCount: number;      // Number of unique sessions containing evidence\n  successCount: number;      // Sessions that ended successfully\n  failureCount: number;      // Sessions that failed\n}\n```\n\nWHY THIS MATTERS:\n- Pre-LLM filter result - cheap check before expensive LLM call\n- Provides transparency into validation decision-making\n- Includes correlation data from diary entries\n- Guides lifecycle state assignment (draft vs active)\n\nUSAGE:\n- Returned by evidenceCountGate() function\n- Consumed by validateDelta() to determine next steps\n- Used in validation reports for audit trail\n\nDEPENDENCIES:\n- None (pure type definition)\n\nLOCATION:\n- src/types/validator.ts (or similar)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:44:50.603554-05:00","updated_at":"2025-12-07T20:53:50.973642-05:00","closed_at":"2025-12-07T20:53:26.100437-05:00"}
{"id":"cass_memory_system-gyur","title":"[Semantic] embedText - Generate embedding vector","description":"Generate 384-dimensional embedding vector from text.\n\nImplementation:\n```typescript\nasync function embedText(text: string): Promise\u003cnumber[]\u003e {\n  const embed = await getEmbedder();\n  const result = await embed(text, {\n    pooling: \"mean\",      // Average all token embeddings\n    normalize: true        // Unit vector for cosine similarity\n  });\n  return Array.from(result.data);  // Float32Array → number[]\n}\n```\n\nInput:\n- Any text string (bullet content, task description, etc.)\n- Automatically tokenized and truncated if too long\n- Max tokens: 512 (model limit)\n\nOutput:\n- 384-dimensional number array\n- Normalized to unit vector (L2 norm = 1)\n- Values typically in [-1, 1]\n\nPerformance:\n- ~3ms per embedding (after model load)\n- Can batch for efficiency\n\nUse cases:\n- Bullet content embedding\n- Task query embedding\n- Semantic search\n- Duplicate detection","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-07T16:49:28.793899-05:00","updated_at":"2025-12-07T17:14:57.309122-05:00","comments":[{"id":17,"issue_id":"cass_memory_system-gyur","author":"jemanuel","text":"Generate 384-dimensional embedding vector from text.\n\nImplementation:\n```typescript\nasync function embedText(text: string): Promise\u003cnumber[]\u003e {\n  const embed = await getEmbedder();\n  const result = await embed(text, {\n    pooling: \"mean\",      // Average all token embeddings\n    normalize: true        // Unit vector for cosine similarity\n  });\n  return Array.from(result.data);  // Float32Array → number[]\n}\n```\n\nInput:\n- Any text string (bullet content, task description, etc.)\n- Automatically tokenized and truncated if too long\n- Max tokens: 512 (model limit)\n\nOutput:\n- 384-dimensional number array\n- Normalized to unit vector (L2 norm = 1)\n- Values typically in [-1, 1]\n\nPerformance:\n- ~3ms per embedding (after model load)\n- Can batch for efficiency\n\nUse cases:\n- Bullet content embedding\n- Task query embedding\n- Semantic search\n- Duplicate detection","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-h2ol","title":"Fix Race Condition in Reflect Command \u0026 Context Awareness","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T22:02:35.99835-05:00","updated_at":"2025-12-07T22:03:40.433754-05:00","closed_at":"2025-12-07T22:03:40.433754-05:00"}
{"id":"cass_memory_system-h4zk","title":"[Testing:Unit] curator.test.ts - Deterministic curation tests","description":"Test cases:\n- handleAddDelta: adds new, skips duplicates\n- handleHelpfulDelta: records event, checks promotion\n- handleHarmfulDelta: records event with reason\n- detectConflicts: finds contradictory rules\n- invertToAntiPattern: correct transformation\n- autoInvertHarmfulBullets: threshold-based inversion","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:35.79888-05:00","updated_at":"2025-12-08T12:48:28.816285-05:00","closed_at":"2025-12-08T12:48:28.816285-05:00"}
{"id":"cass_memory_system-hbjv","title":"[Testing:Property] deduplication.test.ts - Property-based tests","description":"Using fast-check:\nimport fc from \"fast-check\";\n\n// Properties:\n// - jaccardSimilarity is symmetric\n// - jaccardSimilarity returns [0, 1]\n// - identical strings have similarity 1.0\n// - hashContent is deterministic\n// - different content produces different hashes (usually)\n// - exact duplicates are always detected","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:47.303349-05:00","updated_at":"2025-12-08T12:52:09.483066-05:00","closed_at":"2025-12-08T12:52:09.483066-05:00"}
{"id":"cass_memory_system-hfi","title":"[Cass] withCassErrorRecovery - Generic error recovery wrapper","description":"Implement withCassErrorRecovery() generic wrapper for consistent error handling.\n\n## Signature\n```typescript\nasync function withCassErrorRecovery\u003cT\u003e(\n  operation: () =\u003e Promise\u003cT\u003e,\n  fallback: T,\n  options?: { \n    maxRetries?: number; \n    rebuildIndexOnError?: boolean;\n  }\n): Promise\u003cT\u003e\n```\n\n## Implementation Flow\n1. Try operation\n2. On error, check exit code against CASS_EXIT_CODES\n3. If retryable and has recovery action, attempt recovery:\n   - Exit 3: Rebuild index, retry operation\n   - Exit 10: Modify operation params (caller responsibility), retry\n4. If max retries exhausted or non-retryable, return fallback\n5. Log all recovery attempts\n\n## Error Handling Strategy\n```typescript\nlet attempts = 0;\nconst maxRetries = options?.maxRetries || 1;\n\nwhile (attempts \u003c= maxRetries) {\n  try {\n    return await operation();\n  } catch (error) {\n    const exitCode = extractExitCode(error);\n    const codeInfo = CASS_EXIT_CODES[exitCode];\n    \n    if (!codeInfo?.retryable || attempts \u003e= maxRetries) {\n      log.debug(\"Non-retryable or max retries, returning fallback\");\n      return fallback;\n    }\n    \n    // Attempt recovery\n    if (codeInfo.action === \"rebuild_index\" \u0026\u0026 options?.rebuildIndexOnError) {\n      await cassIndex({ full: true });\n    }\n    \n    attempts++;\n  }\n}\n\nreturn fallback;\n```\n\n## Parameters\n- operation: Async function to wrap\n- fallback: Value to return on failure\n- options.maxRetries: Max retry attempts (default: 1)\n- options.rebuildIndexOnError: Auto-rebuild on exit 3 (default: false)\n\n## Usage\nDRY wrapper for consistent error handling:\n```typescript\n// Simple usage\nconst hits = await withCassErrorRecovery(\n  () =\u003e cassSearch(\"query\"),\n  [],\n  { rebuildIndexOnError: true }\n);\n\n// Complex usage\nconst result = await withCassErrorRecovery(\n  async () =\u003e {\n    const timeline = await cassTimeline(7);\n    return processTimeline(timeline);\n  },\n  { groups: [] },\n  { maxRetries: 2 }\n);\n```\n\n## Benefits\n- Centralized retry logic\n- Consistent error handling across all cass operations\n- Automatic recovery actions based on exit codes\n- Reduces boilerplate in wrapper functions","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:05.553389-05:00","updated_at":"2025-12-07T18:48:03.203271-05:00","closed_at":"2025-12-07T18:48:01.860783-05:00"}
{"id":"cass_memory_system-hg12","title":"[Design] README Structure for Agent-First Framing","description":"# README Structure for Agent-First Framing\n\n## Purpose\nDesign the new structure for README.md that clearly separates concerns:\n- Agents are primary users (consumers of memory)\n- Humans are operators (setup, monitoring, oversight)\n\n## Proposed Structure\n\n### Section 1: What This Is (~10% of doc)\n- Tagline: \"Universal memory system FOR AI coding agents\"\n- The problem (agents forget everything)\n- The solution (three-layer architecture)\n- Key insight: Agents consume, humans operate\n\n### Section 2: Quick Start - For Humans (~15%)\n- Installation (one-liners)\n- Add blurb to AGENTS.md (point to blurb section)\n- Basic health check\n- That's it - you're done\n\n### Section 3: For Agents - How to Use Memory (~20%)\n- The protocol (START: context, WORK: reference rules, END: automatic)\n- Essential command reference (context, mark)\n- Output schemas\n- Error handling\n\n### Section 4: For Humans - Operation \u0026 Monitoring (~15%)\n- Configuration options\n- Running reflection (manual or cron)\n- Stats and health monitoring\n- Audit and review tools\n\n### Section 5: Architecture (~20%)\n- Three-layer memory model\n- ACE pipeline\n- Scoring and decay\n- Data models\n\n### Section 6: Advanced (~10%)\n- MCP server mode\n- Custom starters\n- Extending the system\n\n### Section 7: Reference (~10%)\n- All commands (comprehensive)\n- Configuration schema\n- Troubleshooting\n\n## Key Changes from Current\n\n1. Remove \"Typical Workflow\" section showing humans running commands\n2. Remove \"Individual developers\" and \"Power users\" as audiences\n3. Move human commands (init, reflect, playbook add) to operator section\n4. Simplify agent section to essential commands only\n5. Add explicit blurb section\n\n## Deliverables\n- [ ] Detailed outline with section headers\n- [ ] Content migration plan (what moves where)\n- [ ] List of sections to remove/merge","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T12:46:33.025719-05:00","updated_at":"2025-12-08T13:13:28.19971-05:00","closed_at":"2025-12-08T13:13:28.19971-05:00","dependencies":[{"issue_id":"cass_memory_system-hg12","depends_on_id":"cass_memory_system-2bnu","type":"blocks","created_at":"2025-12-08T12:48:44.523831-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-hg12","depends_on_id":"cass_memory_system-ajkn","type":"blocks","created_at":"2025-12-08T12:48:44.594023-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-hh3","title":"[Curator] handleHelpfulDelta - Record positive feedback","description":"Record positive feedback and check for maturity promotions.\n\nSignature:\nfunction handleHelpfulDelta(\n  playbook: Playbook,\n  delta: HelpfulDelta\n): { applied: boolean; promotion?: PromotionReport }\n\nProcess:\n1. Find bullet by ID\n   - If not found: return applied: false\n2. Create FeedbackEvent:\n   - timestamp: Date.now()\n   - sessionId: delta.sessionId\n   - context: delta.context (optional)\n3. Push to bullet.helpfulEvents array\n4. Increment bullet.helpfulCount\n5. Update bullet.lastValidatedAt to current timestamp\n6. Update bullet.updatedAt\n7. Check for promotion eligibility:\n   - candidate → validated: helpfulCount \u003e= 3 \u0026\u0026 effectiveScore \u003e= 2\n   - validated → trusted: helpfulCount \u003e= 10 \u0026\u0026 effectiveScore \u003e= 8\n   - trusted → core: helpfulCount \u003e= 25 \u0026\u0026 effectiveScore \u003e= 20\n8. If promoted:\n   - Update bullet.maturity\n   - Create PromotionReport\n   - Add to result.promotions\n9. Return result\n\nPromotion thresholds enforce evidence-based trust. Bullets must prove value over time.\n\nNote: effectiveScore = helpfulCount - harmfulCount","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:44:57.952849-05:00","updated_at":"2025-12-07T21:14:16.243068-05:00","closed_at":"2025-12-07T21:14:08.88418-05:00"}
{"id":"cass_memory_system-hhrv","title":"[Critical] Undo/Rollback - Revert Bad Curation Decisions","description":"$(cat /tmp/fix_hhrv.txt)","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T17:08:19.546516-05:00","updated_at":"2025-12-08T14:20:28.212147-05:00","closed_at":"2025-12-08T14:20:28.212147-05:00"}
{"id":"cass_memory_system-hir","title":"[Generator] generateSearchPlan - LLM query generation","description":"LLM-powered query generation for cass searches.\n\nSIGNATURE:\nasync function generateSearchPlan(task: string, config: Config): Promise\u003c{ queries: string[]; keywords: string[] }\u003e\n\nPURPOSE:\nUses LLM to analyze the task and generate targeted search queries for cass, plus keywords for playbook bullet matching. This ensures we find the most relevant historical context.\n\nOUTPUT:\n- queries: 3-5 targeted cass search strings\n- keywords: List of important terms for bullet scoring\n\nEXAMPLE:\nTask: 'Fix authentication timeout bug'\nOutput:\n  queries: ['authentication timeout', 'token expiry', 'session timeout fix']\n  keywords: ['authentication', 'timeout', 'token', 'session', 'jwt']\n\nIMPLEMENTATION NOTES:\n- Uses config.llmProvider and config.llmModel\n- Prompt should emphasize: specific technical terms, error patterns, component names\n- Fallback to extractKeywords (simple regex) if LLM unavailable\n- Cache queries if same task seen recently (optional optimization)\n\nPROMPT STRUCTURE:\nGiven task: {task}\nGenerate 3-5 search queries that would find relevant past work on:\n- Similar problems solved\n- Related error patterns\n- Component/domain mentions\nAlso extract key technical terms as keywords.\n\nLLM CONFIG:\n- Temperature: 0.3 (focused, deterministic)\n- Max tokens: 200 (short structured output)\n- Format: JSON { queries: [], keywords: [] }","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:53.078843-05:00","updated_at":"2025-12-07T18:59:44.043808-05:00","closed_at":"2025-12-07T18:59:33.684502-05:00"}
{"id":"cass_memory_system-hpv6","title":"E2E test: 'cass stats' command","description":"E2E test for 'cass stats' CLI command:\n- Real subprocess execution via bun\n- Test stats output with various playbook states\n- Verify bullet counts by category, maturity, state\n- Verify feedback statistics accuracy\n- Test --json output format\n- Test error cases: empty playbook, missing playbook\n- Detailed logging: expected vs actual stats\nSetup: fixture directory with playbook containing known statistics","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:27:16.992897-05:00","updated_at":"2025-12-08T14:04:05.812027-05:00","closed_at":"2025-12-08T14:04:05.812027-05:00","dependencies":[{"issue_id":"cass_memory_system-hpv6","depends_on_id":"cass_memory_system-8dxr","type":"blocks","created_at":"2025-12-07T20:28:33.708444-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-hpzx","title":"[CLI:doctor] checkStorage - Verify storage health","description":"Implements the checkStorage function that verifies storage health and configuration.\n\nFUNCTION SIGNATURE:\n```typescript\nasync function checkStorage(config: Config): Promise\u003cHealthCheck[]\u003e\n```\n\nCHECKS PERFORMED:\n\n1. DATA DIRECTORY:\n   - Check if data directory exists\n   - Verify write permissions\n   - Test by creating temp file\n   - Status: FAIL if missing/unwritable, PASS otherwise\n   - Fixable: Create directory if missing\n\n2. DISK SPACE:\n   - Check available disk space at data directory\n   - Warn if \u003c100MB available\n   - Fail if \u003c10MB (critical)\n   - Status: WARN or FAIL based on threshold\n   - Not fixable (user must free space)\n\n3. PLAYBOOK FILE:\n   - Check if playbook.json exists\n   - Validate JSON structure\n   - Test loading and parsing\n   - Check for corruption (malformed JSON)\n   - Status: WARN if missing (will create), FAIL if corrupted\n   - Fixable: Create empty playbook if missing\n\n4. DIARY:\n   - Check if diary directory exists\n   - Count diary entries\n   - Calculate total size\n   - Report statistics\n   - Status: PASS or WARN (info only)\n\n5. EMBEDDING CACHE:\n   - Check if cache directory exists\n   - Check cache size and entry count\n   - Warn if cache very large (\u003e1GB)\n   - Report hit/miss ratio if available\n   - Status: PASS or WARN (info only)\n\nIMPLEMENTATION APPROACH:\n- Check data directory exists and is writable\n- Measure available disk space with threshold checks\n- Validate playbook JSON structure and integrity\n- Count diary entries and calculate storage usage\n- Check embedding cache status and size\n\nERROR HANDLING:\n- Handle missing directories gracefully\n- Distinguish ENOENT vs EACCES vs corruption\n- Timeout on slow disk operations (10s max)\n- Provide specific error messages\n\nDEPENDENCIES:\n- fs/promises (file operations)\n- diskSpace or df (disk space check)\n- Config system\n- Path utilities\n\nSUCCESS CRITERIA:\n- Accurately detects all storage issues\n- Write test doesn't leave artifacts\n- Corruption detection reliable\n- Performance: all checks \u003c1 second\n- Auto-fix safe (doesn't overwrite existing data)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:55:27.661082-05:00","updated_at":"2025-12-07T20:22:21.026147-05:00","closed_at":"2025-12-07T20:21:59.90091-05:00"}
{"id":"cass_memory_system-hs01","title":"[Config] mergePlaybooks - Combine two playbooks","description":"Function signature:\n```typescript\nfunction mergePlaybooks(\n  base: Playbook,\n  overlay: Playbook | null,\n  options: {\n    conflictResolution: 'overlay-wins' | 'base-wins';\n    deduplication: 'by-id' | 'by-content-similarity';\n  }\n): Playbook\n```\n\nAlgorithm:\n1. If overlay is null, return base unchanged\n2. Merge bullets arrays:\n   - Create map by bullet ID\n   - Apply conflict resolution for duplicate IDs\n   - If deduplication by content-similarity, check semantic similarity (\u003e0.9)\n3. Merge deprecated patterns arrays (union)\n4. Merge metadata:\n   - totalUsageCount: sum both counts\n   - lastUsed: max of both timestamps\n\nDeduplication strategies:\n- by-id: Only merge bullets with same ID\n- by-content-similarity: Also dedupe semantically similar bullets (embedding cosine \u003e0.9)\n\nUsed by loadMergedPlaybook to combine global + repo playbooks.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:50:13.803147-05:00","updated_at":"2025-12-07T20:26:00.905876-05:00","closed_at":"2025-12-07T20:25:32.309665-05:00"}
{"id":"cass_memory_system-htps","title":"[E2E Tests] CLI playbook commands - list, add, remove","description":"## E2E Test: CLI playbook Commands - List, Add, Remove\n\n### Test Scenario\nTest playbook management CLI commands\n\n### Test Steps\n\n#### 1. List Bullets\n- Create playbook with 5 bullets\n- Run `cm playbook list`\n- Verify all bullets displayed\n- Verify confidence scores shown\n- Test `--format json` output\n\n#### 2. Add Bullet Manually\n- Run `cm playbook add \"Always use TypeScript strict mode\"`\n- Verify bullet added to playbook\n- Verify default confidence (0.5)\n- Run `cm playbook add --confidence 0.8 \"Use bun test\"`\n- Verify custom confidence applied\n\n#### 3. Remove Bullet\n- Run `cm playbook remove \"content to remove\"`\n- Verify bullet removed from playbook\n- Verify other bullets unchanged\n- Test fuzzy matching for removal\n\n#### 4. Playbook Export\n- Run `cm playbook export --format markdown`\n- Verify readable markdown output\n- Run `cm playbook export --format yaml`\n- Verify valid YAML output\n\n#### 5. Playbook Stats\n- Run `cm playbook stats`\n- Verify bullet count shown\n- Verify average confidence shown\n- Verify scope distribution shown\n\n### Verbose Logging\n- Log: 'Loading playbook from \u003cpath\u003e'\n- Log: 'Playbook contains N bullets'\n- Log: 'Adding bullet: \u003ccontent\u003e'\n- Log: 'Removing bullet: \u003ccontent\u003e'\n- Log: 'Saving playbook to \u003cpath\u003e'\n\n### Error Cases\n- Remove non-existent bullet\n- Add duplicate bullet (warn or skip)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:24:41.006823-05:00","updated_at":"2025-12-08T01:21:38.378314-05:00","closed_at":"2025-12-08T01:21:38.378314-05:00","dependencies":[{"issue_id":"cass_memory_system-htps","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2025-12-07T20:31:25.624984-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-htps","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2025-12-07T20:31:25.747225-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-htps","depends_on_id":"cass_memory_system-33w3","type":"blocks","created_at":"2025-12-07T20:31:30.235476-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-huos","title":"[Test] Fixtures: Sample playbook YAML files","description":"Create test/fixtures/playbooks/ with:\n\n1. empty-playbook.yaml - No bullets, just structure\n2. minimal-playbook.yaml - 1-2 simple bullets\n3. complex-playbook.yaml - 10+ bullets with all field types\n4. workspace-scoped.yaml - Bullets with workspace scope\n5. deprecated-patterns.yaml - Playbook with deprecated patterns\n6. feedback-heavy.yaml - Bullets with many feedback events\n\nEach fixture should:\n- Be valid against PlaybookSchema\n- Have realistic content (not lorem ipsum)\n- Cover edge cases for that scenario\n- Include inline comments explaining purpose\n\nExample:\n\\`\\`\\`yaml\n# test/fixtures/playbooks/minimal-playbook.yaml\n# Purpose: Test basic playbook loading with minimal data\nschema_version: 2\nname: minimal-test\nbullets:\n  - id: b-test-001\n    category: testing\n    content: Always run tests before committing changes\n    # ... rest of required fields\n\\`\\`\\`","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:22:16.110589-05:00","updated_at":"2025-12-07T21:13:03.911932-05:00","closed_at":"2025-12-07T21:12:43.944156-05:00"}
{"id":"cass_memory_system-hw7","title":"[Curator] curatePlaybook - Main deterministic merge function","description":"Implement the main deterministic playbook curation function. This is the ACE core - NO LLM calls allowed.\n\nSignature:\nfunction curatePlaybook(\n  playbook: Playbook,\n  deltas: PlaybookDelta[],\n  config: { dedupThreshold: number; pruneThreshold: number; toxicLog?: ToxicEntry[] }\n): CurationResult\n\nHigh-level algorithm:\n1. Build hash cache from existing bullets (buildHashCache)\n2. Initialize result tracking (applied, skipped, conflicts, etc.)\n3. Process each delta by type:\n   - AddDelta → handleAddDelta\n   - HelpfulDelta → handleHelpfulDelta\n   - HarmfulDelta → handleHarmfulDelta\n   - ReplaceDelta → handleReplaceDelta\n   - DeprecateDelta → handleDeprecateDelta\n   - MergeDelta → handleMergeDelta\n4. Post-processing phase:\n   - Auto-invert harmful bullets (autoInvertHarmfulBullets)\n   - Check for maturity transitions (checkPromotions)\n   - Prune deprecated bullets (pruneDeprecated)\n5. Return comprehensive CurationResult\n\nCRITICAL: This function is DETERMINISTIC. Same inputs = same outputs. No AI inference, no randomness.\n\nThis prevents context collapse by ensuring playbook evolution is transparent and reproducible.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:44:55.303034-05:00","updated_at":"2025-12-07T21:14:16.244959-05:00","closed_at":"2025-12-07T21:14:07.584212-05:00"}
{"id":"cass_memory_system-hyho","title":"[CLI] context command - Pre-task hydration","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:51:34.968114-05:00","updated_at":"2025-12-07T20:18:30.006609-05:00","closed_at":"2025-12-07T20:18:17.644857-05:00"}
{"id":"cass_memory_system-hzxr","title":"[Config] loadMergedConfig - Combine global + repo config","description":"Function signature:\n```typescript\nasync function loadMergedConfig(): Promise\u003cConfig\u003e\n```\n\nSteps:\n1. Load global config (~/.cass-memory/config.json)\n2. Load repo config (./.cass/config.yaml) - may not exist\n3. Deep merge (repo overrides global for same keys)\n4. Validate with ConfigSchema\n5. Return merged config\n\nDeep merge strategy:\n- Primitive values: repo overrides global\n- Objects: recursively merge keys\n- Arrays: repo replaces entire array (no element merging)\n\nExample:\nGlobal: { llm: { provider: 'anthropic', model: 'opus' }, maxTokens: 4000 }\nRepo: { llm: { model: 'sonnet' } }\nResult: { llm: { provider: 'anthropic', model: 'sonnet' }, maxTokens: 4000 }\n\nValidation ensures merged config conforms to ConfigSchema before returning.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:49:47.020793-05:00","updated_at":"2025-12-07T21:01:15.48289-05:00","closed_at":"2025-12-07T21:01:06.082139-05:00"}
{"id":"cass_memory_system-i45e","title":"[Epic] Agent-First Architecture Transformation","description":"# Agent-First Architecture Transformation\n\n## Background \u0026 Motivation\n\ncass-memory was designed as a persistent memory system for AI coding agents, but the current documentation and UX are framed as if **humans** are the primary users running `cm` commands. This is fundamentally backwards.\n\n**The reality:**\n- AI agents (Claude Code, Codex, Cursor, etc.) are the PRIMARY CONSUMERS of the memory system\n- Humans are OPERATORS who set up, configure, and monitor the system\n- Agents should make ALL determinations about what/how to add things to memory\n\n**Current problems:**\n1. README shows humans running `cm context \"task\"` → agents should get this automatically\n2. Workflow requires humans to run `cm mark` → agents should provide feedback inline\n3. Reflection is presented as a manual periodic task → should be automated via hooks\n4. Documentation is verbose and human-oriented → agents need minimal, LLM-native output\n\n## Vision: What Makes Agents Actually Use This\n\nFrom the perspective of an AI coding agent, the system must be:\n\n1. **Zero-friction**: ONE command to get value: `cm context \"my task\"`\n2. **Automatic learning**: Sessions are processed without explicit commands\n3. **Trivial feedback**: Inline comments like `[cass: helpful b-xyz]` not separate commands\n4. **LLM-native output**: Compact JSON, not walls of ASCII art\n\n## Target Workflow\n\n**Human does once:**\n1. Install cass-memory\n2. Add blurb to AGENTS.md  \n3. Configure hooks for automation\n\n**Agent does every session:**\n1. Runs `cm context \"\u003ctask\u003e\" --json` (or gets injected context)\n2. Works normally, optionally drops inline feedback\n3. Session ends → hooks handle reflection automatically\n\n## Success Criteria\n\n- An agent reading only the AGENTS.md blurb knows exactly how to use cass-memory\n- The most common agent workflow requires exactly ONE command\n- Post-session learning happens without agent intervention\n- README clearly separates \"For Humans (Setup)\" from \"For Agents (Usage)\"","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-08T12:45:39.741395-05:00","updated_at":"2025-12-08T13:22:37.140638-05:00","closed_at":"2025-12-08T13:22:37.140638-05:00"}
{"id":"cass_memory_system-i57c","title":"[Critical] Starter Playbooks - Pre-built Rules for Common Stacks","description":"$(cat /tmp/fix_i57c.txt)","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T17:08:18.216525-05:00","updated_at":"2025-12-08T13:53:15.087152-05:00","closed_at":"2025-12-08T13:53:15.087152-05:00"}
{"id":"cass_memory_system-i73","title":"[Generator] contextWithoutCass - Graceful degradation","description":"Graceful degradation when cass is unavailable - provide playbook-only context.\n\nSIGNATURE:\nasync function contextWithoutCass(task: string, config: Config): Promise\u003cContextResult\u003e\n\nPURPOSE:\nWhen cass binary is not found or cass searches fail, still provide useful context from the playbook alone. The system remains functional even without historical data.\n\nFLOW:\n1. Log warning: 'cass unavailable - providing playbook context only'\n2. Extract keywords from task using extractKeywords (simple regex, no LLM)\n3. Score bullets using keywords\n4. Separate anti-patterns\n5. Build ContextResult with:\n   - relevantBullets (from playbook)\n   - antiPatterns (from playbook)\n   - historySnippets: [] (empty)\n   - deprecatedWarnings: [] (can't check without history)\n   - suggestedCassQueries: [] (no point suggesting if cass unavailable)\n6. Add warning to result: 'Context generated without historical data'\n\nKEYWORD EXTRACTION (NO LLM):\nfunction extractKeywords(task: string): string[] {\n  // Simple heuristic:\n  // 1. Lowercase and split on whitespace\n  // 2. Remove stop words (the, a, is, etc)\n  // 3. Extract technical terms (camelCase, snake_case, etc)\n  // 4. Return unique terms\n}\n\nDEGRADATION LEVELS:\n1. Full: LLM queries + cass history + playbook\n2. No LLM: Simple keywords + cass history + playbook\n3. No cass: LLM queries + playbook only (NOT IMPLEMENTED)\n4. No cass, no LLM: Simple keywords + playbook only (THIS FUNCTION)\n\nSTILL USEFUL BECAUSE:\n- Playbook contains learned patterns from past work\n- Scoring by keyword relevance still surfaces useful rules\n- Anti-patterns still prevent common mistakes\n- Better than nothing!\n\nERROR HANDLING:\n- Don't throw errors - this IS the error handler\n- If playbook also unavailable, return minimal result:\n  { task, relevantBullets: [], antiPatterns: [], historySnippets: [], deprecatedWarnings: [], suggestedCassQueries: [] }\n\nLOGGING:\n- console.warn level (not error)\n- Message: 'cass unavailable - showing playbook only'\n- Include reason if known (binary not found vs search failed)\n\nUSE CASE:\n- Fresh install before cass is set up\n- CI environment without session history\n- Corrupted cass index\n- User working offline","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:02.102425-05:00","updated_at":"2025-12-07T20:06:29.95556-05:00","closed_at":"2025-12-07T20:05:18.929182-05:00"}
{"id":"cass_memory_system-ia2","title":"[Cass] cassExport - Export session content","description":"Implement cassExport() to export session content in various formats.\n\n## Signature\n```typescript\nasync function cassExport(\n  sessionPath: string, \n  format: \"markdown\" | \"json\" | \"text\" = \"markdown\",\n  cassPath = \"cass\"\n): Promise\u003cstring | null\u003e\n```\n\n## CLI Command\n`cass export \"{sessionPath}\" --format {format}`\n\n## Implementation\n- Use execFile() with maxBuffer: 50MB for large sessions\n- Return raw output string\n- Return null on error\n\n## Error Handling\n- Return null if session not found (exit 4)\n- Return null if export fails\n- Log error details at debug level\n- No retries (export is deterministic)\n\n## Format Options\n- markdown: Claude-style markdown with headers and formatting\n- json: Raw JSON session structure\n- text: Plain text concatenation of messages\n\n## Usage\nPrimary use case is diary generation:\n```typescript\nconst content = await cassExport(sessionPath, \"markdown\");\nif (content) {\n  const summary = await llm.summarize(content);\n  await writeDiaryEntry(summary);\n}\n```\n\n## Exit Codes\n- 0: Export successful\n- 4: Session not found\n- Other: Export error\n\n## Performance\n- Large sessions may take several seconds\n- maxBuffer prevents truncation of long sessions\n- Consider streaming API in future for very large sessions","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:58.772146-05:00","updated_at":"2025-12-07T20:09:09.483809-05:00","closed_at":"2025-12-07T20:08:36.296505-05:00"}
{"id":"cass_memory_system-idy1","title":"[Decay] getDecayCurveData - Data for decay visualization","description":"Generate time-series data showing how a bullet's scores decay over time. Used for visualization, debugging decay parameters, and explaining score changes to users. Enables future charting/graphing features.\n\nCOMPLETE IMPLEMENTATION:\n```typescript\n/**\n * Generate decay curve data for visualization.\n * Shows how helpful/harmful/effective scores change over time.\n */\nfunction getDecayCurveData(\n  bullet: PlaybookBullet,\n  daysToPlot: number = 180,\n  stepSize: number = 7  // Weekly data points\n): Array\u003c{\n  day: number;\n  helpful: number;\n  harmful: number;\n  effective: number;\n  date: string;\n}\u003e {\n  const now = Date.now();\n  const dataPoints: Array\u003c{\n    day: number;\n    helpful: number;\n    harmful: number;\n    effective: number;\n    date: string;\n  }\u003e = [];\n\n  for (let day = 0; day \u003c= daysToPlot; day += stepSize) {\n    const futureTime = now + (day * 24 * 60 * 60 * 1000);\n\n    // Calculate decayed scores at this future point\n    const helpful = getDecayedScore(\n      bullet.helpfulEvents,\n      bullet.confidenceDecayHalfLifeDays,\n      futureTime\n    );\n\n    const harmful = getDecayedScore(\n      bullet.harmfulEvents,\n      bullet.confidenceDecayHalfLifeDays,\n      futureTime\n    );\n\n    const baseScore = helpful - (4 * harmful);\n    const maturityMultiplier = {\n      candidate: 0.5,\n      established: 1.0,\n      proven: 1.5,\n      deprecated: 0\n    }[bullet.maturity];\n    const effective = baseScore * maturityMultiplier;\n\n    dataPoints.push({\n      day,\n      helpful: Math.round(helpful * 100) / 100,\n      harmful: Math.round(harmful * 100) / 100,\n      effective: Math.round(effective * 100) / 100,\n      date: new Date(futureTime).toISOString().split('T')[0]\n    });\n  }\n\n  return dataPoints;\n}\n```\n\nUSAGE EXAMPLES:\n\n1. ASCII CHART (for CLI):\n```typescript\nconst data = getDecayCurveData(bullet, 90, 7);\n\nconsole.log('Effective Score Decay (next 90 days):');\nconsole.log('');\ndata.forEach(point =\u003e {\n  const bar = '█'.repeat(Math.max(0, Math.floor(point.effective)));\n  const label = `Day ${point.day.toString().padStart(3)}`;\n  console.log(`${label}: ${bar} (${point.effective.toFixed(1)})`);\n});\n```\n\nOutput:\n```\nEffective Score Decay (next 90 days):\n\nDay   0: ████████████ (12.0)\nDay   7: ███████████ (11.2)\nDay  14: ██████████ (10.5)\nDay  21: █████████ (9.8)\nDay  28: █████████ (9.2)\nDay  35: ████████ (8.6)\n...\nDay  84: ████ (4.1)\nDay  91: ███ (3.8)\n```\n\n2. JSON FOR CHARTING:\n```typescript\n// Export for frontend charting library (Chart.js, D3, etc.)\nconst chartData = getDecayCurveData(bullet, 180, 1);\n\nconst chart = {\n  labels: chartData.map(d =\u003e d.date),\n  datasets: [\n    {\n      label: 'Effective Score',\n      data: chartData.map(d =\u003e d.effective),\n      borderColor: 'rgb(75, 192, 192)'\n    },\n    {\n      label: 'Helpful (decayed)',\n      data: chartData.map(d =\u003e d.helpful),\n      borderColor: 'rgb(75, 192, 75)'\n    },\n    {\n      label: 'Harmful (decayed)',\n      data: chartData.map(d =\u003e d.harmful),\n      borderColor: 'rgb(192, 75, 75)'\n    }\n  ]\n};\n```\n\n3. EXPLAIN SCORE CHANGE:\n```typescript\n// User asks: \"Why did this rule's score drop?\"\nconst data = getDecayCurveData(bullet, 90, 30);\n\nconsole.log(`Current score: ${data[0].effective}`);\nconsole.log(`30 days from now: ${data[1].effective}`);\nconsole.log(`60 days from now: ${data[2].effective}`);\nconsole.log(`90 days from now: ${data[3].effective}`);\nconsole.log(`\\nScore will drop ${(data[0].effective - data[3].effective).toFixed(1)} points over 90 days due to decay.`);\n```\n\n4. COMPARE HALF-LIFE SCENARIOS:\n```typescript\n// Compare 60-day vs 90-day vs 120-day half-life\nconst halfLives = [60, 90, 120];\n\nhalfLives.forEach(halfLife =\u003e {\n  const tempBullet = { ...bullet, confidenceDecayHalfLifeDays: halfLife };\n  const data = getDecayCurveData(tempBullet, 180, 30);\n  \n  console.log(`\\nHalf-life: ${halfLife} days`);\n  console.log(`Score at 90 days: ${data[3].effective}`);\n  console.log(`Score at 180 days: ${data[6].effective}`);\n});\n```\n\nPARAMETERS:\n\ndaysToPlot (default: 180):\n- How far into future to project\n- 90 = quarterly view\n- 180 = semi-annual view\n- 365 = annual view\n\nstepSize (default: 7):\n- Granularity of data points\n- 1 = daily (180 points for 180 days)\n- 7 = weekly (26 points for 180 days)\n- 30 = monthly (6 points for 180 days)\n\nTrade-off:\n- Smaller stepSize = more data points, smoother curve, slower computation\n- Larger stepSize = fewer data points, faster, good for CLI displays\n\nDATA POINT STRUCTURE:\n\nday: Number of days from now (0, 7, 14, ...)\nhelpful: Decayed helpful score at that point\nharmful: Decayed harmful score at that point\neffective: Final effective score (helpful - 4×harmful) × maturity\ndate: ISO date string (2025-03-15)\n\nWHY THIS IS USEFUL:\n\n1. TRANSPARENCY:\n   Users can see exactly why scores change over time\n\n2. DEBUGGING:\n   Verify decay algorithm is working correctly\n\n3. PLANNING:\n   \"If I don't update this rule, it will be deprecated in 60 days\"\n\n4. EDUCATION:\n   Help users understand exponential decay concept\n\n5. TUNING:\n   Compare different half-life values to find optimal settings\n\nFUTURE ENHANCEMENTS:\n\n1. Web Dashboard:\n   - Interactive charts with Chart.js\n   - Zoom, pan, hover tooltips\n   - Compare multiple bullets\n\n2. Alerts:\n   - \"Rule will drop below 0 in 30 days\"\n   - \"Rule will auto-deprecate in 45 days\"\n\n3. What-If Analysis:\n   - \"What if I mark this helpful 3 more times?\"\n   - \"What if I extend half-life to 120 days?\"\n\n4. Export:\n   - CSV for spreadsheet analysis\n   - PNG chart generation\n   - PDF reports\n\nDEPENDENCIES:\n- getDecayedScore()\n- PlaybookBullet with events and halfLife\n- maturity multipliers\n\nRETURNS:\nArray of data points with day, helpful, harmful, effective, date\n\nPERFORMANCE:\n- O(n × m) where n = number of steps, m = number of events\n- For 26 weekly points and 50 events: ~1300 calculations\n- Fast enough for real-time display","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:48:11.319323-05:00","updated_at":"2025-12-08T14:28:58.378099-05:00","closed_at":"2025-12-08T14:28:58.378099-05:00"}
{"id":"cass_memory_system-ikds","title":"[CLI] doctor command - System health check","description":"Implements the main entry point for the 'cass-memory doctor' command - a comprehensive system health check.\n\nCOMMAND SYNTAX:\n```bash\ncass-memory doctor [options]\n\nOptions:\n  --json    Output as JSON instead of pretty terminal UI\n  --fix     Auto-fix recoverable issues (interactive confirmation)\n```\n\nPURPOSE:\nSingle command to verify the entire cass-memory setup is healthy and properly configured. Diagnoses common issues and offers auto-fixes where safe.\n\nHEALTH CHECK CATEGORIES:\n\n1. CASS INTEGRATION:\n   - cass binary found in PATH\n   - Version compatibility\n   - Index health (stale? corrupted?)\n   - Session count and storage size\n   - Agent breakdown (which tools used)\n\n2. STORAGE:\n   - Data directory exists and writable\n   - Disk space available (warn if \u003c100MB)\n   - Playbook file valid and loadable\n   - Diary count and total size\n   - Embedding cache status\n\n3. LLM PROVIDERS:\n   - OpenAI API key present and format valid\n   - Anthropic API key (optional)\n   - Other providers configured\n   - Rate limit status (if available)\n\n4. SELF-TEST:\n   - Playbook load performance\n   - Cass search latency\n   - Sanitization pattern breadth\n   - Config validation\n\nIMPLEMENTATION REQUIREMENTS:\n1. Parse command-line options\n2. Run all health checks in parallel (where safe)\n3. Collect results with pass/warn/fail status\n4. Identify fixable issues\n5. Render results (terminal UI or JSON)\n6. If --fix: prompt and apply fixes\n\nOUTPUT FORMAT (Terminal):\n```\nCASS-MEMORY SYSTEM HEALTH CHECK\n================================\n\n[✓] Cass Integration\n    ✓ cass found at /usr/local/bin/cass (v1.2.0)\n    ✓ Index healthy (156 sessions, last updated 2h ago)\n    ⚠ Large index size (2.3GB) - consider pruning old sessions\n\n[✓] Storage\n    ✓ Data directory: /Users/me/.cass-memory\n    ✓ Disk space: 45GB available\n    ✓ Playbook loaded (156 bullets)\n    ✗ Diary directory not found\n\n[⚠] LLM Providers\n    ✓ OpenAI API key configured\n    ⚠ Anthropic key missing (optional for some features)\n\n[✓] Self-Test\n    ✓ Playbook load: 45ms\n    ✓ Cass search: 120ms\n    ✓ Sanitization: 23 patterns loaded\n\nSUMMARY: 1 error, 2 warnings\n  • Run with --fix to auto-repair recoverable issues\n```\n\nERROR TYPES:\n- PASS (✓): All good\n- WARN (⚠): Non-critical issue\n- FAIL (✗): Critical problem\n\nFIXABLE ISSUES:\n- Missing directory → create\n- Missing playbook → create empty\n- Stale cass index → rebuild\n- Invalid config → reset to defaults\n\nNON-FIXABLE ISSUES:\n- Missing API keys → manual setup required\n- Insufficient disk space → manual cleanup\n- cass not found → installation required\n\nDEPENDENCIES:\n- Health check modules (checkCassIntegration, checkStorage, etc.)\n- Terminal UI renderer\n- Auto-fix utilities\n- Config system\n\nSUCCESS CRITERIA:\n- Detects all common issues reliably\n- Clear actionable guidance for failures\n- Auto-fix safe and effective\n- Performance \u003c3 seconds for full check\n- JSON output suitable for CI/CD integration","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:54:29.60623-05:00","updated_at":"2025-12-07T20:22:21.027704-05:00","closed_at":"2025-12-07T20:21:52.957361-05:00"}
{"id":"cass_memory_system-im5","title":"[Utils] generateBulletId - Unique bullet identifier generation","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:44:58.314468-05:00","updated_at":"2025-12-07T18:48:03.203875-05:00","closed_at":"2025-12-07T18:47:47.137585-05:00","comments":[{"id":18,"issue_id":"cass_memory_system-im5","author":"jemanuel","text":"## Function Signature\n```typescript\nfunction generateBulletId(): string\n```\n\n## Implementation Details\n- Format: \"b-{timestamp36}-{random}\"\n- timestamp36: Date.now().toString(36) - base36 encoding of current timestamp\n- random: Math.random().toString(36).slice(2, 8) - 6 chars of base36 random\n- Example output: \"b-lz3k5m2-x7y8z9\"\n- Concatenate with hyphens\n\n## Why This Matters\nMust be unique across all playbooks. Base36 keeps IDs short but readable (vs UUID which is long). Timestamp prefix ensures rough chronological ordering. Random suffix prevents collisions.\n\n## Edge Cases to Handle\n- Collision risk - very low with timestamp + 6 random chars (~2 billion combinations per ms)\n- Clock skew - if system clock goes backward, IDs might not be monotonic\n- Concurrent generation - random suffix handles this\n- Determinism - NOT deterministic, generates new ID each call","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-inv","title":"[LLM] getModel - Provider-agnostic model instantiation","description":"Function signature:\nfunction getModel(config: Config): LanguageModel\n\nUsing Vercel AI SDK provider abstraction:\n- openai: createOpenAI({ apiKey })(config.model)\n- anthropic: createAnthropic({ apiKey })(config.model)\n- google: createGoogleGenerativeAI({ apiKey })(config.model)\n\nProvider abstraction is KEY benefit - same code works with any provider.\n\nImplementation:\n1. Get API key using getApiKey(config.provider)\n2. Create provider instance based on config.provider\n3. Return LanguageModel instance for config.model\n\nThis enables seamless switching between providers without changing generation code.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:50.252148-05:00","updated_at":"2025-12-07T18:48:03.204695-05:00","closed_at":"2025-12-07T18:45:21.480279-05:00"}
{"id":"cass_memory_system-iqat","title":"[Foundation] Bun build configuration for cross-platform binaries","description":"Configure Bun build system to compile CASS Memory System to standalone executables for Linux, macOS, and Windows.\n\n## Context\nCASS Memory System must be distributed as standalone executables that users can run without installing Node.js, Bun, or any dependencies. Bun's --compile flag creates single-file binaries that bundle the runtime, dependencies, and source code.\n\n## Technical Specification\n\n### Build Targets:\n1. Linux x64: bun build src/cass-memory.ts --compile --target=linux-x64 --outfile dist/cass-memory-linux\n2. macOS ARM64: bun build src/cass-memory.ts --compile --target=darwin-arm64 --outfile dist/cass-memory-macos\n3. Windows x64: bun build src/cass-memory.ts --compile --target=windows-x64 --outfile dist/cass-memory-windows.exe\n\n### Build Configuration:\n- Entry Point: src/cass-memory.ts\n- Output Directory: dist/\n- Compile Mode: --compile (creates executable, not JavaScript)\n- Minification: --minify (optional, reduces binary size)\n- Sourcemaps: --sourcemap (optional, for debugging)\n\n### Package.json Scripts:\njson\n{\n  \"scripts\": {\n    \"build\": \"bun build src/cass-memory.ts --compile --outfile dist/cass-memory\",\n    \"build:all\": \"npm run build:linux \u0026\u0026 npm run build:macos \u0026\u0026 npm run build:windows\",\n    \"build:linux\": \"bun build src/cass-memory.ts --compile --target=linux-x64 --outfile dist/cass-memory-linux\",\n    \"build:macos\": \"bun build src/cass-memory.ts --compile --target=darwin-arm64 --outfile dist/cass-memory-macos\",\n    \"build:windows\": \"bun build src/cass-memory.ts --compile --target=windows-x64 --outfile dist/cass-memory-windows.exe\",\n    \"build:current\": \"bun build src/cass-memory.ts --compile --outfile dist/cass-memory\"\n  }\n}\n\n\n### Binary Naming Convention:\n- cass-memory-linux (Linux x64)\n- cass-memory-macos (macOS ARM64 - Apple Silicon)\n- cass-memory-windows.exe (Windows x64)\n- cass-memory (current platform, for development)\n\n### Distribution Strategy:\n- GitHub Releases: Attach binaries to release tags\n- Homebrew: Formula for macOS installation\n- apt/yum: Future package repositories for Linux\n- Chocolatey: Future package for Windows\n- Direct Download: Users can download from GitHub releases\n\n### Build Process:\n1. Run typecheck: Ensure no TypeScript errors\n2. Run tests: Ensure all tests pass\n3. Build for all platforms: npm run build:all\n4. Test binaries: Run ./dist/cass-memory-* --version on each platform\n5. Create GitHub release: Upload binaries as release assets\n\n## Reasoning\n\n### Why Bun --compile:\n1. Single Binary: No dependencies to install\n2. Fast Startup: Compiled binaries start faster than Node.js scripts\n3. Cross-Platform: Bun can cross-compile from any platform\n4. Bundled Runtime: No 'command not found' errors\n5. Easy Distribution: Just download and run\n\n### Why Multiple Targets:\n1. Platform Compatibility: Users on Linux, macOS, and Windows\n2. Architecture Support: ARM64 for Apple Silicon, x64 for Intel/AMD\n3. Maximum Reach: Support as many users as possible\n\n### Why dist/ Directory:\n1. Standard Convention: Build artifacts go in dist/\n2. .gitignore: dist/ is ignored, binaries not committed\n3. Clean Separation: Source vs. build artifacts\n\n### Why Not npm Package:\n1. No Runtime Dependency: Users don't need Node.js/Bun installed\n2. Faster Install: Download binary vs. npm install\n3. Simpler: One file vs. node_modules/\n4. Offline: Works without internet after download\n\n### Why GitHub Releases:\n1. Hosting: Free hosting for binaries\n2. Versioning: Tied to git tags\n3. Changelog: Release notes for each version\n4. CDN: Fast downloads worldwide\n\n## Acceptance Criteria\n\n- bun run build creates executable for current platform\n- bun run build:all creates executables for Linux, macOS, Windows\n- All binaries are in dist/ directory\n- Binaries are executable (chmod +x on Unix)\n- ./dist/cass-memory-* --version shows correct version\n- ./dist/cass-memory-* --help shows usage information\n- Binary size is reasonable (\u003c 50MB per platform)\n- Binaries work on clean systems without Bun/Node installed\n- README includes download instructions\n- GitHub Actions workflow builds and uploads binaries on release\n\n## How This Serves the Universal Agent Memory System\n\nCross-platform binaries make CASS Memory universally accessible:\n\n1. No Install Friction: Users download and run, no setup required\n2. Universal Compatibility: Works on any OS without runtime dependencies\n3. Enterprise-Friendly: IT departments can distribute binaries without npm registry\n4. Offline Support: Binaries work without internet connection\n5. Fast Startup: Compiled binaries start in milliseconds\n6. Consistent Behavior: Same binary works identically across machines\n7. CI/CD Integration: Binaries work in Docker, GitHub Actions, etc.\n\nWithout cross-platform binaries, users would need to install Bun, manage dependencies, and deal with version conflicts. Binaries make CASS Memory as easy to use as git - just download and run.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:48:27.875231-05:00","updated_at":"2025-12-07T21:49:07.632859-05:00","closed_at":"2025-12-07T21:48:49.452611-05:00"}
{"id":"cass_memory_system-iqe0","title":"[CLI:playbook] remove - Remove or deprecate bullet","description":"Remove or deprecate a playbook bullet.\n\nCommand signature:\n```bash\ncass-memory playbook remove \u003cbullet-id\u003e [options]\n\nOptions:\n  --hard             Permanently delete (default: soft deprecate)\n  --reason TEXT      Reason for removal\n```\n\nImplementation:\n1. Load playbook\n2. Find bullet by ID\n3. Perform removal based on mode:\n\nSoft delete (default):\n- Set bullet.deprecated = true\n- Set bullet.deprecatedAt = now\n- Set bullet.deprecationReason = reason\n- Keep in playbook file but exclude from active use\n- Preserves history\n\nHard delete:\n- Remove bullet entirely from playbook\n- No recovery possible\n- Should prompt for confirmation\n\n4. Save updated playbook\n5. Display confirmation\n\nOutput format (soft):\n```\nDeprecated bullet b-abc123\nContent: {content}\nReason: {reason}\n\nThe bullet is now hidden from active playbook but preserved in history.\nUse 'playbook list --all' to see deprecated bullets.\n```\n\nOutput format (hard):\n```\nPermanently deleted bullet b-abc123\nContent: {content}\n\nThis action cannot be undone.\n```\n\nConfirmation prompt for hard delete:\n```\nThis will permanently delete bullet b-abc123: \"{content}\"\nThis action cannot be undone. Continue? [y/N]\n```\n\nUse cases:\n- Soft: Rule is no longer relevant but keep for history\n- Hard: Duplicate bullet or mistake\n\nDefault to soft delete to preserve evidence trail.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:52:25.037538-05:00","updated_at":"2025-12-07T20:58:47.065139-05:00","closed_at":"2025-12-07T20:57:29.951901-05:00"}
{"id":"cass_memory_system-ix2t","title":"[Unit Tests] tracking.ts - Session tracking functions","description":"## Unit Tests: tracking.ts - Session Tracking Functions\n\n### Test Categories\n\n#### 1. TrackingLog Loading/Saving\n- loadTrackingLog() reads existing file\n- loadTrackingLog() creates default for missing\n- saveTrackingLog() writes atomically\n- Handles corrupt tracking files\n\n#### 2. markSessionProcessed()\n- Adds path to processedSessions set\n- Updates lastProcessedAt timestamp\n- Persists to tracking file\n- Idempotent for duplicate paths\n\n#### 3. isSessionProcessed()\n- Returns true for processed sessions\n- Returns false for unprocessed\n- Handles path normalization\n\n#### 4. getUnprocessedSessions()\n- Returns sessions not in tracking log\n- Respects maxSessions limit\n- Filters by agent if specified\n- Orders by timestamp (oldest first)\n\n#### 5. pruneOldEntries()\n- Removes entries older than threshold\n- Preserves recent entries\n- Updates file after pruning\n- Handles empty tracking log\n\n#### 6. Tracking Log Schema\n- Validates required fields\n- Handles schema migrations\n- Forward-compatible with new fields\n\n### Test Approach\n- Real temp file I/O\n- Concurrent access simulation\n- Verify file contents match expectations\n- Test with large tracking logs (10k+ entries)\n\n### Edge Cases\n- Unicode session paths\n- Very long paths\n- Paths with special characters\n- Case sensitivity on different OS","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:23:41.109984-05:00","updated_at":"2025-12-07T21:06:05.991889-05:00","closed_at":"2025-12-07T21:06:03.811723-05:00","dependencies":[{"issue_id":"cass_memory_system-ix2t","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2025-12-07T20:31:05.357554-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-ix2t","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2025-12-07T20:31:09.069307-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-ix3l","title":"E2E test: 'cass doctor' command","description":"E2E test for 'cass doctor' CLI command:\n- Real subprocess execution via bun\n- Test health check output\n- Verify detection of: missing playbook, invalid YAML, orphaned sessions\n- Test with healthy setup (all green)\n- Test with various problem scenarios\n- Test --json output format\n- Detailed logging: each check performed, pass/fail status\nSetup: fixture directories representing healthy and unhealthy states","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:27:18.463151-05:00","updated_at":"2025-12-08T14:04:05.807967-05:00","closed_at":"2025-12-08T14:04:05.807967-05:00","dependencies":[{"issue_id":"cass_memory_system-ix3l","depends_on_id":"cass_memory_system-8dxr","type":"blocks","created_at":"2025-12-07T20:28:33.940147-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-ixln","title":"[CLI:init] createDirectoryStructure - Set up directories","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:32.132292-05:00","updated_at":"2025-12-07T21:13:03.914238-05:00","closed_at":"2025-12-07T21:12:21.865742-05:00"}
{"id":"cass_memory_system-j2i","title":"[Curator] handleReplaceDelta - Update bullet content","description":"Update bullet content while preserving feedback history.\n\nSignature:\nfunction handleReplaceDelta(\n  playbook: Playbook,\n  delta: ReplaceDelta\n): { applied: boolean }\n\nProcess:\n1. Find bullet by ID\n   - If not found: return applied: false\n2. Update bullet.content to delta.newContent\n3. Update bullet.updatedAt to current timestamp\n4. DO NOT reset helpfulCount or harmfulCount\n5. DO NOT clear helpfulEvents or harmfulEvents\n6. DO NOT reset maturity state\n7. Return applied: true\n\nKEY PRINCIPLE: Feedback history is PRESERVED across content updates.\n\nWhy preserve history?\n- The rule's value/harm is tied to its semantic meaning, not exact wording\n- Allows refining phrasing without losing trust\n- Prevents gaming the system by rewording harmful rules\n\nExample use case:\n- Original: 'Use any type for flexibility'\n- Gets harmful feedback\n- Replace: 'Use any type when prototyping'\n- Still carries harmful history - must earn back trust\n\nThis maintains accountability while allowing improvement.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:44:59.97769-05:00","updated_at":"2025-12-07T21:14:16.247621-05:00","closed_at":"2025-12-07T21:14:08.88724-05:00"}
{"id":"cass_memory_system-j2j1","title":"Optimize sanitization performance and context quality","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T00:45:31.102929-05:00","updated_at":"2025-12-08T00:45:42.415306-05:00","closed_at":"2025-12-08T00:45:42.415306-05:00"}
{"id":"cass_memory_system-j7gh","title":"[E2E Tests] CLI context command - pre-task briefing","description":"## E2E Test: CLI context Command - Pre-task Briefing\n\n### Test Scenario\nTest `cm context` generates useful pre-task context\n\n### Test Steps\n\n#### 1. Basic Context Generation\n- Initialize project with playbook\n- Add sample bullets to playbook\n- Run `cm context \"implement auth\"`\n- Verify relevant bullets returned\n- Verify context_brief generated\n\n#### 2. Context with Cass Integration\n- Ensure cass index exists\n- Run `cm context \"error handling\"`\n- Verify cass search results included\n- Verify deduplication with playbook\n\n#### 3. Context without Cass\n- Disable cass (rename binary or unset PATH)\n- Run `cm context \"testing\"`\n- Verify graceful fallback\n- Verify playbook-only context returned\n\n#### 4. Context Output Formats\n- Test `--format json` output\n- Test `--format markdown` output\n- Test `--format text` output\n- Verify each format is valid\n\n### Verbose Logging\n- Log: 'Generating context for task: \u003ctask\u003e'\n- Log: 'Loading playbook from \u003cpath\u003e'\n- Log: 'Found N relevant bullets'\n- Log: 'Searching cass for related sessions...'\n- Log: 'Cass returned M hits'\n- Log: 'Building context brief...'\n- Log: 'Context generation complete'\n\n### Performance\n- Should complete in \u003c 5s for typical playbook\n- Log timing information","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:24:35.050166-05:00","updated_at":"2025-12-08T01:17:40.812427-05:00","closed_at":"2025-12-08T01:17:40.812427-05:00","dependencies":[{"issue_id":"cass_memory_system-j7gh","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2025-12-07T20:31:24.958342-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-j7gh","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2025-12-07T20:31:25.087325-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-j7gh","depends_on_id":"cass_memory_system-p4mv","type":"blocks","created_at":"2025-12-07T20:31:25.214784-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-j7gh","depends_on_id":"cass_memory_system-33w3","type":"blocks","created_at":"2025-12-07T20:31:29.642072-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-j7gh","depends_on_id":"cass_memory_system-92xd","type":"blocks","created_at":"2025-12-07T20:31:29.747845-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-j7lc","title":"[Impl] Rewrite README.md with Agent-First Framing","description":"# Rewrite README.md with Agent-First Framing\n\n## Purpose\nTransform README from human-centric to agent-first documentation. This is the MAIN documentation task that consolidates all doc work.\n\n## This Task Includes (Consolidated)\n- Command categorization by audience (was ajkn)\n- README structure design (was hg12)  \n- Audience tags on all commands (was muvr)\n- Automation setup documentation (was skri)\n\n## Key Sections to Create\n\n### 1. What This Is\n- \"Memory system FOR AI coding agents\"\n- Agents are consumers, humans are operators\n- Three-layer architecture (keep, it's good)\n\n### 2. For Humans: Quick Start (~15%)\n- Install\n- Add blurb to AGENTS.md (link to blurb)\n- Done (that's it!)\n\n### 3. For Agents: Usage (~25%)\n- Protocol: START (cm context) → WORK → END (automatic)\n- cm context command with examples\n- cm mark command (and inline feedback option)\n- Output schemas\n\n### 4. For Humans: Operation \u0026 Monitoring (~20%)\n- Configuration options\n- Setting up automation (cron examples, hook examples)\n- cm stats, cm doctor, cm audit\n- cm playbook for manual rule management\n\n### 5. Architecture (~20%)\n- Keep existing content, it's good\n\n### 6. Command Reference (~15%)\n- ALL commands with audience tags:\n  - [Agent-Essential]: context, mark\n  - [Agent-Occasional]: doctor, stats\n  - [Operator]: init, playbook, project, serve\n  - [Automated]: reflect, audit\n\n## Quality Checklist\n- [ ] Agent section fits in ~500 tokens if extracted\n- [ ] Every command has audience tag\n- [ ] No implication that humans run agent commands\n- [ ] Blurb prominently featured\n- [ ] Automation setup clearly documented\n\n## Success Criteria\nSomeone reading just the \"For Agents\" section can use cass-memory effectively.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T12:47:06.08316-05:00","updated_at":"2025-12-08T13:17:58.731628-05:00","closed_at":"2025-12-08T13:17:58.731628-05:00","dependencies":[{"issue_id":"cass_memory_system-j7lc","depends_on_id":"cass_memory_system-hg12","type":"blocks","created_at":"2025-12-08T12:48:46.0535-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-j7lc","depends_on_id":"cass_memory_system-ajkn","type":"blocks","created_at":"2025-12-08T12:48:46.210463-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-jhuj","title":"[CLI:audit] scanSessionsForViolations - Find rule violations","description":"Core logic to scan sessions and identify playbook rule violations.\n\nFunction signature:\n```typescript\nasync function scanSessionsForViolations(\n  sessions: string[],\n  playbook: Playbook,\n  config: Config\n): Promise\u003cAuditViolation[]\u003e\n```\n\nImplementation:\n1. For each session path:\n   - Load or export session content\n   - Extract key events: commits, file changes, commands\n   \n2. For each active playbook bullet:\n   - Prepare violation check prompt:\n     ```\n     Session summary: {sessionSummary}\n     Rule: {bullet.content}\n     Category: {bullet.category}\n     \n     Did this session violate this rule? If yes, provide evidence.\n     ```\n   \n   - Call LLM (fast model)\n   - Parse response for violation detection\n   \n3. Record violations:\n   ```typescript\n   interface AuditViolation {\n     bulletId: string;\n     bulletContent: string;\n     sessionPath: string;\n     timestamp: string;\n     severity: 'high' | 'medium' | 'low';\n     evidence: string;\n   }\n   ```\n   \n4. Severity mapping:\n   - proven → high\n   - accepted → medium\n   - candidate → low\n\nOptimizations:\n- Batch LLM calls where possible\n- Cache session summaries\n- Skip deprecated bullets\n- Early exit if no active rules\n\nEdge cases:\n- Handle session load failures gracefully\n- Skip sessions with no meaningful content\n- Handle LLM parsing errors (assume no violation)\n\nReturn array of all violations found across all sessions.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:11.808386-05:00","updated_at":"2025-12-07T21:13:03.915275-05:00","closed_at":"2025-12-07T21:12:30.963946-05:00"}
{"id":"cass_memory_system-jl41","title":"[Integration] CLI Command Chains - Multi-Command Flows","description":"## Target: Integration tests for CLI command sequences\n\n### Test Scenarios:\n\n1. **Init → Context → Mark Flow**\n   ```bash\n   cm init --json\n   cm context \"test query\" --json\n   cm mark \u003cbullet-id\u003e helpful --json\n   cm context \"test query\" --json  # Score changed\n   ```\n\n2. **Init Repo → Playbook → Curate Flow**\n   ```bash\n   cd \u003ctemp-git-repo\u003e\n   cm init --repo --json\n   cm playbook --add \"Test bullet\" --json\n   cm playbook --add \"Duplicate bullet\" --json\n   cm curate --dry-run --json\n   ```\n\n3. **Diary → Timeline → Reflect Flow**\n   ```bash\n   # Create diary entries\n   cm diary --list --json\n   cm timeline --since 7d --json\n   cm reflect --json\n   ```\n\n4. **Toxic Pattern Flow**\n   ```bash\n   cm toxic add \"bad-pattern\" --json\n   cm toxic list --json\n   cm toxic check \"content with bad-pattern\" --json\n   ```\n\n5. **Doctor → Validate → Fix Flow**\n   ```bash\n   cm doctor --json\n   cm validate --json\n   cm validate --fix --json\n   cm doctor --json  # Issues resolved\n   ```\n\n### Test Infrastructure:\n- Spawn actual CLI process\n- Capture stdout/stderr\n- Parse JSON output\n- Verify state changes\n\n### Logging:\n- Full command with args\n- Exit code\n- Stdout content\n- Stderr content\n- Duration","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-07T20:30:12.582767-05:00","updated_at":"2025-12-08T14:44:33.284936-05:00","dependencies":[{"issue_id":"cass_memory_system-jl41","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:35.364597-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-jl41","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:32:35.578433-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-jl41","depends_on_id":"cass_memory_system-zc1d","type":"blocks","created_at":"2025-12-07T20:33:04.077144-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-job7","title":"Remove redundant path-utils and harden sanitize performance","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T01:05:01.162559-05:00","updated_at":"2025-12-08T01:05:18.418768-05:00","closed_at":"2025-12-08T01:05:18.418768-05:00"}
{"id":"cass_memory_system-jsk7","title":"Implement split curation for Global vs Repo playbooks","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T00:23:49.064368-05:00","updated_at":"2025-12-08T00:23:57.665355-05:00","closed_at":"2025-12-08T00:23:57.665355-05:00"}
{"id":"cass_memory_system-jvpl","title":"[Unit] diary.ts - Diary Loading, Formatting \u0026 Timeline","description":"## Target: src/diary.ts - Diary Module\n\n### Existing Tests to Expand:\n- test/format-raw-session.test.ts covers formatRawSession()\n\n### Functions to Test:\n\n1. **loadDiary(diaryDir)** - Load diary entries\n   - Loads all .md, .json, .jsonl files\n   - Sorts by date\n   - Returns DiaryEntry array\n   - Handles missing directory\n   - Handles permission errors\n\n2. **loadDiaryEntry(path)** - Load single entry\n   - Parses frontmatter\n   - Extracts content\n   - Returns DiaryEntry object\n   - Handles malformed files\n\n3. **formatRawSession(content, ext)** - Already tested\n   - EXPAND existing tests\n   - Add more edge cases\n   - Performance for large files\n\n4. **buildTimeline(entries, options)** - Timeline construction\n   - Chronological ordering\n   - Date grouping\n   - Filter by date range\n   - Filter by type\n\n5. **searchDiary(entries, query)** - Diary search\n   - Full-text search\n   - Date filtering\n   - Returns ranked results\n   - Handles empty query\n\n6. **checkToxicity(content, toxicLog)** - Toxicity check\n   - Matches against toxic patterns\n   - Returns match details\n   - Case insensitive matching\n   - Regex pattern support\n\n7. **validateDiaryEntry(entry)** - Entry validation\n   - Required fields present\n   - Date format valid\n   - Content not empty\n\n### Test Data:\n- Create sample diary entries\n- Various formats (.md, .json, .jsonl)\n- Include malformed examples\n- Unicode content","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:28:38.426582-05:00","updated_at":"2025-12-08T00:40:29.451273-05:00","closed_at":"2025-12-08T00:40:29.451273-05:00","dependencies":[{"issue_id":"cass_memory_system-jvpl","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:17.662149-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-jvpl","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:33:00.053846-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-jzo","title":"[LLM] extractDiary - Structured diary extraction","description":"Function signature:\nasync function extractDiary\u003cT extends z.ZodSchema\u003e(\n  schema: T,\n  sessionContent: string,\n  metadata: { sessionPath: string; agent: string; workspace?: string },\n  config: Config\n): Promise\u003cz.infer\u003cT\u003e\u003e\n\nImplementation:\n1. Build prompt from PROMPTS.diary template\n2. Substitute variables: sessionPath, agent, workspace, content\n3. Truncate sessionContent if \u003e50000 chars (to avoid token limits)\n4. Call generateObject with:\n   - schema: provided Zod schema\n   - prompt: built prompt\n   - temperature: 0.3 (low for consistency)\n   - model: from config\n5. Return typed object (Zod validates structure)\n\nUsed by: digest command to extract structured insights from agent sessions.\n\nError handling: Should use llmWithRetry wrapper for resilience.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:58.35478-05:00","updated_at":"2025-12-07T20:10:50.054671-05:00","closed_at":"2025-12-07T20:10:47.843882-05:00"}
{"id":"cass_memory_system-k0qp","title":"[Semantic] saveEmbeddingCache - Persist cache to disk","description":"Persist embedding cache to disk atomically.\n\nImplementation:\n```typescript\nasync function saveEmbeddingCache(cache: EmbeddingCache): Promise\u003cvoid\u003e\n```\n\nProcess:\n1. Serialize cache to JSON\n2. Write to temp file (~/.cass-memory/embeddings/bullets.json.tmp)\n3. Atomic move to final location\n4. Handle errors gracefully\n\nAtomicity:\n- Write to temp file first\n- Move is atomic on most filesystems\n- Prevents corruption if crash during write\n\nError handling:\n- Directory not exist → create\n- Permission denied → log error\n- Disk full → log error, keep old cache\n- JSON serialization error → log and skip\n\nFile size:\n- 100 bullets: ~300KB\n- 1000 bullets: ~3MB\n- Gzip compression could reduce 50% (future)\n\nWhen called:\n- After loadOrComputeEmbeddings\n- After batch embedding updates\n- Before process exit (cleanup)\n\nExample:\n```typescript\nawait saveEmbeddingCache({\n  version: \"1.0\",\n  model: \"Xenova/all-MiniLM-L6-v2\",\n  bullets: {\n    \"b-123\": { contentHash: \"...\", embedding: [...], computedAt: \"...\" }\n  }\n});\n```","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-07T16:49:44.691385-05:00","updated_at":"2025-12-07T17:14:56.690349-05:00","comments":[{"id":19,"issue_id":"cass_memory_system-k0qp","author":"jemanuel","text":"Persist embedding cache to disk atomically.\n\nImplementation:\n```typescript\nasync function saveEmbeddingCache(cache: EmbeddingCache): Promise\u003cvoid\u003e\n```\n\nProcess:\n1. Serialize cache to JSON\n2. Write to temp file (~/.cass-memory/embeddings/bullets.json.tmp)\n3. Atomic move to final location\n4. Handle errors gracefully\n\nAtomicity:\n- Write to temp file first\n- Move is atomic on most filesystems\n- Prevents corruption if crash during write\n\nError handling:\n- Directory not exist → create\n- Permission denied → log error\n- Disk full → log error, keep old cache\n- JSON serialization error → log and skip\n\nFile size:\n- 100 bullets: ~300KB\n- 1000 bullets: ~3MB\n- Gzip compression could reduce 50% (future)\n\nWhen called:\n- After loadOrComputeEmbeddings\n- After batch embedding updates\n- Before process exit (cleanup)\n\nExample:\n```typescript\nawait saveEmbeddingCache({\n  version: \"1.0\",\n  model: \"Xenova/all-MiniLM-L6-v2\",\n  bullets: {\n    \"b-123\": { contentHash: \"...\", embedding: [...], computedAt: \"...\" }\n  }\n});\n```","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-k2k","title":"[Reflector] ReflectionStats - Track reflection effectiveness","description":"interface ReflectionStats {\n  sessionPath: string;\n  iterations: number;\n  deltasPerIteration: number[];\n  totalDeltas: number;\n  deltasByType: Record\u003cstring, number\u003e;\n  duration: number;\n}\n\nTrack for analysis of reflection quality\n\nPURPOSE:\n- Monitor reflection effectiveness\n- Identify when early exit is working\n- Debug reflection issues\n- Optimize maxReflectorIterations\n\nEXAMPLE OUTPUT:\n```json\n{\n  \"sessionPath\": \"/path/to/session.jsonl\",\n  \"iterations\": 3,\n  \"deltasPerIteration\": [12, 5, 0],\n  \"totalDeltas\": 17,\n  \"deltasByType\": {\n    \"add\": 10,\n    \"helpful\": 4,\n    \"harmful\": 2,\n    \"replace\": 1,\n    \"deprecate\": 0\n  },\n  \"duration\": 4523\n}\n```\n\nANALYSIS INSIGHTS:\n- If iterations = 1 always: prompt may be too narrow\n- If deltasPerIteration decreases: good (finding less each time)\n- If duration \u003e 10s: consider reducing maxReflectorIterations\n- If totalDeltas = 0: diary may be empty or LLM issue\n\nCOLLECTION POINTS:\n- Start: record sessionPath, start time\n- Each iteration: push deltas count\n- End: record total, duration, type breakdown\n\nSTORAGE:\n- Log to console in verbose mode\n- Optional: append to .cass/reflection-stats.jsonl\n\nUsed in reflectOnSession()","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:02.213483-05:00","updated_at":"2025-12-07T20:06:29.959739-05:00","closed_at":"2025-12-07T20:05:24.166253-05:00"}
{"id":"cass_memory_system-k706","title":"[Unit Tests] utils.ts - Comprehensive utility function tests","description":"## Unit Tests: utils.ts - Comprehensive Utility Function Tests\n\n### Test Categories\n\n#### 1. Path Utilities\n- expandPath() handles ~/ expansion\n- expandPath() handles env vars\n- normalizePath() resolves relative paths\n- isAbsolutePath() cross-platform check\n- ensureDir() creates nested directories\n\n#### 2. File Utilities\n- readFileIfExists() returns content or null\n- writeFileAtomic() uses temp + rename\n- fileExists() sync existence check\n- getFileModTime() returns mtime\n\n#### 3. String Utilities\n- truncate() respects max length\n- truncate() adds ellipsis\n- sanitize() removes dangerous chars\n- slugify() creates URL-safe strings\n- capitalize() handles empty strings\n\n#### 4. Hash Utilities\n- hashContent() deterministic SHA256\n- shortHash() truncated for IDs\n- hashFile() streams large files\n\n#### 5. Keyword Extraction\n- extractKeywords() from text\n- Handles stopwords\n- Handles punctuation\n- Returns unique keywords\n- Case normalization\n\n#### 6. Scoring Utilities\n- normalizeScore() to [0,1] range\n- weightedAverage() calculation\n- percentile() calculation\n\n#### 7. Date/Time Utilities\n- formatDate() ISO format\n- parseDate() from various formats\n- daysAgo() calculation\n- isRecent() threshold check\n\n#### 8. Logging\n- log() respects verbose flag\n- error() always outputs\n- Proper stderr/stdout separation\n\n### Test Approach\n- Pure function testing (deterministic)\n- Edge cases: empty inputs, unicode, very long strings\n- Cross-platform path handling","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:24:03.916398-05:00","updated_at":"2025-12-07T21:56:12.050023-05:00","closed_at":"2025-12-07T21:56:12.050023-05:00","dependencies":[{"issue_id":"cass_memory_system-k706","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2025-12-07T20:31:05.654468-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-k706","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2025-12-07T20:31:09.29534-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-kam","title":"[Curator] handleDeprecateDelta - Mark bullet as deprecated","description":"Explicitly mark a bullet as deprecated with optional replacement.\n\nSignature:\nfunction handleDeprecateDelta(\n  playbook: Playbook,\n  delta: DeprecateDelta\n): { applied: boolean }\n\nProcess:\n1. Find bullet by ID\n   - If not found: return applied: false\n2. Update bullet fields:\n   - state: 'retired'\n   - maturity: 'deprecated'\n   - deprecationReason: delta.reason (required)\n   - replacedBy: delta.replacedBy (optional bullet ID)\n   - updatedAt: current timestamp\n3. Return applied: true\n\nWhen is this used?\n- Manual deprecation by user (cm forget)\n- Merging bullets (old bullets point to merged result)\n- Replacing outdated rules with better versions\n\nImportant notes:\n- Deprecated bullets are NOT deleted\n- They're moved to playbook.deprecated array during pruning\n- History is preserved for audit trail\n- replacedBy provides migration path\n\nExample deprecation chain:\n1. Bullet A is deprecated with replacedBy: B\n2. Bullet B later deprecated with replacedBy: C\n3. System can trace evolution: A → B → C\n\nThis maintains continuity while allowing playbook evolution.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:45:00.887743-05:00","updated_at":"2025-12-07T21:14:16.251092-05:00","closed_at":"2025-12-07T21:14:08.888464-05:00"}
{"id":"cass_memory_system-ke2x","title":"Sub-Epic: E2E Test Suite with Detailed Logging","description":"# Sub-Epic: E2E Test Suite with Detailed Logging\n\n## Philosophy\nTest complete user workflows from CLI to result.\nRun actual `cm` commands against real (temp) file systems.\nDetailed logging at every step for debugging.\n\n## Logging Framework\n\n### Log Levels\n- DEBUG: Every function entry/exit, variable states\n- INFO: Major workflow steps, assertions\n- WARN: Unexpected but recoverable states\n- ERROR: Failures with full context\n\n### Log Format\n```\n[TIMESTAMP] [LEVEL] [TEST_NAME] [STEP] message\n  context: { key: value, ... }\n  duration: Xms\n```\n\n### Log Output\n- Console: INFO and above\n- File: ALL levels to test/logs/{test-name}-{timestamp}.log\n- Summary: test/logs/summary.json with pass/fail/duration\n\n## E2E Test Scenarios\n\n### Scenario 1: Fresh Installation\n1. Run `cm init` in empty temp dir\n2. Verify directory structure created\n3. Verify default config written\n4. Verify empty playbook created\n5. Log: All file paths and contents\n\n### Scenario 2: Session → Diary → Reflect Workflow\n1. Create fixture session file\n2. Run `cm diary \u003csession\u003e` (may skip LLM with fixture)\n3. Verify diary JSON created\n4. Run `cm reflect --dry-run` (with LLM fixture)\n5. Verify deltas proposed\n6. Log: Each step's input/output\n\n### Scenario 3: Playbook CRUD Operations\n1. `cm playbook add \"Test rule\"` → verify ID returned\n2. `cm playbook list --json` → verify rule appears\n3. `cm mark \u003cid\u003e --helpful` → verify count incremented\n4. `cm mark \u003cid\u003e --harmful` → verify feedback recorded\n5. `cm playbook remove \u003cid\u003e` → verify deprecation\n6. Log: Playbook state before/after each operation\n\n### Scenario 4: Context Retrieval\n1. Populate playbook with varied rules\n2. `cm context \"task description\" --json`\n3. Verify relevant rules returned\n4. Verify scoring makes sense\n5. Log: Scoring breakdown for each rule\n\n### Scenario 5: Feedback Loop \u0026 State Transitions\n1. Add new rule (maturity: candidate)\n2. Mark helpful 3x → verify maturity: established\n3. Mark helpful 7x more → verify maturity: proven\n4. Mark harmful 5x → verify state transition\n5. Log: State machine transitions\n\n### Scenario 6: Anti-Pattern Detection\n1. Add rule, mark harmful repeatedly\n2. Verify anti-pattern inversion triggered\n3. Attempt to add similar rule\n4. Verify conflict/warning raised\n5. Log: Inversion details, similarity scores\n\n### Scenario 7: Multi-Session Learning\n1. Process session A → extract deltas\n2. Process session B → extract deltas (should reference A's learnings)\n3. Process session C → verify deduplication\n4. Verify playbook growth curve\n5. Log: Delta counts, dedup stats\n\n### Scenario 8: Doctor \u0026 Stats\n1. Create scenario with issues (missing files, etc.)\n2. Run `cm doctor --json`\n3. Verify issues detected\n4. Run `cm stats --json`\n5. Verify statistics accurate\n6. Log: All diagnostic output\n\n### Scenario 9: Validation Pipeline\n1. Propose rule via reflect\n2. Run evidence-count gate\n3. If ambiguous, run LLM validation (fixture)\n4. Verify verdict matches expectations\n5. Log: Gate results, LLM prompt/response\n\n### Scenario 10: Error Recovery\n1. Simulate various error conditions:\n   - Missing cass binary\n   - Corrupted playbook YAML\n   - Invalid config JSON\n   - LLM API timeout (mocked)\n2. Verify graceful degradation\n3. Verify error messages helpful\n4. Log: Error chain, recovery actions\n\n## Test Execution\n- `bun test:e2e` - Run all E2E tests\n- `bun test:e2e:verbose` - Run with DEBUG logging\n- `bun test:e2e:scenario \u003cname\u003e` - Run specific scenario\n\n## CI/CD Integration\n- GitHub Actions workflow\n- Artifacts: Log files, coverage reports\n- Failure screenshots (terminal output)","status":"in_progress","priority":1,"issue_type":"epic","created_at":"2025-12-07T20:22:59.495309-05:00","updated_at":"2025-12-08T02:01:07.65802-05:00","dependencies":[{"issue_id":"cass_memory_system-ke2x","depends_on_id":"cass_memory_system-m7np","type":"blocks","created_at":"2025-12-07T20:23:08.63244-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-ke2x","depends_on_id":"cass_memory_system-zc1d","type":"blocks","created_at":"2025-12-07T20:23:08.866958-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-ke2x","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:31:41.068307-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-ke2x","depends_on_id":"cass_memory_system-u64s","type":"blocks","created_at":"2025-12-07T20:31:41.181568-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-kfi","title":"[Security] SECRET_PATTERNS - Regex patterns for secret detection","description":"Implement the SECRET_PATTERNS array containing high-yield regex patterns for detecting common secrets.\n\nCOMPLETE list of patterns:\n\nTypeScript implementation:\n```typescript\nconst SECRET_PATTERNS: Array\u003c{ pattern: RegExp; replacement: string }\u003e = [\n  // AWS\n  { pattern: /AKIA[0-9A-Z]{16}/g, replacement: \"[AWS_ACCESS_KEY]\" },\n  { pattern: /[A-Za-z0-9/+=]{40}(?=\\s|$|\"|')/g, replacement: \"[AWS_SECRET_KEY]\" },\n\n  // Generic API keys/tokens\n  { pattern: /Bearer\\s+[A-Za-z0-9\\-\\._~\\+\\/]+=*/g, replacement: \"[BEARER_TOKEN]\" },\n  { pattern: /api[_-]?key[\"\\s:=]+[\"']?[A-Za-z0-9\\-_]{20,}[\"']?/gi, replacement: \"[API_KEY]\" },\n  { pattern: /token[\"\\s:=]+[\"']?[A-Za-z0-9\\-_]{20,}[\"']?/gi, replacement: \"[TOKEN]\" },\n\n  // Private keys\n  { pattern: /-----BEGIN (RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----[\\s\\S]+?-----END (RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----/g, replacement: \"[PRIVATE_KEY]\" },\n\n  // Passwords in common formats\n  { pattern: /password[\"\\s:=]+[\"'][^\"']{8,}[\"']/gi, replacement: 'password=\"[REDACTED]\"' },\n\n  // GitHub tokens\n  { pattern: /ghp_[A-Za-z0-9]{36}/g, replacement: \"[GITHUB_PAT]\" },\n  { pattern: /github_pat_[A-Za-z0-9_]{22,}/g, replacement: \"[GITHUB_PAT]\" },\n\n  // Slack tokens\n  { pattern: /xox[baprs]-[A-Za-z0-9-]+/g, replacement: \"[SLACK_TOKEN]\" },\n\n  // Database URLs with credentials\n  { pattern: /(postgres|mysql|mongodb):\\/\\/[^:]+:[^@]+@/gi, replacement: \"$1://[USER]:[PASS]@\" }\n];\n```\n\nEach pattern is chosen for HIGH YIELD - catches most secrets without excessive false positives.\nThese are proven patterns that work across codebases.\n\nPriority: 0 (Security Critical - P12)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:47.352672-05:00","updated_at":"2025-12-07T18:48:03.205548-05:00","closed_at":"2025-12-07T18:43:22.954606-05:00"}
{"id":"cass_memory_system-kfj","title":"[Types] ContextResult - Pre-Task Hydration Output","description":"## Overview\nDefine ContextResult type - the structured output from pre-task hydration that provides agents with relevant playbook rules, history, and warnings.\n\n## Purpose\nContextResult is the PRIMARY INTERFACE between cass-memory and AI agents:\n1. Delivered before each task to provide relevant context\n2. Includes playbook rules ranked by relevance\n3. Provides historical session snippets\n4. Warns about deprecated patterns\n5. Suggests useful cass queries for deeper investigation\n\n## ContextResult Structure\n\nCore fields that make up the hydrated context.\n\ntask: string\n- The task description that triggered context retrieval\n- Example: 'Implement JWT authentication for API endpoints'\n- Used for: Relevance ranking, scope filtering\n\nrelevantBullets: RelevantBullet[]\n- Array of playbook rules relevant to task\n- Ranked by: effectiveScore (with decay), semantic similarity, scope match\n- Limited by: config.maxBulletsInContext (default 50)\n- Sorted: Highest relevance first\n\nantiPatterns: AntiPattern[]\n- Array of anti-pattern warnings (type: 'anti-pattern')\n- Displayed separately as PITFALLS section\n- Purpose: Warn about common mistakes\n- Example: { id: 'b-xyz', content: 'Don't mock Router hooks directly', type: 'anti-pattern', effectiveScore: 8.2 }\n\nhistorySnippets: HistorySnippet[]\n- Array of relevant session excerpts from cass\n- Limited by: config.maxHistoryInContext (default 10)\n- Provides: Real examples from past work\n- Sorted: By relevance score\n\ndeprecatedWarnings: string[]\n- Array of warnings about deprecated patterns\n- Triggered if: Task description matches deprecatedPatterns\n- Example: ['Warning: \"Use class components\" is deprecated as of 2025-11-15. See b-new-hooks-rule instead.']\n\nsuggestedCassQueries: string[]\n- Array of recommended cass search queries\n- Generated from: Task analysis, bullet searchPointers\n- Purpose: Help agent find more context if needed\n- Example: ['JWT authentication patterns', 'token validation examples', 'auth middleware setup']\n\n## RelevantBullet Structure\n\nIndividual playbook rule in context.\n\nFields:\n- id: string (bullet ID)\n- content: string (rule text)\n- category: string (e.g., 'authentication')\n- type: 'rule' | 'anti-pattern'\n- maturity: 'candidate' | 'established' | 'proven'\n- effectiveScore: number (decayed confidence score)\n- lastHelpful: string | undefined (ISO 8601, most recent helpful mark)\n- reasoning: string | undefined (why rule was created)\n- searchPointer: string | undefined (for deeper investigation)\n\nExample:\n{ id: 'b-abc123', content: 'Use TokenValidator from @/lib/auth for JWT validation', category: 'authentication', type: 'rule', maturity: 'proven', effectiveScore: 12.5, lastHelpful: '2025-12-07T14:30:00Z', reasoning: 'Prevents auth bypass vulnerabilities' }\n\n## AntiPattern Structure\n\nAnti-pattern warning in context.\n\nFields:\n- id: string (bullet ID)\n- content: string (warning text)\n- type: 'anti-pattern' (always)\n- effectiveScore: number (how important this warning is)\n- category: string | undefined\n\nExample:\n{ id: 'b-xyz789', content: 'Don't mock useRouter - use mockRouter from test/utils', type: 'anti-pattern', effectiveScore: 8.2, category: 'testing' }\n\n## HistorySnippet Structure\n\nRelevant excerpt from past session.\n\nFields:\n- sessionPath: string (path to session file)\n- agent: string (which agent)\n- snippet: string (relevant excerpt, ~200 chars)\n- relevance: number (0-1, similarity to task)\n- timestamp: string | undefined (when session occurred)\n\nExample:\n{ sessionPath: '/cass/2025-12-05-auth-impl.jsonl', agent: 'claude', snippet: 'Implemented JWT validation using TokenValidator service with exp claim checks', relevance: 0.89, timestamp: '2025-12-05T10:15:00Z' }\n\n## Context Retrieval Flow\n\n1. Parse task description\n2. Determine scope (workspace, language, framework from task context)\n3. Filter bullets by scope\n4. Rank bullets by:\n   - Effective confidence score (with decay)\n   - Semantic similarity to task\n   - Maturity level\n5. Separate anti-patterns\n6. Search cass for relevant history\n7. Check for deprecated pattern matches\n8. Generate suggested queries\n9. Return ContextResult\n\n## JSON Output Mode\n\nCritical for agent integration (P2 feature).\n\nWhen config.jsonOutput = true, format as:\n{ task: '...', relevantBullets: [...], antiPatterns: [...], historySnippets: [...], deprecatedWarnings: [...], suggestedCassQueries: [...] }\n\nEnables: Programmatic consumption by AI agents, MCP integration, tool use\n\n## Display Format (Human-Readable)\n\nWhen config.jsonOutput = false:\n\nRELEVANT PLAYBOOK RULES:\n[PROVEN] Use TokenValidator from @/lib/auth for JWT validation (score: 12.5)\n  Reasoning: Prevents auth bypass vulnerabilities\n  Last helpful: 2 days ago\n\n[ESTABLISHED] Validate JWT exp and iat claims (score: 8.2)\n  Last helpful: 5 days ago\n\nPITFALLS TO AVOID:\n- Don't mock Router hooks directly - use mockRouter utility\n\nRELEVANT HISTORY:\n[2 days ago, claude] Implemented JWT validation using TokenValidator...\n[5 days ago, cursor] Added exp claim validation to prevent token replay...\n\nSUGGESTED CASS QUERIES:\n- cass search \"JWT authentication patterns\"\n- cass search \"token validation examples\"\n\n## Acceptance Criteria\n- ContextResult interface with all fields\n- RelevantBullet interface\n- AntiPattern interface\n- HistorySnippet interface\n- Zod schema validation\n- JSON output mode\n- Human-readable display format\n- Scope filtering logic\n- Relevance ranking algorithm\n- Examples showing complete context\n- JSDoc documentation\n- Integration with context command","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:07.368147-05:00","updated_at":"2025-12-07T20:09:09.488026-05:00","closed_at":"2025-12-07T20:08:29.011501-05:00"}
{"id":"cass_memory_system-koji","title":"[Testing:Fixtures] Test fixture files","description":"tests/fixtures/session.jsonl:\n{\"role\":\"user\",\"content\":\"Help me write a React hook\"}\n{\"role\":\"assistant\",\"content\":\"I'll create a useAuth hook...\"}\n\ntests/fixtures/playbook.yaml:\nschema_version: 2\nbullets:\n  - id: \"b-test-001\"\n    category: testing\n    content: \"Use React Testing Library\"\n    ...","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:48.141817-05:00","updated_at":"2025-12-08T14:04:52.929118-05:00","closed_at":"2025-12-08T14:04:52.929118-05:00"}
{"id":"cass_memory_system-krys","title":"[CLI] diary command - Generate session diary","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:37.942813-05:00","updated_at":"2025-12-07T21:13:40.086301-05:00","closed_at":"2025-12-07T21:13:38.273428-05:00"}
{"id":"cass_memory_system-kxi7","title":"Unit tests for utils.ts - Utility functions","description":"Complete unit test coverage for utils.ts:\n- getBulletsByCategory() filtering and sorting\n- findUnprocessedSessions() directory scanning\n- Date/time utilities\n- Path normalization\n- String utilities (truncation, sanitization)\n- Array utilities (deduplication, grouping)\nNO MOCKS - use real filesystem fixtures where needed","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:25:41.093958-05:00","updated_at":"2025-12-08T14:15:54.049462-05:00","closed_at":"2025-12-08T14:15:54.049462-05:00","dependencies":[{"issue_id":"cass_memory_system-kxi7","depends_on_id":"cass_memory_system-ai52","type":"blocks","created_at":"2025-12-07T20:28:09.461054-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-kyzs","title":"[Config] Cascading configuration architecture","description":"Memory as Code - Configuration and playbooks merge from multiple levels:\n\n1. Global level: ~/.cass-memory/\n   - User preferences\n   - Personal rules\n   - API keys\n\n2. Repo level: .cass/\n   - Project-specific rules\n   - Team conventions\n   - Committed to git (shared!)\n\nMerge order: global → repo (repo wins on conflict)\nThis means cloning a repo gives you the team's memory instantly!\n\nImplementation requires:\n- Two-level configuration hierarchy\n- Conflict resolution strategy (repo wins)\n- Seamless merging of playbooks and config files\n- Git-friendly repo-level storage (.cass/ directory)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:49:21.740485-05:00","updated_at":"2025-12-07T20:50:29.265486-05:00","closed_at":"2025-12-07T20:50:09.068309-05:00"}
{"id":"cass_memory_system-l12","title":"[Reflector] formatCassHistory - Structure history for prompt","description":"function formatCassHistory(hits: CassHit[]): string\n\nFormat:\n```\nRELATED HISTORY FROM OTHER AGENTS:\n\nSession: ~/.cursor/projects/myapp/session-001.jsonl\nAgent: cursor\nSnippet: \"Fixed similar authentication issue by...\"\n---\nSession: ~/.codex/sessions/xyz.jsonl\nAgent: codex\nSnippet: \"Used waitFor to handle async...\"\n```\n\nSTRUCTURE:\n1. Header line\n2. For each hit:\n   - Session path (relative if possible)\n   - Agent name\n   - Relevant snippet (truncate to 200 chars)\n   - Separator (---)\n3. Limit to top 5 hits\n\nWHY THIS FORMAT:\n- Clear source attribution\n- Concise for prompt inclusion\n- Easy to scan for relevance\n\nTRUNCATION:\nIf snippet \u003e 200 chars, truncate with \"...\"\n\nUsed in fetchCrossAgentHistory()","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:58.038308-05:00","updated_at":"2025-12-07T19:25:15.776103-05:00","closed_at":"2025-12-07T19:25:10.554438-05:00"}
{"id":"cass_memory_system-l1ft","title":"Infra: Offline LLM Stub","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:23:02.916783-05:00","updated_at":"2025-12-08T14:19:16.454789-05:00","closed_at":"2025-12-08T14:19:16.454789-05:00"}
{"id":"cass_memory_system-l2gd","title":"[Testing] Add pure unit tests: cass integration wrappers (cass.ts)","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:29:48.466892-05:00","updated_at":"2025-12-08T14:27:02.255023-05:00","closed_at":"2025-12-08T14:27:02.255023-05:00","dependencies":[{"issue_id":"cass_memory_system-l2gd","depends_on_id":"cass_memory_system-f63a","type":"blocks","created_at":"2025-12-07T20:29:48.470533-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-l2ok","title":"[CLI:playbook] get - Get single bullet details","description":"Display detailed information for a single playbook bullet.\n\nCommand signature:\n```bash\ncass-memory playbook get \u003cbullet-id\u003e [--json]\n```\n\nImplementation:\n1. Load playbook\n2. Find bullet by ID\n3. Calculate effective score (with time decay)\n4. Format detailed output\n\nOutput format:\n```\nBULLET: b-abc123\n\nContent: Always run tests before committing\nCategory: best-practice\nMaturity: proven\nScope: global\n\nScores:\n  Raw score: 0.95\n  Effective score: 0.92 (with decay)\n  Positive feedback: 12\n  Negative feedback: 1\n\nHistory:\n  Created: 2024-11-15T10:30:00Z\n  Last updated: 2025-01-10T14:22:00Z\n  Age: 56 days\n\nSource sessions:\n  - ~/.claude/sessions/session-001.jsonl\n  - ~/.cursor/sessions/session-xyz.jsonl\n  - ~/.aider/sessions/2024-11-15-abc.jsonl\n\nTags: [testing, ci-cd, quality]\n\n{if deprecated:}\nStatus: DEPRECATED\nReason: {deprecationReason}\nDeprecated at: {deprecatedAt}\n```\n\nJSON output:\n- Include all fields from Bullet type\n- Add computed fields: effectiveScore, age\n- Full source session paths\n\nError handling:\n- If bullet ID not found: error message with suggestion\n- Suggest similar IDs (fuzzy match)\n\nThis command helps understand individual bullet provenance and health.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:59.52504-05:00","updated_at":"2025-12-07T22:45:37.63512-05:00","closed_at":"2025-12-07T22:45:32.881958-05:00"}
{"id":"cass_memory_system-l2w","title":"[Reflector] summarizeExistingBullets - Compact bullet representation","description":"function summarizeExistingBullets(bullets: PlaybookBullet[]): string\n\nFormat:\n```\nEXISTING PLAYBOOK BULLETS (summarized by category):\n\n### testing\n- [b-abc123] Use React Testing Library for components\n- [b-def456] Run tests before committing\n\n### git\n- [b-ghi789] Make atomic commits\n```\n\nPURPOSE:\n- Keeps prompt concise while providing context for helpful/harmful marks\n- Shows LLM what's already in playbook to avoid redundancy\n- Groups by category for better organization\n\nIMPLEMENTATION:\n1. Group bullets by category\n2. Sort categories alphabetically\n3. Format with markdown headers\n4. Include bulletId for reference\n5. Truncate content if needed (max 100 chars per bullet)\n\nUsed in buildReflectorPrompt()","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:53.704474-05:00","updated_at":"2025-12-07T18:56:58.859864-05:00","closed_at":"2025-12-07T18:56:45.259983-05:00"}
{"id":"cass_memory_system-l5e","title":"[Decay] getLastFeedbackTimestamp - Most recent feedback date","description":"Get the timestamp of the most recent feedback event (helpful or harmful) for a bullet. Used in stats command, stale detection, and UI displays.\n\nCOMPLETE IMPLEMENTATION:\n```typescript\n/**\n * Get timestamp of most recent feedback event.\n * Returns null if bullet has no feedback history.\n */\nfunction getLastFeedbackTimestamp(bullet: PlaybookBullet): Date | null {\n  const allEvents = [...bullet.helpfulEvents, ...bullet.harmfulEvents];\n  \n  if (allEvents.length === 0) return null;\n\n  const timestamps = allEvents.map(e =\u003e new Date(e.timestamp).getTime());\n  return new Date(Math.max(...timestamps));\n}\n```\n\nUSAGE EXAMPLES:\n\n1. STATS COMMAND:\n```typescript\nbullets.forEach(bullet =\u003e {\n  const lastFeedback = getLastFeedbackTimestamp(bullet);\n  const daysSince = lastFeedback \n    ? Math.floor((Date.now() - lastFeedback.getTime()) / (1000*60*60*24))\n    : Infinity;\n  \n  console.log(`${bullet.title}: ${lastFeedback ? `${daysSince} days ago` : 'never'}`);\n});\n```\n\n2. STALE DETECTION:\n```typescript\nfunction isStale(bullet: PlaybookBullet, staleDays: number = 90): boolean {\n  const lastFeedback = getLastFeedbackTimestamp(bullet);\n  \n  if (\\!lastFeedback) {\n    return daysSince(bullet.createdAt) \u003e staleDays;\n  }\n  \n  return daysSince(lastFeedback) \u003e staleDays;\n}\n```\n\n3. SORTING BY ACTIVITY:\n```typescript\n// Sort bullets by most recently used\nconst sortedByActivity = bullets.sort((a, b) =\u003e {\n  const aTime = getLastFeedbackTimestamp(a)?.getTime() ?? 0;\n  const bTime = getLastFeedbackTimestamp(b)?.getTime() ?? 0;\n  return bTime - aTime;  // Most recent first\n});\n```\n\n4. JSON OUTPUT:\n```typescript\n{\n  id: 'rule-123',\n  title: 'Use semantic imports',\n  lastFeedback: getLastFeedbackTimestamp(bullet)?.toISOString() ?? null,\n  daysSinceLastFeedback: lastFeedback ? daysSince(lastFeedback) : null\n}\n```\n\nRETURN VALUES:\n\nnull:\n- No helpful events AND no harmful events\n- Bullet has never received feedback\n- May indicate unused or never-matched rule\n\nDate object:\n- Most recent timestamp from either helpful or harmful\n- Can be compared, formatted, or converted to ISO string\n- Use .getTime() for numeric comparison\n- Use .toISOString() for JSON serialization\n\nEDGE CASES:\n\n1. Only helpful events:\n   - Returns max(helpfulEvents.timestamp)\n\n2. Only harmful events:\n   - Returns max(harmfulEvents.timestamp)\n\n3. Both helpful and harmful:\n   - Returns max of all events\n   - Could be helpful or harmful - whichever is most recent\n\n4. Empty arrays:\n   - Returns null\n   - Caller should handle null case\n\nDEPENDENCIES:\n- PlaybookBullet.helpfulEvents: FeedbackEvent[]\n- PlaybookBullet.harmfulEvents: FeedbackEvent[]\n- FeedbackEvent.timestamp: string (ISO format)\n\nUSED BY:\n- isStale()\n- stats command\n- review command (future)\n- UI/dashboard displays (future)\n- Activity-based sorting\n- Playbook health analytics","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:46:37.38492-05:00","updated_at":"2025-12-08T14:28:58.37269-05:00","closed_at":"2025-12-08T14:28:58.37269-05:00"}
{"id":"cass_memory_system-l5nt","title":"[CLI] stats command - Playbook health dashboard","description":"Implements the main entry point for the 'cass-memory stats' command - a comprehensive health dashboard for the playbook.\n\nCOMMAND SYNTAX:\n```bash\ncass-memory stats [options]\n\nOptions:\n  --json    Output in JSON format instead of pretty terminal UI\n```\n\nPURPOSE:\nProvides a single command to understand the overall health and composition of the playbook. Surfaces actionable insights like stale bullets, merge candidates, and at-risk rules.\n\nDISPLAYED METRICS:\n1. Total counts (global vs workspace)\n2. Maturity distribution (candidate/established/proven/deprecated)\n3. Type breakdown (rules vs anti-patterns)\n4. Score distribution buckets\n5. Top performers (highest effective scores)\n6. At-risk bullets (negative/declining scores)\n7. Stale bullets (no feedback in 90+ days)\n8. Merge candidates (high semantic similarity)\n\nIMPLEMENTATION REQUIREMENTS:\n1. Parse command-line options\n2. Load playbook from storage\n3. Compute full statistics (computeFullStats)\n4. Route to JSON output or terminal UI renderer\n5. Highlight actionable items\n\nOUTPUT MODES:\n1. Terminal UI (default):\n   - Pretty box drawing with colors\n   - Visual charts (bar graphs, sparklines)\n   - Highlighted warnings/issues\n   - Actionable recommendations\n\n2. JSON (--json):\n   - Complete stats object\n   - Machine-readable for scripting\n   - Include all metrics and lists\n\nACTIONABLE INSIGHTS:\n- \"5 bullets at risk - run 'cass-memory show \u003cid\u003e' to review\"\n- \"3 potential duplicates - consider 'cass-memory merge'\"\n- \"12 stale bullets - last feedback \u003e90 days ago\"\n\nDEPENDENCIES:\n- Playbook loader\n- Stats computation (computeFullStats)\n- Terminal UI renderer (renderStatsUI)\n- JSON serialization\n\nSUCCESS CRITERIA:\n- Stats computed correctly across all dimensions\n- Terminal UI readable and informative\n- JSON output valid and complete\n- Actionable items clearly highlighted\n- Performance acceptable even for large playbooks (1000+ bullets)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:53:16.549568-05:00","updated_at":"2025-12-07T20:22:21.032174-05:00","closed_at":"2025-12-07T20:22:18.435997-05:00"}
{"id":"cass_memory_system-l6kv","title":"Unit tests for lock.ts - File locking mechanisms","description":"Complete unit test coverage for lock.ts:\n- Lock acquisition and release\n- Lock timeout handling\n- Stale lock detection\n- Lock file cleanup\n- Concurrent lock attempts\n- Edge cases: process crash recovery, orphaned locks\nNO MOCKS - use real temp directory with actual file locks","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:25:44.374398-05:00","updated_at":"2025-12-08T14:16:37.966652-05:00","closed_at":"2025-12-08T14:16:37.966652-05:00","dependencies":[{"issue_id":"cass_memory_system-l6kv","depends_on_id":"cass_memory_system-ai52","type":"blocks","created_at":"2025-12-07T20:28:09.68802-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-laj4","title":"[ErrorHandling] handleMalformedLLMResponse - Parse failures","description":"Handle malformed or invalid LLM responses with retry and recovery.\n\nFunction signature:\nasync function handleMalformedLLMResponse(\n  response: unknown,\n  schema: z.ZodSchema,\n  prompt: string\n): Promise\u003cunknown\u003e\n\nImplementation:\n- Log the malformed response for debugging\n- Retry with modified prompt emphasizing JSON format requirements\n- Include example of expected output structure\n- Slightly increase temperature (may help with parsing)\n- Try to extract partial valid data if possible\n- Throw detailed error after max attempts with example of what was expected\n\nRecovery strategies:\n1. First retry: Add explicit JSON format instructions\n2. Second retry: Include example output\n3. Final retry: Simplify request\n4. Extract partial data or fail gracefully","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:24.594734-05:00","updated_at":"2025-12-07T22:34:15.770992-05:00","closed_at":"2025-12-07T22:33:30.738588-05:00"}
{"id":"cass_memory_system-laui","title":"[Decay] Per-bullet half-life configuration","description":"$(cat /tmp/fix_laui.txt)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:48:55.58999-05:00","updated_at":"2025-12-07T21:01:42.046224-05:00","closed_at":"2025-12-07T21:01:38.719972-05:00"}
{"id":"cass_memory_system-lmna","title":"[CLI] init command - Initialize cass-memory","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:30.383633-05:00","updated_at":"2025-12-07T21:13:03.917075-05:00","closed_at":"2025-12-07T21:12:21.859543-05:00"}
{"id":"cass_memory_system-lmwr","title":"E2E test: 'cass reflect' command","description":"E2E test for 'cass reflect' CLI command:\n- Real subprocess execution via bun\n- Test reflection on session exports\n- Verify deltas are generated correctly\n- Verify playbook is updated with new patterns\n- Test --dry-run mode\n- Test --max-iterations option\n- Test error cases: no sessions, invalid session format\n- Detailed logging: sessions processed, deltas generated, playbook changes\nSetup: fixture directory with session exports and initial playbook\nNOTE: Requires test API key for real LLM calls","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:27:20.854775-05:00","updated_at":"2025-12-08T14:03:17.50574-05:00","closed_at":"2025-12-08T14:03:17.50574-05:00","dependencies":[{"issue_id":"cass_memory_system-lmwr","depends_on_id":"cass_memory_system-8dxr","type":"blocks","created_at":"2025-12-07T20:28:34.102278-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-lyu","title":"[LLM] runValidator - Scientific validation","description":"Function signature:\nasync function runValidator\u003cT extends z.ZodSchema\u003e(\n  schema: T,\n  proposedRule: string,\n  evidence: string,\n  config: Config\n): Promise\u003cz.infer\u003cT\u003e\u003e\n\nImplementation:\n1. Build prompt from PROMPTS.validator template\n2. Substitute variables:\n   - proposedRule: the bullet text to validate\n   - evidence: historical session data from cass (last 90 days)\n3. Call generateObject with:\n   - schema: validation result schema\n   - temperature: 0.2 (low for consistency)\n4. Return validation result with:\n   - isValid: boolean\n   - reasoning: string (cite session paths)\n   - suggestedRefinement?: string (if wording could improve)\n\nUsed by: validate command (GPT Pro innovation).\n\nThis is the scientific method - test hypotheses against empirical data.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:59.994922-05:00","updated_at":"2025-12-07T20:11:16.258885-05:00","closed_at":"2025-12-07T20:11:02.186794-05:00"}
{"id":"cass_memory_system-m2jt","title":"[Semantic] loadOrComputeEmbeddings - Cache-aware embedding","description":"Load embeddings from cache or compute fresh if needed.\n\nImplementation:\n```typescript\nasync function loadOrComputeEmbeddings(\n  playbook: Playbook,\n  cache: EmbeddingCache\n): Promise\u003cvoid\u003e\n```\n\nProcess for each bullet:\n1. Compute content hash\n2. Check cache for bullet.id\n3. If cached AND hash matches:\n   - Use cached embedding\n   - Skip computation\n4. Otherwise:\n   - Compute fresh embedding\n   - Update cache entry\n5. Mutate bullet.embedding in place\n6. Save cache at end\n\nCache hit rate:\n- First run: 0% (cold cache)\n- Subsequent runs: ~95% (only changed bullets recomputed)\n- After content change: ~90% (only affected bullets)\n\nPerformance:\n- Cache hit: \u003c1ms (array lookup)\n- Cache miss: ~3ms (embedding computation)\n- 100 bullets, 95% hit rate: ~65ms total\n\nError handling:\n- Missing cache file → create new\n- Corrupt cache → rebuild\n- Hash mismatch → recompute\n- Model mismatch → recompute all\n\nAtomic updates:\n- Write to temp file\n- Move to final location\n- Prevents corruption from crashes","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-07T16:49:33.888832-05:00","updated_at":"2025-12-07T17:14:56.802359-05:00","comments":[{"id":20,"issue_id":"cass_memory_system-m2jt","author":"jemanuel","text":"Load embeddings from cache or compute fresh if needed.\n\nImplementation:\n```typescript\nasync function loadOrComputeEmbeddings(\n  playbook: Playbook,\n  cache: EmbeddingCache\n): Promise\u003cvoid\u003e\n```\n\nProcess for each bullet:\n1. Compute content hash\n2. Check cache for bullet.id\n3. If cached AND hash matches:\n   - Use cached embedding\n   - Skip computation\n4. Otherwise:\n   - Compute fresh embedding\n   - Update cache entry\n5. Mutate bullet.embedding in place\n6. Save cache at end\n\nCache hit rate:\n- First run: 0% (cold cache)\n- Subsequent runs: ~95% (only changed bullets recomputed)\n- After content change: ~90% (only affected bullets)\n\nPerformance:\n- Cache hit: \u003c1ms (array lookup)\n- Cache miss: ~3ms (embedding computation)\n- 100 bullets, 95% hit rate: ~65ms total\n\nError handling:\n- Missing cache file → create new\n- Corrupt cache → rebuild\n- Hash mismatch → recompute\n- Model mismatch → recompute all\n\nAtomic updates:\n- Write to temp file\n- Move to final location\n- Prevents corruption from crashes","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-m55","title":"[Generator] scorePlaybookBullets - Relevance scoring","description":"Score and rank playbook bullets by relevance to task.\n\nSIGNATURE:\nfunction scorePlaybookBullets(bullets: PlaybookBullet[], keywords: string[], config: Config): ScoredBullet[]\n\nPURPOSE:\nCalculate relevance scores for playbook bullets to surface the most useful rules for the current task. Combines keyword matching with temporal decay from feedback events.\n\nSCORING ALGORITHM:\nFor each active bullet:\n1. Calculate keyword relevance: scoreBulletRelevance(bullet, keywords)\n   - Count keyword matches in content/category/tags\n   - Weight by keyword importance (exact match \u003e partial \u003e stem)\n   - Range: 0.0 to 1.0\n\n2. Calculate effective score: getEffectiveScore(bullet, config)\n   - Base score from helpful/unhelpful events\n   - Apply temporal decay (recent feedback weighted higher)\n   - Range: -5.0 to +5.0\n\n3. Combine scores: final = relevance * max(0.1, effectiveScore)\n   - relevance gates the effective score\n   - Minimum 0.1 multiplier prevents total zero-out\n   - This ensures keyword match is required for high ranking\n\n4. Sort by final score descending\n\n5. Return top config.maxBulletsInContext (default 10)\n\nFILTERING:\n- Only include bullets with status: 'active'\n- Exclude bullets marked as deprecated\n- Exclude anti-patterns (handled separately)\n\nOUTPUT:\nArray\u003c{\n  ...bullet,\n  relevanceScore: number,\n  effectiveScore: number,\n  finalScore: number\n}\u003e\n\nEDGE CASES:\n- No keywords: Use base effective score only\n- New bullets (no feedback): Default effective score 0.5\n- Negative effective score: Can happen if unhelpful \u003e helpful","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:54.91684-05:00","updated_at":"2025-12-07T18:59:44.045055-05:00","closed_at":"2025-12-07T18:59:33.687319-05:00"}
{"id":"cass_memory_system-m7np","title":"EPIC: Comprehensive Test Coverage - Unit, Integration, E2E","description":"# EPIC: Comprehensive Test Coverage\n\n## Current State (As of Dec 2025)\n- **Coverage**: ~37% (10 test files, 1,147 LOC tests vs 7,199 LOC source)\n- **Unit Tests**: Partial coverage on 6/28 source files\n- **Integration Tests**: NONE\n- **E2E Tests**: NONE\n- **Mock Usage**: Minimal (only console.warn in retry tests)\n\n## Philosophy: Real Tests, No Fakes\nThis epic prioritizes REAL behavior testing:\n- Unit tests use actual function implementations\n- Integration tests use real file I/O with temp directories\n- E2E tests run actual CLI commands with fixture data\n- Mocks ONLY for external services (LLM APIs) with clear boundaries\n\n## Structure\n1. **Sub-Epic: Unit Tests** - Pure function testing without mocks\n2. **Sub-Epic: Integration Tests** - Multi-module testing with real files\n3. **Sub-Epic: E2E Test Suite** - Complete workflow testing with logging\n\n## Success Criteria\n- [ ] 95%+ line coverage on all source files\n- [ ] Every exported function has explicit test cases\n- [ ] Integration tests cover all file I/O paths\n- [ ] E2E tests cover all CLI commands\n- [ ] Detailed logging in E2E tests for debugging\n- [ ] CI/CD integration with coverage reporting","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-07T20:22:32.238036-05:00","updated_at":"2025-12-08T00:17:18.118717-05:00","closed_at":"2025-12-08T00:15:39.095907-05:00","dependencies":[{"issue_id":"cass_memory_system-m7np","depends_on_id":"cass_memory_system-ai52","type":"blocks","created_at":"2025-12-07T20:31:41.586111-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-mcs8","title":"[CLI:playbook] export/import - Playbook portability","description":"Export and import playbook for portability and sharing.\n\nCommand signatures:\n```bash\ncass-memory playbook export [--yaml|--json] \u003e playbook.yaml\ncass-memory playbook import \u003cfile\u003e\n```\n\nEXPORT implementation:\n1. Load current playbook\n2. Serialize to requested format:\n   - Default: YAML (more human-readable)\n   - --json: JSON format\n3. Output to stdout (user redirects to file)\n\nExport format considerations:\n- Include all bullets (even deprecated if using --all)\n- Strip source session paths (not portable)\n- Preserve IDs for reimport\n- Include metadata: version, exported_at\n\nIMPORT implementation:\n1. Parse input file (detect YAML vs JSON)\n2. Validate schema\n3. Merge strategy:\n   - If bullet ID exists: skip (don't overwrite)\n   - If new: add to playbook\n   - Optional --replace flag to overwrite existing\n4. Display import summary:\n   ```\n   Imported playbook from playbook.yaml\n   - 5 bullets added\n   - 2 bullets skipped (already exist)\n   - 0 bullets updated\n   ```\n\nUse cases:\n- Share playbook between team members\n- Backup playbook\n- Migrate between systems\n- Import external best practices\n\nExample workflow:\n```bash\n# Export on machine A\ncass-memory playbook export \u003e my-playbook.yaml\n\n# Import on machine B\ncass-memory playbook import my-playbook.yaml\n\n# Import with overwrite\ncass-memory playbook import --replace my-playbook.yaml\n```\n\nValidation:\n- Check file exists\n- Validate YAML/JSON syntax\n- Validate bullet schema\n- Warn on version mismatches","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:52:38.414909-05:00","updated_at":"2025-12-08T00:14:50.530438-05:00","closed_at":"2025-12-08T00:14:43.875854-05:00"}
{"id":"cass_memory_system-md5c","title":"[Unit] security.ts - Complete Sanitization Coverage","description":"## Target: src/security.ts - Complete Sanitization Coverage\n\n### Functions to Test:\n1. **sanitizePath(path)** - Path traversal prevention\n   - Clean path unchanged: '/home/user/file.txt'\n   - Traversal blocked: '../../../etc/passwd' → error or sanitized\n   - Double encoding: '%2e%2e%2f' handling\n   - Null bytes: 'file\\x00.txt' stripped\n   - Unicode normalization attacks\n   - Windows paths: 'C:\\..\\' on cross-platform\n   - Symlink considerations (document behavior)\n\n2. **sanitizeInput(input)** - General input sanitization\n   - XSS vectors: '\u003cscript\u003ealert(1)\u003c/script\u003e'\n   - SQL injection patterns (if applicable)\n   - Command injection: '; rm -rf /'\n   - Template injection: '{{constructor.constructor}}'\n   - Length limits\n   - Encoding preservation for valid Unicode\n\n3. **validateBulletId(id)** - ID format validation\n   - Valid format: 'project-xxxx' pattern\n   - Invalid characters rejected\n   - Length constraints\n   - Case sensitivity rules\n\n4. **escapeForShell(arg)** - Shell argument escaping\n   - Spaces: 'hello world' → quoted\n   - Special chars: '$HOME' → escaped\n   - Quotes within strings\n   - Empty string handling\n   - Newlines and control chars\n\n5. **escapeForRegex(str)** - Regex metachar escaping\n   - All metacharacters: . * + ? ^ $ { } [ ] \\ | ( )\n   - Safe strings unchanged\n   - Empty string handling\n\n### Security Test Patterns:\n- OWASP test vectors\n- Fuzzing-style boundary inputs\n- Known CVE patterns (where applicable)\n- Verify NO false negatives (security must not fail open)\n- Test error messages don't leak sensitive info","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:24:34.725358-05:00","updated_at":"2025-12-07T22:02:29.71902-05:00","closed_at":"2025-12-07T22:02:29.71902-05:00","dependencies":[{"issue_id":"cass_memory_system-md5c","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:14.199287-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-md5c","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:32:57.104773-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-mehs","title":"[Tracking] LLM cost tracking","description":"Purpose: Track LLM usage and estimated costs for budget awareness\n\nFile path: ~/.cass-memory/cost/usage-{YYYY-MM}.json\nExample: ~/.cass-memory/cost/usage-2025-12.json\n\nType definitions:\n```typescript\ninterface CostEntry {\n  timestamp: string;           // ISO 8601\n  operation: 'diary' | 'reflect' | 'validate' | 'context';\n  provider: string;            // 'anthropic', 'openai', etc.\n  model: string;               // 'claude-opus-4', 'gpt-4', etc.\n  inputTokens: number;\n  outputTokens: number;\n  estimatedCost: number;       // USD\n}\n\ninterface MonthlyCost {\n  entries: CostEntry[];\n  totals: {\n    inputTokens: number;\n    outputTokens: number;\n    estimatedCost: number;\n  };\n}\n```\n\nOperations:\n- diary: Diary entry generation\n- reflect: Reflection analysis\n- validate: Delta validation\n- context: Context building/filtering\n\nImplementation:\n- One file per month (rotate monthly)\n- Append entries as operations complete\n- Recalculate totals on save\n- Use current pricing from config","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:10.870267-05:00","updated_at":"2025-12-07T22:34:43.091021-05:00","closed_at":"2025-12-07T22:34:18.23284-05:00"}
{"id":"cass_memory_system-mey","title":"[Diary] saveDiaryEntry - Persist to disk","description":"$(cat /tmp/fix_mey.txt)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:56.156512-05:00","updated_at":"2025-12-07T20:10:22.246437-05:00","closed_at":"2025-12-07T20:10:01.199032-05:00"}
{"id":"cass_memory_system-mikz","title":"Integration test: Curator pipeline (curate + validate)","description":"Integration test for Curator pipeline:\n- curatePlaybook() -\u003e validatePlaybook() full flow\n- Real playbook fixtures with various bullet states\n- Verify anti-pattern inversion persists through validation\n- Verify maturity transitions are validated correctly\n- Verify pruning decisions are reflected in output\n- Detailed logging: input state, transform deltas, output state\nNO MOCKS - real curate.ts + validate.ts interaction","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:26:20.995694-05:00","updated_at":"2025-12-07T21:55:43.331866-05:00","closed_at":"2025-12-07T21:55:43.331866-05:00","dependencies":[{"issue_id":"cass_memory_system-mikz","depends_on_id":"cass_memory_system-0rfo","type":"blocks","created_at":"2025-12-07T20:28:21.304779-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-mikz","depends_on_id":"cass_memory_system-su9a","type":"blocks","created_at":"2025-12-07T20:28:21.461721-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-mjhj","title":"[Testing] tests/ directory structure","description":"tests/\n├── setup.ts              # Global test setup\n├── unit/\n│   ├── utils.test.ts\n│   ├── playbook.test.ts\n│   ├── validators.test.ts\n│   ├── decay.test.ts\n│   └── curator.test.ts\n├── integration/\n│   ├── cass.test.ts\n│   ├── playbook-persistence.test.ts\n│   └── config.test.ts\n├── llm/\n│   ├── diary-extraction.test.ts\n│   ├── reflector.test.ts\n│   └── validator.test.ts\n├── e2e/\n│   └── commands.test.sh\n├── property/\n│   └── deduplication.test.ts\n└── fixtures/\n    ├── session.jsonl\n    ├── playbook.yaml\n    └── config.json","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:25.292418-05:00","updated_at":"2025-12-08T14:04:52.927973-05:00","closed_at":"2025-12-08T14:04:52.927973-05:00"}
{"id":"cass_memory_system-mkvs","title":"[CLI:doctor] checkLLMProviders - Verify API keys","description":"Implements the checkLLMProviders function that verifies API key configuration for LLM providers.\n\nFUNCTION SIGNATURE:\n```typescript\nasync function checkLLMProviders(): Promise\u003cHealthCheck[]\u003e\n```\n\nCHECKS PERFORMED:\n\n1. OPENAI:\n   - Check if OPENAI_API_KEY env var is set\n   - Validate key format (starts with sk-)\n   - Optionally: test with simple API call\n   - Status: FAIL if missing/invalid, PASS if valid\n   - Required for core functionality\n\n2. ANTHROPIC:\n   - Check if ANTHROPIC_API_KEY env var is set\n   - Validate key format (starts with sk-ant-)\n   - Status: WARN if missing (optional feature)\n   - Used for advanced extraction/reasoning\n\n3. OTHER PROVIDERS:\n   - Check for other configured providers (Cohere, HuggingFace, etc.)\n   - Report presence\n   - Status: PASS (info only)\n\n4. RATE LIMIT STATUS:\n   - If API access available, check rate limit headers\n   - Warn if approaching limits\n   - Status: WARN if near limit\n\nIMPLEMENTATION DETAILS:\n\nOpenAI Check:\n- Check process.env.OPENAI_API_KEY\n- Validate format: /^sk-[A-Za-z0-9]{32,}$/\n- Optional: Test with lightweight API call (models list)\n- Report: \"OpenAI configured (key: sk-...wxyz)\"\n\nAnthropic Check:\n- Check process.env.ANTHROPIC_API_KEY\n- Validate format: /^sk-ant-[A-Za-z0-9_-]{32,}$/\n- Mark as optional if missing\n- Report: \"Anthropic not configured (optional)\"\n\nSECURITY:\n- Never log full API keys\n- Only show first 3 and last 4 characters (sk-...wxyz)\n- Sanitize error messages\n- Don't include keys in JSON output\n\nERROR HANDLING:\n- Missing key → WARN or FAIL depending on provider\n- Invalid format → WARN with guidance\n- API test failures → WARN (network issue vs auth issue)\n- Timeout on API tests (5s max)\n\nVALIDATION LEVELS:\n1. Basic: Check env var exists (fast)\n2. Format: Validate key structure (fast)\n3. Live: Test API call (slow, optional)\n\nUse basic+format by default, live only with --full flag\n\nDEPENDENCIES:\n- Environment variable access\n- Regex for format validation\n- Optional: OpenAI/Anthropic SDK for live tests\n- Secret sanitization utilities\n\nSUCCESS CRITERIA:\n- Detects missing/invalid keys reliably\n- Clear guidance on which keys are required vs optional\n- Security: never leaks full keys\n- Performance: \u003c1 second without live tests\n- Actionable error messages","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:55:45.322015-05:00","updated_at":"2025-12-07T20:22:21.034094-05:00","closed_at":"2025-12-07T20:21:59.902991-05:00"}
{"id":"cass_memory_system-mmxv","title":"Sub-Epic: Unit Test Coverage (No Mocks)","description":"# Sub-Epic: Unit Test Coverage (No Mocks)\n\n## Philosophy\nTest pure functions with real implementations. No mocking of internal modules.\nMocks are ONLY acceptable for:\n- console.log/warn/error (to verify logging behavior)\n- Date.now() (for deterministic timestamp testing)\n- External APIs (LLM providers) - but prefer fixture responses\n\n## Phases (Ordered by Dependency)\n\n### Phase 1: Foundation (Types \u0026 Utilities)\n- types.ts: isBulletInScope, filterBulletsByScope, schema validation\n- utils.ts: Pure functions (hashContent, jaccardSimilarity, extractKeywords, etc.)\n- security.ts: Complete sanitize() and compileExtraPatterns()\n\n### Phase 2: Scoring System\n- scoring.ts: getEffectiveScore, getDecayedCounts, checkForPromotion, checkForDemotion\n- Decay algorithm verification with various time spans\n\n### Phase 3: Playbook Operations\n- playbook.ts: CRUD operations (find, add, deprecate, pin, unpin)\n- Merge operations, duplicate detection\n- Export to markdown\n\n### Phase 4: Curation Pipeline\n- curate.ts: Full curatePlaybook testing\n- Delta application (add, helpful, harmful, replace, deprecate)\n- Anti-pattern inversion logic\n- Duplicate detection and merging\n\n### Phase 5: Validation System\n- validate.ts: evidenceCountGate, validateDelta\n- Verdict normalization\n- Evidence classification\n\n### Phase 6: Diary \u0026 Reflection\n- diary.ts: loadDiaryEntry, loadAllDiaries, migrateOldDiary\n- reflect.ts: formatBulletsForPrompt, shouldExitEarly, deduplication\n\n## Test File Naming Convention\n- test/{module}.test.ts - Unit tests for src/{module}.ts\n- test/{module}.{feature}.test.ts - Specific feature tests\n\n## Coverage Target: 95%+ per module","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-07T20:22:55.719561-05:00","updated_at":"2025-12-08T00:17:18.121981-05:00","closed_at":"2025-12-08T00:16:13.523244-05:00","dependencies":[{"issue_id":"cass_memory_system-mmxv","depends_on_id":"cass_memory_system-m7np","type":"blocks","created_at":"2025-12-07T20:23:08.332715-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-mmxv","depends_on_id":"cass_memory_system-ai52","type":"blocks","created_at":"2025-12-07T20:31:40.793596-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-mszn","title":"[ErrorHandling] LLM_RETRY_CONFIG - Retry policy constants","description":"Define retry policy configuration for LLM API calls.\n\nConfiguration object:\nconst LLM_RETRY_CONFIG = {\n  maxRetries: 3,\n  baseDelayMs: 1000,\n  maxDelayMs: 30000,\n  retryableErrors: [\n    'rate_limit_exceeded',\n    'server_error',\n    'timeout',\n    'overloaded',\n    'ETIMEDOUT',\n    'ECONNRESET'\n  ]\n};\n\nUsage:\n- Used by all LLM API calls for consistent retry behavior\n- Exponential backoff: baseDelay * 2^attempt\n- Cap delays at maxDelayMs to prevent excessive waits\n- Only retry on transient errors (not auth failures or invalid requests)\n\nThis ensures resilient LLM operations with predictable retry behavior.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:50:48.573972-05:00","updated_at":"2025-12-07T21:15:58.748254-05:00","closed_at":"2025-12-07T21:15:19.443387-05:00"}
{"id":"cass_memory_system-muvr","title":"[Docs] Update Command Reference with Audience Tags","description":"# Update Command Reference with Audience Tags\n\n## Purpose\nEvery command in the documentation should be tagged with its intended audience so readers know at a glance what applies to them.\n\n## Audience Tags\n- **[Agent-Essential]** - Agents should know and use these\n- **[Agent-Occasional]** - Agents might use, but not routine\n- **[Operator]** - For human setup and monitoring\n- **[Automated]** - Run by hooks, not directly\n\n## Commands to Tag\n\n| Command | Audience | Notes |\n|---------|----------|-------|\n| cm context | Agent-Essential | Primary command |\n| cm mark | Agent-Essential | Feedback |\n| cm doctor | Agent-Occasional | Health check |\n| cm stats | Agent-Occasional | Overview |\n| cm init | Operator | One-time setup |\n| cm playbook | Operator | Rule management |\n| cm reflect | Automated | Post-session |\n| cm audit | Automated | CI/CD |\n| cm project | Operator | Export |\n| cm serve | Operator | MCP server |\n\n## Implementation\n1. Add audience tag to each command section header\n2. Group commands by audience in quick reference\n3. Add note explaining the tagging system\n\n## Deliverables\n- [ ] All command sections tagged\n- [ ] Quick reference grouped by audience\n- [ ] Explanation of audience system","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T12:48:21.792654-05:00","updated_at":"2025-12-08T13:13:28.394132-05:00","closed_at":"2025-12-08T13:13:28.394132-05:00","dependencies":[{"issue_id":"cass_memory_system-muvr","depends_on_id":"cass_memory_system-j7lc","type":"blocks","created_at":"2025-12-08T12:48:48.465428-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-mw0i","title":"[MCP:Future] memory_context tool definition","description":"Define memory_context tool for MCP:\n\n```typescript\n{\n  name: \"memory_context\",\n  description: \"Get relevant context for a task from playbook and cass\",\n  inputSchema: {\n    type: \"object\",\n    properties: {\n      task: { type: \"string\", description: \"Task description\" },\n      maxBullets: { type: \"number\", default: 50 },\n      workspace: { type: \"string\" }\n    },\n    required: [\"task\"]\n  }\n}\n```\n\nThis tool provides agents with relevant context from the memory system for a given task.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:49:29.334688-05:00","updated_at":"2025-12-07T21:50:28.989539-05:00","closed_at":"2025-12-07T21:50:24.19897-05:00"}
{"id":"cass_memory_system-mxgy","title":"[ErrorHandling] recoverCorruptPlaybook - Backup and recreate","description":"Implement recovery mechanism for corrupt or malformed playbook files.\n\nFunction signature:\nasync function recoverCorruptPlaybook(\n  playbookPath: string,\n  error: Error\n): Promise\u003cPlaybook\u003e\n\nImplementation:\n- Backup corrupt file to {path}.backup.{timestamp} (never lose user data)\n- Log what happened (corruption type, backup location)\n- Create fresh empty playbook with correct structure\n- Return new playbook object\n- Provide clear instructions to user about recovery\n\nError scenarios:\n- Invalid JSON syntax\n- Missing required fields\n- Type mismatches\n- File truncation\n\nAlways prioritize data safety - backup before any destructive operation.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:50:47.565366-05:00","updated_at":"2025-12-07T21:53:36.591623-05:00","closed_at":"2025-12-07T21:53:36.591623-05:00"}
{"id":"cass_memory_system-myc","title":"[Security] sanitize - Apply all secret patterns to text","description":"Implement the core sanitize() function that applies all secret patterns to text.\n\nFunction signature:\n```typescript\nfunction sanitize(\n  text: string,\n  config: { enabled: boolean; extraPatterns?: RegExp[] }\n): string\n```\n\nImplementation requirements:\n1. If !config.enabled, return text unchanged\n2. Apply each SECRET_PATTERN in order (iterate through array)\n3. Then apply any extraPatterns (user-configured patterns)\n4. Return fully sanitized text\n\nCRITICAL: This function is the SINGLE POINT of sanitization for the entire system.\nAll secret redaction flows through this function.\n\nUsage example:\n```typescript\nconst raw = 'export AWS_ACCESS_KEY=AKIAIOSFODNN7EXAMPLE';\nconst clean = sanitize(raw, { enabled: true });\n// clean = 'export AWS_ACCESS_KEY=[AWS_ACCESS_KEY]'\n```\n\nPriority: 0 (Security Critical - P12)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:48.303514-05:00","updated_at":"2025-12-07T18:48:03.206308-05:00","closed_at":"2025-12-07T18:43:24.340785-05:00"}
{"id":"cass_memory_system-mz34","title":"[Test] Unit: config.ts - Configuration loading and merging","description":"# Unit Tests for config.ts\n\n## Functions to Test\n\n### loadConfig(options?)\nTest Cases:\n- No config file → returns defaults\n- Global config only → loads from ~/.cass-memory/config.yaml\n- Repo config only → loads from .cass/config.yaml\n- Both configs → merges (repo overrides global)\n- CLI options override both\n- Expands ~ in paths\n- Validates against ConfigSchema\n\n### mergeConfig(base, override)\nTest Cases:\n- Empty override → returns base\n- Nested override → deep merge\n- Array override → replaces (not appends)\n- null values don't override\n\n### validateConfig(config)\nTest Cases:\n- Valid config passes\n- Missing required fields → error\n- Invalid provider → error\n- Invalid paths → error\n\n### getDefaultConfig()\nTest Cases:\n- Returns complete config\n- All required fields present\n- Sensible defaults (90-day decay, etc.)\n\n### expandPath(path)\nTest Cases:\n- Expands ~ to home directory\n- Handles ~user format\n- Absolute paths unchanged\n- Relative paths resolved\n\n## Edge Cases\n- Config file with extra fields → ignored (forward compat)\n- Config file with invalid YAML → helpful error\n- Missing home directory → fallback behavior\n- Read-only file system → appropriate error\n\n## Test Setup\n\\`\\`\\`typescript\nimport { withTempDir } from \"./helpers/temp\";\n\ndescribe(\"config\", () =\u003e {\n  it(\"loads and merges global and repo configs\", async () =\u003e {\n    await withTempDir(\"config-merge\", async (dir) =\u003e {\n      // Create global config\n      const globalDir = path.join(dir, \".cass-memory\");\n      await fs.mkdir(globalDir, { recursive: true });\n      await fs.writeFile(\n        path.join(globalDir, \"config.yaml\"),\n        yaml.stringify({ provider: \"openai\" })\n      );\n      \n      // Create repo config\n      const repoDir = path.join(dir, \"project\", \".cass\");\n      await fs.mkdir(repoDir, { recursive: true });\n      await fs.writeFile(\n        path.join(repoDir, \"config.yaml\"),\n        yaml.stringify({ model: \"gpt-4\" })\n      );\n      \n      const config = await loadConfig({\n        home: dir,\n        cwd: path.join(dir, \"project\")\n      });\n      \n      expect(config.provider).toBe(\"openai\");\n      expect(config.model).toBe(\"gpt-4\");\n    });\n  });\n});\n\\`\\`\\`","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T20:23:40.917307-05:00","updated_at":"2025-12-07T21:00:31.315016-05:00","closed_at":"2025-12-07T21:00:18.540186-05:00","dependencies":[{"issue_id":"cass_memory_system-mz34","depends_on_id":"cass_memory_system-ai52","type":"blocks","created_at":"2025-12-07T20:28:10.224992-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-mz5q","title":"[Unit] Commands - diary.ts, toxic.ts, timeline.ts","description":"## Target: src/commands/*.ts - CLI Commands (Part 4)\n\n### diary.ts Tests:\n\n1. **diaryCommand(options)** - Diary CLI\n   - Lists diary entries\n   - Shows specific entry\n   - --since date filter\n   - --format option (md, json)\n   - --json output\n\n2. **Entry display**\n   - Frontmatter shown/hidden\n   - Content formatted\n   - Metadata included\n\n### toxic.ts Tests:\n\n1. **toxicCommand(action, pattern, options)** - Toxic patterns\n   - 'add' adds pattern to toxic.log\n   - 'remove' removes pattern\n   - 'list' shows all patterns\n   - 'check' tests content\n   - --json output\n\n2. **Pattern matching**\n   - Regex patterns work\n   - Literal patterns work\n   - Case sensitivity option\n\n### timeline.ts Tests:\n\n1. **timelineCommand(options)** - Timeline CLI\n   - Builds timeline from diary\n   - --since and --until filters\n   - --output file parameter\n   - --format (md, json, html)\n   - --json output\n\n2. **Timeline formatting**\n   - Chronological order\n   - Grouping by day/week\n   - Links to sources\n\n### Test Fixtures:\n- Sample diary entries\n- Sample toxic patterns\n- Date range test data","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:29:21.111136-05:00","updated_at":"2025-12-08T14:25:16.151325-05:00","closed_at":"2025-12-08T14:25:16.151325-05:00","dependencies":[{"issue_id":"cass_memory_system-mz5q","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:20.892271-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-mz5q","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:33:02.586129-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-mz5q","depends_on_id":"cass_memory_system-jvpl","type":"blocks","created_at":"2025-12-07T20:33:19.602332-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-n6s7","title":"[Design] Outcome Tracking in Agent-First Workflow","description":"# Outcome Tracking in Agent-First Workflow\n\n## Background\nThe system has \\`cm outcome\\` to record session outcomes (success/failure/partial). This valuable signal helps:\n- Correlate which rules lead to successful sessions\n- Identify rules that might be harmful (used in failed sessions)\n- Improve scoring over time\n\n## The Gap\nIn our agent-first model, how does outcome tracking happen?\n\nCurrent options (all have friction):\n1. Agent explicitly calls \\`cm outcome success\\` → agent must remember\n2. Human marks outcomes → defeats agent-first\n3. Parse session for success indicators → complex heuristics\n\n## Design Options\n\n### Option A: Implicit Outcome Signals\nInfer success from agent behavior:\n- Session ends with commit → likely success\n- Session ends with \"done\" or similar → likely success\n- Session ends with error/frustration → likely failure\n- Parse from session log during reflection\n\n### Option B: Trivial Agent Command\nMake it so easy agents do it naturally:\n\\`\\`\\`bash\ncm done        # alias for cm outcome success\ncm failed      # alias for cm outcome failure\ncm partial     # alias for cm outcome partial\n\\`\\`\\`\nAdd to quickstart/blurb so agents know to call it.\n\n### Option C: Hook-Based\nPost-session hook that:\n1. Checks for commit in session → success\n2. Checks for test pass → success\n3. Checks for error patterns → failure\n4. Defaults to partial if unclear\n\n### Option D: MCP Integration\n\\`cm_outcome\\` tool already exists. When running as MCP server, agents can call it naturally as part of their tool-calling flow.\n\n## Recommendation\nCombine approaches:\n1. Add simple aliases (cm done/failed) for explicit signaling\n2. Document in quickstart: \"END: cm done (or session auto-processed)\"\n3. Implement implicit inference in reflection as enhancement\n\n## Depends On\n- [Design] Low-Friction Feedback Mechanism (similar design considerations)\n\n## Deliverables\n- [ ] Design decision on primary approach\n- [ ] Implementation plan\n- [ ] Integration with reflection pipeline","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T13:08:11.664562-05:00","updated_at":"2025-12-08T13:13:38.352591-05:00","closed_at":"2025-12-08T13:13:38.352591-05:00","dependencies":[{"issue_id":"cass_memory_system-n6s7","depends_on_id":"cass_memory_system-afjz","type":"blocks","created_at":"2025-12-08T13:08:18.658617-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-nd9","title":"[Playbook] createEmptyPlaybook - Initialize new playbook structure","description":"## Function Signature\n```typescript\nfunction createEmptyPlaybook(): Playbook\n```\n\n## Purpose\nInitialize a new empty playbook structure with default values. Called when no playbook exists or when recovering from corruption.\n\n## Returns\n```typescript\n{\n  schema_version: 2,\n  name: \"playbook\",\n  description: \"Auto-generated by cass-memory\",\n  metadata: {\n    createdAt: now(),\n    totalReflections: 0,\n    totalSessionsProcessed: 0\n  },\n  deprecatedPatterns: [],\n  bullets: []\n}\n```\n\n## Implementation Requirements\n- Set schema_version to 2 (current version)\n- Use ISO 8601 timestamp for createdAt\n- Initialize empty arrays for deprecatedPatterns and bullets\n- Set counters to 0\n\n## Usage Scenarios\n1. First-time setup when playbook.yaml doesn't exist\n2. Recovery from corrupted playbook file\n3. Manual reset of playbook data\n4. Testing and development initialization\n\n## Dependencies\n- None (pure function)\n\n## Related Functions\n- loadPlaybook() - calls this when file doesn't exist\n- savePlaybook() - saves the created structure","notes":"Existing playbook helper implementations already present; no code changes made. Released reservation; feel free to take over.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:44.868015-05:00","updated_at":"2025-12-07T18:57:45.662187-05:00","closed_at":"2025-12-07T18:57:35.448226-05:00"}
{"id":"cass_memory_system-nf0v","title":"[Critical] V1 Minimal Command Set - Only 5 Commands","description":"# V1 Minimal Command Set - Only 5 Commands\n\n## The Problem\nCurrent plan has 15+ commands. This is overwhelming for new users.\n\n## The Solution\nV1 ships with only 5 commands:\n\n### V1 Commands:\n1. **context** - Get relevant context for a task\n2. **mark** - Record helpful/harmful feedback\n3. **playbook** - List/add/remove rules\n4. **status** - Health check (doctor + stats combined)\n5. **reflect** - Extract rules from sessions (optional)\n\n### Command Details:\n```bash\n# 1. CONTEXT - The main command\ncm context \"fix the auth timeout bug\"\n\n# 2. MARK - Record feedback\ncm mark rule-123 helpful\ncm mark rule-456 harmful --reason \"caused test failure\"\n\n# 3. PLAYBOOK - Manage rules\ncm playbook             # List all rules\ncm playbook add \"Always check token expiry first\" --category auth\ncm playbook remove rule-123\n\n# 4. STATUS - Health check\ncm status               # Quick health + stats\ncm status --full        # Detailed diagnostics\n\n# 5. REFLECT - Extract rules (advanced)\ncm reflect              # Process recent sessions\ncm reflect --dry-run    # Preview without applying\n```\n\n### Help Text:\n```bash\n$ cm --help\n\ncm v1.0.0 - Cross-Agent Memory System (cass-memory)\n\nCOMMANDS:\n  context \u003ctask\u003e    Get relevant rules and history for a task\n  mark \u003crule\u003e \u003cfb\u003e  Record helpful/harmful feedback for a rule\n  playbook          List, add, or remove playbook rules\n  status            Check system health and statistics\n  reflect           Extract rules from recent sessions\n\nEXAMPLES:\n  cm context \"fix the auth bug\"\n  cm mark rule-123 helpful\n  cm playbook add \"Always validate JWT\" --category auth\n```\n\n## Why This Is Critical\n- Less is more for v1\n- Users can learn 5 commands\n- Users cannot learn 15 commands","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T17:16:46.28884-05:00","updated_at":"2025-12-07T20:23:31.485853-05:00","closed_at":"2025-12-07T20:22:50.782262-05:00"}
{"id":"cass_memory_system-nfgu","title":"[Testing:Unit] decay.test.ts - Confidence decay algorithm tests","description":"Test cases:\n- getDecayedScore: empty events = 0, recent \u003e old, halfLife math\n- getEffectiveScore: harmful multiplier, maturity bonus\n- checkForPromotion: candidate → established → proven thresholds\n- checkForDemotion: negative score triggers demotion\n- isStale: no feedback detection","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:28.489944-05:00","updated_at":"2025-12-08T02:03:20.794505-05:00","closed_at":"2025-12-08T02:03:20.794505-05:00"}
{"id":"cass_memory_system-ngd","title":"[Security] Pattern breadth testing in doctor command","description":"Implement pattern breadth testing in the doctor command to detect over-aggressive patterns.\n\nTest purpose:\n- Detect patterns that are too broad (match benign text)\n- Warn about patterns with excessive false positives\n- Suggest more specific alternatives\n\nImplementation in doctor command:\n```typescript\nfunction testPatternBreadth(patterns: typeof SECRET_PATTERNS) {\n  const benignSamples = [\n    \"The tokenizer splits text into tokens\",\n    \"Bearer of bad news\",\n    \"This is a password-protected file\",\n    \"The API key concept is important\"\n  ];\n\n  for (const { pattern, replacement } of patterns) {\n    for (const sample of benignSamples) {\n      if (pattern.test(sample)) {\n        console.warn(`[doctor] Pattern too broad: ${pattern}`);\n        console.warn(`  Matches benign text: \"${sample}\"`);\n        console.warn(`  Consider more specific pattern`);\n      }\n    }\n  }\n}\n```\n\nExample warnings:\n```\nWarning: Pattern too broad: /token.*/gi\n  Matches benign text: \"The tokenizer splits text\"\n  Consider more specific pattern like /token[\"\\s:=]+/\n```\n\nTests to perform:\n1. Test each SECRET_PATTERN against benign samples\n2. Test user extraPatterns\n3. Suggest improvements for overly broad patterns\n4. Calculate false positive rate estimate\n\nAdd to doctor command output:\n- \"Sanitization Pattern Health\"\n- List any overly broad patterns\n- Suggest fixes\n\nPriority: 0 (Security Critical - P12)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:54.287971-05:00","updated_at":"2025-12-07T20:22:21.036648-05:00","closed_at":"2025-12-07T20:22:19.875504-05:00"}
{"id":"cass_memory_system-nmp8","title":"[Semantic] Local embedding architecture with @xenova/transformers","description":"Uses @xenova/transformers for LOCAL embeddings (no network required):\n- Model: Xenova/all-MiniLM-L6-v2 (~23MB)\n- Runs locally on CPU\n- ~3ms per embedding on modern laptop\n- Relevance improvement: 60% → 90%\n\nWhy local:\n- No network latency\n- No API costs\n- Works offline\n- Privacy (content never leaves machine)\n\nArchitecture components:\n1. Model loading: Lazy singleton pattern\n2. Embedding generation: Feature extraction pipeline\n3. Vector storage: 384-dimensional float arrays\n4. Similarity calculation: Cosine distance\n5. Caching: Hash-based invalidation\n6. Integration: Hybrid keyword + semantic scoring\n\nDependencies:\n- @xenova/transformers (primary)\n- Model cache: ~/.cache/huggingface/\n- Embedding cache: ~/.cass-memory/embeddings/bullets.json","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-07T16:49:27.179503-05:00","updated_at":"2025-12-07T17:14:57.58642-05:00","comments":[{"id":21,"issue_id":"cass_memory_system-nmp8","author":"jemanuel","text":"Uses @xenova/transformers for LOCAL embeddings (no network required):\n- Model: Xenova/all-MiniLM-L6-v2 (~23MB)\n- Runs locally on CPU\n- ~3ms per embedding on modern laptop\n- Relevance improvement: 60% → 90%\n\nWhy local:\n- No network latency\n- No API costs\n- Works offline\n- Privacy (content never leaves machine)\n\nArchitecture components:\n1. Model loading: Lazy singleton pattern\n2. Embedding generation: Feature extraction pipeline\n3. Vector storage: 384-dimensional float arrays\n4. Similarity calculation: Cosine distance\n5. Caching: Hash-based invalidation\n6. Integration: Hybrid keyword + semantic scoring\n\nDependencies:\n- @xenova/transformers (primary)\n- Model cache: ~/.cache/huggingface/\n- Embedding cache: ~/.cass-memory/embeddings/bullets.json","created_at":"2025-12-07T23:15:50Z"},{"id":22,"issue_id":"cass_memory_system-nmp8","author":"jemanuel","text":"Test comment","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-nn33","title":"Secure audit command and fix sanitization leak","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T22:10:38.763701-05:00","updated_at":"2025-12-07T22:10:45.096274-05:00","closed_at":"2025-12-07T22:10:45.096274-05:00"}
{"id":"cass_memory_system-np4","title":"[Types] PlaybookBullet Schema Part 2 - Content, Type, and Kind","description":"## Overview\nDefine content, classification, and semantic categorization fields for PlaybookBullet. These fields determine WHAT the rule says and HOW it should be presented.\n\n## Content Fields\n\n### category: string\n- Purpose: High-level grouping for organization\n- Type: String (not strict enum - allows flexibility)\n- Common values: 'testing', 'git', 'debugging', 'api-design', 'security', 'performance', 'documentation'\n- Usage: Grouping in playbook display, filtering in search\n- Example: 'testing' for all test-related rules\n\n### content: string\n- Purpose: The actual rule text shown to agents\n- Length: 10-500 characters (enforced by validation)\n- Format: Clear, imperative statement\n- Examples: 'Use vitest for unit tests, not jest' / 'Validate JWT tokens before trusting claims' / 'Run pnpm test before committing'\n- Style: Action-oriented, specific, actionable\n\n### searchPointer: string | undefined\n- Purpose: Gemini-style pattern for retrieving detailed examples\n- Format: cass query pattern (e.g., 'auth* AND token validation')\n- Usage: When rule needs deep context, agent can run 'cass search \u003csearchPointer\u003e'\n- Example: 'JWT validation patterns' -\u003e searches cass for relevant examples\n- Benefit: Keep bullets concise while providing depth on demand\n\n## Type Classification (Binary)\n\n### type: 'rule' | 'anti-pattern'\n- rule: Prescriptive guidance (do this)\n- anti-pattern: Proscriptive warning (don't do this)\n\n### isNegative: boolean\n- Purpose: Computed shorthand for type === 'anti-pattern'\n- Usage: Quick filtering and display logic\n- Derivation: Automatically set based on type field\n\nDisplay Impact:\n- Rules: Shown in main playbook sections\n- Anti-patterns: Shown in separate 'PITFALLS' section\n\n## Semantic Kind (4 Categories)\n\n### kind: 'project_convention' | 'stack_pattern' | 'workflow_rule' | 'anti_pattern'\n\n#### project_convention\n- Definition: Repository-specific conventions\n- Portability: LOW - unique to this codebase\n- Scope: Usually workspace-scoped\n- Examples: 'Use AuthService from @/lib/auth for authentication' / 'Store config in config/app.yaml, not .env' / 'Use JobQueue class for background tasks'\n- Characteristics: References specific files/modules/patterns in THIS project\n\n#### stack_pattern\n- Definition: Reusable patterns for languages/frameworks\n- Portability: HIGH - transferable across projects\n- Scope: Usually language or framework-scoped\n- Examples: 'For React hooks, test effects with renderHook from @testing-library/react-hooks' / 'In TypeScript, use const assertions for literal arrays' / 'For Next.js, prefer server components over client components'\n- Characteristics: Generic best practices for the tech stack\n\n#### workflow_rule\n- Definition: Process and methodology rules\n- Portability: MEDIUM - often org-specific\n- Scope: Usually global or workspace\n- Examples: 'Run pnpm test before committing' / 'Write commit messages in conventional commits format' / 'Update changelog in CHANGELOG.md for user-facing changes'\n- Characteristics: About HOW to work, not WHAT to code\n\n#### anti_pattern\n- Definition: Pitfalls and mistakes to avoid\n- Portability: VARIABLE\n- Scope: Any scope\n- Examples: 'Don't mock Router hooks directly - use mockRouter utility' / 'Avoid useState for derived values - use useMemo' / 'Don't commit .env files with secrets'\n- Characteristics: Negative guidance, often learned from past mistakes\n- Display: Shown in PITFALLS section, not main playbook\n\n## Kind vs Type vs Scope\n\nField | Purpose | Values | Controls\nscope | WHERE it applies | global/workspace/language/framework/task | Filtering by context\ntype | DO or DON'T | rule/anti-pattern | Display section\nkind | WHY it exists | project_convention/stack_pattern/workflow_rule/anti_pattern | Portability/semantics\n\n## Examples\n\nProject Convention Rule: { category: 'authentication', content: 'Use TokenValidator from @/lib/auth for all JWT validation', searchPointer: 'TokenValidator usage examples', type: 'rule', isNegative: false, kind: 'project_convention' }\n\nStack Pattern Rule: { category: 'testing', content: 'For React hooks, use renderHook from @testing-library/react', type: 'rule', isNegative: false, kind: 'stack_pattern' }\n\nWorkflow Rule: { category: 'git', content: 'Run full test suite before pushing to main', type: 'rule', isNegative: false, kind: 'workflow_rule' }\n\nAnti-Pattern: { category: 'testing', content: 'Don't mock useRouter - use mockRouter from test/utils', type: 'anti-pattern', isNegative: true, kind: 'anti_pattern' }\n\n## Acceptance Criteria\n- category field as flexible string\n- content field with 10-500 char validation\n- searchPointer optional field\n- type enum with 2 values\n- isNegative computed boolean\n- kind enum with 4 values\n- Examples for all kind types\n- JSDoc explaining kind semantics\n- Content length validation in schema","notes":"Completed: Added JSDoc for BulletTypeEnum and BulletKindEnum with portability guidance and examples. Added content length validation (10-500 chars). Added superRefine validation for type/isNegative consistency and kind/type consistency.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:58.784179-05:00","updated_at":"2025-12-07T20:07:53.574133-05:00","closed_at":"2025-12-07T20:06:39.70268-05:00"}
{"id":"cass_memory_system-nqfw","title":"[ErrorHandling] checkDiskSpace - Verify adequate storage","description":"Verify adequate disk space before large write operations.\n\nFunction signature:\nasync function checkDiskSpace(path: string): Promise\u003c{\n  available: number;\n  warning: boolean;\n  critical: boolean;\n}\u003e\n\nImplementation:\n- Use platform-specific commands (df on Unix, wmic on Windows)\n- Parse available space in bytes\n- Warning threshold: \u003c100MB available\n- Critical threshold: \u003c10MB available\n- Log warnings to user before proceeding\n- Throw error if critical\n\nCalled before:\n- Session ingestion\n- Playbook backups\n- Large log writes\n\nPrevents disk full errors during critical operations.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:25.727592-05:00","updated_at":"2025-12-07T21:15:58.749008-05:00","closed_at":"2025-12-07T21:15:04.246063-05:00"}
{"id":"cass_memory_system-nu1s","title":"[CLI:init] initRepoLevel - Create .cass/ in current repo","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:33.599046-05:00","updated_at":"2025-12-07T21:13:03.920237-05:00","closed_at":"2025-12-07T21:12:21.862087-05:00"}
{"id":"cass_memory_system-nvuz","title":"[Testing:Unit] utils.test.ts - Utility function tests","description":"Test cases:\n- hashContent: consistent, normalized, 16 chars\n- jaccardSimilarity: symmetric, [0,1] range, identical=1\n- generateBulletId: unique, format match\n- expandPath: ~ expansion, absolute unchanged\n- extractKeywords: stop word removal, limit 10\n- scoreBulletRelevance: keyword and tag matching","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:26.466792-05:00","updated_at":"2025-12-08T12:54:45.174449-05:00","closed_at":"2025-12-08T12:54:45.174449-05:00"}
{"id":"cass_memory_system-nwd","title":"[Curator] handleAddDelta - Process new bullet additions","description":"Process AddDelta to add new bullets to the playbook with comprehensive validation.\n\nSignature:\nfunction handleAddDelta(\n  playbook: Playbook,\n  delta: AddDelta,\n  existingHashes: Set\u003cstring\u003e,\n  config: CuratorConfig\n): { applied: boolean; reason: string }\n\nValidation pipeline:\n1. Hash new content using SHA-256\n2. Check exact duplicate (hash in existingHashes)\n   - If found: skip, return 'duplicate'\n3. Check semantic duplicate (jaccardSimilarity \u003e= dedupThreshold)\n   - If found: boost existing bullet's helpfulCount instead of adding\n   - Return 'similar-boosted'\n4. Check toxic log (isToxic)\n   - If toxic: reject permanently, return 'toxic'\n5. Detect semantic conflicts (detectConflicts)\n   - If conflicts: log warnings but still allow add\n   - Add conflict reports to result\n6. If all checks pass:\n   - Create bullet with state: 'active', maturity: 'candidate'\n   - Set createdAt, updatedAt\n   - Initialize helpfulCount: 0, harmfulCount: 0\n   - Add hash to existingHashes\n   - Return applied: true\n\nKEY PRINCIPLE: New bullets ALWAYS start as candidates. They must earn promotion through helpful feedback.\n\nThis prevents low-quality rules from polluting the playbook immediately.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:44:56.828452-05:00","updated_at":"2025-12-07T21:14:16.253551-05:00","closed_at":"2025-12-07T21:14:08.883057-05:00"}
{"id":"cass_memory_system-nx8k","title":"[MCP:Future] memory_reflect tool definition","description":"Define memory_reflect tool for MCP:\n\n```typescript\n{\n  name: \"memory_reflect\",\n  description: \"Trigger reflection on recent sessions\",\n  inputSchema: {\n    type: \"object\",\n    properties: {\n      days: { type: \"number\", default: 7 },\n      maxSessions: { type: \"number\", default: 20 },\n      dryRun: { type: \"boolean\", default: false }\n    }\n  }\n}\n```\n\nAllows agents to trigger the reflection process to extract insights from recent sessions.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:49:32.439291-05:00","updated_at":"2025-12-07T22:22:34.240512-05:00","closed_at":"2025-12-07T22:22:34.240512-05:00"}
{"id":"cass_memory_system-nxms","title":"Integration test: Full ACE pipeline (Generator -\u003e Reflector -\u003e Curator -\u003e Validator)","description":"Full ACE (Adaptive Cognitive Evolution) pipeline integration test:\n- Session export -\u003e Diary -\u003e Reflection -\u003e Curation -\u003e Validation\n- Complete data flow through all four stages\n- Real fixtures representing realistic agent sessions\n- Verify end-to-end transformation correctness\n- Verify playbook evolution after processing\n- Detailed logging at each stage boundary with timing\n- Test with: minimal session, large session, multi-agent session\nNO MOCKS - full pipeline with real LLM calls (test API key)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:26:27.471438-05:00","updated_at":"2025-12-08T14:28:28.550316-05:00","closed_at":"2025-12-08T14:28:28.550316-05:00","dependencies":[{"issue_id":"cass_memory_system-nxms","depends_on_id":"cass_memory_system-mikz","type":"blocks","created_at":"2025-12-07T20:28:24.556987-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-nxms","depends_on_id":"cass_memory_system-qrk5","type":"blocks","created_at":"2025-12-07T20:28:24.678731-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-o037","title":"[Build] Bun binary compilation for distribution","description":"Set up Bun binary compilation for cross-platform distribution.\n\nAdd to package.json scripts:\n{\n  \"scripts\": {\n    \"build\": \"bun build src/cass-memory.ts --compile --outfile dist/cass-memory\",\n    \"build:linux\": \"bun build src/cass-memory.ts --compile --target=bun-linux-x64 --outfile dist/cass-memory-linux-x64\",\n    \"build:macos-arm\": \"bun build src/cass-memory.ts --compile --target=bun-darwin-arm64 --outfile dist/cass-memory-darwin-arm64\",\n    \"build:macos-x64\": \"bun build src/cass-memory.ts --compile --target=bun-darwin-x64 --outfile dist/cass-memory-darwin-x64\",\n    \"build:windows\": \"bun build src/cass-memory.ts --compile --target=bun-windows-x64 --outfile dist/cass-memory-windows-x64.exe\",\n    \"build:all\": \"npm run build:linux \u0026\u0026 npm run build:macos-arm \u0026\u0026 npm run build:macos-x64 \u0026\u0026 npm run build:windows\"\n  }\n}\n\nProduces standalone executables with Bun runtime bundled - no external dependencies required.\n\nTest each binary on target platform before release","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:42.44737-05:00","updated_at":"2025-12-07T21:03:13.191833-05:00","closed_at":"2025-12-07T21:03:04.696519-05:00"}
{"id":"cass_memory_system-o1g2","title":"[Unit] types.ts - Schema Validation \u0026 Scope Utilities","description":"## Target: src/types.ts - Schema Validation \u0026 Scope Utilities\n\n### Zod Schemas to Test:\n1. **PlaybookBulletSchema** - Core bullet validation\n   - Valid complete bullet passes\n   - Missing required fields fail\n   - Invalid field types fail\n   - feedbackEvents array validation\n   - Optional fields (pinned, tags, scope)\n   - Default values applied correctly\n\n2. **FeedbackEventSchema** - Event validation\n   - type: 'helpful' | 'harmful' required\n   - timestamp validation (ISO string)\n   - Optional context field\n   - Invalid type rejected\n\n3. **PlaybookSchema** - Full playbook validation\n   - Valid playbook with bullets\n   - Empty bullets array valid\n   - Nested bullet validation\n   - Metadata fields\n\n4. **ConfigSchema** - Configuration validation\n   - All required paths present\n   - Optional fields with defaults\n   - Path expansion handling\n   - Invalid paths rejected\n\n5. **CassSearchOptionsSchema** - Search options\n   - All optional fields\n   - Type constraints (number ranges)\n   - Default values\n\n### Scope Utilities to Test:\n1. **scopeMatches(bulletScope, queryScope)** - Scope matching\n   - Exact match: 'project:foo' matches 'project:foo'\n   - Wildcard: 'project:*' matches 'project:foo'\n   - Global scope matches all\n   - Hierarchy: 'project:foo/bar' vs 'project:foo'\n   - Case sensitivity rules\n   - Invalid scope format handling\n\n2. **parseScope(scopeString)** - Parse scope strings\n   - Valid formats: 'global', 'project:name', 'file:path'\n   - Invalid format handling\n   - Empty string handling\n\n3. **normalizeScope(scope)** - Normalize scope representation\n   - Consistent formatting\n   - Path normalization within scope\n\n### Test Patterns:\n- Use Zod's safeParse for validation testing\n- Test both .parse() (throws) and .safeParse() (returns result)\n- Cover all discriminated union branches\n- Test refinements and transforms","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:24:31.008972-05:00","updated_at":"2025-12-07T21:08:28.046618-05:00","closed_at":"2025-12-07T21:08:26.527722-05:00","dependencies":[{"issue_id":"cass_memory_system-o1g2","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:14.050931-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-o1g2","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:32:56.770797-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-o44i","title":"[Critical] Decision Logging - Why Rules Were Accepted/Rejected","description":"$(cat /tmp/fix_o44i.txt)","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T17:08:20.522057-05:00","updated_at":"2025-12-08T01:34:07.459619-05:00","closed_at":"2025-12-08T01:34:07.459619-05:00"}
{"id":"cass_memory_system-o450","title":"[CLI:mark] markOutputResult - Confirm feedback recorded","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:45.671595-05:00","updated_at":"2025-12-07T21:12:17.524092-05:00","closed_at":"2025-12-07T21:12:13.75537-05:00"}
{"id":"cass_memory_system-o9mu","title":"[Unit Tests] llm.ts - llmWithFallback and provider selection","description":"## Unit Tests: llm.ts - LLM Provider Integration Tests\n\n### Test Categories\n\n#### 1. getApiKey()\n- Returns key from environment variable\n- Throws for missing key\n- Throws for unknown provider\n- Checks correct env var per provider\n\n#### 2. getAvailableProviders()\n- Returns providers with valid API keys\n- Empty array when no keys set\n- Caches result within session\n\n#### 3. getModel()\n- Returns correct model instance per provider\n- Uses config model name\n- Falls back to provider default model\n\n#### 4. llmWithFallback() - Core Logic\n- Tries primary provider first\n- Falls back through FALLBACK_ORDER\n- Skips unavailable providers\n- Collects all errors on total failure\n\n#### 5. llmWithFallback() - Success Paths\n- Returns on first provider success\n- Stops trying after success\n- Parses response with provided schema\n- Returns typed object matching schema\n\n#### 6. llmWithFallback() - Failure Paths\n- Throws when all providers fail\n- Error message includes all failures\n- Logs each failure with provider name\n- Final log says 'No more providers'\n\n#### 7. Provider Configuration\n- FALLBACK_ORDER is [anthropic, openai, google]\n- FALLBACK_MODELS has correct model per provider\n- Primary provider from config.llm.provider\n- Primary model from config.llm.model\n\n#### 8. generateContext() - Structured Output\n- Returns ContextOutput schema\n- Includes bullets array\n- Includes context_brief\n- Includes search_queries (optional)\n\n### Test Approach\n- Test getApiKey with env manipulation\n- Test getAvailableProviders with mocked env\n- Test llmWithFallback logic without real LLM calls\n- Integration tests (separate) for real provider calls\n\n### Note\n- Unit tests focus on logic, not actual LLM calls\n- Integration tests in E2E suite test real providers","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:24:14.315107-05:00","updated_at":"2025-12-07T22:26:12.840201-05:00","closed_at":"2025-12-07T22:26:12.840201-05:00","dependencies":[{"issue_id":"cass_memory_system-o9mu","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2025-12-07T20:31:06.024044-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-o9mu","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2025-12-07T20:31:09.521375-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-obb","title":"[Reflector] fetchCrossAgentHistory - Get related sessions from other agents","description":"async function fetchCrossAgentHistory(\n  diary: DiaryEntry,\n  config: Config\n): Promise\u003cstring\u003e\n\nSteps:\n1. Extract keywords from diary (accomplishments, challenges, keyLearnings)\n2. Query cass with keywords\n3. Exclude current session's agent to get cross-agent results\n4. Format top 5 hits as context\n5. Return formatted string\n\nTHIS IS THE CROSS-AGENT ENRICHMENT - learning from what other agents did\n\nEXAMPLE:\nCurrent agent: cursor\nQuery: \"authentication token refresh\"\nResults:\n- codex session: \"Fixed token expiry with refresh logic\"\n- windsurf session: \"Implemented JWT rotation pattern\"\n\nPURPOSE:\n- Share learnings across agents\n- Avoid reinventing solutions\n- Build collective memory\n\nQUERY CONSTRUCTION:\nCombine: accomplishments + challenges + keyLearnings\nLimit: 100 tokens\nFilter: agent != currentAgent\n\nDEPENDENCIES:\n- cass.query()\n- formatCassHistory()\n\nUsed in buildReflectorPrompt()","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:44:56.863357-05:00","updated_at":"2025-12-07T21:15:58.749846-05:00","closed_at":"2025-12-07T21:14:46.649452-05:00"}
{"id":"cass_memory_system-oea","title":"[Cass] cassStats - Get cass index statistics","description":"Implement cassStats() to get cass index statistics and metrics.\n\n## Signature\n```typescript\ninterface CassStats {\n  totalConversations: number;\n  totalMessages: number;\n  agentBreakdown: Record\u003cstring, number\u003e;\n  oldestSession: string;\n  newestSession: string;\n}\n\nasync function cassStats(\n  cassPath = \"cass\"\n): Promise\u003cCassStats | null\u003e\n```\n\n## CLI Command\n`cass stats --json`\n\n## Implementation\n- Use execFile() to run stats command\n- Parse JSON output\n- Return structured stats object\n- Return null on error\n\n## Error Handling\n- Return null if index not available\n- Return null if parse error\n- Log errors at debug level\n\n## Output Structure\n```json\n{\n  \"totalConversations\": 150,\n  \"totalMessages\": 4500,\n  \"agentBreakdown\": {\n    \"claude-code\": 100,\n    \"claude-sonnet\": 30,\n    \"claude-opus\": 20\n  },\n  \"oldestSession\": \"2024-01-01T10:00:00Z\",\n  \"newestSession\": \"2024-01-15T16:30:00Z\"\n}\n```\n\n## Usage\nUsed in:\n- doctor command (system health checks)\n- stats display (user queries about usage)\n- Analytics and reporting\n\n```typescript\nconst stats = await cassStats();\nif (stats) {\n  console.log(`Total sessions: ${stats.totalConversations}`);\n  console.log(`Total messages: ${stats.totalMessages}`);\n  console.log(\"Agent breakdown:\");\n  for (const [agent, count] of Object.entries(stats.agentBreakdown)) {\n    console.log(`  ${agent}: ${count}`);\n  }\n}\n```","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:01.7616-05:00","updated_at":"2025-12-07T18:48:03.20794-05:00","closed_at":"2025-12-07T18:45:13.352457-05:00"}
{"id":"cass_memory_system-of39","title":"E2E: Concurrency Stress Test","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:23:11.937589-05:00","updated_at":"2025-12-08T15:04:05.95511-05:00","closed_at":"2025-12-08T15:04:05.95511-05:00"}
{"id":"cass_memory_system-olu","title":"[Foundation] Create src/ directory structure with module organization","description":"Create the src/ directory structure with all core module files for the CASS Memory System.\n\n## Context\nThe src/ directory contains all TypeScript source code for the CASS Memory System. The structure must be organized by functional domain with clear separation of concerns for maintainability and testability.\n\n## Technical Specification\n\n### Directory Structure:\nsrc/\n├── cass-memory.ts          # Main CLI entry point, argument parsing, command routing\n├── types.ts                # Shared TypeScript types and Zod schemas\n├── utils.ts                # Shared utility functions (file I/O, path resolution, etc.)\n├── cass.ts                 # Core CASS orchestration logic\n├── llm.ts                  # LLM client factory and provider configuration\n├── playbook.ts             # Playbook loading, merging, and rule management\n├── diary.ts                # Diary entry creation and retrieval\n├── reflect.ts              # Reflection processing and memory extraction\n├── validate.ts             # Validation logic for configs and playbooks\n├── curate.ts               # Curation workflow (evidence gathering, LLM decisions)\n├── sanitize.ts             # Secret detection and sanitization\n└── commands/               # Command implementations\n    ├── init.ts             # Initialize CASS in repo/globally\n    ├── wrap.ts             # Wrap command execution with session tracking\n    ├── doctor.ts           # System health checks\n    ├── status.ts           # Show configuration status\n    ├── reflect.ts          # Manual reflection trigger\n    ├── diary.ts            # Diary entry commands\n    ├── playbook.ts         # Playbook management commands\n    ├── forget.ts           # Mark bullets as toxic\n    └── stats.ts            # Usage statistics\n\n### File Responsibilities:\n\n#### cass-memory.ts (Entry Point):\n- Parse CLI arguments using process.argv or a library like commander\n- Route to appropriate command handler in commands/\n- Handle --help, --version flags\n- Set up error handling and logging\n- Export main() function\n\n#### types.ts (Type Definitions):\n- TypeScript interfaces for Config, Playbook, DiaryEntry, Reflection, etc.\n- Zod schemas for runtime validation\n- Enums for bullet states, priority levels, etc.\n- Type guards and utility types\n\n#### utils.ts (Shared Utilities):\n- File system operations (ensureDir, readYAML, writeYAML, appendJSONL)\n- Path resolution (resolveGlobalDir, resolveRepoDir)\n- Date/time formatting\n- Error handling helpers\n- String manipulation utilities\n\n#### cass.ts (Core Orchestration):\n- High-level CASS workflow coordination\n- Session management\n- Playbook + Diary + Reflection integration\n- Decision-making orchestration\n\n#### llm.ts (LLM Integration):\n- Factory function to create LLM clients based on config\n- Provider detection (OpenAI, Anthropic, Google)\n- API key validation\n- Structured output helpers using Zod schemas\n- Rate limiting and error handling\n\n#### playbook.ts (Playbook Management):\n- Load playbook from ~/.cass-memory/ and .cass/\n- Merge global and repo-level playbooks\n- Rule filtering and prioritization\n- Toxic bullet checking\n- Usage tracking\n\n#### diary.ts (Diary Operations):\n- Create diary entries\n- Read diary history\n- Format diary content\n- Track diary metadata\n\n#### reflect.ts (Reflection Processing):\n- Parse session logs\n- Extract learned patterns\n- Generate playbook bullets via LLM\n- Update playbook YAML\n\n#### validate.ts (Validation):\n- Validate config.json structure\n- Validate playbook.yaml structure\n- Check for required fields\n- Provide helpful error messages\n\n#### curate.ts (Curation Workflow):\n- Evidence-based gate (check usage.jsonl)\n- LLM-based curation decision\n- Bullet promotion/demotion logic\n- Historical analysis\n\n#### sanitize.ts (Secret Sanitization):\n- Detect API keys, tokens, passwords\n- Pattern-based detection\n- Entropy-based detection\n- Replace secrets with placeholders\n\n## Reasoning\n\n### Why This Structure:\n1. Single Responsibility: Each file has one clear purpose\n2. Testability: Modules can be tested in isolation\n3. Discoverability: New contributors can find functionality quickly\n4. Import Clarity: Clear dependency graph (utils \u003c- types \u003c- everything else)\n5. Command Separation: Each CLI command is a separate module\n\n### Why commands/ Subdirectory:\n1. Scalability: Easy to add new commands\n2. Organization: Keeps main src/ clean\n3. Parallel Development: Multiple devs can work on different commands\n4. Lazy Loading: Only load command code when needed\n\n### Why Separate LLM Module:\n1. Provider Agnostic: Switch providers without touching business logic\n2. Testing: Mock LLM calls easily\n3. Configuration: Centralized API key and model management\n4. Rate Limiting: Global rate limit tracking\n\n## Acceptance Criteria\n\n- src/ directory exists\n- All core files created with proper exports\n- commands/ subdirectory exists\n- All command files created\n- Each file has a JSDoc comment explaining its purpose\n- All files use ES module syntax (import/export)\n- Types are imported from types.ts\n- Utils are imported from utils.ts\n- No circular dependencies\n- bun run typecheck passes\n\n## How This Serves the Universal Agent Memory System\n\nThe directory structure is the skeleton of the CASS Memory System:\n\n1. Modularity: Agents can extend specific modules without touching core logic\n2. Maintainability: Clear boundaries make bug fixes and enhancements easier\n3. Testability: Each module can be unit tested independently\n4. Onboarding: New contributors can navigate the codebase intuitively\n5. Extensibility: New commands and features can be added without refactoring\n\nA well-organized codebase ensures the CASS Memory System can evolve as new use cases emerge, from simple diary logging to complex multi-agent orchestration.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:46:16.460684-05:00","updated_at":"2025-12-07T20:11:39.810636-05:00","closed_at":"2025-12-07T20:11:35.414918-05:00"}
{"id":"cass_memory_system-oq5j","title":"Fix test isolation issues - tests pass individually but fail when run together","description":"","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-08T00:44:44.815421-05:00","updated_at":"2025-12-08T01:21:33.178815-05:00","closed_at":"2025-12-08T01:21:33.178815-05:00"}
{"id":"cass_memory_system-oqgl","title":"[Semantic] batchEmbed - Efficient bulk embedding","description":"Efficient bulk embedding with batching and progress reporting.\n\nImplementation:\n```typescript\nasync function batchEmbed(\n  texts: string[],\n  batchSize: number = 32\n): Promise\u003cnumber[][]\u003e\n```\n\nWhy batching:\n- Transformer.js supports batch processing\n- More efficient than one-at-a-time\n- Better GPU utilization (if available)\n- Memory management for large sets\n\nProcess:\n1. Split texts into batches of 32\n2. For each batch:\n   - Embed all texts together\n   - Show progress (if large)\n3. Flatten results\n4. Return embeddings array\n\nPerformance:\n- Batch of 32: ~80ms vs 96ms (32×3ms)\n- Speedup: ~20%\n- Memory: ~15MB per batch\n\nProgress reporting:\n- For batches \u003e 100 texts\n- Show progress bar\n- Estimate time remaining\n\nExample:\n```typescript\nconst bullets = playbook.bullets.map(b =\u003e b.content);\nconst embeddings = await batchEmbed(bullets, 32);\nbullets.forEach((b, i) =\u003e b.embedding = embeddings[i]);\n```\n\nUse cases:\n- Initial playbook embedding\n- Bulk cache rebuild\n- Embedding multiple diaries","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-07T16:49:45.641445-05:00","updated_at":"2025-12-07T17:14:56.566377-05:00","comments":[{"id":23,"issue_id":"cass_memory_system-oqgl","author":"jemanuel","text":"Efficient bulk embedding with batching and progress reporting.\n\nImplementation:\n```typescript\nasync function batchEmbed(\n  texts: string[],\n  batchSize: number = 32\n): Promise\u003cnumber[][]\u003e\n```\n\nWhy batching:\n- Transformer.js supports batch processing\n- More efficient than one-at-a-time\n- Better GPU utilization (if available)\n- Memory management for large sets\n\nProcess:\n1. Split texts into batches of 32\n2. For each batch:\n   - Embed all texts together\n   - Show progress (if large)\n3. Flatten results\n4. Return embeddings array\n\nPerformance:\n- Batch of 32: ~80ms vs 96ms (32×3ms)\n- Speedup: ~20%\n- Memory: ~15MB per batch\n\nProgress reporting:\n- For batches \u003e 100 texts\n- Show progress bar\n- Estimate time remaining\n\nExample:\n```typescript\nconst bullets = playbook.bullets.map(b =\u003e b.content);\nconst embeddings = await batchEmbed(bullets, 32);\nbullets.forEach((b, i) =\u003e b.embedding = embeddings[i]);\n```\n\nUse cases:\n- Initial playbook embedding\n- Bulk cache rebuild\n- Embedding multiple diaries","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-oug","title":"[LLM] PROMPTS.diary - Diary extraction prompt template","description":"Full prompt template for diary extraction:\n\nYou are analyzing a coding agent session to extract structured insights.\n\nSESSION METADATA:\n- Path: {sessionPath}\n- Agent: {agent}\n- Workspace: {workspace}\n\nSESSION CONTENT:\n{content}\n\nINSTRUCTIONS:\nExtract the following from this session. Be SPECIFIC and ACTIONABLE.\nAvoid generic statements like 'wrote code' or 'fixed bug'.\nInclude specific:\n- File names and paths\n- Function/class/component names\n- Error messages and stack traces\n- Commands run\n- Tools used\n\nIf the session lacks information for a field, provide an empty array.\n\n---\n\nThis prompt is tuned for structured extraction with Zod schema.\nTemperature: 0.3 (low for consistency)\nUsed in extractDiary function.\n\nImplementation: Truncate sessionContent if \u003e50000 chars to avoid token limits.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:51.952015-05:00","updated_at":"2025-12-07T18:53:18.255091-05:00","closed_at":"2025-12-07T18:49:30.130561-05:00"}
{"id":"cass_memory_system-ov1","title":"[Utils] log - Conditional verbose logging to stderr","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:45:24.46759-05:00","updated_at":"2025-12-07T20:24:20.357408-05:00","closed_at":"2025-12-07T20:24:03.893383-05:00","comments":[{"id":24,"issue_id":"cass_memory_system-ov1","author":"jemanuel","text":"## Function Signature\n```typescript\nfunction log(message: string, verbose = false): void\n```\n\n## Implementation Details\n- Check if verbose parameter is true OR CASS_MEMORY_VERBOSE env var is set\n- If yes, output to stderr: console.error('[cass-memory]', message)\n- If no, do nothing (silent)\n- NEVER output to stdout (reserved for JSON/data output)\n\n## Why This Matters\nAllows debugging without polluting stdout. Commands that output JSON (--json flag) must keep stdout clean. Stderr is for human-readable logs, stdout for machine-readable data.\n\n## Edge Cases to Handle\n- CASS_MEMORY_VERBOSE can be \"1\", \"true\", \"yes\" - normalize to boolean\n- Empty message - still output prefix\n- Multi-line messages - output as-is\n- verbose=false but env var set - should still log (env var takes precedence)","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-p0dr","title":"[Docs] CLI --help text for all commands","description":"Implement comprehensive --help text for all commands.\n\nMain help:\ncass-memory \u003ccommand\u003e [options]\n\nCommands:\n  init       Initialize configuration and playbook\n  context    Get relevant context for a task\n  diary      Generate structured diary from session\n  reflect    Run reflection cycle on recent sessions\n  validate   Validate playbook integrity\n  mark       Mark bullet helpful/harmful\n  audit      Show bullet audit trail\n  playbook   Playbook operations\n  project    Project knowledge operations\n  forget     Remove toxic rules\n  stats      Playbook health metrics\n  doctor     System health check\n  top        Most impactful bullets\n  stale      Unused bullets\n  why        Show bullet provenance\n  similar    Find similar bullets\n\nGlobal Options:\n  --json     Output as JSON\n  --quiet    Suppress diagnostic output\n  --help     Show help\n  --version  Show version\n\nEach command should have detailed help accessible via: cass-memory \u003ccommand\u003e --help","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:31.460347-05:00","updated_at":"2025-12-07T20:56:31.963315-05:00","closed_at":"2025-12-07T20:56:25.082376-05:00"}
{"id":"cass_memory_system-p1y9","title":"[Unit] cass.ts - CASS Integration (External Tool)","description":"## Target: src/cass.ts (291 LOC) - ZERO CURRENT COVERAGE\n\n### Functions to Test:\n\n1. **cassAvailable(cassPath)** - Check CASS availability\n   - Returns true if cass binary exists\n   - Returns false if missing\n   - Custom path parameter\n   - Permission checking\n\n2. **searchCass(query, options)** - Search CASS index\n   - Valid query returns results\n   - Empty query handling\n   - Limit parameter respected\n   - --robot flag always used\n   - Timeout handling\n\n3. **parseCassOutput(output)** - Parse CASS JSON output\n   - Valid JSON parsed correctly\n   - Invalid JSON → graceful error\n   - Empty output handling\n   - Partial results handling\n\n4. **viewCassSession(path, options)** - View session\n   - Returns session content\n   - Line number parameter\n   - Context parameter (-C)\n   - Missing file handling\n\n5. **expandCassContext(path, lineNumber, context)** - Expand context\n   - Returns surrounding context\n   - Handles file boundaries\n   - Missing file handling\n\n6. **getCassCapabilities()** - Get CASS features\n   - Returns capabilities object\n   - Handles version differences\n   - Caches results\n\n### External Process Testing:\nNote: These tests need real cass binary OR should be skipped if unavailable.\n\n- Test with CASS_AVAILABLE=false env var for skip\n- Use small test fixtures for real tests\n- Verify timeout handling with slow responses\n- Test stderr handling\n\n### Mock-Free Approach:\n- Detect if cass is installed\n- Skip tests gracefully if not\n- Use real cass for CI if available\n- Document test requirements","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:28:39.965544-05:00","updated_at":"2025-12-08T14:23:01.335208-05:00","closed_at":"2025-12-08T14:23:01.335208-05:00","dependencies":[{"issue_id":"cass_memory_system-p1y9","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:17.843869-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-p1y9","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:33:00.216919-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-p4mv","title":"[Test Infrastructure] Test data directory with sample fixtures","description":"## Test Infrastructure: Test Data Directory with Sample Fixtures\n\n### Directory Structure\n\n```\ntest/\n  fixtures/\n    configs/\n      valid-global.yaml        # Full valid global config\n      valid-repo.yaml          # Full valid repo config\n      minimal.yaml             # Only required fields\n      malformed.yaml           # Invalid YAML syntax\n      unknown-keys.yaml        # Future compatibility test\n    \n    playbooks/\n      empty.yaml               # Empty playbook\n      single-bullet.yaml       # One bullet for simple tests\n      multi-bullet.yaml        # 10 bullets, various confidences\n      scoped-bullets.yaml      # Bullets with different scopes\n      with-toxic.yaml          # Playbook with toxic list\n    \n    sessions/\n      simple-chat.jsonl        # 10 messages, basic Q\u0026A\n      code-session.jsonl       # 30 messages, code discussion\n      error-session.jsonl      # Session with errors/debugging\n      long-session.jsonl       # 100+ messages for stress test\n    \n    diaries/\n      sample-diary.yaml        # Valid diary entry\n      multi-entry.yaml         # Multiple diary entries\n    \n    cass-output/\n      search-results.json      # Sample cass search response\n      timeline.json            # Sample cass timeline response\n      empty-results.json       # No hits response\n```\n\n### Fixture Principles\n- All fixtures are valid unless explicitly named otherwise\n- Fixtures are minimal but complete\n- Each fixture tests one specific scenario\n- Fixtures are deterministic (fixed timestamps)\n\n### Usage in Tests\n```typescript\nimport { loadFixture } from './helpers';\nconst config = loadFixture('configs/valid-global.yaml');\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:23:05.861799-05:00","updated_at":"2025-12-07T21:13:03.922202-05:00","closed_at":"2025-12-07T21:12:32.208445-05:00"}
{"id":"cass_memory_system-p5gv","title":"[Testing] Fix duplicate schema exports blocking tests","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T20:29:51.54246-05:00","updated_at":"2025-12-07T20:55:55.538102-05:00","closed_at":"2025-12-07T20:55:14.324598-05:00","dependencies":[{"issue_id":"cass_memory_system-p5gv","depends_on_id":"cass_memory_system-f63a","type":"blocks","created_at":"2025-12-07T20:29:51.545936-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-p8p","title":"[Utils] normalizeLineEndings - Cross-platform line ending handling","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:45:27.161664-05:00","updated_at":"2025-12-07T22:18:51.669462-05:00","closed_at":"2025-12-07T22:18:51.669462-05:00","comments":[{"id":25,"issue_id":"cass_memory_system-p8p","author":"jemanuel","text":"## Function Signature\n```typescript\nfunction normalizeLineEndings(content: string): string\n```\n\n## Implementation Details\n- Replace \\r\\n (Windows CRLF) with \\n: content.replace(/\\r\\n/g, '\\n')\n- Replace \\r (old Mac CR) with \\n: result.replace(/\\r/g, '\\n')\n- Return normalized content with Unix-style line endings (LF only)\n- Order matters: replace CRLF before CR to avoid double replacement\n\n## Why This Matters\nCritical for cross-platform compatibility when processing session files. Git on Windows might checkout with CRLF, but processing expects LF. Ensures consistent behavior across macOS, Linux, and Windows.\n\n## Edge Cases to Handle\n- No line endings (single line) - return unchanged\n- Mixed line endings in same file - all normalized to LF\n- Empty string - return empty\n- Only line endings (no content) - return normalized line endings\n- Binary content - may corrupt, but session files are text only","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-p8pb","title":"[Testing:E2E] commands.test.sh - Full workflow tests","description":"#!/bin/bash\nset -e\n\nCASS_MEMORY=\"./dist/cass-memory\"\nTEST_DIR=$(mktemp -d)\nexport CASS_MEMORY_HOME=\"$TEST_DIR\"\n\n# Tests:\n# 1. init creates files\n# 2. config show returns JSON\n# 3. playbook list (empty)\n# 4. playbook add\n# 5. mark helpful\n# 6. context (if cass available)\n# 7. JSON output valid\n# 8. help shows commands\n\ncleanup() { rm -rf \"$TEST_DIR\"; }\ntrap cleanup EXIT","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:39.40823-05:00","updated_at":"2025-12-08T14:25:16.153513-05:00","closed_at":"2025-12-08T14:25:16.153513-05:00"}
{"id":"cass_memory_system-pbwy","title":"[Semantic] findSimilarBulletsSemantic - Embedding-based search","description":"Find semantically similar bullets using embeddings.\n\nImplementation:\n```typescript\nasync function findSimilarBulletsSemantic(\n  query: string,\n  bullets: PlaybookBullet[],\n  topK: number = 5\n): Promise\u003c{ bullet: PlaybookBullet; similarity: number }[]\u003e\n```\n\nProcess:\n1. Embed query text\n2. For each bullet:\n   - Get or compute embedding\n   - Calculate cosine similarity\n3. Sort by similarity (descending)\n4. Return top K results\n\nUse cases:\n- \"similar\" command: Find bullets like a query\n- Duplicate detection: Find bullets too similar\n- Related content: Suggest related rules\n\nExample usage:\n```typescript\nconst similar = await findSimilarBulletsSemantic(\n  \"handling authentication errors\",\n  playbook.bullets,\n  5\n);\n// Returns:\n// [\n//   { bullet: {...}, similarity: 0.92 },  // \"wrap auth calls in try-catch\"\n//   { bullet: {...}, similarity: 0.87 },  // \"log failed login attempts\"\n//   { bullet: {...}, similarity: 0.81 },  // \"return 401 for auth failures\"\n//   ...\n// ]\n```\n\nPerformance:\n- 100 bullets: ~60ms\n- 1000 bullets: ~600ms\n- Could optimize with vector index (future)\n\nSimilarity thresholds:\n- 0.9+: Very similar (possible duplicates)\n- 0.7-0.9: Related content\n- 0.5-0.7: Loosely related\n- \u003c0.5: Not related","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-07T16:49:46.57849-05:00","updated_at":"2025-12-07T17:14:56.439017-05:00","comments":[{"id":26,"issue_id":"cass_memory_system-pbwy","author":"jemanuel","text":"Find semantically similar bullets using embeddings.\n\nImplementation:\n```typescript\nasync function findSimilarBulletsSemantic(\n  query: string,\n  bullets: PlaybookBullet[],\n  topK: number = 5\n): Promise\u003c{ bullet: PlaybookBullet; similarity: number }[]\u003e\n```\n\nProcess:\n1. Embed query text\n2. For each bullet:\n   - Get or compute embedding\n   - Calculate cosine similarity\n3. Sort by similarity (descending)\n4. Return top K results\n\nUse cases:\n- \"similar\" command: Find bullets like a query\n- Duplicate detection: Find bullets too similar\n- Related content: Suggest related rules\n\nExample usage:\n```typescript\nconst similar = await findSimilarBulletsSemantic(\n  \"handling authentication errors\",\n  playbook.bullets,\n  5\n);\n// Returns:\n// [\n//   { bullet: {...}, similarity: 0.92 },  // \"wrap auth calls in try-catch\"\n//   { bullet: {...}, similarity: 0.87 },  // \"log failed login attempts\"\n//   { bullet: {...}, similarity: 0.81 },  // \"return 401 for auth failures\"\n//   ...\n// ]\n```\n\nPerformance:\n- 100 bullets: ~60ms\n- 1000 bullets: ~600ms\n- Could optimize with vector index (future)\n\nSimilarity thresholds:\n- 0.9+: Very similar (possible duplicates)\n- 0.7-0.9: Related content\n- 0.5-0.7: Loosely related\n- \u003c0.5: Not related","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-pcl","title":"[LLM] PROMPTS.context - Pre-task briefing prompt","description":"Full prompt template for pre-task briefing (hydration):\n\nVariables: {task}, {bullets}, {history}, {deprecatedPatterns}\n\nInstructions:\n1. Highlight 3-5 most relevant playbook rules with IDs\n2. Point to specific historical solutions (cite session paths)\n3. Warn about deprecated patterns if matched\n4. Suggest cass search queries for complex tasks\n\nFormat for agent consumption: structured, scannable, actionable\n\n---\n\nTemperature: 0.3\nMax tokens: 2000\nOutput: Free-form text (uses generateText, not generateObject)\n\nThis is the 'briefing' that agents receive before starting work - connect them to relevant organizational memory.\n\nUsed in generateContext function.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:55.028306-05:00","updated_at":"2025-12-07T18:55:28.723377-05:00","closed_at":"2025-12-07T18:55:03.551194-05:00"}
{"id":"cass_memory_system-pdkm","title":"[Build] Version management and display","description":"Implement version management and --version flag.\n\nImplementation:\n\n\nInclude version in:\n- --version flag output\n- --help text header\n- JSON output metadata: {\"version\": \"0.1.0\", ...}\n- Error messages for debugging\n- Doctor command output\n\nFormat: Semantic versioning (MAJOR.MINOR.PATCH)\n- MAJOR: Breaking changes\n- MINOR: New features (backward compatible)\n- PATCH: Bug fixes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:44.420975-05:00","updated_at":"2025-12-07T21:03:13.261933-05:00","closed_at":"2025-12-07T21:03:04.691782-05:00"}
{"id":"cass_memory_system-peoi","title":"[Impl] Add cm quickstart Command for Agent Self-Documentation","description":"# Add cm quickstart Command for Agent Self-Documentation\n\n## Purpose\nAn agent encountering cass-memory should be able to learn how to use it by running ONE command. The tool teaches agents how to use it.\n\n## Command\n\\`\\`\\`bash\ncm quickstart\n\\`\\`\\`\n\n## Output Content (~40 lines, ~400 tokens)\n\n\\`\\`\\`markdown\n# cass-memory Quick Start for AI Agents\n\n## What This Is\nPersistent memory across sessions. Check what's been learned before you work.\n\n## Protocol\nSTART: cm context \\\"\u003ctask\u003e\\\" --json   ← Run before non-trivial work\nWORK:  Reference rule IDs: \\\"Per [b-xyz], checking expiry first...\\\"\nEND:   Session auto-processed (no action needed)\n\n## Essential Commands\n\n### Get Context (run first!)\ncm context \\\"fix authentication bug\\\" --json\n\n### Provide Feedback\ncm mark b-xyz123 helpful --reason \\\"prevented caching bug\\\"\ncm mark b-abc456 harmful --reason \\\"didn't apply here\\\"\n\nOr inline (auto-parsed during reflection):\n// [cass: helpful b-xyz123] this prevented a bug\n\n### Health Check\ncm doctor --json\n\n## Output Format\n{\\\"rules\\\": [{\\\"id\\\": \\\"b-xxx\\\", \\\"content\\\": \\\"...\\\", \\\"score\\\": N}], ...}\n\n## Rule IDs\nFormat: b-abc123. Reference when following rules or giving feedback.\n\n## Exit Codes\n0 = success (parse stdout), non-zero = error (check stderr)\n\\`\\`\\`\n\n## Implementation\n- Add new command: src/commands/quickstart.ts\n- Static markdown string (simple)\n- Support --json flag for structured output\n\n## NO BLOCKERS\nThis can be implemented immediately. Content is well-defined.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T12:51:58.763314-05:00","updated_at":"2025-12-08T13:19:34.14179-05:00","closed_at":"2025-12-08T13:19:34.14179-05:00","dependencies":[{"issue_id":"cass_memory_system-peoi","depends_on_id":"cass_memory_system-2bnu","type":"blocks","created_at":"2025-12-08T12:52:05.786989-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-pljm","title":"[Docs] AGENTS.md template for agent integration","description":"Create AGENTS.md template showing how to integrate cass-memory with AI agents.\n\nTemplate content:\n## Memory System: cass-memory\n\nBefore starting complex tasks, retrieve relevant context:\n```bash\ncass-memory context \"\u003ctask description\u003e\" --json\n```\n\nAs you work, track bullet usage:\n- When helpful: `cass-memory mark \u003cid\u003e --helpful`\n- When harmful: `cass-memory mark \u003cid\u003e --harmful`\n\n### Memory Protocol\n1. PRE-FLIGHT: Run context before non-trivial tasks\n2. REFERENCE: Cite bullet IDs when following rules\n3. FEEDBACK: Mark helpful/harmful during work\n4. REFLECT: Diary auto-generated after sessions\n\nInclude integration examples for Claude Code, custom agents, and CI/CD workflows","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:29.589824-05:00","updated_at":"2025-12-08T13:25:55.600692-05:00","closed_at":"2025-12-08T13:25:55.600692-05:00"}
{"id":"cass_memory_system-pn4m","title":"[Unit] Commands - reflect.ts, search.ts, validate.ts","description":"## Target: src/commands/*.ts - CLI Commands (Part 3)\n\n### reflect.ts Tests:\n\n1. **reflectCommand(options)** - Reflection CLI\n   - Runs reflection pipeline\n   - --since date filter\n   - --output file parameter\n   - --json structured output\n   - No sessions → appropriate message\n\n2. **Output handling**\n   - Markdown report generation\n   - Suggestions clearly formatted\n   - Statistics included\n\n### search.ts Tests:\n\n1. **searchCommand(query, options)** - Search CLI\n   - Searches playbook\n   - Searches CASS if available\n   - --scope filtering\n   - --limit parameter\n   - --json output\n   - No results message\n\n2. **Result formatting**\n   - Scores displayed\n   - Snippets included\n   - Source indicated\n\n### validate.ts Tests:\n\n1. **validateCommand(options)** - Validation CLI\n   - Validates playbook files\n   - Validates config files\n   - --fix attempts fixes\n   - --json output structured\n   - Exit code reflects validity\n\n2. **Error reporting**\n   - Clear error messages\n   - Line numbers when applicable\n   - Suggested fixes\n\n### CLI Testing:\n- Process.exit mocking for exit codes\n- Temp file fixtures\n- stderr capture for errors","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:29:19.209517-05:00","updated_at":"2025-12-08T14:27:02.264231-05:00","closed_at":"2025-12-08T14:27:02.264231-05:00","dependencies":[{"issue_id":"cass_memory_system-pn4m","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:20.673071-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-pn4m","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:33:02.423704-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-pn4m","depends_on_id":"cass_memory_system-vlyh","type":"blocks","created_at":"2025-12-07T20:33:19.224494-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-pn4m","depends_on_id":"cass_memory_system-fem1","type":"blocks","created_at":"2025-12-07T20:33:19.441529-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-pqbp","title":"[CLI] similar command - Semantic bullet search","description":"Implements the 'cass-memory similar' command for semantic bullet search using embeddings.\n\nCOMMAND SYNTAX:\n```bash\ncass-memory similar \"\u003cquery\u003e\" [options]\n\nArguments:\n  query          Text query to find similar bullets\n\nOptions:\n  --limit N      Number of results (default: 5)\n  --threshold T  Minimum similarity score 0-1 (default: 0.7)\n  --scope SCOPE  Filter by scope (global, workspace, all)\n  --json         Output as JSON\n```\n\nPURPOSE:\nUses embeddings to find semantically similar bullets based on a natural language query. Useful for discovering related rules, finding duplicates, and exploring the playbook.\n\nOUTPUT FORMAT (Terminal):\n```\nSIMILAR BULLETS TO: \"handling authentication errors\"\n====================================================\n\nFound 5 semantically similar bullets:\n\n1. [Similarity: 0.92] Retry auth requests with exponential backoff\n   ID: abc-123 | Category: API | Score: 8.4\n   \"When authentication fails with 401, retry with exponential...\"\n\n2. [Similarity: 0.87] Handle token expiry gracefully\n   ID: def-456 | Category: Security | Score: 6.2\n   \"Check token expiry before API calls and refresh proactively...\"\n\n3. [Similarity: 0.81] Log auth failures for security monitoring\n   ID: ghi-789 | Category: Security | Score: 5.1\n   \"Always log authentication failures with context for audit...\"\n\n4. [Similarity: 0.76] Show user-friendly error on auth failure\n   ID: jkl-012 | Category: UX | Score: 4.3\n   \"Display clear message when auth fails, avoid technical jargon...\"\n\n5. [Similarity: 0.72] Use OAuth refresh tokens correctly\n   ID: mno-345 | Category: Security | Score: 7.8\n   \"Store refresh tokens securely and use to obtain new access...\"\n\nTIP: Use 'cass-memory show \u003cid\u003e' to see full details\n```\n\nIMPLEMENTATION REQUIREMENTS:\n\n1. Parse query and options\n2. Generate embedding for query text\n3. Load playbook with embeddings\n4. Compute cosine similarity between query and all bullets\n5. Filter by threshold and scope\n6. Sort by similarity descending\n7. Take top N results\n8. Display with formatting\n\nEMBEDDING SYSTEM:\n\nQuery Embedding:\n```typescript\nconst queryEmbedding = await generateEmbedding(query);\n```\n\nSimilarity Calculation:\n```typescript\nfunction cosineSimilarity(vec1: number[], vec2: number[]): number {\n  const dotProduct = vec1.reduce((sum, val, i) =\u003e sum + val * vec2[i], 0);\n  const mag1 = Math.sqrt(vec1.reduce((sum, val) =\u003e sum + val * val, 0));\n  const mag2 = Math.sqrt(vec2.reduce((sum, val) =\u003e sum + val * val, 0));\n  return dotProduct / (mag1 * mag2);\n}\n```\n\nBullet Matching:\n```typescript\nconst matches = bullets.map(bullet =\u003e ({\n  bullet,\n  similarity: cosineSimilarity(queryEmbedding, bullet.embedding)\n}))\n.filter(m =\u003e m.similarity \u003e= threshold)\n.sort((a, b) =\u003e b.similarity - a.similarity)\n.slice(0, limit);\n```\n\nDISPLAYED INFORMATION:\n- Similarity score (0-1 scale)\n- Bullet ID\n- Category\n- Current effectiveness score\n- Content preview (truncated)\n\nFILTERS:\n- --threshold: minimum similarity (default 0.7)\n- --limit: max results (default 5)\n- --scope: global, workspace, or all\n\nJSON OUTPUT:\n```json\n{\n  \"query\": \"handling authentication errors\",\n  \"results\": [\n    {\n      \"id\": \"abc-123\",\n      \"similarity\": 0.92,\n      \"content\": \"Retry auth requests with exponential backoff\",\n      \"category\": \"API\",\n      \"score\": 8.4,\n      \"preview\": \"When authentication fails with 401...\"\n    },\n    ...\n  ]\n}\n```\n\nUSE CASES:\n- Find related rules before creating new one\n- Discover duplicate or overlapping bullets\n- Explore playbook by concept\n- Find rules by natural language description\n- Identify merge candidates\n\nEDGE CASES:\n- No embeddings available → error with setup instructions\n- No results above threshold → show message\n- Query too short → suggest more specific query\n- Very high similarity (\u003e0.95) → flag as potential duplicate\n\nPERFORMANCE:\n- Cache embeddings in memory\n- Use FAISS or similar for large playbooks (1000+ bullets)\n- Lazy load embeddings on first use\n- Target \u003c1 second for 500 bullets\n\nFALLBACK:\nIf embeddings not available:\n- Suggest enabling embeddings\n- Offer keyword-based search as alternative\n- Explain benefits of semantic search\n\nDEPENDENCIES:\n- Embedding generation (OpenAI/local)\n- Playbook with embeddings\n- Vector similarity utilities\n- Terminal formatting\n\nSUCCESS CRITERIA:\n- Semantically relevant results\n- Fast response time (\u003c1s typical)\n- Similarity scores make sense\n- Helps discover related content\n- Clear when duplicates found","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-07T16:58:16.13367-05:00","updated_at":"2025-12-07T17:14:55.723841-05:00"}
{"id":"cass_memory_system-ps2","title":"[Playbook] findMergeCandidates - Group similar bullets for merging","description":"## Function Signature\n```typescript\nfunction findMergeCandidates(\n  bullets: PlaybookBullet[],\n  minSimilarity: number = 0.7\n): PlaybookBullet[][]\n```\n\n## Purpose\nGroup similar bullets that could be merged. Used by stats command to suggest consolidation opportunities.\n\n## Algorithm\n1. Filter to active bullets only (exclude deprecated)\n2. Group bullets by category first\n3. Within each category:\n   - Calculate pairwise similarity for all bullets\n   - Cluster bullets with similarity \u003e= minSimilarity\n   - Form groups of 2+ similar bullets\n4. Return array of groups\n\n## Output Format\n```typescript\n[\n  [bullet1, bullet2, bullet3],  // Group 1: 3 similar bullets\n  [bullet4, bullet5],           // Group 2: 2 similar bullets\n]\n```\n\n## Clustering Strategy\nOptions:\n1. **Simple pairwise**: If A~B and B~C, group {A,B,C}\n2. **Transitive closure**: Build similarity graph, find connected components\n3. **Hierarchical**: Use complete-linkage clustering\n\nRecommended: Transitive closure for best results\n\n## Category Grouping\nOnly compare bullets in same category:\n- Testing bullets with Testing bullets\n- Security bullets with Security bullets\n- Prevents false positives from shared terms\n\n## Usage in Stats Command\n```typescript\nconst groups = findMergeCandidates(playbook.bullets, 0.7);\nconsole.log(`Found ${groups.length} merge opportunities:`);\ngroups.forEach((group, i) =\u003e {\n  console.log(`\\nGroup ${i + 1}:`);\n  group.forEach(b =\u003e console.log(`  - ${b.content}`));\n});\n```\n\n## Similarity Threshold\n- **0.7**: Good default, catches related rules\n- **0.8**: Stricter, only very similar\n- **0.6**: Looser, may need manual review\n\n## Implementation Notes\n- Skip deprecated bullets entirely\n- Group by category first (performance)\n- Return only groups with 2+ bullets\n- Sort groups by size (largest first)\n\n## Dependencies\n- jaccardSimilarity() utility\n- Category field on bullets\n\n## Related Functions\n- findSimilarBullet() - finds single best match\n- isDuplicateBullet() - boolean duplicate check\n- deprecateBullet() - used when merging","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:08.411547-05:00","updated_at":"2025-12-07T20:07:53.576223-05:00","closed_at":"2025-12-07T20:07:19.785457-05:00"}
{"id":"cass_memory_system-pub","title":"[Types] ConfigSchema - Application Configuration Zod Schema","description":"## Overview\nImplement comprehensive Zod schema for application-wide configuration with validation, defaults, and type safety.\n\n## Required Fields\n\n### Core Settings\n- schema_version: number (default: 1) - Config file version for migrations\n- provider: enum 'openai' | 'anthropic' | 'google' (default: 'anthropic') - LLM provider selection\n- model: string (default: 'claude-sonnet-4-20250514') - Model identifier\n- cassPath: string (default: 'cass') - Path to cass executable\n- playbookPath: string (default: '~/.cass-memory/playbook.yaml') - Main playbook location\n- diaryDir: string (default: '~/.cass-memory/diary') - Working memory directory\n\n### Reflector Configuration\n- maxReflectorIterations: number, range 1-10 (default: 3) - Max iterations for reflector loop\n- autoReflect: boolean (default: false) - Automatic reflection after sessions\n\n### Deduplication \u0026 Pruning\n- dedupSimilarityThreshold: number, range 0-1 (default: 0.85) - Cosine similarity threshold for merging bullets\n- pruneHarmfulThreshold: number, range 1-10 (default: 3) - Harmful marks before auto-retirement\n- defaultDecayHalfLife: number (default: 90) - Days for confidence decay half-life\n\n### Context Limits\n- maxBulletsInContext: number, range 5-200 (default: 50) - Max bullets in pre-task hydration\n- maxHistoryInContext: number, range 3-50 (default: 10) - Max history snippets per context\n\n### Lookback Windows\n- sessionLookbackDays: number, range 1-365 (default: 7) - Days for session search in context\n- validationLookbackDays: number, range 30-365 (default: 90) - Days for scientific validation\n\n### Feature Flags\n- validationEnabled: boolean (default: true) - Enable scientific validation before adding rules\n- enrichWithCrossAgent: boolean (default: true) - Include multi-agent history in context\n- verbose: boolean (default: false) - Detailed logging output\n- jsonOutput: boolean (default: false) - Machine-readable JSON output\n\n### Sanitization (Nested Object)\n- sanitization.enabled: boolean (default: true) - Enable secret sanitization\n- sanitization.extraPatterns: string[] (default: []) - Additional regex patterns for sanitization\n\n## Implementation Details\n- Use Zod's .default() for all optional fields\n- Implement .refine() for cross-field validation (e.g., maxBulletsInContext \u003e maxHistoryInContext)\n- Add .transform() to expand ~ in paths\n- Include helpful error messages via .describe()\n- Export both schema and inferred TypeScript type\n\n## Acceptance Criteria\n- All 20+ config fields with correct types and ranges\n- Default values match specification\n- Range validation for numeric fields\n- Enum validation for provider/model\n- Path expansion for ~ in file paths\n- Type-safe TypeScript interface exported\n- Comprehensive JSDoc comments","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:54.88196-05:00","updated_at":"2025-12-07T19:56:31.22448-05:00","closed_at":"2025-12-07T19:55:57.982986-05:00"}
{"id":"cass_memory_system-pwp","title":"[Generator] formatLastHelpful - Human-readable feedback time","description":"Format bullet feedback timestamps as human-readable relative time.\n\nSIGNATURE:\nfunction formatLastHelpful(bullet: PlaybookBullet): string\n\nPURPOSE:\nConvert the most recent helpful event timestamp into a user-friendly relative time string for display in context output. Helps users understand recency of validation.\n\nINPUT:\nPlaybookBullet with events: Array\u003c{\n  type: 'helpful' | 'unhelpful',\n  timestamp: Date,\n  sessionPath?: string,\n  notes?: string\n}\u003e\n\nLOGIC:\n1. Find most recent event where type === 'helpful'\n2. If no helpful events exist, return 'Never'\n3. Calculate time difference from now\n4. Format based on magnitude:\n   - \u003c 1 hour: '{minutes} minutes ago'\n   - \u003c 24 hours: '{hours} hours ago'\n   - \u003c 7 days: '{days} days ago'\n   - \u003c 30 days: '{weeks} weeks ago'\n   - \u003c 365 days: '{months} months ago'\n   - \u003e= 365 days: '{years} years ago'\n\nEXAMPLES:\n- Last helpful 45 minutes ago → '45 minutes ago'\n- Last helpful 3 hours ago → '3 hours ago'\n- Last helpful 2 days ago → '2 days ago'\n- Last helpful 3 weeks ago → '3 weeks ago'\n- Last helpful 5 months ago → '5 months ago'\n- Last helpful 2 years ago → '2 years ago'\n- No helpful events → 'Never'\n\nROUNDING:\n- Always round down (floor)\n- 1.9 days → '1 day ago' (not 2)\n- This is conventional for relative time\n\nSPECIAL CASES:\n- 'just now' for \u003c 1 minute (optional)\n- 'today' for same calendar day (optional)\n- 'yesterday' for previous calendar day (optional)\n\nFORMATTING OPTIONS:\nBasic: '{n} {unit}s ago'\nFriendly: 'last week', 'yesterday', 'just now'\n\nIMPLEMENTATION:\nUse date-fns or similar library for robust relative time:\nimport { formatDistanceToNow } from 'date-fns';\nreturn formatDistanceToNow(lastHelpfulEvent.timestamp, { addSuffix: true });\n\nOUTPUT USAGE:\nAppears in context markdown:\n  - Score: 4.2 | Last helpful: 2 days ago\n\nHelps user assess:\n- Recency of validation (recent = high confidence)\n- Staleness (never helpful = low confidence)\n- Temporal patterns (helpful 2 years ago = may be outdated)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:02.833061-05:00","updated_at":"2025-12-07T20:04:56.116261-05:00","closed_at":"2025-12-07T20:04:52.720295-05:00"}
{"id":"cass_memory_system-pwt6","title":"[E2E Tests] CLI doctor command - health diagnostics","description":"## E2E Test: CLI doctor Command - Health Diagnostics\n\n### Test Scenario\nTest `cm doctor` diagnoses and optionally fixes issues\n\n### Test Steps\n\n#### 1. Healthy System Check\n- Initialize properly configured project\n- Run `cm doctor`\n- Verify all checks pass\n- Verify clear success message\n\n#### 2. Missing Config Detection\n- Remove config.yaml\n- Run `cm doctor`\n- Verify 'Missing config' reported\n- Test `cm doctor --fix` recreates config\n\n#### 3. Invalid Config Detection\n- Write malformed YAML to config.yaml\n- Run `cm doctor`\n- Verify parse error reported\n- Show line number of error\n\n#### 4. Cass Integration Check\n- Test with cass available\n- Test with cass unavailable\n- Verify appropriate status messages\n\n#### 5. Index Health Check\n- Test with healthy cass index\n- Test with missing/corrupt index\n- Verify `--fix` rebuilds index\n\n#### 6. Playbook Validation\n- Test with valid playbook\n- Test with invalid bullet schemas\n- Report specific validation errors\n\n### Verbose Logging\n- Log: 'Running cass-memory diagnostics...'\n- Log: 'Checking config file...'\n- Log: 'Checking playbook schema...'\n- Log: 'Checking cass availability...'\n- Log: 'Checking cass index health...'\n- Log: 'Diagnostics complete: N issues found'\n\n### Output Format\n- `--format json` for machine parsing\n- Human-readable table by default\n- Exit code reflects health status","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:24:43.178213-05:00","updated_at":"2025-12-08T01:16:39.669768-05:00","closed_at":"2025-12-08T01:16:39.669768-05:00","dependencies":[{"issue_id":"cass_memory_system-pwt6","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2025-12-07T20:31:25.862873-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-pwt6","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2025-12-07T20:31:25.970997-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-pwt6","depends_on_id":"cass_memory_system-70sd","type":"blocks","created_at":"2025-12-07T20:31:30.35586-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-pwt6","depends_on_id":"cass_memory_system-92xd","type":"blocks","created_at":"2025-12-07T20:31:30.475879-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-q23","title":"[LLM] generateObjectSafe - Schema validation with retry","description":"Function signature:\nasync function generateObjectSafe\u003cT\u003e(\n  schema: z.ZodSchema\u003cT\u003e,\n  prompt: string,\n  config: Config,\n  maxAttempts: number = 2\n): Promise\u003cT\u003e\n\nImplementation:\n1. Call generateObject with schema and prompt\n2. Validate result with Zod (double-check - SDK should already validate)\n3. If validation fails (malformed LLM response):\n   a. Modify prompt to emphasize JSON format requirements\n   b. Add schema example to prompt\n   c. Slightly increase temperature (e.g., 0.3 → 0.35) to avoid repeating same error\n   d. Retry (up to maxAttempts)\n4. Return validated result\n\nEnhanced prompt on retry:\n'[PREVIOUS ATTEMPT FAILED - OUTPUT MUST BE VALID JSON]\n\n{original prompt}\n\nCRITICAL: Your response MUST match this exact schema:\n{JSON.stringify(schema, null, 2)}\n\nExample valid output:\n{schemaExample}'\n\nHandles edge cases where LLM produces malformed JSON or misses required fields.\n\nUsed by: All generateObject calls in production code.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:46:11.328654-05:00","updated_at":"2025-12-07T20:15:05.017026-05:00","closed_at":"2025-12-07T20:14:56.344487-05:00"}
{"id":"cass_memory_system-q2zt","title":"Update lock.test.ts for atomic mkdir implementation","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T21:04:36.017152-05:00","updated_at":"2025-12-07T21:05:28.613226-05:00","closed_at":"2025-12-07T21:05:28.613226-05:00"}
{"id":"cass_memory_system-q3h2","title":"[Testing] Epic: full coverage + e2e logging","description":"","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-07T20:29:33.260572-05:00","updated_at":"2025-12-08T00:17:18.216052-05:00","closed_at":"2025-12-08T00:17:03.761279-05:00"}
{"id":"cass_memory_system-q4v","title":"[Reflector] buildReflectorPrompt - Dynamic prompt construction","description":"function buildReflectorPrompt(\n  diary: DiaryEntry,\n  sessionContent: string,\n  existingBullets: PlaybookBullet[],\n  iteration: number\n): string\n\nConstructs comprehensive prompt with:\n- Existing bullets summary (by category) - provides context for helpful/harmful marks\n- Diary fields (accomplishments, decisions, challenges, etc.) - structured insights\n- Session content (truncated if needed) - raw material for analysis\n- Cass history for cross-agent context - learn from other agents\n- Iteration note (\"This is iteration N. Focus on insights you may have missed.\")\n\nPROMPT STRUCTURE:\n1. System context (what reflection is for)\n2. Existing bullets (summarizeExistingBullets)\n3. Diary extraction fields\n4. Cross-agent history (fetchCrossAgentHistory)\n5. Session content snippet\n6. Iteration guidance (getIterationNote)\n7. Output schema instructions\n\nDEPENDENCIES:\n- summarizeExistingBullets()\n- fetchCrossAgentHistory()\n- getIterationNote()","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:52.839075-05:00","updated_at":"2025-12-07T18:57:45.663377-05:00","closed_at":"2025-12-07T18:57:40.293865-05:00"}
{"id":"cass_memory_system-q858","title":"[Docs] Command reference documentation","description":"Create comprehensive command reference documentation for all cass-memory commands.\n\nFor each command document:\n- Command name and purpose: One-line description\n- Usage syntax: cass-memory \u003ccommand\u003e [options] [args]\n- Arguments: Positional args with descriptions\n- Options: All flags with type, default, description\n- Examples: 3-5 real-world examples\n- Exit codes: 0 success, 1 error, 2 validation failure, etc.\n- JSON output format: Schema for --json mode\n\nCommands to document:\n- init, context, diary, reflect, validate, mark, audit, playbook, project, forget, stats, doctor, top, stale, why, similar\n\nTarget: Complete reference with copy-paste examples","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:27.309716-05:00","updated_at":"2025-12-08T13:50:38.498223-05:00","closed_at":"2025-12-08T13:50:38.498223-05:00"}
{"id":"cass_memory_system-qbdq","title":"[Critical] Zero-Config Quick Start Mode - Immediate Value Without Setup","description":"# Zero-Config Quick Start Mode\n\n## The Problem\nCurrent plan requires: init → config → reflect → wait for sessions → curate → then finally get value.\nThis is too many steps before users see ANY benefit. Most will abandon before step 3.\n\n## The Solution\nMake `cm context \"my task\"` work IMMEDIATELY, even with zero setup:\n\n### Day 1 (No Setup Required):\n```bash\n# User just runs this - no init, no config\ncm context \"fix the auth bug\"\n\n# Output (even with empty playbook):\n# Checking your recent agent sessions...\n# Found 3 relevant sessions from Claude Code and Cursor\n# \n# ## Relevant Past Work:\n# - Session from 2 hours ago: Fixed JWT validation (similar: auth)\n# - Session from yesterday: Updated user model schema\n# \n# No playbook rules yet. Run 'cm reflect' to start learning from your sessions.\n```\n\n### How It Works:\n1. Auto-detect ~/.cass directory (create if needed with sensible defaults)\n2. Auto-find cass sessions in standard locations\n3. Show value immediately from raw cass history\n4. Gradually introduce playbook as it gets populated\n\n### Config Auto-Detection:\n1. Check ~/.cass-memory/config.json → use if exists\n2. Check ./.cass/config.json → use if exists\n3. Otherwise → use sensible defaults, no file needed\n\n## Why This Is Critical\n- Users need to see value in \u003c 30 seconds\n- If first experience is \"run init, then configure, then...\" they leave\n- cass history search alone is valuable - don't hide it behind setup\n- Playbook is a bonus, not a prerequisite\n\n## Success Metrics\n- Time to first useful output: \u003c 5 seconds\n- Required setup steps: 0\n- Commands needed for basic usage: 1 (`cm context \"task\"`)","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T17:08:05.870433-05:00","updated_at":"2025-12-07T20:21:09.200662-05:00","closed_at":"2025-12-07T20:20:42.300762-05:00","comments":[{"id":27,"issue_id":"cass_memory_system-qbdq","author":"jemanuel","text":"CRITICAL FOR USER ADOPTION - This is the #1 priority!\n\n## Problem\nCurrent flow requires too many steps before users see value. Users will abandon by step 5.\n\n## Solution\nZero-config mode that provides value IMMEDIATELY using local keyword extraction + cass search (NO LLM required).\n\n## Acceptance Criteria\n- context command works without any configuration\n- Works without API keys\n- Returns useful results from cass history alone\n- Clear messaging about \"quick-start mode\"\n","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-qbmq","title":"[E2E] Error Recovery - Graceful Handling of Failures","description":"## Target: E2E test of error handling and recovery\n\n### Scenario: Various Failure Modes\n\n```\nCorrupted config file → graceful error, offer fix\nMissing permissions → clear message\nInvalid playbook YAML → validation error\nNetwork timeout (LLM) → retry then fallback\nDisk full → atomic write prevents corruption\nInterrupted operation → recoverable state\n```\n\n### Test Script:\n\n```typescript\ndescribe('E2E: Error Recovery', () =\u003e {\n  describe('corrupted config', () =\u003e {\n    it('detects and offers recovery', async () =\u003e {\n      const env = await createTestEnvironment();\n      \n      // Corrupt the config\n      await writeFile(join(env.home, '.cass-memory/config.json'), '{ invalid json');\n      log('Corrupted config file');\n      \n      // Try to use\n      const result = await runCLI(['context', 'test', '--json'], { env });\n      log('Result:', result.stdout, result.stderr);\n      \n      expect(result.exitCode).not.toBe(0);\n      expect(result.stderr).toContain('config');\n      \n      // Doctor should detect\n      const doctor = await runCLI(['doctor', '--json'], { env });\n      log('Doctor result:', doctor.stdout);\n      expect(JSON.parse(doctor.stdout).issues).toContainEqual(\n        expect.objectContaining({ type: 'config_invalid' })\n      );\n      \n      // Fix should work\n      const fix = await runCLI(['init', '--force', '--json'], { env });\n      log('Fix result:', fix.stdout);\n      expect(fix.exitCode).toBe(0);\n      \n      // Now works\n      const retry = await runCLI(['context', 'test', '--json'], { env });\n      log('Retry result:', retry.stdout);\n      expect(retry.exitCode).toBe(0);\n    });\n  });\n\n  describe('permission errors', () =\u003e {\n    it('handles unreadable playbook', async () =\u003e {\n      // ... test permission denied scenarios\n    });\n  });\n\n  describe('network failures', () =\u003e {\n    it('retries and falls back', async () =\u003e {\n      // Set invalid API endpoint\n      // Verify retry behavior\n      // Verify fallback to non-LLM mode\n    });\n  });\n});\n```\n\n### Logging:\n- Error messages captured\n- Recovery steps logged\n- Final state verification","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-07T20:31:15.840297-05:00","updated_at":"2025-12-07T20:31:15.840297-05:00","dependencies":[{"issue_id":"cass_memory_system-qbmq","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:41.163554-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-qbmq","depends_on_id":"cass_memory_system-zc1d","type":"blocks","created_at":"2025-12-07T20:32:41.303532-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-qbmq","depends_on_id":"cass_memory_system-ke2x","type":"blocks","created_at":"2025-12-07T20:33:05.912106-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-qd9r","title":"[E2E] Add coverage reports + log formatting (JSONL)","description":"Emit coverage summary (bun test --coverage) as artifact; enforce thresholds. Standardize e2e logging format (JSONL with step, command, exit_code, duration, stdout_truncated, stderr_truncated) and add per-run log directory under .cass-memory/usage/e2e.","notes":"Added scripts/coverage.sh to run bun test --coverage with artifacts + summary JSON","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:30:30.441139-05:00","updated_at":"2025-12-07T20:54:36.022705-05:00","closed_at":"2025-12-07T20:54:27.225347-05:00","dependencies":[{"issue_id":"cass_memory_system-qd9r","depends_on_id":"cass_memory_system-4fx1","type":"blocks","created_at":"2025-12-07T20:30:30.446357-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-qec","title":"[Generator] generateTaskContext - Main context generation","description":"Main context generation orchestrator function.\n\nSIGNATURE:\nasync function generateTaskContext(task: string, config: Config): Promise\u003cContextResult\u003e\n\nFLOW:\n1. Plan searches (generate queries from task using LLM)\n2. Execute cass searches in parallel\n3. Score playbook bullets by relevance to task\n4. Separate rules from anti-patterns\n5. Check deprecated patterns for warnings\n6. Build JSON output structure\n7. Optionally generate formatted markdown\n\nRETURNS:\nContextResult with structured data for agent consumption including:\n- Relevant playbook rules (scored and filtered)\n- Anti-patterns to avoid\n- Historical context from cass\n- Deprecated pattern warnings\n- Suggested follow-up queries\n\nPURPOSE:\nCreates 'mission briefings' before tasks by hydrating context from both the playbook (learned patterns) and cass (historical sessions). This is the entry point for the Generator domain.\n\nDEPENDENCIES:\n- generateSearchPlan (query generation)\n- executeSearchPlan (cass searches)\n- scorePlaybookBullets (relevance scoring)\n- separateAntiPatterns (rule/pitfall split)\n- checkDeprecatedPatterns (warnings)\n- buildContextResult (assembly)\n- formatContextMarkdown (optional formatting)\n\nERROR HANDLING:\nFalls back to contextWithoutCass if cass is unavailable - still provides playbook context even without historical data.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:52.093332-05:00","updated_at":"2025-12-07T18:59:44.047172-05:00","closed_at":"2025-12-07T18:59:33.683086-05:00"}
{"id":"cass_memory_system-qef","title":"[Decay] isStale - Detect rules without recent feedback","description":"Detect rules that haven't received any feedback (helpful or harmful) in a configurable period. Stale rules need review - they may be obsolete or just unused.\n\nCOMPLETE IMPLEMENTATION:\n```typescript\n/**\n * Check if bullet is stale (no recent feedback).\n * Stale rules may be obsolete, irrelevant, or just not being invoked.\n */\nfunction isStale(bullet: PlaybookBullet, staleDays: number = 90): boolean {\n  const allEvents = [...bullet.helpfulEvents, ...bullet.harmfulEvents];\n  \n  if (allEvents.length === 0) {\n    // No feedback ever - check creation date\n    return daysSince(bullet.createdAt) \u003e staleDays;\n  }\n\n  const lastFeedback = Math.max(\n    ...allEvents.map(e =\u003e new Date(e.timestamp).getTime())\n  );\n  \n  return daysSince(lastFeedback) \u003e staleDays;\n}\n\nfunction daysSince(timestamp: string | number): number {\n  const time = typeof timestamp === 'string' \n    ? new Date(timestamp).getTime() \n    : timestamp;\n  return (Date.now() - time) / (1000 * 60 * 60 * 24);\n}\n```\n\nSTALENESS LOGIC:\n\nCase 1: No feedback ever\n- Check days since bullet.createdAt\n- If \u003e staleDays, consider stale\n- May indicate rule never matches or is too narrow\n\nCase 2: Has feedback history\n- Find most recent event (helpful OR harmful)\n- If last event \u003e staleDays ago, consider stale\n- May indicate codebase evolved past this rule\n\nDEFAULT: 90 days\n- Configurable per playbook or system-wide\n- Shorter for fast-moving projects\n- Longer for stable, mature codebases\n\nWHY STALENESS MATTERS:\n\nSTALE \\!= BAD:\n- Stale rule might be perfect but just not encountered\n- Could be edge case that rarely triggers\n- Or could be obsolete cruft from old codebase\n\nSTALE RULES NEED REVIEW:\n- Human review: Is this still relevant?\n- If yes: Keep or pin\n- If no: Deprecate or delete\n- If unsure: Leave as candidate, watch for another 90 days\n\nEXAMPLE SCENARIOS:\n\n1. SECURITY RULE (stale but critical):\n   - \"Never commit AWS credentials\"\n   - Created 1 year ago\n   - 0 feedback (good thing\\!)\n   - Stale = true but should be pinned\n   - Keep forever even without feedback\n\n2. OBSOLETE FRAMEWORK RULE:\n   - \"Use Angular 1.x controllers\"\n   - Last helpful 300 days ago\n   - Project migrated to React\n   - Stale = true, should deprecate\n\n3. EDGE CASE RULE:\n   - \"Handle leap year in date calculations\"\n   - Created 200 days ago\n   - 0 feedback (hasn't been encountered)\n   - Stale = true but may still be valid\n   - Review and decide\n\nINTEGRATION:\n\nUsed by stats command:\n```typescript\nconst staleCount = bullets.filter(b =\u003e isStale(b)).length;\nconsole.log(`Stale rules (\u003e90 days): ${staleCount}`);\n```\n\nUsed by review command (future):\n```typescript\nconst staleRules = bullets.filter(b =\u003e isStale(b) \u0026\u0026 \\!b.pinned);\nconsole.log('Rules needing review:', staleRules);\n```\n\nCONFIGURATION:\n- Default staleDays: 90\n- Override per-playbook in playbook.json\n- Override per-invocation: isStale(bullet, 60)\n\nDEPENDENCIES:\n- daysSince() helper\n- PlaybookBullet.createdAt field\n- PlaybookBullet.helpfulEvents array\n- PlaybookBullet.harmfulEvents array\n\nRETURNS:\n- true: No feedback in staleDays period\n- false: Has recent feedback","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:46:10.631857-05:00","updated_at":"2025-12-07T21:15:58.750641-05:00","closed_at":"2025-12-07T21:14:24.788114-05:00"}
{"id":"cass_memory_system-qhbq","title":"Correct validation result normalization and mapping","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T00:33:00.558498-05:00","updated_at":"2025-12-08T00:33:31.090004-05:00","closed_at":"2025-12-08T00:33:31.090004-05:00"}
{"id":"cass_memory_system-qino","title":"[E2E] Add failure-path e2e: cass unavailable, LLM unavailable","description":"Script e2e to simulate cass binary missing and LLM API unset. Expect graceful degradation messages, non-zero? exit codes defined, and structured logs showing fallback. Verify no network calls when LLM disabled.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:30:22.943382-05:00","updated_at":"2025-12-08T01:38:52.441073-05:00","closed_at":"2025-12-08T01:38:52.441073-05:00","dependencies":[{"issue_id":"cass_memory_system-qino","depends_on_id":"cass_memory_system-4fx1","type":"blocks","created_at":"2025-12-07T20:30:22.949431-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-qlab","title":"Fix Critical RCE: Prevent repo config from overriding cassPath","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T21:00:25.821149-05:00","updated_at":"2025-12-07T21:01:42.059969-05:00","closed_at":"2025-12-07T21:01:39.005632-05:00"}
{"id":"cass_memory_system-qm27","title":"[Decay] applyMaturityTransitions - Batch promotion/demotion","description":"Apply promotion/demotion rules across all bullets in a playbook. Called at the end of each curate cycle to automatically advance proven rules and demote toxic ones. Returns summary of all transitions.\n\nCOMPLETE IMPLEMENTATION:\n```typescript\n/**\n * Apply maturity transitions across entire playbook.\n * Checks each bullet for promotion/demotion and applies changes.\n * Called at end of curate cycle.\n */\nfunction applyMaturityTransitions(playbook: Playbook): {\n  promotions: { bulletId: string; from: string; to: string }[];\n  demotions: { bulletId: string; from: string; to: string }[];\n  autoDeprecated: { bulletId: string; score: number }[];\n  unchanged: number;\n} {\n  const promotions: { bulletId: string; from: string; to: string }[] = [];\n  const demotions: { bulletId: string; from: string; to: string }[] = [];\n  const autoDeprecated: { bulletId: string; score: number }[] = [];\n  let unchanged = 0;\n\n  playbook.bullets.forEach(bullet =\u003e {\n    if (bullet.maturity === 'deprecated') {\n      unchanged++;\n      return;  // Skip already deprecated\n    }\n\n    const currentMaturity = bullet.maturity;\n    \n    // Check for promotion first\n    const promotionTarget = checkForPromotion(bullet);\n    if (promotionTarget !== currentMaturity) {\n      bullet.maturity = promotionTarget;\n      promotions.push({\n        bulletId: bullet.id,\n        from: currentMaturity,\n        to: promotionTarget\n      });\n      return;\n    }\n\n    // Check for demotion\n    const demotionTarget = checkForDemotion(bullet);\n    if (demotionTarget === 'auto-deprecate') {\n      const score = getEffectiveScore(bullet);\n      bullet.maturity = 'deprecated';\n      bullet.deprecatedAt = new Date().toISOString();\n      bullet.deprecationReason = `Auto-deprecated due to negative score (${score.toFixed(2)})`;\n      autoDeprecated.push({ bulletId: bullet.id, score });\n      return;\n    }\n    \n    if (demotionTarget !== currentMaturity) {\n      bullet.maturity = demotionTarget;\n      demotions.push({\n        bulletId: bullet.id,\n        from: currentMaturity,\n        to: demotionTarget\n      });\n      return;\n    }\n\n    unchanged++;\n  });\n\n  return {\n    promotions,\n    demotions,\n    autoDeprecated,\n    unchanged\n  };\n}\n```\n\nTRANSITION RULES:\n\nProcessing Order:\n1. Skip deprecated bullets (already terminal state)\n2. Check promotion first (reward positive signals)\n3. Check demotion only if no promotion\n4. Apply auto-deprecation if score \u003c -3\n\nWhy Promotion First?\n- Positive signals should override minor negatives\n- Prevents flip-flopping between maturity levels\n- Rewards consistent helpful marks\n\nEXAMPLE SCENARIOS:\n\nScenario 1: Mass Promotion\n```typescript\n// After successful sprint with good playbook usage\nconst result = applyMaturityTransitions(playbook);\n// Result:\n// promotions: 5 (candidate → established)\n// demotions: 0\n// autoDeprecated: 0\n// unchanged: 37\n```\n\nScenario 2: Codebase Evolution\n```typescript\n// After major refactor, old rules become toxic\nconst result = applyMaturityTransitions(playbook);\n// Result:\n// promotions: 2 (new patterns emerging)\n// demotions: 8 (old patterns harmful)\n// autoDeprecated: 3 (severely toxic old rules)\n// unchanged: 29\n```\n\nScenario 3: Stable Playbook\n```typescript\n// Mature playbook with infrequent changes\nconst result = applyMaturityTransitions(playbook);\n// Result:\n// promotions: 0\n// demotions: 0\n// autoDeprecated: 0\n// unchanged: 42\n```\n\nOUTPUT STRUCTURE:\n\nPromotions:\n```json\n{\n  \"bulletId\": \"rule-123\",\n  \"from\": \"candidate\",\n  \"to\": \"established\"\n}\n```\n\nDemotions:\n```json\n{\n  \"bulletId\": \"rule-456\",\n  \"from\": \"proven\",\n  \"to\": \"established\"\n}\n```\n\nAuto-Deprecated:\n```json\n{\n  \"bulletId\": \"rule-789\",\n  \"score\": -5.25\n}\n```\n\nINTEGRATION WITH CURATE CYCLE:\n```typescript\n// At end of curate command\nasync function finalizeCuration(playbook: Playbook) {\n  // 1. Save all feedback events\n  await savePlaybook(playbook);\n\n  // 2. Apply maturity transitions\n  const transitions = applyMaturityTransitions(playbook);\n\n  // 3. Save updated maturities\n  await savePlaybook(playbook);\n\n  // 4. Report to user\n  if (transitions.promotions.length \u003e 0) {\n    console.log(`✓ Promoted ${transitions.promotions.length} rules`);\n    transitions.promotions.forEach(p =\u003e {\n      console.log(`  - ${p.bulletId}: ${p.from} → ${p.to}`);\n    });\n  }\n\n  if (transitions.demotions.length \u003e 0) {\n    console.log(`⚠ Demoted ${transitions.demotions.length} rules`);\n    transitions.demotions.forEach(d =\u003e {\n      console.log(`  - ${d.bulletId}: ${d.from} → ${d.to}`);\n    });\n  }\n\n  if (transitions.autoDeprecated.length \u003e 0) {\n    console.log(`⛔ Auto-deprecated ${transitions.autoDeprecated.length} rules`);\n    transitions.autoDeprecated.forEach(a =\u003e {\n      console.log(`  - ${a.bulletId} (score: ${a.score.toFixed(2)})`);\n    });\n  }\n}\n```\n\nSIDE EFFECTS:\n- Modifies playbook.bullets[].maturity in place\n- Sets deprecatedAt timestamp for auto-deprecated bullets\n- Sets deprecationReason for auto-deprecated bullets\n- Does NOT save to disk (caller's responsibility)\n\nIDEMPOTENCY:\nSafe to call multiple times - already-transitioned bullets won't re-transition unless scores change.\n\nDEPENDENCIES:\n- checkForPromotion()\n- checkForDemotion()\n- getEffectiveScore()\n- PlaybookBullet.maturity field\n- PlaybookBullet.deprecatedAt field (optional)\n- PlaybookBullet.deprecationReason field (optional)\n\nUSED BY:\n- curate command (end of cycle)\n- Batch processing scripts\n- Playbook maintenance tools","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:47:35.351776-05:00","updated_at":"2025-12-08T14:28:58.375925-05:00","closed_at":"2025-12-08T14:28:58.375925-05:00"}
{"id":"cass_memory_system-qoto","title":"[Config] isSemanticallyToxic - Check against toxic log","description":"Function signature:\n```typescript\nasync function isSemanticallyToxic(\n  content: string,\n  toxicLog: ToxicEntry[]\n): Promise\u003cboolean\u003e\n```\n\nImplementation:\n1. Compute content hash (SHA256)\n2. Check if hash exists in toxicLog entries\n3. If not found by hash, compute content embedding\n4. Compare embedding against all toxic embeddings using cosine similarity\n5. Return true if similarity \u003e 0.85 threshold\n\nToxicEntry structure:\n```typescript\ninterface ToxicEntry {\n  contentHash: string;\n  embedding: number[];\n  forgottenAt: string;\n  reason?: string;\n}\n```\n\nUsed during playbook loading to filter out bullets marked as toxic via `cm forget` command.\nPrevents resurrection of harmful rules across sessions.\n\nPerformance: Hash check is O(1), embedding comparison is O(n * embedding_dim) where n = toxic entries.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:50:23.294264-05:00","updated_at":"2025-12-07T20:26:00.908727-05:00","closed_at":"2025-12-07T20:25:32.325865-05:00"}
{"id":"cass_memory_system-qp8","title":"[Playbook] addBullet - Add new bullet to playbook","description":"## Function Signature\n```typescript\nfunction addBullet(\n  playbook: Playbook,\n  data: NewBulletData,\n  sourceSession: string\n): PlaybookBullet\n```\n\n## Purpose\nAdd a new bullet to the playbook with complete initialization of all required fields.\n\n## Created Bullet Structure\n```typescript\n{\n  id: generateBulletId(),\n  content: data.content,\n  category: data.category,\n  tags: data.tags || [],\n  type: \"rule\",\n  isNegative: false,\n  state: \"draft\",\n  maturity: \"candidate\",\n  helpfulCount: 0,\n  harmfulCount: 0,\n  helpfulEvents: [],\n  harmfulEvents: [],\n  confidenceDecayHalfLifeDays: config.defaultDecayHalfLife || 90,\n  pinned: false,\n  sourceSessions: [sourceSession],\n  sourceAgents: [extractAgentFromPath(sourceSession)],\n  createdAt: now(),\n  updatedAt: now()\n}\n```\n\n## Field Initialization\n- **id**: Generated via generateBulletId() (timestamp-based)\n- **type**: Always \"rule\" by default\n- **isNegative**: false (rules are positive by default)\n- **state**: \"draft\" (new bullets start in draft)\n- **maturity**: \"candidate\" (needs validation)\n- **confidenceDecayHalfLifeDays**: From config or 90 days\n- **helpfulEvents/harmfulEvents**: Empty arrays for feedback\n- **sourceSessions**: Array with creating session\n- **sourceAgents**: Extracted from session path\n\n## Implementation Notes\n- Push bullet to playbook.bullets array\n- Return the created bullet for immediate use\n- extractAgentFromPath() parses session filename\n- Timestamps use ISO 8601 format\n\n## Dependencies\n- generateBulletId()\n- extractAgentFromPath()\n- Config for decay half-life\n\n## Related Functions\n- findBullet() - locate created bullet\n- recordFeedbackEvent() - add feedback to bullet\n- savePlaybook() - persist the addition","notes":"Existing playbook helper implementations already present; no code changes made. Released reservation; feel free to take over.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:47.858394-05:00","updated_at":"2025-12-07T18:58:10.126825-05:00","closed_at":"2025-12-07T18:57:52.632669-05:00"}
{"id":"cass_memory_system-qqi8","title":"Unit Test: reflect.ts","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:53:20.188957-05:00","updated_at":"2025-12-07T20:55:55.541702-05:00","closed_at":"2025-12-07T20:54:38.82029-05:00","dependencies":[{"issue_id":"cass_memory_system-qqi8","depends_on_id":"cass_memory_system-u64s","type":"discovered-from","created_at":"2025-12-07T20:53:20.192796-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-qrk5","title":"Integration test: Reflector pipeline (diary -\u003e reflect -\u003e delta)","description":"Integration test for Reflector pipeline:\n- extractDiary() -\u003e reflectOnSession() -\u003e Delta output\n- Real session export fixtures\n- Multi-iteration reflection with shouldExitEarly()\n- Verify delta accumulation across iterations\n- Verify stats tracking accuracy\n- Detailed logging: diary extraction, each iteration, final deltas\nNO MOCKS - real diary.ts + reflect.ts interaction","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:26:23.344061-05:00","updated_at":"2025-12-08T00:17:18.258144-05:00","closed_at":"2025-12-08T00:17:12.389322-05:00","dependencies":[{"issue_id":"cass_memory_system-qrk5","depends_on_id":"cass_memory_system-tmcq","type":"blocks","created_at":"2025-12-07T20:28:22.989654-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-qrk5","depends_on_id":"cass_memory_system-8pqd","type":"blocks","created_at":"2025-12-07T20:28:23.388418-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-qt2q","title":"[CLI:context] formatContextOutput - JSON vs Markdown","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:51:36.878209-05:00","updated_at":"2025-12-07T22:38:15.491742-05:00","closed_at":"2025-12-07T22:38:06.470686-05:00"}
{"id":"cass_memory_system-qxes","title":"[CLI:mark] recordMarkEvent - Create feedback event","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:44.573386-05:00","updated_at":"2025-12-07T21:12:17.524918-05:00","closed_at":"2025-12-07T21:12:13.743524-05:00"}
{"id":"cass_memory_system-r0ap","title":"[Testing:Unit] playbook.test.ts - Playbook management tests","description":"Test cases:\n- createEmptyPlaybook: valid structure\n- addBullet: generates ID, initializes counters\n- updateBulletCounter: increments, handles missing\n- deprecateBullet: sets flags, optional replacement\n- isDuplicateBullet: exact and near duplicates, ignores deprecated\n- curatePlaybook: applies deltas, skips duplicates, auto-prunes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:27.649666-05:00","updated_at":"2025-12-08T02:03:20.785038-05:00","closed_at":"2025-12-08T02:03:20.785038-05:00"}
{"id":"cass_memory_system-r2w","title":"[Utils] fileExists - Async file existence check","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:44:47.194958-05:00","updated_at":"2025-12-07T20:24:04.197162-05:00","closed_at":"2025-12-07T20:24:00.177807-05:00","comments":[{"id":28,"issue_id":"cass_memory_system-r2w","author":"jemanuel","text":"## Function Signature\n```typescript\nasync function fileExists(filePath: string): Promise\u003cboolean\u003e\n```\n\n## Implementation Details\n- Expand path using expandPath() first\n- Use fs.promises.access(expandedPath, fs.constants.F_OK)\n- Return true if access succeeds\n- Return false on any error (ENOENT, permission denied, etc.)\n- Never throw - always returns boolean\n\n## Why This Matters\nPrefer this over sync version (fs.existsSync) for performance in async contexts. Used extensively to check if playbook.yaml, sessions, or config files exist before attempting to read or create them.\n\n## Edge Cases to Handle\n- File doesn't exist - return false\n- File exists but no read permission - return false (file exists but not accessible)\n- Path is a directory - return true (directory exists)\n- Broken symlink - return false\n- Empty path - return false\n- Null/undefined - return false","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-r6w7","title":"Fix Inefficient Outcome Locking","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T22:03:18.076714-05:00","updated_at":"2025-12-07T22:03:45.046906-05:00","closed_at":"2025-12-07T22:03:45.046906-05:00"}
{"id":"cass_memory_system-r79a","title":"[CLI:diary] handleDiaryOutput - Save or print diary","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:40.071474-05:00","updated_at":"2025-12-07T21:13:40.088686-05:00","closed_at":"2025-12-07T21:13:38.283059-05:00"}
{"id":"cass_memory_system-r9fb","title":"[E2E] Implement full-path scenario: reflect + validate + curate with logging","description":"Add scripted e2e covering diary extraction, reflect pipeline, validate, curate apply. Include fixtures for fake cass export, run in temp dir, assert playbook deltas applied. Capture verbose logs (timestamps, command + args, stderr) and redact secrets.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:30:14.040228-05:00","updated_at":"2025-12-08T01:32:37.481002-05:00","closed_at":"2025-12-08T01:32:37.481002-05:00","dependencies":[{"issue_id":"cass_memory_system-r9fb","depends_on_id":"cass_memory_system-4fx1","type":"blocks","created_at":"2025-12-07T20:30:14.043172-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-r9h","title":"[Diary] enrichWithRelatedSessions - Cross-agent context","description":"Enrich diary with related sessions from other agents for cross-agent learning.\n\nFunction Signature:\nasync function enrichWithRelatedSessions(\n  diary: DiaryEntry,\n  config: Config\n): Promise\u003cDiaryEntry\u003e\n\nProcess:\n1. Extract keywords from diary content:\n   - All accomplishments, decisions, challenges, keyLearnings\n   - Suggested tags\n   - Combine into keyword set\n2. Query cass for related sessions using keywords\n3. Filter out sessions from same agent (diversity requirement)\n4. Score each result by relevance to current diary\n5. Take top 5 most relevant sessions\n6. Add to diary.relatedSessions array\n7. Return enriched diary\n\nRelevance Scoring Algorithm:\n- Keyword overlap count\n- Tag matching weight\n- Recency bonus (newer sessions scored higher)\n- Agent diversity bonus (different agent types)\n\nCross-Agent Learning Benefits:\n- Discover how other agents solved similar problems\n- Learn user preferences across different contexts\n- Build holistic view of user's work patterns\n- Enable knowledge transfer between tools\n\nExample Use Case:\nIf Claude diary shows 'React component refactoring', find related Cursor sessions about React, even if from different projects.\n\nConfiguration:\n- config.maxRelatedSessions: default 5\n- config.relatedSessionsDays: search within N days (default 30)\n- config.minRelevanceScore: threshold for inclusion\n\nOutput:\nReturns diary with relatedSessions array populated with {sessionPath, agent, score}.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:45:39.692623-05:00","updated_at":"2025-12-07T21:04:25.967339-05:00","closed_at":"2025-12-07T21:03:24.042581-05:00"}
{"id":"cass_memory_system-rd7d","title":"[Semantic] Model selection and fallback","description":"Configurable embedding model selection with fallback.\n\nConfig option:\n```typescript\ninterface Config {\n  embeddingModel: \"Xenova/all-MiniLM-L6-v2\" | \"Xenova/bge-small-en-v1.5\" | \"none\";\n  semanticSearchEnabled: boolean;\n}\n```\n\nModels:\n1. Xenova/all-MiniLM-L6-v2 (default)\n   - Size: 23MB\n   - Dims: 384\n   - Quality: Good\n   - Speed: ~3ms/embedding\n   - Best for: General purpose\n\n2. Xenova/bge-small-en-v1.5\n   - Size: 33MB\n   - Dims: 384\n   - Quality: Better\n   - Speed: ~4ms/embedding\n   - Best for: Higher quality matching\n\n3. \"none\"\n   - Disables semantic search\n   - Falls back to keyword-only\n   - Useful for: Low-resource environments\n\nFallback strategy:\n```typescript\nasync function getEmbedder(): Promise\u003cany | null\u003e {\n  try {\n    return await pipeline(\"feature-extraction\", config.embeddingModel);\n  } catch (error) {\n    console.warn(\"Embedding model failed to load:\", error.message);\n    console.warn(\"Falling back to keyword-only matching\");\n    config.semanticSearchEnabled = false;\n    return null;\n  }\n}\n```\n\nWhen to fall back:\n- Model download fails (network issue)\n- Model incompatible with platform\n- Insufficient memory\n- User preference (config.embeddingModel = \"none\")\n\nConfig example:\n```yaml\nsemantic:\n  enabled: true\n  model: \"Xenova/all-MiniLM-L6-v2\"\n  fallbackToKeyword: true\n```","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-07T16:49:48.161611-05:00","updated_at":"2025-12-07T17:14:56.163463-05:00","comments":[{"id":29,"issue_id":"cass_memory_system-rd7d","author":"jemanuel","text":"Configurable embedding model selection with fallback.\n\nConfig option:\n```typescript\ninterface Config {\n  embeddingModel: \"Xenova/all-MiniLM-L6-v2\" | \"Xenova/bge-small-en-v1.5\" | \"none\";\n  semanticSearchEnabled: boolean;\n}\n```\n\nModels:\n1. Xenova/all-MiniLM-L6-v2 (default)\n   - Size: 23MB\n   - Dims: 384\n   - Quality: Good\n   - Speed: ~3ms/embedding\n   - Best for: General purpose\n\n2. Xenova/bge-small-en-v1.5\n   - Size: 33MB\n   - Dims: 384\n   - Quality: Better\n   - Speed: ~4ms/embedding\n   - Best for: Higher quality matching\n\n3. \"none\"\n   - Disables semantic search\n   - Falls back to keyword-only\n   - Useful for: Low-resource environments\n\nFallback strategy:\n```typescript\nasync function getEmbedder(): Promise\u003cany | null\u003e {\n  try {\n    return await pipeline(\"feature-extraction\", config.embeddingModel);\n  } catch (error) {\n    console.warn(\"Embedding model failed to load:\", error.message);\n    console.warn(\"Falling back to keyword-only matching\");\n    config.semanticSearchEnabled = false;\n    return null;\n  }\n}\n```\n\nWhen to fall back:\n- Model download fails (network issue)\n- Model incompatible with platform\n- Insufficient memory\n- User preference (config.embeddingModel = \"none\")\n\nConfig example:\n```yaml\nsemantic:\n  enabled: true\n  model: \"Xenova/all-MiniLM-L6-v2\"\n  fallbackToKeyword: true\n```","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-rf0t","title":"Fix reflect.test.ts schema expectation","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T22:04:43.847711-05:00","updated_at":"2025-12-07T22:13:28.803564-05:00","closed_at":"2025-12-07T22:13:28.803564-05:00","dependencies":[{"issue_id":"cass_memory_system-rf0t","depends_on_id":"cass_memory_system-u64s","type":"discovered-from","created_at":"2025-12-07T22:04:43.848526-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-rg3","title":"[Utils] normalizeYamlKeys - snake_case to camelCase conversion","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:45:26.29149-05:00","updated_at":"2025-12-08T00:14:33.048816-05:00","closed_at":"2025-12-08T00:14:30.612249-05:00","comments":[{"id":30,"issue_id":"cass_memory_system-rg3","author":"jemanuel","text":"## Function Signature\n```typescript\nfunction normalizeYamlKeys(obj: any): any\n```\n\n## Implementation Details\n- Check if obj is array - recursively normalize each element\n- Check if obj is object - for each key:\n  - Convert snake_case to camelCase: replace /_([a-z])/g with (match, letter) =\u003e letter.toUpperCase()\n  - Recursively normalize value\n  - Build new object with camelCase keys\n- Return normalized object/array/primitive\n\n## Why This Matters\nSchema naming convention: camelCase in TypeScript, accept both snake_case and camelCase on YAML load, emit camelCase on save. Allows backward compatibility with old YAML files using snake_case while standardizing on camelCase internally.\n\n## Edge Cases to Handle\n- Null/undefined - return as-is\n- Primitives (string, number) - return as-is\n- Already camelCase - return unchanged\n- Mixed case (helpfulCount and helpful_count in same object) - both normalized to helpfulCount, last one wins\n- Nested objects - recursively normalize all levels\n- Arrays of objects - normalize each object","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-rj0p","title":"[CLI] validate command - Scientific rule validation","description":"Standalone command to validate a proposed playbook rule against historical evidence.\n\nCommand signature:\n```bash\ncass-memory validate \"\u003cproposed rule\u003e\" [options]\n\nOptions:\n  --json             Output as JSON\n  --verbose          Show evidence details\n  --days N           Look back N days for evidence (default: 90)\n```\n\nPurpose:\nBefore adding a rule to the playbook, validate it scientifically against past sessions. Prevents adding rules based on hunches rather than evidence.\n\nImplementation flow:\n1. Parse proposed rule from command line\n2. Query cass for relevant sessions:\n   - Look back N days\n   - Search for sessions related to rule topic\n   \n3. Run validator core logic:\n   - Extract evidence from sessions\n   - Classify as supporting/contradicting/neutral\n   - Calculate confidence score\n   - Generate verdict (accept/reject/unclear)\n   \n4. Format and display report:\n   - If --json: output ValidationReport as JSON\n   - Else: format human-readable report\n   - If --verbose: include full evidence excerpts\n\nExample usage:\n```bash\n$ cass-memory validate \"Always use httpx instead of requests\"\nPROPOSED RULE: \"Always use httpx instead of requests\"\nVERDICT: ✓ ACCEPT (confidence: 0.85)\nEVIDENCE:\n- [supports] ~/.claude/.../session-001.jsonl\n  \"Switched to httpx, fixed timeout issues\"\n- [supports] ~/.codex/.../session-xyz.jsonl\n  \"httpx handled async properly\"\nREASON: Found 4 sessions where requests caused issues, 0 issues with httpx\n```\n\nThis command can be used standalone or called internally by reflect command.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:50:32.385303-05:00","updated_at":"2025-12-07T21:13:40.091484-05:00","closed_at":"2025-12-07T21:13:35.842188-05:00"}
{"id":"cass_memory_system-rm96","title":"[Unit] curate.ts - Curation Pipeline Logic","description":"## Target: src/curate.ts - Curation Module\n\n### Functions to Test:\n\n1. **curatePlaybook(playbook, options)** - Main curation pipeline\n   - Applies all curation rules\n   - Respects options (dryRun, verbose)\n   - Returns curation report\n   - Handles empty playbook\n\n2. **detectDuplicates(bullets)** - Duplicate detection\n   - Exact duplicates found\n   - Near-duplicates (fuzzy matching)\n   - Returns duplicate groups\n   - Similarity threshold configurable\n\n3. **mergeDuplicates(bullets, duplicateGroups)** - Merge duplicates\n   - Combines feedbackEvents\n   - Keeps most informative content\n   - Preserves highest score\n   - Handles edge cases (all identical)\n\n4. **detectObsolete(bullets, options)** - Obsolete detection\n   - Age-based obsolescence\n   - Score-based obsolescence\n   - Combines multiple factors\n   - Respects pinned bullets\n\n5. **suggestTags(bullet)** - Auto-tagging suggestions\n   - Extract keywords from content\n   - Map to existing tag vocabulary\n   - Return confidence scores\n   - Handle technical terms\n\n6. **validateBulletContent(bullet)** - Content validation\n   - Check for placeholder text\n   - Check minimum content length\n   - Check for broken references\n   - Return validation issues\n\n### Curation Report Schema:\n- duplicatesFound: number\n- obsoleteFound: number\n- suggestedMerges: array\n- suggestedDeletions: array\n- suggestedTags: array\n\n### Test Data:\n- Create realistic bullet sets\n- Include edge cases (empty, massive)\n- Unicode content handling","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:28:35.084231-05:00","updated_at":"2025-12-08T14:22:22.771534-05:00","closed_at":"2025-12-08T14:22:22.771534-05:00","dependencies":[{"issue_id":"cass_memory_system-rm96","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:17.387525-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-rm96","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:32:59.73569-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-rmt","title":"[Generator] formatContextMarkdown - Human-readable output","description":"Format ContextResult as human-readable markdown for display.\n\nSIGNATURE:\nfunction formatContextMarkdown(result: ContextResult): string\n\nPURPOSE:\nConvert the structured JSON ContextResult into a nicely formatted markdown document for human consumption. Used when user runs 'cass-memory context' command.\n\nOUTPUT FORMAT:\n\nwtmp begins Sun Dec  7 16:47:25 EST 2025\n\nFORMATTING RULES:\n- Use proper markdown headers (##, ###)\n- Bullet IDs as bold inline code: **[b-abc123]**\n- Scores rounded to 1 decimal: 4.2\n- Snippets indented and quoted\n- Warnings with emoji ⚠️ prefix\n- Suggested queries as bullet list\n\nSECTION VISIBILITY:\n- 'PITFALLS TO AVOID': Only if antiPatterns.length \u003e 0\n- 'Historical Context': Only if historySnippets.length \u003e 0\n- 'Deprecated Warnings': Only if warnings.length \u003e 0\n- 'Dig Deeper': Only if suggestedQueries.length \u003e 0\n\nSNIPPET TRUNCATION:\n- Limit snippets to 150 chars with '...' if longer\n- Preserve code formatting if snippet contains newlines\n\nEXAMPLE OUTPUT:\n\nwtmp begins Sun Dec  7 16:47:26 EST 2025\n\nwtmp begins Sun Dec  7 16:47:26 EST 2025\n\nUSE CASE:\nDirect CLI output when user runs: cass-memory context 'Fix authentication timeout bug'","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:01.382979-05:00","updated_at":"2025-12-07T20:06:29.962963-05:00","closed_at":"2025-12-07T20:05:53.580019-05:00"}
{"id":"cass_memory_system-rxd","title":"[Curator] buildHashCache - Pre-compute content hashes","description":"Build a hash cache for O(1) duplicate detection during curation.\n\nSignature:\nfunction buildHashCache(playbook: Playbook): Set\u003cstring\u003e\n\nProcess:\n1. Initialize empty Set\u003cstring\u003e\n2. For each bullet in playbook.bullets:\n   - Hash bullet.content using SHA-256\n   - Add hash to set\n3. Return set\n\nWhy hash caching?\n- Enables O(1) exact duplicate lookup\n- Called once at start of curation\n- Prevents expensive re-hashing for each add delta\n- Clean separation of hashing logic\n\nHash algorithm:\n- SHA-256 of normalized content\n- Normalization:\n  * Trim whitespace\n  * Lowercase\n  * Remove extra spaces\n  * Consistent encoding\n\nExample usage in curatePlaybook:\nThe hash cache is built once and passed to all add delta handlers.\n\nPerformance impact:\n- Without cache: O(n * m) where n=deltas, m=bullets\n- With cache: O(n + m) - linear time\n- Critical for large playbooks (100+ bullets)\n\nHash cache is READ-ONLY during delta processing.\nUpdated after successful adds in handleAddDelta.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:45:07.428337-05:00","updated_at":"2025-12-07T21:14:16.256654-05:00","closed_at":"2025-12-07T21:14:07.587632-05:00"}
{"id":"cass_memory_system-ryxn","title":"Enhance dedup threshold and playbook command locking","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T21:53:38.587472-05:00","updated_at":"2025-12-07T21:53:42.619673-05:00","closed_at":"2025-12-07T21:53:42.619673-05:00"}
{"id":"cass_memory_system-s1hm","title":"Unit Tests: Playbook Management","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:23:02.386658-05:00","updated_at":"2025-12-07T21:53:28.285682-05:00","closed_at":"2025-12-07T21:51:06.590224-05:00"}
{"id":"cass_memory_system-s578","title":"[CLI:doctor] applyFixes - Auto-fix recoverable issues","description":"Implements the applyFixes function that automatically repairs recoverable issues found by doctor.\n\nFUNCTION SIGNATURE:\n```typescript\ninterface FixableIssue {\n  id: string;\n  description: string;\n  category: string;\n  severity: 'warn' | 'fail';\n  fix: () =\u003e Promise\u003cvoid\u003e;\n}\n\nasync function applyFixes(\n  issues: FixableIssue[],\n  options: { interactive?: boolean }\n): Promise\u003cvoid\u003e\n```\n\nPURPOSE:\nAutomatically repairs common issues that are safe to fix without user data loss. Requires explicit user confirmation unless --yes flag provided.\n\nFIXABLE ISSUES:\n\n1. Missing Data Directory:\n   - Create directory with proper permissions\n   - Safe: no data loss risk\n   - Auto-fix: Yes\n\n2. Missing Playbook:\n   - Create empty playbook.json\n   - Safe: creates new file, doesn't overwrite\n   - Auto-fix: Yes\n\n3. Stale Cass Index:\n   - Run: cass rebuild-index\n   - Potentially slow (warn user)\n   - Auto-fix: With confirmation\n\n4. Invalid Config:\n   - Reset to defaults\n   - Save backup of old config\n   - Auto-fix: With confirmation\n\n5. Missing Diary Directory:\n   - Create directory structure\n   - Safe: no data loss\n   - Auto-fix: Yes\n\nNON-FIXABLE ISSUES (guidance only):\n- Missing API keys → provide setup instructions\n- Insufficient disk space → suggest cleanup\n- cass not installed → provide install link\n- Corrupted playbook → manual recovery needed\n\nIMPLEMENTATION WORKFLOW:\n\n```typescript\nasync function applyFixes(issues, options) {\n  if (issues.length === 0) {\n    console.log('No fixable issues found.');\n    return;\n  }\n\n  console.log(`Found ${issues.length} fixable issues:\\n`);\n  issues.forEach((issue, i) =\u003e {\n    console.log(`${i + 1}. ${issue.description}`);\n  });\n\n  if (options.interactive) {\n    const answer = await prompt('Apply all fixes? (y/n): ');\n    if (answer !== 'y') {\n      console.log('Aborted.');\n      return;\n    }\n  }\n\n  for (const issue of issues) {\n    try {\n      console.log(`Fixing: ${issue.description}...`);\n      await issue.fix();\n      console.log('  ✓ Fixed');\n    } catch (err) {\n      console.error(`  ✗ Failed: ${err.message}`);\n    }\n  }\n\n  console.log('\\nRe-running health check...');\n  // Run doctor again to verify fixes\n}\n```\n\nSAFETY MEASURES:\n- Dry-run mode: show what would be fixed\n- Backup before destructive changes\n- Atomic operations (temp file + rename)\n- Rollback on failure\n- Detailed logging\n\nINTERACTIVE PROMPTS:\n- Show issue description\n- Show proposed fix\n- Ask for confirmation per-issue or batch\n- Provide skip option\n- Show progress during fixes\n\nERROR HANDLING:\n- If fix fails, continue with remaining fixes\n- Log failures but don't abort\n- Provide rollback option if available\n- Re-run doctor after fixes to verify\n\nFIX CATEGORIES:\n1. SAFE (auto-apply):\n   - Create missing directories\n   - Create missing empty files\n   \n2. CAUTIOUS (prompt):\n   - Rebuild indexes\n   - Reset configs\n   - Clear caches\n\n3. MANUAL (guidance only):\n   - Install dependencies\n   - Configure API keys\n   - Free disk space\n\nDEPENDENCIES:\n- File system operations\n- Prompt library (readline/inquirer)\n- Backup utilities\n- Config reset functions\n\nSUCCESS CRITERIA:\n- Only fixes safe issues without data loss\n- Clear communication of what's being fixed\n- Rollback on failure\n- Re-validates after fixes\n- Handles partial failures gracefully","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:56:30.12739-05:00","updated_at":"2025-12-07T22:54:47.009077-05:00","closed_at":"2025-12-07T22:54:36.106092-05:00"}
{"id":"cass_memory_system-sc7","title":"[Validator] shouldSkipValidation - Determine if validation needed","description":"Implement the shouldSkipValidation function - Heuristics to determine if validation is needed.\n\nSIGNATURE:\n```typescript\nfunction shouldSkipValidation(delta: PlaybookDelta, config: Config): boolean\n```\n\nSKIP VALIDATION IF:\n1. Delta type is not \"add\" (remove/edit operations)\n2. config.validationEnabled === false (validation disabled globally)\n3. Rule content is too short to validate meaningfully (\u003c 20 chars)\n4. Rule is workspace-specific (less generalizable)\n5. Rule is in \"PITFALLS\" section (anti-patterns, different validation)\n\nIMPLEMENTATION:\n```typescript\nfunction shouldSkipValidation(delta: PlaybookDelta, config: Config): boolean {\n  // Check 1: Validation disabled in config\n  if (!config.validationEnabled) {\n    return true;\n  }\n\n  // Check 2: Only validate \"add\" deltas\n  if (delta.type !== \"add\") {\n    return true;\n  }\n\n  // Check 3: Content too short\n  if (delta.content.length \u003c 20) {\n    return true;\n  }\n\n  // Check 4: Workspace-specific rules (less generalizable)\n  const workspaceIndicators = [\n    /this project/i,\n    /our codebase/i,\n    /in this workspace/i,\n    /for this team/i\n  ];\n  if (workspaceIndicators.some(pattern =\u003e pattern.test(delta.content))) {\n    return true;\n  }\n\n  // Check 5: PITFALLS section (different validation logic)\n  if (delta.section === \"PITFALLS\") {\n    return true;  // Could have separate pitfall validation\n  }\n\n  // Check 6: Generic rule detection\n  if (isGenericRule(delta.content)) {\n    return true;  // Too obvious to validate\n  }\n\n  return false;  // Validation needed\n}\n```\n\nWORKSPACE-SPECIFIC DETECTION:\nRules that reference:\n- \"This project\"\n- \"Our codebase\"\n- \"In this workspace\"\n- \"For this team\"\n- Specific project names\n\nThese are valid but don't need historical validation.\n\nPERFORMANCE OPTIMIZATION:\n- Fast heuristics avoid expensive operations\n- No I/O, no LLM calls\n- Pure function for easy testing\n- Runs before evidenceCountGate()\n\nWHY THIS MATTERS:\n- Avoids wasting resources on rules that don't need validation\n- Allows workspace-specific rules without false rejections\n- Improves performance by early filtering\n- Provides escape hatch for validation edge cases\n\nDEPENDENCIES:\n- isGenericRule() - Detect overly obvious rules\n- PlaybookDelta type\n- Config type\n\nLOCATION:\n- src/validator/skip-validation.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:44:58.794611-05:00","updated_at":"2025-12-08T14:28:28.548043-05:00","closed_at":"2025-12-08T14:28:28.548043-05:00"}
{"id":"cass_memory_system-sdt1","title":"Epic: Comprehensive Test Coverage","description":"# Epic: Comprehensive Test Coverage\n\n## Goal\nAchieve comprehensive test coverage for cass-memory with:\n1. Unit tests - Pure function tests WITHOUT mocks/fakes\n2. Integration tests - Cross-module tests with real dependencies\n3. E2E tests - Full CLI tests with detailed logging\n\n## Philosophy: No Mocks Where Possible\n- Test REAL behavior, not mocked behavior\n- Use actual file I/O with temp directories\n- Use actual YAML parsing/serialization\n- Only mock external services (LLM APIs) when absolutely necessary\n- Prefer integration tests over unit tests with mocks\n\n## Structure\n1. Test Infrastructure (fixtures, helpers, logging)\n2. Unit Tests - Per-module (scoring, playbook, config, etc.)\n3. Integration Tests - Cross-module (curator pipeline, reflect pipeline)\n4. E2E Tests - Full CLI commands with logging\n\n## Success Criteria\n- All exported functions have tests\n- All CLI commands have e2e tests\n- Test output includes detailed logging for debugging\n- No flaky tests (deterministic)\n- Tests run in \u003c30 seconds total","status":"in_progress","priority":0,"issue_type":"epic","created_at":"2025-12-07T20:21:38.071226-05:00","updated_at":"2025-12-08T01:43:39.770727-05:00","dependencies":[{"issue_id":"cass_memory_system-sdt1","depends_on_id":"cass_memory_system-b82i","type":"blocks","created_at":"2025-12-07T20:28:44.749277-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-skri","title":"[Impl] Automated Post-Session Reflection Hook","description":"# Automated Post-Session Reflection Hook\n\n## Purpose\nAgents shouldn't have to remember to run `cm reflect`. Learning should happen automatically after sessions end. This task designs and documents the automation approach.\n\n## Current State\n- `cm reflect --days N` processes recent sessions\n- Must be run manually or via cron\n- Agents don't call this (nor should they)\n\n## Automation Options\n\n### Option 1: Shell Hook / Alias\nUsers configure their shell or agent tool to run reflection after sessions:\n```bash\n# In .bashrc or agent config\nalias ccend='cm reflect --days 1 --quiet'\n```\n\n### Option 2: Cron Job\nRegular background processing:\n```cron\n0 * * * * cm reflect --days 1 --quiet\n```\n\n### Option 3: cass Integration Hook\nWhen cass indexes a new session, trigger reflection:\n```bash\n# cass post-index hook\ncm reflect --session \"$INDEXED_SESSION\"\n```\n\n### Option 4: MCP Server Background Task\nThe MCP server periodically processes new sessions in the background.\n\n## Recommendation\nDocument all options in README with copy-paste examples. Primary recommendation:\n1. Cron for personal use (simple, reliable)\n2. CI/CD hook for team use (processes sessions on commit)\n3. MCP server for real-time use (when running as MCP)\n\n## Deliverables\n- [ ] Documentation for each automation option\n- [ ] Copy-paste configs for common setups\n- [ ] Add to \"For Humans - Operation\" section of README\n- [ ] Consider adding `cm setup-hooks` command","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T12:47:51.059278-05:00","updated_at":"2025-12-08T13:13:28.298192-05:00","closed_at":"2025-12-08T13:13:28.298192-05:00","dependencies":[{"issue_id":"cass_memory_system-skri","depends_on_id":"cass_memory_system-afjz","type":"blocks","created_at":"2025-12-08T12:48:46.54771-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-sqsy","title":"[CLI:project] formatAgentsMd - Generate AGENTS.md section","description":"Implements the formatAgentsMd function that generates the AGENTS.md format for playbook export.\n\nFUNCTION SIGNATURE:\n```typescript\nfunction formatAgentsMd(\n  playbook: Playbook,\n  options: { topN?: number; showCounts?: boolean }\n): string\n```\n\nOUTPUT FORMAT:\n```markdown\n## Agent Playbook (auto-generated from cass-memory)\n\n### Testing (top 5 rules)\n1. [8× helpful] For React hooks, test effects separately\n2. [5× helpful] Run tests before committing\n3. [3× helpful] Use test fixtures for complex data\n\n### Git Workflow\n1. [6× helpful] Make atomic commits\n2. [4× helpful] Write descriptive commit messages\n\n### PITFALLS TO AVOID\n- AVOID: Caching auth tokens without expiry check\n- AVOID: Running migrations without backup\n```\n\nIMPLEMENTATION REQUIREMENTS:\n1. Group bullets by category (semantic clustering)\n2. Sort bullets within each category by effectiveness score\n3. Apply topN filter if specified\n4. Format counts as \"[Nx helpful]\" or \"[Nx helpful, 1× harmful]\"\n5. Separate anti-patterns into PITFALLS section\n6. Include metadata header (generation timestamp, total count)\n\nRANKING LOGIC:\n- Use effective score (with decay) for ranking\n- Prioritize established/proven over candidates\n- Show global rules before workspace-specific\n\nOUTPUT QUALITY:\n- Clean markdown formatting\n- Proper heading hierarchy\n- Concise bullet previews (truncate if needed)\n- Professional tone suitable for AI assistants\n\nDEPENDENCIES:\n- Playbook data structure\n- Score calculation utilities\n- Category inference system","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:52:09.248029-05:00","updated_at":"2025-12-08T13:27:07.935982-05:00","closed_at":"2025-12-08T13:27:07.935982-05:00"}
{"id":"cass_memory_system-sr2t","title":"[ErrorHandling] EXIT_CODES - Standard exit codes","description":"Define standard exit codes for consistent scripting integration.\n\nConstants:\nconst EXIT_CODES = {\n  SUCCESS: 0,\n  USER_ERROR: 1,       // Invalid input\n  CONFIG_ERROR: 2,     // Configuration issues\n  CASS_ERROR: 3,       // cass unavailable/failed\n  LLM_ERROR: 4,        // LLM provider failed\n  IO_ERROR: 5,         // Filesystem issues\n  INTERNAL_ERROR: 9,   // Unexpected errors\n  INTERRUPTED: 130     // SIGINT (128 + 2)\n};\n\nUsage:\nprocess.exit(EXIT_CODES.SUCCESS);\n\nBenefits:\n- Enables shell scripting: if cass-memory ingest; then...\n- Distinguishes error types in CI/CD\n- Follows Unix conventions\n- Consistent with standard tools\n\nExamples:\n- Missing file: IO_ERROR (5)\n- Bad command args: USER_ERROR (1)\n- Rate limit exceeded: LLM_ERROR (4)\n- Ctrl+C: INTERRUPTED (130)\n\nDocument in README for users writing scripts.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:59.786064-05:00","updated_at":"2025-12-07T21:00:31.319301-05:00","closed_at":"2025-12-07T20:59:56.058056-05:00"}
{"id":"cass_memory_system-sr3","title":"[Decay] getDecayedScore - Time-weighted event aggregation","description":"Calculate decayed helpful count based on recency of events. A rule that was helpful 8 times in January but never since June will have dramatically lower effective score by December.\n\nCOMPLETE IMPLEMENTATION:\n```typescript\n/**\n * Calculate decayed helpful count based on recency of events.\n * A rule that was helpful 8 times in January but never since June\n * will have dramatically lower effective score by December.\n */\nfunction getDecayedScore(\n  events: FeedbackEvent[],\n  halfLifeDays: number = 90,\n  now: number = Date.now()\n): number {\n  if (events.length === 0) return 0;\n\n  return events.reduce((sum, event) =\u003e {\n    const eventTime = new Date(event.timestamp).getTime();\n    const daysSinceEvent = (now - eventTime) / (1000 * 60 * 60 * 24);\n    const decayFactor = Math.pow(0.5, daysSinceEvent / halfLifeDays);\n    return sum + decayFactor;\n  }, 0);\n}\n```\n\nMATHEMATICAL EXPLANATION:\n- halfLife = 90 days means after 90 days, an event is worth 0.5 of original\n- After 180 days, worth 0.25\n- After 270 days, worth 0.125\n- Exponential decay: decayFactor = 0.5^(daysAgo/halfLife)\n\nWHY THIS MATTERS:\nWithout decay, rules from 2 years ago have same weight as rules from yesterday. Codebases evolve - old rules may no longer apply. This is the SINGLE MOST IMPORTANT ENHANCEMENT - prevents playbook fossilization.\n\nPARAMETERS:\n- events: Array of FeedbackEvent with timestamp field\n- halfLifeDays: Number of days for event value to decay to 50% (default: 90)\n- now: Current timestamp in milliseconds (default: Date.now())\n\nRETURNS:\n- Decayed score as sum of all time-weighted events\n\nEXAMPLE:\nEvent from today: decayFactor = 1.0\nEvent from 90 days ago: decayFactor = 0.5\nEvent from 180 days ago: decayFactor = 0.25\nTotal score = 1.0 + 0.5 + 0.25 = 1.75","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:44:43.001078-05:00","updated_at":"2025-12-07T21:15:58.752014-05:00","closed_at":"2025-12-07T21:14:24.783045-05:00"}
{"id":"cass_memory_system-ssb2","title":"[Config] savePlaybookToAppropriateLevel - Smart save location","description":"Function signature:\n```typescript\nasync function savePlaybookToAppropriateLevel(\n  bullet: PlaybookBullet,\n  config: Config\n): Promise\u003c'global' | 'repo'\u003e\n```\n\nDecision logic:\n1. If scope === 'workspace' → save to repo (.cass/playbook.yaml)\n2. If scope === 'global' AND in repo AND bullet is project-specific → save to repo\n3. Otherwise → save to global (~/.cass-memory/playbook.yaml)\n\nProject-specific heuristics:\n- Contains file paths\n- References project-specific APIs/frameworks\n- Created during workspace reflection\n\nImplementation:\n1. Detect repo context\n2. Apply decision logic\n3. Load appropriate playbook file\n4. Add/update bullet\n5. Save atomically\n6. Return save location\n\nEnsures team conventions go to .cass/ (shared) while personal rules stay global.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:50:04.188624-05:00","updated_at":"2025-12-07T21:15:58.754663-05:00","closed_at":"2025-12-07T21:14:50.023643-05:00"}
{"id":"cass_memory_system-su8w","title":"[E2E] Performance - Large Scale Operations","description":"## Target: E2E performance tests with detailed timing\n\n### Scenario: Large Data Volumes\n\n```\n1000 bullets in playbook\n100 diary entries\nComplex queries\nBulk operations\n```\n\n### Test Script:\n\n```typescript\ndescribe('E2E: Performance', () =\u003e {\n  describe('large playbook', () =\u003e {\n    it('handles 1000 bullets efficiently', async () =\u003e {\n      const env = await createTestEnvironment();\n      \n      // Generate 1000 bullets\n      log('Generating 1000 bullets...');\n      const startGen = performance.now();\n      \n      const playbook = createEmptyPlaybook();\n      for (let i = 0; i \u003c 1000; i++) {\n        playbook.bullets.push(generateRandomBullet(i));\n      }\n      await savePlaybook(playbook, env.playbookPath);\n      \n      const genTime = performance.now() - startGen;\n      log(`Generated 1000 bullets in ${genTime.toFixed(2)}ms`);\n\n      // Test context query performance\n      log('Testing context query...');\n      const startQuery = performance.now();\n      \n      const result = await runCLI(['context', 'typescript error handling', '--json'], { env });\n      \n      const queryTime = performance.now() - startQuery;\n      log(`Context query completed in ${queryTime.toFixed(2)}ms`);\n      log('Result count:', JSON.parse(result.stdout).bullets.length);\n      \n      // Should complete in reasonable time\n      expect(queryTime).toBeLessThan(5000); // 5 seconds max\n      \n      // Test curate performance\n      log('Testing curation...');\n      const startCurate = performance.now();\n      \n      await runCLI(['curate', '--dry-run', '--json'], { env });\n      \n      const curateTime = performance.now() - startCurate;\n      log(`Curation completed in ${curateTime.toFixed(2)}ms`);\n      \n      expect(curateTime).toBeLessThan(10000); // 10 seconds max\n    });\n  });\n\n  describe('many diary entries', () =\u003e {\n    it('scans 100 entries quickly', async () =\u003e {\n      // Create 100 diary entries\n      // Test timeline generation\n      // Test reflect performance\n    });\n  });\n\n  describe('concurrent operations', () =\u003e {\n    it('handles 10 parallel context queries', async () =\u003e {\n      const startParallel = performance.now();\n      \n      const queries = Array(10).fill(null).map((_, i) =\u003e\n        runCLI(['context', `query ${i}`, '--json'], { env })\n      );\n      \n      const results = await Promise.all(queries);\n      \n      const parallelTime = performance.now() - startParallel;\n      log(`10 parallel queries in ${parallelTime.toFixed(2)}ms`);\n      log(`Average per query: ${(parallelTime / 10).toFixed(2)}ms`);\n      \n      results.forEach((r, i) =\u003e {\n        expect(r.exitCode).toBe(0);\n        log(`Query ${i}: ${r.duration.toFixed(2)}ms`);\n      });\n    });\n  });\n});\n```\n\n### Metrics Logged:\n- Operation duration (ms)\n- Memory usage (if measurable)\n- File sizes\n- Bullet/entry counts\n- Throughput (ops/sec)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-07T20:31:17.188941-05:00","updated_at":"2025-12-07T20:31:17.188941-05:00","dependencies":[{"issue_id":"cass_memory_system-su8w","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:41.490753-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-su8w","depends_on_id":"cass_memory_system-zc1d","type":"blocks","created_at":"2025-12-07T20:32:41.656733-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-su8w","depends_on_id":"cass_memory_system-ke2x","type":"blocks","created_at":"2025-12-07T20:33:06.221485-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-su9a","title":"Unit tests for validate.ts - Validator pipeline","description":"Complete unit test coverage for validate.ts:\n- validatePlaybook() main entry point\n- Bullet validation against schema\n- Category consistency checks\n- Scope validation (global vs project-specific)\n- Duplicate detection\n- Circular reference detection (if applicable)\n- Validation result structure\n- Error message formatting\nNO MOCKS - use real playbook fixtures with intentional errors","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:25:17.193708-05:00","updated_at":"2025-12-07T21:00:31.321743-05:00","closed_at":"2025-12-07T21:00:11.35417-05:00","dependencies":[{"issue_id":"cass_memory_system-su9a","depends_on_id":"cass_memory_system-ai52","type":"blocks","created_at":"2025-12-07T20:28:09.05098-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-sww","title":"[Validator] extractValidationKeywords - Rule to search terms","description":"Implement the extractValidationKeywords function - Extract search terms from proposed rules for cass search.\n\nSIGNATURE:\n```typescript\nfunction extractValidationKeywords(rule: string): string[]\n```\n\nALGORITHM:\n1. Tokenize the rule text\n2. Remove stop words (the, a, an, is, should, must, etc.)\n3. Extract technical terms (camelCase, PascalCase, kebab-case, snake_case)\n4. Identify technology names (React, TypeScript, PostgreSQL, etc.)\n5. Extract action verbs (validate, sanitize, implement, etc.)\n6. Prioritize domain-specific terms over generic ones\n7. Return 5-10 most relevant keywords\n\nEXAMPLE:\n```typescript\nconst rule = \"Always use TypeScript strict mode and enable noImplicitAny for type safety\";\nconst keywords = extractValidationKeywords(rule);\n// Returns: [\"TypeScript\", \"strict mode\", \"noImplicitAny\", \"type safety\"]\n```\n\nSTOP WORDS TO REMOVE:\n- Generic: the, a, an, is, are, should, must, always, never, etc.\n- Too common: use, when, if, then, for, with, etc.\n\nPRIORITIZE:\n- Technology names (React, Node.js, PostgreSQL)\n- Configuration options (strict mode, noImplicitAny)\n- Technical patterns (dependency injection, event sourcing)\n- Specific actions (sanitize, validate, normalize)\n\nWHY THIS MATTERS:\n- Focuses cass search on relevant historical sessions\n- Avoids noise from overly generic searches\n- Improves precision of evidence gathering\n- Key input to evidenceCountGate()\n\nDEPENDENCIES:\n- None (pure function)\n- Could use NLP library for better extraction (optional)\n\nLOCATION:\n- src/validator/keyword-extraction.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:44:53.996904-05:00","updated_at":"2025-12-08T14:28:28.541344-05:00","closed_at":"2025-12-08T14:28:28.541344-05:00"}
{"id":"cass_memory_system-sxf","title":"[Utils] error - Error logging to stderr","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:45:25.399714-05:00","updated_at":"2025-12-07T20:24:20.359149-05:00","closed_at":"2025-12-07T20:24:03.897956-05:00","comments":[{"id":31,"issue_id":"cass_memory_system-sxf","author":"jemanuel","text":"## Function Signature\n```typescript\nfunction error(message: string): void\n```\n\n## Implementation Details\n- Always output to stderr: console.error('[cass-memory] ERROR:', message)\n- No verbose flag - errors always shown\n- Prefix with ERROR: to distinguish from regular logs\n- Use for recoverable errors (non-fatal)\n\n## Why This Matters\nUsers need to see errors even without verbose mode. Distinguishes errors from info logs. Example: \"Playbook not found, using defaults\" is an error but not fatal.\n\n## Edge Cases to Handle\n- Empty message - still output prefix\n- Multi-line error messages - output as-is\n- Stack traces - caller should format before passing\n- Should NOT throw - just logs to stderr","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-syls","title":"[ErrorHandling] categorizeError - Error type classification","description":"Categorize errors for appropriate handling and user messaging.\n\nType definition:\ntype ErrorCategory = \n  | 'user_input'      // Invalid input from user\n  | 'configuration'   // Config file issues\n  | 'filesystem'      // File/directory issues\n  | 'network'         // API/network failures\n  | 'cass'            // cass-specific errors\n  | 'llm'             // LLM provider errors\n  | 'internal'        // Bugs in cass-memory\n\nFunction signature:\nfunction categorizeError(error: Error): ErrorCategory\n\nImplementation:\n- Check error message and code patterns\n- Match against known error types\n- Return appropriate category\n\nUsed for:\n- Selecting appropriate exit code\n- Formatting user-friendly error messages\n- Determining retry behavior\n- Logging and diagnostics\n\nExamples:\n- ENOENT -\u003e 'filesystem'\n- 'Invalid bullet ID' -\u003e 'user_input'\n- 'API rate limit' -\u003e 'llm'\n- 'cass: command not found' -\u003e 'cass'","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:58.715364-05:00","updated_at":"2025-12-07T22:38:15.494584-05:00","closed_at":"2025-12-07T22:37:26.554708-05:00"}
{"id":"cass_memory_system-t4es","title":"Fix 27 typecheck errors blocking build","description":"","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-07T19:03:29.529896-05:00","updated_at":"2025-12-07T19:26:46.479986-05:00","closed_at":"2025-12-07T19:26:41.135759-05:00"}
{"id":"cass_memory_system-t5t","title":"[Types] Playbook Schema - YAML File Structure","description":"## Overview\nDefine top-level Playbook file schema - the YAML structure that stores the entire playbook with metadata, bullets, and deprecated patterns.\n\n## Purpose\nThe Playbook is the central artifact of the memory system:\n1. Single source of truth for all active rules\n2. Persisted as YAML for human readability and git-friendliness\n3. Includes metadata for tracking playbook health\n4. Implements Gemini tombstone pattern for deprecated rules\n\n## Schema Structure\n\nschema_version: number (required, current value: 2)\nname: string (required, playbook identifier)\ndescription: string | undefined (optional, free-form description)\nmetadata: object (playbook health tracking)\ndeprecatedPatterns: DeprecatedPattern[] (Gemini tombstones)\nbullets: PlaybookBullet[] (actual playbook rules)\n\n## Metadata Object Fields\n\ncreatedAt: string (ISO 8601, immutable)\nlastReflection: string | undefined (ISO 8601, most recent reflection)\ntotalReflections: number (count of reflection runs, default 0)\ntotalSessionsProcessed: number (sessions analyzed, default 0)\n\n## DeprecatedPattern Schema\n\npattern: string (text or regex of deprecated rule)\ndeprecatedAt: string (ISO 8601 timestamp)\nreason: string (why it was deprecated)\nreplacement: string | undefined (optional pointer to replacement rule ID)\n\nPurpose: Prevents re-adding deprecated rules in future reflections\n\n## File Location and Operations\n\nDefault: ~/.cass-memory/playbook.yaml\nConfigurable: config.playbookPath\nGit-friendly: YAML format enables meaningful diffs\nHuman-editable: Can be manually edited with care\n\nOperations:\n- Load: loadPlaybook(config.playbookPath)\n- Save: savePlaybook(playbook, config.playbookPath)\n- Validate: PlaybookSchema.safeParse(playbookData)\n\n## Migration Strategy\n\nDetect old schema_version, run migration function, update version, save\n\n## Playbook Health Metrics\n\nMaturity: totalReflections / totalSessionsProcessed ratio\nStaleness: Days since lastReflection\nCoverage: Active bullets / totalSessionsProcessed ratio\nQuality: Average effectiveScore across active bullets\nChurn: Deprecated bullets / total bullets ratio\n\n## Acceptance Criteria\n- schema_version field (number)\n- name field (string, required)\n- description field (optional)\n- metadata object with all 4 fields\n- deprecatedPatterns array with DeprecatedPattern schema\n- bullets array of PlaybookBullet objects\n- Zod schema validation\n- YAML serialization/deserialization\n- Complete example in docs\n- Migration utilities\n- Load/save functions\n- JSDoc documentation","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:04.038891-05:00","updated_at":"2025-12-07T20:06:29.965656-05:00","closed_at":"2025-12-07T20:05:24.134911-05:00"}
{"id":"cass_memory_system-t87z","title":"[Unit] Commands - mark.ts, playbook.ts, curate.ts","description":"## Target: src/commands/*.ts - CLI Commands (Part 2)\n\n### mark.ts Tests:\n\n1. **markCommand(bulletId, action, options)** - Mark feedback\n   - 'helpful' action adds helpful event\n   - 'harmful' action adds harmful event\n   - Invalid bullet ID → error\n   - --context adds context\n   - --json output\n\n2. **Event array handling**\n   - feedbackEvents array updated\n   - Previous events preserved\n   - Timestamps correct\n\n### playbook.ts Tests:\n\n1. **playbookCommand(options)** - Playbook management\n   - Lists bullets with --list\n   - Shows specific bullet with --show\n   - Adds bullet with --add\n   - Removes bullet with --remove\n   - --json output for all operations\n\n2. **playbookExportCommand(options)** - Export\n   - Exports to markdown\n   - Exports to JSON\n   - Output file parameter\n\n### curate.ts Tests:\n\n1. **curateCommand(options)** - Curation CLI\n   - Runs curation pipeline\n   - --dry-run shows without changing\n   - --auto applies suggestions\n   - --json output structured\n   - Report includes all findings\n\n### Test Patterns:\n- Real temp playbook files\n- Pre-populated test data\n- Verify file changes after commands","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:29:17.874392-05:00","updated_at":"2025-12-08T14:25:16.148356-05:00","closed_at":"2025-12-08T14:25:16.148356-05:00","dependencies":[{"issue_id":"cass_memory_system-t87z","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:20.483078-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-t87z","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:33:02.274651-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-t87z","depends_on_id":"cass_memory_system-5oro","type":"blocks","created_at":"2025-12-07T20:33:18.852654-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-t87z","depends_on_id":"cass_memory_system-0ede","type":"blocks","created_at":"2025-12-07T20:33:18.988009-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-t8iv","title":"[CLI:audit] formatAuditViolations - Human-readable violations","description":"Format audit results for display.\n\nFunction signature:\n```typescript\nfunction formatAuditViolations(\n  result: AuditResult,\n  options: { json?: boolean }\n): string\n```\n\nAuditResult structure:\n```typescript\ninterface AuditResult {\n  violations: AuditViolation[];\n  stats: {\n    sessionsScanned: number;\n    rulesChecked: number;\n    violationsFound: number;\n    bySeverity: { high: number; medium: number; low: number; }\n  };\n  scannedAt: string;\n}\n```\n\nOutput format:\n```\nAUDIT RESULTS (scanned N sessions)\n\nVIOLATIONS FOUND: N\n\nFor each violation, grouped by severity:\n1. [SEVERITY] Rule bulletId: bulletContent\n   Session: sessionPath\n   Timestamp: timestamp\n   Evidence: evidence\n   \nIf no violations:\nNo violations found. All sessions comply with playbook rules.\n\nSUMMARY:\n- Sessions scanned: N\n- Rules checked: N\n- High severity: N\n- Medium severity: N\n- Low severity: N\n```\n\nFormatting rules:\n- Group violations by severity (high to medium to low)\n- Truncate session paths to last 2 components\n- Wrap evidence text at 80 chars\n- Use severity indicators in brackets\n- Color coding if terminal supports it\n\nJSON mode:\n- If --json flag: return JSON.stringify(result, null, 2)\n- Include all fields, no truncation\n\nThis output helps developers quickly identify and fix compliance issues.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:32.423484-05:00","updated_at":"2025-12-07T21:13:03.925362-05:00","closed_at":"2025-12-07T21:12:30.967403-05:00"}
{"id":"cass_memory_system-tf26","title":"[MCP:Future] MCP server initialization","description":"Implement MCP server initialization code:\n\n```typescript\nimport { Server } from \"@modelcontextprotocol/sdk/server/index.js\";\n\nconst server = new Server({\n  name: \"cass-memory\",\n  version: \"1.0.0\"\n}, {\n  capabilities: {\n    tools: {}\n  }\n});\n```\n\nSets up the basic MCP server structure with capabilities for tool support.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:49:28.381282-05:00","updated_at":"2025-12-07T21:49:40.731235-05:00","closed_at":"2025-12-07T21:49:33.665969-05:00"}
{"id":"cass_memory_system-tf5","title":"[Types] Cass Integration Types - Search Options and Results","description":"## Overview\nDefine types for cass search integration - search options, results, and timeline data structures.\n\n## Purpose\nEnable seamless integration with cass session search engine for:\n1. Validation: Find evidence for/against proposed rules\n2. Context: Pull relevant session snippets for pre-task hydration\n3. Provenance: Link rules to originating sessions\n4. Analytics: Timeline views and usage patterns\n\n## CassSearchOptions\n\nConfigure cass search queries with filters and output options.\n\nFields:\n- limit: number | undefined (max results, default 10, range 1-1000)\n- days: number | undefined (lookback window, default 7, range 1-365)\n- agent: string | undefined (filter by agent, e.g., 'claude')\n- workspace: string | undefined (filter by workspace path)\n- fields: string[] | undefined (which fields to return, default all)\n- maxTokens: number | undefined (truncate snippets, range 10-2000)\n- highlight: boolean | undefined (wrap matches in markers, default false)\n- explain: boolean | undefined (include score details, default false)\n- timeout: number | undefined (query timeout ms, default 5000)\n\n## CassHit\n\nSingle search result from cass query.\n\nFields:\n- source_path: string (path to session file)\n- line_number: number (line in session, 1-indexed)\n- agent: string (which agent)\n- workspace: string | undefined (workspace path if available)\n- title: string | undefined (session title/summary)\n- snippet: string (matching text excerpt, ~200 chars)\n- score: number (BM25 relevance score, higher = more relevant)\n- created_at: string (ISO 8601 timestamp)\n\n## CassSearchResult\n\nComplete search response with results and metadata.\n\nStructure:\n- hits: CassHit[] (array of search results)\n- _meta: object | undefined (optional metadata)\n  - elapsed_ms: number (query execution time)\n  - total_hits: number (total matches before limit)\n  - wildcard_fallback: boolean (did query use wildcard)\n  - query_plan: string | undefined (if explain=true)\n\n## CassTimelineGroup\n\nAggregate session data by date for timeline visualization.\n\nStructure:\n- date: string (ISO date YYYY-MM-DD)\n- agents: Record\u003cstring, number\u003e (sessions per agent)\n- total: number (total sessions for date)\n\nUsage: Timeline command, visualize activity, identify patterns\n\n## Integration Examples\n\nBasic Search:\n  cassSearch('JWT validation', { limit: 10, days: 30, workspace: '...' })\n\nEvidence Collection:\n  cassSearch(proposedRule, { limit: 20, days: 90, fields: ['snippet', 'score'] })\n\nTimeline Analysis:\n  cassTimeline({ days: 90 })\n\n## Acceptance Criteria\n- CassSearchOptions interface with all optional fields\n- CassHit interface with required/optional fields\n- CassSearchResult interface with hits and metadata\n- CassTimelineGroup interface for timeline data\n- Zod schemas for runtime validation\n- TypeScript type exports\n- Example usage for each type\n- JSDoc documentation\n- Integration with cass CLI wrapper functions","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:04.976704-05:00","updated_at":"2025-12-07T21:48:01.82363-05:00","closed_at":"2025-12-07T21:47:41.806727-05:00"}
{"id":"cass_memory_system-tkb2","title":"[E2E Tests] Confidence decay over time - scoring accuracy","description":"## E2E Test: Confidence Decay Over Time - Scoring Accuracy\n\n### Test Scenario\nTest that bullet confidence decays over time as expected\n\n### Test Steps\n\n#### 1. No Decay at Creation\n- Create bullet with confidence 0.9\n- Immediately read effective confidence\n- Verify effective = base confidence\n\n#### 2. Decay After Half-Life\n- Create bullet dated 30 days ago\n- Default half-life = 30 days\n- Verify effective confidence ~ 0.45 (half)\n\n#### 3. Decay After Multiple Half-Lives\n- Bullet dated 60 days ago (2 half-lives)\n- Verify effective ~ 0.225 (quarter)\n- Bullet dated 90 days ago (3 half-lives)\n- Verify effective ~ 0.1125 (eighth)\n\n#### 4. Decay Floor\n- Very old bullet (1 year)\n- Verify doesn't decay below floor (e.g., 0.01)\n- Floor prevents total obsolescence\n\n#### 5. Custom Half-Life\n- Config: decay_half_life_days=7\n- Bullet dated 7 days ago\n- Verify effective = base * 0.5\n\n#### 6. Decay Disabled\n- Config: decay_enabled=false\n- Old bullet\n- Verify effective = base (no decay)\n\n#### 7. Context Generation Impact\n- Multiple bullets with different ages\n- Generate context\n- Verify newer bullets ranked higher\n- Verify old bullets still included if relevant\n\n### Verbose Logging\n- Log: 'Calculating effective confidence for bullet: \u003cid\u003e'\n- Log: 'Base confidence: X'\n- Log: 'Age: Y days'\n- Log: 'Half-life: Z days'\n- Log: 'Decay factor: W'\n- Log: 'Effective confidence: X * W = V'\n\n### Precision Testing\n- Use fixed timestamps (not Date.now())\n- Compare with epsilon for floating point\n- Test at exact half-life boundaries","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:24:58.208656-05:00","updated_at":"2025-12-08T01:16:55.790356-05:00","closed_at":"2025-12-08T01:16:55.790356-05:00","dependencies":[{"issue_id":"cass_memory_system-tkb2","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2025-12-07T20:31:27.102458-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-tkb2","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2025-12-07T20:31:27.222799-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-tkb2","depends_on_id":"cass_memory_system-z8y7","type":"blocks","created_at":"2025-12-07T20:31:29.047655-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-tmcq","title":"Unit tests for diary.ts - Diary extraction and parsing","description":"Complete unit test coverage for diary.ts:\n- extractDiary() from session exports\n- DiaryEntry parsing and validation\n- Context extraction from agent conversations\n- Delta extraction from diary entries\n- Multi-agent session handling\n- Edge cases: empty sessions, malformed entries, very long entries\n- Timestamp handling and ordering\nNO MOCKS - use real session export fixtures","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:25:40.015302-05:00","updated_at":"2025-12-07T22:00:02.830381-05:00","closed_at":"2025-12-07T22:00:02.830381-05:00","dependencies":[{"issue_id":"cass_memory_system-tmcq","depends_on_id":"cass_memory_system-ai52","type":"blocks","created_at":"2025-12-07T20:28:09.282435-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-tp7","title":"[Diary] exportSessionSafe - Session export with validation","description":"Safely export session content with validation and fallback to raw file reading.\n\nFunction Signature:\nasync function exportSessionSafe(\n  sessionPath: string,\n  cassPath: string\n): Promise\u003c{ content: string | null; error?: string }\u003e\n\nProcess:\n1. Validate sessionPath exists on filesystem\n2. Check file size (reject if \u003e50MB to prevent memory issues)\n3. Try primary method: cass export sessionPath\n4. If cass export fails, try fallback: raw file read\n5. For raw read, use formatRawSession based on extension\n6. Return { content } on success or { content: null, error } on failure\n\nValidation Steps:\n- File exists check (fs.existsSync)\n- File size check (fs.statSync - reject \u003e50MB)\n- File readable check (fs.accessSync)\n\nPrimary Method (cass export):\n- Execute: cass export \u003csessionPath\u003e\n- Captures formatted session content\n- Handles all cass-supported formats\n- Includes sanitization automatically\n\nFallback Method (raw read):\n- Read file directly with fs.readFileSync\n- Detect extension (.jsonl, .json, .md)\n- Pass to formatRawSession for parsing\n- Manual sanitization required\n\nError Cases:\n- File not found: { content: null, error: 'File not found' }\n- File too large: { content: null, error: 'File exceeds 50MB limit' }\n- Cass failed + raw failed: { content: null, error: 'Both export methods failed' }\n- Read permission denied: { content: null, error: 'Permission denied' }\n\nKey Features:\n- Graceful degradation (cass → raw)\n- Size limit prevents memory exhaustion\n- Detailed error messages\n- Never throws exceptions\n\nOutput:\nReturns object with content string or error message.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:47:15.958626-05:00","updated_at":"2025-12-07T20:11:39.811829-05:00","closed_at":"2025-12-07T20:11:15.870223-05:00"}
{"id":"cass_memory_system-tq21","title":"[MCP:Future] memory_search tool definition","description":"Define memory_search tool for MCP:\n\n```typescript\n{\n  name: \"memory_search\",\n  description: \"Search playbook and cass history\",\n  inputSchema: {\n    type: \"object\",\n    properties: {\n      query: { type: \"string\" },\n      scope: { enum: [\"playbook\", \"cass\", \"both\"] },\n      limit: { type: \"number\", default: 10 }\n    },\n    required: [\"query\"]\n  }\n}\n```\n\nEnables agents to search through the memory system for specific information.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:49:31.352618-05:00","updated_at":"2025-12-07T22:05:34.91466-05:00","closed_at":"2025-12-07T22:05:34.91466-05:00"}
{"id":"cass_memory_system-tr8y","title":"[CLI:doctor] runSelfTest - End-to-end smoke test","description":"Implements the runSelfTest function that performs end-to-end smoke tests of core functionality.\n\nFUNCTION SIGNATURE:\n```typescript\nasync function runSelfTest(config: Config): Promise\u003cHealthCheck[]\u003e\n```\n\nTESTS PERFORMED:\n\n1. PLAYBOOK LOAD PERFORMANCE:\n   - Load playbook from disk\n   - Measure load time\n   - Parse and validate structure\n   - Warn if \u003e500ms (performance issue)\n   - Report: \"Playbook load: 45ms (156 bullets)\"\n\n2. CASS SEARCH LATENCY:\n   - Execute sample cass query\n   - Measure end-to-end latency\n   - Warn if \u003e2 seconds\n   - Fail if \u003e5 seconds or error\n   - Report: \"Cass search: 120ms\"\n\n3. SANITIZATION PATTERN BREADTH:\n   - Load sanitization patterns\n   - Count patterns by category\n   - Verify all required categories present\n   - Warn if \u003c10 patterns total\n   - Report: \"Sanitization: 23 patterns loaded\"\n\n4. CONFIG VALIDATION:\n   - Validate all config values\n   - Check for deprecated options\n   - Verify paths are absolute\n   - Check for common misconfigurations\n   - Report: \"Config valid\"\n\n5. EMBEDDING SYSTEM:\n   - Check if embeddings enabled\n   - Test embedding generation for sample text\n   - Measure latency\n   - Report status\n   - Report: \"Embeddings: enabled (OpenAI ada-002)\"\n\nIMPLEMENTATION DETAILS:\n\nPlaybook Load Test:\n```typescript\nconst start = Date.now();\nconst playbook = await loadPlaybook(config.playbookPath);\nconst loadTime = Date.now() - start;\n\nif (loadTime \u003e 500) {\n  return [{\n    category: 'Self-Test',\n    item: 'Playbook Load',\n    status: 'warn',\n    message: `Slow: ${loadTime}ms (consider optimization)`,\n  }];\n} else {\n  return [{\n    category: 'Self-Test',\n    item: 'Playbook Load',\n    status: 'pass',\n    message: `${loadTime}ms (${playbook.bullets.length} bullets)`,\n  }];\n}\n```\n\nCass Search Test:\n```typescript\nconst start = Date.now();\ntry {\n  const result = await exec('cass search \"test query\" --limit 5');\n  const searchTime = Date.now() - start;\n  \n  if (searchTime \u003e 5000) {\n    return [{ status: 'fail', message: 'Very slow: ${searchTime}ms' }];\n  } else if (searchTime \u003e 2000) {\n    return [{ status: 'warn', message: 'Slow: ${searchTime}ms' }];\n  } else {\n    return [{ status: 'pass', message: '${searchTime}ms' }];\n  }\n} catch (err) {\n  return [{ status: 'fail', message: 'Search failed: ${err.message}' }];\n}\n```\n\nSanitization Check:\n- Load patterns from config/patterns directory\n- Count by category (secrets, pii, sensitive_data)\n- Verify minimum coverage\n- Report total count\n\nConfig Validation:\n- Check all paths are absolute (not relative)\n- Verify no deprecated options\n- Check LLM model names are valid\n- Validate threshold values in range\n\nERROR HANDLING:\n- Graceful degradation if test fails\n- Report specific error details\n- Don't fail overall doctor run\n- Suggest fixes where applicable\n\nDEPENDENCIES:\n- Playbook loader\n- Cass CLI wrapper\n- Sanitization system\n- Config system\n- Performance measurement utilities\n\nSUCCESS CRITERIA:\n- Tests complete in \u003c3 seconds total\n- Accurate performance measurements\n- Detects common issues (slow loads, bad configs)\n- Clear actionable feedback\n- No side effects from tests","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:56:06.592133-05:00","updated_at":"2025-12-07T22:43:05.793741-05:00","closed_at":"2025-12-07T22:42:47.635157-05:00"}
{"id":"cass_memory_system-tv3j","title":"[MCP:Future] memory_mark tool definition","description":"Define memory_mark tool for MCP:\n\n```typescript\n{\n  name: \"memory_mark\",\n  description: \"Mark a playbook bullet as helpful or harmful\",\n  inputSchema: {\n    type: \"object\",\n    properties: {\n      bulletId: { type: \"string\" },\n      helpful: { type: \"boolean\" },\n      reason: { type: \"string\" }\n    },\n    required: [\"bulletId\", \"helpful\"]\n  }\n}\n```\n\nAllows agents to provide feedback on playbook bullets for reinforcement learning.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:49:30.268429-05:00","updated_at":"2025-12-07T21:50:28.995162-05:00","closed_at":"2025-12-07T21:50:26.627257-05:00"}
{"id":"cass_memory_system-two0","title":"[Unit] utils.ts - Pure Function Tests (Part 2: String \u0026 Hash Utilities)","description":"## Target: src/utils.ts - Part 2: String \u0026 Hash Utilities\n\n### Functions to Test:\n1. **slugify(text)** - Convert text to URL-safe slug\n   - Basic conversion: 'Hello World' → 'hello-world'\n   - Special chars: 'Test@#$%' → 'test'\n   - Unicode handling: 'Café Müller' → appropriate slug\n   - Empty string → empty or throws\n   - Whitespace normalization: '  multiple   spaces  ' → 'multiple-spaces'\n\n2. **hashContent(content)** - Generate deterministic hash\n   - Same input → same hash (deterministic)\n   - Different inputs → different hashes\n   - Empty string handling\n   - Large content (10KB+) performance\n   - Unicode content hashing\n\n3. **truncate(str, maxLen, suffix)** - Truncate with suffix\n   - String shorter than max → unchanged\n   - String at max → unchanged\n   - String longer → truncated with suffix\n   - Custom suffix: '...' vs '…' vs ''\n   - Edge: maxLen \u003c suffix length\n   - Unicode safety (don't break mid-character)\n\n4. **formatBytes(bytes)** - Human-readable byte sizes\n   - 0 → '0 B'\n   - 1023 → '1023 B'\n   - 1024 → '1 KB'\n   - 1048576 → '1 MB'\n   - Decimal precision handling\n   - Negative numbers (error case)\n\n5. **formatDuration(ms)** - Human-readable durations\n   - 0 → '0ms' or '0s'\n   - 999 → '999ms'\n   - 1000 → '1s'\n   - 60000 → '1m'\n   - 3600000 → '1h'\n   - Combined: 3661000 → '1h 1m 1s'\n\n### Test Patterns:\n- Property-based: hash(x) always same length\n- Boundary testing: exactly at thresholds\n- Round-trip where applicable\n- No mocks - pure functions only","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:24:25.392783-05:00","updated_at":"2025-12-07T20:54:04.252433-05:00","closed_at":"2025-12-07T20:53:52.410496-05:00","dependencies":[{"issue_id":"cass_memory_system-two0","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:13.783245-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-two0","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:32:56.485698-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-u3nh","title":"Integration test: Config + Scoring interaction","description":"Integration test for Config + Scoring:\n- Config loading from file\n- Scoring with config-driven parameters\n- Decay calculation with configurable half-life\n- Score thresholds from config\n- Verify config merging with defaults\n- Detailed logging: config source, merged values, scoring decisions\nNO MOCKS - real config.ts + scoring.ts interaction","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:26:31.093568-05:00","updated_at":"2025-12-07T21:55:59.828648-05:00","closed_at":"2025-12-07T21:55:59.828648-05:00","dependencies":[{"issue_id":"cass_memory_system-u3nh","depends_on_id":"cass_memory_system-xgvn","type":"blocks","created_at":"2025-12-07T20:28:25.834552-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-u3nh","depends_on_id":"cass_memory_system-mz34","type":"blocks","created_at":"2025-12-07T20:28:25.999304-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-u64s","title":"[Test] Epic: Unit Tests - Pure Function Testing","description":"# Unit Test Epic\n\n## Philosophy\nTest individual functions in ISOLATION but with REAL implementations.\n- NO mocks for internal dependencies\n- NO mocks for file I/O (use temp dirs)\n- NO mocks for YAML parsing\n- ONLY mock external LLM APIs when absolutely necessary\n\n## Modules to Test (Priority Order)\n\n### P0 - Core Logic (Must Have)\n1. scoring.ts - Decay algorithms, maturity state machine\n2. playbook.ts - CRUD operations, bullet management\n3. config.ts - Config loading, merging, validation\n4. types.ts - Schema validation, edge cases\n\n### P1 - Pipeline Components\n5. curate.ts - Delta application, deduplication (partial exists)\n6. reflect.ts - Multi-iteration reflection helpers\n7. validate.ts - Evidence gate, validation normalization\n8. diary.ts - Diary generation, field extraction\n\n### P2 - Utilities\n9. utils.ts - All utility functions\n10. security.ts - Sanitization (exists, expand)\n11. tracking.ts - Session tracking\n12. lock.ts - File locking\n13. cass.ts - Cass binary integration (integration tests better)\n\n## Test Structure\nEach module test file should:\n- Import only the module under test\n- Use factory helpers for test data\n- Test happy path + edge cases + error cases\n- Achieve \u003e90% line coverage for that module\n\n## Naming Convention\ntest/{module}.test.ts - Unit tests for src/{module}.ts\ntest/{module}.integration.test.ts - Integration tests\n\n## Acceptance Criteria\n- [ ] All exported functions have tests\n- [ ] Edge cases documented and tested\n- [ ] No external network calls\n- [ ] Tests are deterministic\n- [ ] Each test file runs in \u003c5 seconds","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-07T20:22:58.167624-05:00","updated_at":"2025-12-08T00:17:18.264275-05:00","closed_at":"2025-12-08T00:16:39.73942-05:00","dependencies":[{"issue_id":"cass_memory_system-u64s","depends_on_id":"cass_memory_system-ai52","type":"blocks","created_at":"2025-12-07T20:27:57.033746-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-u9jw","title":"[ErrorHandling] handleCassUnavailable - Graceful degradation","description":"Implement graceful degradation when cass CLI is unavailable.\n\nFunction signature:\nasync function handleCassUnavailable(): Promise\u003c{ \n  canContinue: boolean;\n  fallbackMode: 'playbook-only' | 'none';\n  message: string \n}\u003e\n\nImplementation:\n- Try common installation paths (/usr/local/bin/cass, ~/.cargo/bin/cass, ~/.local/bin/cass)\n- If found, suggest setting CASS_PATH environment variable\n- If not found, enable playbook-only mode (no session ingestion, only playbook operations)\n- Log clear instructions for installation (cargo install cass or download from releases)\n- Return appropriate fallback mode and user-friendly message\n\nThis ensures the tool can still function for playbook management even without cass installed.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:50:46.81224-05:00","updated_at":"2025-12-07T22:34:43.095803-05:00","closed_at":"2025-12-07T22:34:36.831411-05:00"}
{"id":"cass_memory_system-uf2z","title":"[MCP:Future] stats resource definition","description":"Define stats resource for MCP:\n\n```typescript\n{\n  uri: \"memory://stats\",\n  name: \"Playbook Stats\",\n  description: \"Playbook health metrics\",\n  mimeType: \"application/json\"\n}\n```\n\nReturns PlaybookStats as a resource for monitoring playbook health.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:49:35.063416-05:00","updated_at":"2025-12-07T22:23:32.920837-05:00","closed_at":"2025-12-07T22:23:32.920837-05:00"}
{"id":"cass_memory_system-uj8","title":"[Validator] evidenceCountGate - Pre-LLM evidence filter","description":"Implement the evidenceCountGate function - Pre-LLM evidence filter that uses simple counts from cass hits + diary status correlation.\n\nCOMPLETE IMPLEMENTATION:\n```typescript\n/**\n * Pre-LLM filter: check if there's enough evidence to even consider this rule.\n * Uses simple counts from cass hits + diary status correlation.\n */\nasync function evidenceCountGate(\n  content: string,\n  config: Config\n): Promise\u003cEvidenceGateResult\u003e {\n  const keywords = extractKeywords(content);\n  const hits = await cassSearch(keywords.join(\" \"), { limit: 20, days: 90 });\n\n  if (hits.length === 0) {\n    return {\n      passed: true,  // No evidence either way - allow as draft\n      reason: \"No historical evidence found, proposing as draft\",\n      suggestedState: \"draft\",\n      sessionCount: 0, successCount: 0, failureCount: 0\n    };\n  }\n\n  // Group by unique session\n  const sessions = new Set(hits.map(h =\u003e h.source_path));\n\n  // Correlate with diaries to get success/failure counts\n  let successCount = 0;\n  let failureCount = 0;\n\n  for (const sessionPath of sessions) {\n    const diary = await findDiaryBySession(sessionPath);\n    if (diary) {\n      if (diary.status === \"success\") successCount++;\n      else if (diary.status === \"failure\") failureCount++;\n    }\n  }\n\n  const sessionCount = sessions.size;\n\n  // Gate 1: Single session - too early to generalize\n  if (sessionCount === 1) {\n    return {\n      passed: true,\n      reason: \"Single session only - proposing as draft for further validation\",\n      suggestedState: \"draft\",\n      sessionCount, successCount, failureCount\n    };\n  }\n\n  // Gate 2: More failures than successes - REJECT\n  if (failureCount \u003e successCount \u0026\u0026 failureCount \u003e= 2) {\n    return {\n      passed: false,\n      reason: `Pattern appears in ${failureCount} failed sessions vs ${successCount} successful - rejecting`,\n      suggestedState: \"draft\",\n      sessionCount, successCount, failureCount\n    };\n  }\n\n  // Gate 3: Strong evidence - allow as active candidate\n  if (successCount \u003e= 3 \u0026\u0026 failureCount === 0) {\n    return {\n      passed: true,\n      reason: `Strong evidence: ${successCount} successful sessions, 0 failures`,\n      suggestedState: \"active\",\n      sessionCount, successCount, failureCount\n    };\n  }\n\n  // Default: pass to LLM, suggest draft\n  return {\n    passed: true,\n    reason: `Mixed evidence: ${sessionCount} sessions (${successCount} success, ${failureCount} failure)`,\n    suggestedState: \"draft\",\n    sessionCount, successCount, failureCount\n  };\n}\n```\n\nWHY THIS MATTERS:\n- Saves LLM cost by filtering out obviously bad rules\n- Improves quality by rejecting patterns from failed sessions\n- Fast heuristic-based validation before expensive LLM call\n- Scientific validation: rules must be supported by historical evidence\n\nVALIDATION GATES:\n1. Single session → draft (too early to generalize)\n2. More failures than successes → REJECT\n3. 3+ successes, 0 failures → active candidate\n4. Mixed evidence → pass to LLM as draft\n\nDEPENDENCIES:\n- extractKeywords() - Extract search terms from rule\n- cassSearch() - Search historical sessions\n- findDiaryBySession() - Get success/failure status\n\nLOCATION:\n- src/validator/evidence-gate.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:44:51.519581-05:00","updated_at":"2025-12-07T20:53:50.976175-05:00","closed_at":"2025-12-07T20:53:11.224354-05:00"}
{"id":"cass_memory_system-ukif","title":"Unit tests for types.ts - Schema validation \u0026 type guards","description":"Complete unit test coverage for types.ts:\n- All Zod schema validations (PlaybookBulletSchema, DeltaSchema, DiaryEntrySchema, etc.)\n- Type guard functions (isBulletScope, isValidCategory)\n- Schema edge cases (missing fields, invalid values, type coercion)\n- PlaybookBulletBaseSchema vs PlaybookBulletSchema behavior\n- NewBulletDataSchema partial validation\n- ScoredBulletSchema extended fields\n- FeedbackEventSchema with various event types\n- Test that superRefine scope validation works correctly\nNO MOCKS - use real schema parsing","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:25:12.674939-05:00","updated_at":"2025-12-08T14:14:26.684165-05:00","closed_at":"2025-12-08T14:14:26.684165-05:00","dependencies":[{"issue_id":"cass_memory_system-ukif","depends_on_id":"cass_memory_system-ai52","type":"blocks","created_at":"2025-12-07T20:28:07.878431-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-umj0","title":"[Test] Helpers: Playbook and bullet factories","description":"Create test/helpers/factories.ts with:\n\n## Functions\n\n### createTestBullet(overrides?: Partial\u003cPlaybookBullet\u003e): PlaybookBullet\n- Returns valid bullet with sensible defaults\n- Generates unique ID if not provided\n- Sets timestamps to now()\n- Merges overrides\n\n### createTestPlaybook(options?: { bulletCount?: number; withDeprecated?: boolean }): Playbook\n- Returns valid playbook with configurable bullets\n- Uses createTestBullet internally\n- Generates metadata timestamps\n\n### createTestDiary(overrides?: Partial\u003cDiaryEntry\u003e): DiaryEntry\n- Returns valid diary with realistic content\n- Sets session path to temp path\n- Generates unique ID\n\n### createTestConfig(overrides?: Partial\u003cConfig\u003e): Config\n- Returns valid config with defaults\n- No LLM API keys (tests shouldn't call LLM)\n- Uses temp paths for playbook/diary\n\n### createFeedbackEvent(type: \"helpful\" | \"harmful\", daysAgo?: number): FeedbackEvent\n- Creates feedback event with timestamp\n- daysAgo parameter for testing decay\n\n## Design Principles\n- All factories return VALID objects (pass schema validation)\n- No external dependencies\n- Deterministic (same input = same output, except timestamps)\n- Composable (use factories in other factories)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:22:43.345267-05:00","updated_at":"2025-12-07T21:13:03.928607-05:00","closed_at":"2025-12-07T21:12:33.844965-05:00"}
{"id":"cass_memory_system-une","title":"[Validator] validateDeltas - Batch validate multiple deltas","description":"Implement the validateDeltas function - Batch validation for multiple playbook deltas.\n\nSIGNATURE:\n```typescript\nasync function validateDeltas(\n  deltas: PlaybookDelta[],\n  config: Config\n): Promise\u003cArray\u003c{ delta: PlaybookDelta; result: ValidationResult }\u003e\u003e\n```\n\nBATCH VALIDATION FLOW:\n1. Filter deltas to only \"add\" type (others pass through)\n2. For each delta requiring validation:\n   - Run validateDelta(delta, config)\n   - Collect result\n3. Return array of delta + result pairs\n\nRETURN TYPE:\n```typescript\nArray\u003c{\n  delta: PlaybookDelta;\n  result: {\n    valid: boolean;\n    reason: string;\n    evidence: string[];\n    suggestedState: \"draft\" | \"active\";\n  };\n}\u003e\n```\n\nPARALLELIZATION OPTIONS:\nSequential (default):\n```typescript\nconst results = [];\nfor (const delta of deltas) {\n  if (delta.type === \"add\") {\n    const result = await validateDelta(delta, config);\n    results.push({ delta, result });\n  }\n}\n```\n\nParallel (optional optimization):\n```typescript\nconst validationPromises = deltas\n  .filter(d =\u003e d.type === \"add\")\n  .map(delta =\u003e validateDelta(delta, config).then(result =\u003e ({ delta, result })));\nconst results = await Promise.all(validationPromises);\n```\n\nFILTERING LOGIC:\n- Only validate deltas with type === \"add\"\n- \"remove\" deltas pass through (valid: true)\n- \"edit\" deltas could be validated (future enhancement)\n- Non-add deltas get default result: { valid: true, reason: \"No validation required\" }\n\nERROR HANDLING:\n- If one validation fails, continue with others\n- Collect errors in result.reason\n- Don't fail entire batch for single validation error\n\nWHY THIS MATTERS:\n- Enables bulk rule processing from `cm learn`\n- Supports batch imports from other sources\n- Can parallelize for performance (if LLM API supports it)\n- Provides consistent interface for single + batch operations\n\nUSE CASES:\n- `cm learn` generating multiple rules from one session\n- Importing rules from external playbooks\n- Re-validating existing rules against new evidence\n- Bulk operations on rule sets\n\nDEPENDENCIES:\n- validateDelta() - Single delta validation\n- PlaybookDelta type\n- Config type\n\nLOCATION:\n- src/validator/batch-validate.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:44:57.802201-05:00","updated_at":"2025-12-08T14:28:28.546867-05:00","closed_at":"2025-12-08T14:28:28.546867-05:00"}
{"id":"cass_memory_system-unhc","title":"[CLI] top command - Most effective bullets","description":"Implements the 'cass-memory top' command to show the most effective bullets.\n\nCOMMAND SYNTAX:\n```bash\ncass-memory top [N] [options]\n\nArguments:\n  N              Number of bullets to show (default: 10)\n\nOptions:\n  --scope SCOPE  Filter by scope (global, workspace, all)\n  --category CAT Filter by category\n  --json         Output as JSON\n```\n\nPURPOSE:\nQuick command to see which bullets are most effective based on current scores with decay applied. Useful for understanding what rules are working well.\n\nOUTPUT FORMAT (Terminal):\n```\nTOP 10 MOST EFFECTIVE BULLETS\n==============================\n\n1. [Score: 12.4] Use React.memo for expensive renders\n   Category: Performance | Scope: global | Maturity: proven\n   Feedback: 8× helpful, 0× harmful\n   Last used: 2 days ago\n\n2. [Score: 11.8] Run migrations in transaction\n   Category: Database | Scope: global | Maturity: proven\n   Feedback: 7× helpful, 0× harmful\n   Last used: 5 days ago\n\n3. [Score: 10.2] Validate input at API boundary\n   Category: Security | Scope: workspace | Maturity: established\n   Feedback: 5× helpful, 1× harmful\n   Last used: 1 day ago\n\n...\n```\n\nIMPLEMENTATION REQUIREMENTS:\n\n1. Load playbook from storage\n2. Calculate effective score for each bullet (with decay)\n3. Filter by scope/category if specified\n4. Sort by effective score descending\n5. Take top N bullets (default 10)\n6. Format and display\n\nSCORE CALCULATION:\n- Use effective score with time decay\n- Formula: base_score * decay_factor\n- Decay based on days since last feedback\n- See score calculation utilities\n\nDISPLAYED INFORMATION:\n- Rank and score\n- Bullet content (truncated to fit)\n- Category and scope\n- Maturity level\n- Feedback counts (helpful vs harmful)\n- Last used timestamp\n\nFILTERS:\n- --scope: global, workspace, or all\n- --category: filter to specific category\n- Can combine filters\n\nJSON OUTPUT:\n```json\n{\n  \"timestamp\": \"2025-01-15T10:30:00Z\",\n  \"count\": 10,\n  \"bullets\": [\n    {\n      \"rank\": 1,\n      \"id\": \"abc-123\",\n      \"score\": 12.4,\n      \"content\": \"Use React.memo for expensive renders\",\n      \"category\": \"Performance\",\n      \"scope\": \"global\",\n      \"maturity\": \"proven\",\n      \"feedback\": { \"helpful\": 8, \"harmful\": 0 },\n      \"lastUsed\": \"2025-01-13T08:00:00Z\"\n    },\n    ...\n  ]\n}\n```\n\nEDGE CASES:\n- Empty playbook → show message\n- N \u003e bullet count → show all\n- All bullets negative scores → still show top N\n- Ties in score → sort by ID or last used\n\nDEPENDENCIES:\n- Playbook loader\n- Score calculation utilities\n- Date formatting\n- Terminal formatting (chalk, table)\n\nSUCCESS CRITERIA:\n- Shows most effective bullets accurately\n- Scores reflect current state with decay\n- Filters work correctly\n- Output is readable and informative\n- Performance \u003c500ms for 1000+ bullets","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:56:52.057091-05:00","updated_at":"2025-12-08T13:28:38.156941-05:00","closed_at":"2025-12-08T13:28:38.156941-05:00"}
{"id":"cass_memory_system-usqd","title":"[E2E Tests] CLI mark command - feedback recording","description":"## E2E Test: CLI mark Command - Feedback Recording\n\n### Test Scenario\nTest `cm mark` records user feedback on bullets\n\n### Test Steps\n\n#### 1. Mark Positive Feedback\n- Initialize project with playbook containing bullets\n- Run `cm mark --helpful \"bullet content snippet\"`\n- Verify bullet confidence increased\n- Verify feedback event logged\n\n#### 2. Mark Negative Feedback\n- Run `cm mark --unhelpful \"bullet content\"`\n- Verify bullet confidence decreased\n- Verify feedback event logged\n\n#### 3. Mark with Session Context\n- Run `cm mark --helpful --session /path/to/session \"bullet\"`\n- Verify session path recorded in event\n- Verify helps future correlation\n\n#### 4. Mark Non-existent Bullet\n- Run `cm mark --helpful \"non existent bullet\"`\n- Verify graceful error message\n- Suggest similar bullets if available\n\n#### 5. Fuzzy Matching\n- Test partial content matching\n- Test case-insensitive matching\n- Verify correct bullet identified\n\n### Verbose Logging\n- Log: 'Recording feedback for bullet: \u003csnippet\u003e'\n- Log: 'Searching playbook for matching bullet...'\n- Log: 'Found matching bullet with confidence: X'\n- Log: 'Applying feedback: +/- Y confidence'\n- Log: 'New confidence: Z'\n- Log: 'Feedback recorded successfully'\n\n### Feedback Persistence\n- Verify feedback survives restart\n- Verify feedback affects future context","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:24:38.119372-05:00","updated_at":"2025-12-08T01:20:05.46877-05:00","closed_at":"2025-12-08T01:20:05.46877-05:00","dependencies":[{"issue_id":"cass_memory_system-usqd","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2025-12-07T20:31:25.346463-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-usqd","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2025-12-07T20:31:25.498852-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-usqd","depends_on_id":"cass_memory_system-33w3","type":"blocks","created_at":"2025-12-07T20:31:29.888053-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-usqd","depends_on_id":"cass_memory_system-ix2t","type":"blocks","created_at":"2025-12-07T20:31:30.050176-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-uufj","title":"[Test Infrastructure] Helpers, Fixtures \u0026 Logging Framework","description":"## Target: Shared test infrastructure for all test suites\n\n### Helper Modules to Create:\n\n1. **test/helpers/temp-env.ts** - Temporary environment management\n   ```typescript\n   export async function createIsolatedEnvironment(): Promise\u003cTestEnv\u003e\n   export async function cleanupEnvironment(env: TestEnv): Promise\u003cvoid\u003e\n   export async function withTempCassHome\u003cT\u003e(fn: (home: string) =\u003e Promise\u003cT\u003e): Promise\u003cT\u003e\n   ```\n\n2. **test/helpers/cli-runner.ts** - CLI execution helpers\n   ```typescript\n   export interface CLIResult {\n     exitCode: number;\n     stdout: string;\n     stderr: string;\n     duration: number;\n   }\n   export async function runCLI(args: string[], options?: RunOptions): Promise\u003cCLIResult\u003e\n   ```\n\n3. **test/helpers/logging.ts** - Detailed test logging\n   ```typescript\n   export function log(message: string, ...data: unknown[]): void\n   export function logStep(step: string): void\n   export function logTiming(operation: string, durationMs: number): void\n   export function logFileState(path: string): void\n   export function summarize(): TestSummary\n   ```\n\n4. **test/helpers/fixtures.ts** - Test data generators\n   ```typescript\n   export function generateBullet(overrides?: Partial\u003cPlaybookBullet\u003e): PlaybookBullet\n   export function generatePlaybook(bulletCount: number): Playbook\n   export function generateDiaryEntry(date?: Date): DiaryEntry\n   export function generateFeedbackEvent(type: 'helpful' | 'harmful'): FeedbackEvent\n   ```\n\n5. **test/helpers/git.ts** - Git repository helpers\n   ```typescript\n   export async function createTempGitRepo(): Promise\u003cstring\u003e\n   export async function cloneRepo(source: string): Promise\u003cstring\u003e\n   export async function commitAll(repoPath: string, message: string): Promise\u003cvoid\u003e\n   ```\n\n6. **test/helpers/assertions.ts** - Custom assertions\n   ```typescript\n   export function expectValidPlaybook(playbook: unknown): asserts playbook is Playbook\n   export function expectValidBullet(bullet: unknown): asserts bullet is PlaybookBullet\n   export function expectFileContains(path: string, content: string): Promise\u003cvoid\u003e\n   ```\n\n### Logging Output Format:\n```\n[2024-01-15T10:30:45.123Z] [STEP] Starting: Initialize environment\n[2024-01-15T10:30:45.456Z] [INFO] Created temp dir: /tmp/cass-test-abc123\n[2024-01-15T10:30:45.789Z] [CLI] Running: cm init --json\n[2024-01-15T10:30:46.012Z] [CLI] Exit: 0 (223ms)\n[2024-01-15T10:30:46.012Z] [CLI] Stdout: {\"success\":true,...}\n[2024-01-15T10:30:46.012Z] [FILE] ~/.cass-memory/config.json: 234 bytes\n[2024-01-15T10:30:46.123Z] [PASS] Step completed successfully\n```\n\n### Configuration:\n- LOG_LEVEL env var (debug, info, warn, error)\n- LOG_FILE env var (optional file output)\n- KEEP_TEMP env var (don't cleanup for debugging)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:31:37.249094-05:00","updated_at":"2025-12-07T20:44:14.854078-05:00","closed_at":"2025-12-07T20:42:52.573522-05:00"}
{"id":"cass_memory_system-v319","title":"[ErrorHandling] handlePermissionError - File access issues","description":"Provide helpful error messages for permission-related failures.\n\nFunction signature:\nfunction handlePermissionError(error: Error, path: string): never\n\nImplementation:\n- Detect EACCES and EPERM errors\n- Get file/directory permissions using fs.stat\n- Provide helpful message including:\n  * Which file/directory failed\n  * Current permissions (in readable format)\n  * Suggested fix command (chmod/chown)\n  * Example: 'chmod 644 /path/to/file' or 'sudo chown user /path'\n- Throw enhanced error with actionable guidance\n\nCommon scenarios:\n- Cannot read session files\n- Cannot write to playbook\n- Cannot create directories\n\nHelps users quickly resolve permission issues.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:26.616724-05:00","updated_at":"2025-12-07T22:34:15.778554-05:00","closed_at":"2025-12-07T22:33:56.769211-05:00"}
{"id":"cass_memory_system-v4j0","title":"[ErrorHandling] AbortController integration - Cancellable operations","description":"Implement operation cancellation via AbortController pattern.\n\nImplementation:\nlet shouldAbort = false;\n\nfunction checkAbort(): void {\n  if (shouldAbort) throw new AbortError('Operation cancelled');\n}\n\nUsage:\n- Set shouldAbort = true in SIGINT handler\n- Call checkAbort() periodically in long-running operations:\n  * Before each LLM API call\n  * Between session file reads\n  * During batch operations\n  * In loops processing multiple items\n\nBenefits:\n- Allows clean exit mid-operation\n- User can cancel long-running tasks\n- Prevents wasted API calls\n- Immediate response to Ctrl+C\n\nExample:\nfor (const session of sessions) {\n  checkAbort(); // Exit cleanly if user pressed Ctrl+C\n  await processSession(session);\n}","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:57.657974-05:00","updated_at":"2025-12-07T22:50:16.227021-05:00","closed_at":"2025-12-07T22:50:05.198378-05:00"}
{"id":"cass_memory_system-v625","title":"[Tracking] Processed log file format","description":"File location: ~/.cass-memory/reflections/global.processed.log\n\nFormat: Tab-separated values (TSV) with header comment\n\nExample file:\n```\n# cass-memory processed sessions log\ndiary-abc123\t~/.claude/projects/app/session-001.jsonl\t2025-12-07T10:30:00Z\t5\t3\ndiary-def456\t~/.cursor/state.vscdb:session-xyz\t2025-12-07T11:00:00Z\t8\t6\ndiary-ghi789\t/workspace/.aider.input.history\t2025-12-07T12:15:00Z\t3\t3\n```\n\nColumns (tab-separated):\n1. diaryId: Unique ID for diary entry (or entry ID if no diary)\n2. sessionPath: Full path to original session\n3. processedAt: ISO 8601 timestamp\n4. deltasProposed: Count of proposed deltas\n5. deltasApplied: Count of applied deltas\n\nNotes:\n- TSV for easy grep/awk processing\n- One line per processed session\n- Sorted chronologically (append-only)\n- Use atomicWrite for safety","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:50:51.469599-05:00","updated_at":"2025-12-07T21:00:55.93286-05:00","closed_at":"2025-12-07T21:00:42.916694-05:00"}
{"id":"cass_memory_system-v6bn","title":"[Semantic] getEmbedder - Lazy-load embedding pipeline","description":"Singleton pattern for embedding pipeline - model loaded once per process.\n\nImplementation:\n```typescript\nimport { pipeline } from \"@xenova/transformers\";\n\nlet embedder: any = null;\n\nasync function getEmbedder(): Promise\u003cany\u003e {\n  if (!embedder) {\n    // First call downloads model (~23MB) if not cached\n    embedder = await pipeline(\n      \"feature-extraction\",\n      \"Xenova/all-MiniLM-L6-v2\"\n    );\n  }\n  return embedder;\n}\n```\n\nPerformance:\n- First call: ~500ms (model loading)\n- Subsequent calls: \u003c1ms (return cached instance)\n- Model cached to ~/.cache/huggingface/\n\nError handling:\n- Network errors during download\n- Model incompatibility\n- Fallback to keyword-only mode if fails\n\nModule scope:\n- Keep embedder at module level\n- Never re-instantiate\n- Thread-safe (single-threaded Node.js)","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-07T16:49:28.018624-05:00","updated_at":"2025-12-07T17:14:57.43482-05:00","comments":[{"id":32,"issue_id":"cass_memory_system-v6bn","author":"jemanuel","text":"Singleton pattern for embedding pipeline - model loaded once per process.\n\nImplementation:\n```typescript\nimport { pipeline } from \"@xenova/transformers\";\n\nlet embedder: any = null;\n\nasync function getEmbedder(): Promise\u003cany\u003e {\n  if (!embedder) {\n    // First call downloads model (~23MB) if not cached\n    embedder = await pipeline(\n      \"feature-extraction\",\n      \"Xenova/all-MiniLM-L6-v2\"\n    );\n  }\n  return embedder;\n}\n```\n\nPerformance:\n- First call: ~500ms (model loading)\n- Subsequent calls: \u003c1ms (return cached instance)\n- Model cached to ~/.cache/huggingface/\n\nError handling:\n- Network errors during download\n- Model incompatibility\n- Fallback to keyword-only mode if fails\n\nModule scope:\n- Keep embedder at module level\n- Never re-instantiate\n- Thread-safe (single-threaded Node.js)","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-v7ru","title":"[Unit Tests] types.ts - Schema validation tests","description":"## Unit Tests: types.ts - Schema Validation Tests\n\n### Test Categories\n\n#### 1. CassHitSchema Validation\n- Accepts valid hit objects\n- Rejects missing required fields\n- Coerces string scores to numbers\n- Handles optional fields correctly\n\n#### 2. DiaryEntrySchema Validation\n- Validates complete diary entries\n- Rejects invalid date formats\n- Validates nested bullet arrays\n- Handles optional reflection field\n\n#### 3. PlaybookSchema Validation\n- Validates full playbook structure\n- Validates bullets array\n- Validates toxic array\n- Validates metadata fields\n\n#### 4. BulletSchema Validation\n- Required: content, confidence\n- Optional: scope, maturity, created_at\n- Confidence range [0, 1]\n- Content minimum length\n\n#### 5. ConfigSchema Validation\n- Validates nested llm settings\n- Validates playbook_paths array\n- Default values applied\n- Type coercion where appropriate\n\n#### 6. Scope Utilities\n- matchesScope() exact matching\n- matchesScope() glob patterns\n- matchesScope() workspace filters\n- normalizeScope() standardization\n\n#### 7. Delta Schemas\n- FeedbackDeltaSchema validation\n- ReflectionDeltaSchema validation\n- MergeDeltaSchema validation\n\n### Test Approach\n- Test valid cases pass\n- Test invalid cases fail with clear errors\n- Verify error messages are helpful\n- Test edge cases (empty strings, null, undefined)\n\n### Error Message Quality\n- Schema errors should identify exact field\n- Should suggest valid values where possible","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:23:57.412093-05:00","updated_at":"2025-12-07T21:53:28.296106-05:00","closed_at":"2025-12-07T21:51:06.587786-05:00","dependencies":[{"issue_id":"cass_memory_system-v7ru","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2025-12-07T20:31:05.504788-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-v7ru","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2025-12-07T20:31:09.19243-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-vh56","title":"[Docs] CHANGELOG.md format and maintenance","description":"Create and maintain CHANGELOG.md following Keep a Changelog format.\n\nFormat:\n## [Unreleased]\n\n## [0.1.0] - 2025-12-07\n\n### Added\n- Initial release of cass-memory\n- Commands: init, context, diary, reflect, validate, mark, audit, playbook, project\n- Advanced commands: forget, stats, doctor, top, stale, why, similar\n- Confidence decay algorithm with configurable half-life\n- Scientific validation of playbook integrity\n- Three-layer memory model (Diary → Playbook → Project)\n- ACE pipeline (Generator → Reflector → Validator → Curator)\n- JSON output support for all commands\n- Cross-platform binary compilation (macOS, Linux, Windows)\n\n### Changed\n### Deprecated\n### Removed\n### Fixed\n### Security\n\nMaintain changelog with every release and keep Unreleased section for ongoing work","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:41.521876-05:00","updated_at":"2025-12-07T20:54:04.256947-05:00","closed_at":"2025-12-07T20:53:59.558143-05:00"}
{"id":"cass_memory_system-vlyh","title":"[Unit] reflect.ts - Reflection System \u0026 Learning","description":"## Target: src/reflect.ts (428 LOC) - ZERO CURRENT COVERAGE\n\n### Functions to Test:\n\n1. **generateReflection(sessions, playbook)** - Main reflection\n   - Analyzes sessions for patterns\n   - Identifies learning opportunities\n   - Returns reflection report\n   - Handles empty sessions\n\n2. **extractPatterns(sessions)** - Pattern extraction\n   - Finds repeated code patterns\n   - Identifies common errors\n   - Groups by category\n   - Returns pattern objects\n\n3. **suggestBullets(patterns, existing)** - Bullet suggestions\n   - Generate new bullet suggestions\n   - Avoid duplicates with existing\n   - Include confidence scores\n   - Categorize by type\n\n4. **compareWithPlaybook(patterns, playbook)** - Comparison\n   - Find covered patterns\n   - Find gaps\n   - Suggest updates\n   - Return comparison report\n\n5. **rankSuggestions(suggestions, options)** - Rank suggestions\n   - Score by frequency\n   - Score by impact\n   - Score by recency\n   - Combined ranking\n\n6. **formatReflectionReport(reflection)** - Report formatting\n   - Markdown output\n   - Structured sections\n   - Actionable items highlighted\n   - Statistics included\n\n### Reflection Report Schema:\n- patternsFound: Pattern[]\n- suggestedBullets: BulletSuggestion[]\n- coverageGaps: string[]\n- statistics: ReflectionStats\n\n### Test Data:\n- Sample sessions with known patterns\n- Edge cases (no patterns, all patterns)\n- Performance with large session sets","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T20:29:15.355219-05:00","updated_at":"2025-12-08T14:24:11.228281-05:00","closed_at":"2025-12-08T14:24:11.228281-05:00","dependencies":[{"issue_id":"cass_memory_system-vlyh","depends_on_id":"cass_memory_system-uufj","type":"blocks","created_at":"2025-12-07T20:32:20.113868-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-vlyh","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:33:01.911591-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-vol","title":"[Types] HarmfulReason - Structured reasons for harmful marks","description":"## Overview\nDefine enumeration of structured reasons for marking a bullet as 'harmful'. Enables analysis of WHY rules fail, not just THAT they fail.\n\n## Purpose\nWhen a playbook rule causes problems, capturing the specific failure mode enables:\n1. Pattern detection - Identify systemic issues (e.g., 'outdated rules are most common problem')\n2. Targeted improvements - Address root causes (e.g., add validation for outdated patterns)\n3. Better refinement - Reflector can learn from failure categories\n4. User insights - Help users understand what went wrong\n\n## Enumeration Values\n\n### caused_bug\n- Definition: Following the rule directly introduced a defect or error\n- Example: 'Use AuthService.login()' but AuthService was refactored to AuthManager\n- Severity: HIGH - broke functionality\n- Action: Often requires immediate deprecation or replacement\n\n### wasted_time\n- Definition: Advice led to unnecessary work or dead ends\n- Example: 'Run full test suite before commit' when project has no tests\n- Severity: MEDIUM - productivity loss\n- Action: Refine rule to check preconditions\n\n### contradicted_requirements\n- Definition: Rule conflicted with actual user needs or project goals\n- Example: 'Use REST API' when project mandate is GraphQL\n- Severity: MEDIUM - misalignment\n- Action: Update rule or mark as wrong scope\n\n### wrong_context\n- Definition: Rule is valid but was applied in inappropriate situation\n- Example: 'Use React hooks' suggested in Vue.js project\n- Severity: LOW - scope issue\n- Action: Improve scope filtering (workspace/framework)\n\n### outdated\n- Definition: Rule was correct historically but no longer applicable\n- Example: 'Use class components' after project migrated to hooks\n- Severity: MEDIUM - temporal drift\n- Action: Add verification check or automatic expiration\n\n### other\n- Definition: Catchall for unclassified failures\n- Example: Edge cases not fitting above categories\n- Severity: VARIABLE\n- Action: Review and potentially add new category\n\n## Type Definition\ntype HarmfulReason = 'caused_bug' | 'wasted_time' | 'contradicted_requirements' | 'wrong_context' | 'outdated' | 'other'\n\n## Usage in FeedbackEvent\nconst harmfulEvent: FeedbackEvent = { timestamp: '2025-12-07T14:30:00Z', sessionPath: '/path/to/session.jsonl', reason: 'caused_bug', context: 'AuthService was refactored to AuthManager' }\n\n## Analytics Use Cases\n- Stats command: Show distribution of failure reasons\n- Audit command: Group violations by reason\n- Reflector: Learn patterns (e.g., 'outdated' rules need verification)\n- Auto-prune: Higher weight for 'caused_bug' vs 'wrong_context'\n\n## Acceptance Criteria\n- TypeScript type with 6 enum values\n- JSDoc for each value explaining semantics\n- Examples of each failure mode in docs\n- Integration with FeedbackEvent type\n- Used in harmful event creation flows","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:57.133573-05:00","updated_at":"2025-12-07T19:02:10.081706-05:00","closed_at":"2025-12-07T19:02:00.164172-05:00"}
{"id":"cass_memory_system-vuss","title":"[Testing] Add pure unit tests: config + utils (fs/time) without mocks","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:29:45.657311-05:00","updated_at":"2025-12-07T21:51:27.215791-05:00","closed_at":"2025-12-07T21:51:27.215791-05:00","dependencies":[{"issue_id":"cass_memory_system-vuss","depends_on_id":"cass_memory_system-f63a","type":"blocks","created_at":"2025-12-07T20:29:45.659587-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-vuxg","title":"[Config] detectRepoContext - Find .cass/ directory","description":"Function signature:\n```typescript\nasync function detectRepoContext(): Promise\u003c{\n  inRepo: boolean;\n  repoRoot?: string;\n  cassDir?: string;\n}\u003e\n```\n\nImplementation:\n1. Run `git rev-parse --show-toplevel` to find repo root\n   - If fails: not in a git repo, return { inRepo: false }\n2. Check if .cass/ directory exists in repo root\n3. Return context information\n\nReturn values:\n- inRepo: true if in a git repository\n- repoRoot: absolute path to git repo root (if inRepo)\n- cassDir: absolute path to .cass/ directory (if exists)\n\nUsed by config loader to determine if repo-level config should be loaded.\nCalled at startup of most commands to establish context.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:49:54.839482-05:00","updated_at":"2025-12-07T20:26:00.910003-05:00","closed_at":"2025-12-07T20:25:32.316508-05:00"}
{"id":"cass_memory_system-w4g","title":"[Utils] extractKeywords - Stop word filtered keyword extraction","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:45:13.74917-05:00","updated_at":"2025-12-07T20:24:20.360846-05:00","closed_at":"2025-12-07T20:24:03.860869-05:00","comments":[{"id":33,"issue_id":"cass_memory_system-w4g","author":"jemanuel","text":"## Function Signature\n```typescript\nfunction extractKeywords(text: string): string[]\n```\n\n## Implementation Details\n- Tokenize text using tokenize() helper\n- Define stop words list (~80 common words):\n  - Articles: the, a, an\n  - Verbs: is, are, was, were, be, been, have, has, had, do, does, did, will, would, could, should, can\n  - Prepositions: to, of, in, for, on, with, at, by, from, as, into, through, during, before, after\n  - Pronouns: I, you, he, she, it, we, they, me, him, her, us, them\n  - Conjunctions: and, or, but, if, when, where, why, how\n  - Other: this, that, these, those, what, which, who, there, here\n- Filter out stop words: tokens.filter(t =\u003e !stopWords.includes(t))\n- Return top 10 keywords by frequency (or all if fewer than 10)\n\n## Why This Matters\nUsed for bullet scoring and cass query generation. Removing stop words focuses on meaningful terms. \"Fix authentication bug\" extracts [\"fix\", \"authentication\", \"bug\"] not [\"fix\", \"the\", \"authentication\", \"bug\"].\n\n## Edge Cases to Handle\n- All stop words - return []\n- No stop words - return all tokens (up to 10)\n- Fewer than 10 keywords - return all\n- Duplicate keywords - count frequency, return unique tokens","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-w5xt","title":"[Diary] formatRawSession - Parse raw session formats","description":"Format raw session files when cass export is unavailable.\n\nFunction Signature:\nfunction formatRawSession(content: string, ext: string): string\n\nSupported Extensions and Formats:\n\n1. Markdown (.md):\n   - Return content as-is\n   - Already human-readable\n   - Used by aider\n\n2. JSONL (.jsonl):\n   - Parse each line as separate JSON object\n   - Expected schema: { role: string, content: string }\n   - Format as: \"**{role}**: {content}\\n\\n\"\n   - Skip invalid lines with warning comment\n   - Used by Claude\n\n3. JSON (.json):\n   - Parse as single JSON object\n   - Expected schema: { messages: Array\u003c{role, content}\u003e }\n   - Format each message as: \"**{role}**: {content}\\n\\n\"\n   - Handle nested conversation structure\n   - Used by various agents\n\nFormat Examples:\n\nJSONL Input:\n{\"role\":\"user\",\"content\":\"Hello\"}\n{\"role\":\"assistant\",\"content\":\"Hi there!\"}\n\nFormatted Output:\n**user**: Hello\n\n**assistant**: Hi there!\n\nJSON Input:\n{\"messages\":[{\"role\":\"user\",\"content\":\"Hello\"},{\"role\":\"assistant\",\"content\":\"Hi!\"}]}\n\nFormatted Output:\n**user**: Hello\n\n**assistant**: Hi!\n\nError Handling:\n- Invalid JSON: Include raw line with [PARSE ERROR] prefix\n- Missing fields: Use [unknown] for role or [empty] for content\n- Unsupported extension: Return raw content with warning header\n\nKey Features:\n- Human-readable output\n- Preserves conversation structure\n- Graceful handling of malformed data\n- Consistent formatting across file types\n\nOutput:\nReturns formatted string ready for LLM extraction.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:47:33.384464-05:00","updated_at":"2025-12-07T20:18:10.655874-05:00","closed_at":"2025-12-07T20:17:48.839531-05:00"}
{"id":"cass_memory_system-w6c","title":"[Types] Delta Schema - Playbook Change Operations","description":"## Overview\nDefine Delta schema - a discriminated union of all possible playbook mutation operations. Enables type-safe, auditable changes with clear semantics.\n\n## Purpose\nDeltas provide:\n1. Type-safe playbook modifications\n2. Audit trail of changes\n3. Rollback/undo capability (future)\n4. Batch operations (apply multiple deltas)\n5. Clear separation of concerns (one type per operation)\n\n## Delta Types (Discriminated Union)\n\nUse Zod's discriminatedUnion on 'type' field for type safety.\n\n### 1. Add Delta\n```typescript\n{\n  type: 'add',\n  bullet: NewBulletData,\n  reason: string,\n  sourceSession: string\n}\n```\n\nPurpose: Create new playbook bullet\nFields:\n- bullet: Partial PlaybookBullet (id, createdAt, updatedAt auto-generated)\n- reason: Why this rule is being added (for audit trail)\n- sourceSession: Which session prompted this addition\nExample: { type: 'add', bullet: { content: 'Use TokenValidator for JWT checks', category: 'authentication', scope: 'workspace', workspace: '/path/to/project' }, reason: 'Authentication bypass incident', sourceSession: '/cass/2025-12-07-auth-fix.jsonl' }\n\n### 2. Helpful Delta\n```typescript\n{\n  type: 'helpful',\n  bulletId: string,\n  sourceSession?: string\n}\n```\n\nPurpose: Mark bullet as helpful (append to helpfulEvents)\nFields:\n- bulletId: ID of bullet to mark helpful\n- sourceSession: Optional session that benefited from rule\nEffect: Appends FeedbackEvent to bullet.helpfulEvents with current timestamp\nExample: { type: 'helpful', bulletId: 'b-l7k9m2p4-a3f8', sourceSession: '/cass/2025-12-07-api-design.jsonl' }\n\n### 3. Harmful Delta\n```typescript\n{\n  type: 'harmful',\n  bulletId: string,\n  sourceSession?: string,\n  reason?: HarmfulReason\n}\n```\n\nPurpose: Mark bullet as harmful (append to harmfulEvents)\nFields:\n- bulletId: ID of bullet to mark harmful\n- sourceSession: Optional session where rule caused problems\n- reason: Optional HarmfulReason enum (caused_bug, outdated, etc.)\nEffect: Appends FeedbackEvent to bullet.harmfulEvents with current timestamp\nAuto-Trigger: If harmfulEvents.length \u003e= config.pruneHarmfulThreshold, transition to retired state\nExample: { type: 'harmful', bulletId: 'b-m8n3p5q7-b4g9', sourceSession: '/cass/2025-11-20-refactor.jsonl', reason: 'outdated' }\n\n### 4. Replace Delta\n```typescript\n{\n  type: 'replace',\n  bulletId: string,\n  newContent: string,\n  reason: string\n}\n```\n\nPurpose: Update bullet content (refinement)\nFields:\n- bulletId: ID of bullet to update\n- newContent: New rule text\n- reason: Why content is being changed\nEffect: Updates bullet.content and bullet.updatedAt\nAudit: Creates history entry (future enhancement)\nExample: { type: 'replace', bulletId: 'b-n9o4q6r8-c5h0', newContent: 'Use TokenValidator from @/lib/auth for all JWT validation', reason: 'Made rule more specific to this codebase' }\n\n### 5. Deprecate Delta\n```typescript\n{\n  type: 'deprecate',\n  bulletId: string,\n  reason: string,\n  replacedBy?: string\n}\n```\n\nPurpose: Retire bullet (mark as deprecated)\nFields:\n- bulletId: ID of bullet to deprecate\n- reason: Why rule is being retired\n- replacedBy: Optional ID of replacement bullet\nEffect: Sets bullet.state = 'retired', bullet.maturity = 'deprecated', bullet.retiredAt = now\nGemini Pattern: Adds to deprecatedPatterns list in playbook\nExample: { type: 'deprecate', bulletId: 'b-o0p5r7s9-d6i1', reason: 'Project migrated from class components to hooks', replacedBy: 'b-p1q6s8t0-e7j2' }\n\n### 6. Merge Delta\n```typescript\n{\n  type: 'merge',\n  bulletIds: string[],\n  mergedContent: string,\n  reason: string\n}\n```\n\nPurpose: Combine duplicate/similar bullets into one\nFields:\n- bulletIds: Array of bullet IDs to merge (2+)\n- mergedContent: Combined rule text\n- reason: Why bullets are being merged\nEffect:\n  - Creates new bullet with mergedContent\n  - Aggregates helpfulEvents and harmfulEvents from all merged bullets\n  - Deprecates all source bullets with replacedBy pointing to merged bullet\n  - Preserves provenance (sourceSessions, sourceAgents)\nExample: { type: 'merge', bulletIds: ['b-a1b2c3d4', 'b-e5f6g7h8'], mergedContent: 'Use vitest for unit tests and playwright for e2e tests', reason: 'Deduplicated similar testing rules' }\n\n## Discriminated Union Schema\n\n```typescript\nconst DeltaSchema = z.discriminatedUnion('type', [\n  z.object({ type: z.literal('add'), bullet: NewBulletDataSchema, reason: z.string(), sourceSession: z.string() }),\n  z.object({ type: z.literal('helpful'), bulletId: z.string(), sourceSession: z.string().optional() }),\n  z.object({ type: z.literal('harmful'), bulletId: z.string(), sourceSession: z.string().optional(), reason: HarmfulReasonSchema.optional() }),\n  z.object({ type: z.literal('replace'), bulletId: z.string(), newContent: z.string(), reason: z.string() }),\n  z.object({ type: z.literal('deprecate'), bulletId: z.string(), reason: z.string(), replacedBy: z.string().optional() }),\n  z.object({ type: z.literal('merge'), bulletIds: z.array(z.string()).min(2), mergedContent: z.string(), reason: z.string() })\n])\n\ntype Delta = z.infer\u003ctypeof DeltaSchema\u003e\n```\n\n## Usage Patterns\n\n### Single Delta Application\n```typescript\nimport { applyDelta } from './playbook'\nconst delta: Delta = { type: 'helpful', bulletId: 'b-abc123', sourceSession: '/cass/session.jsonl' }\nconst updatedPlaybook = await applyDelta(playbook, delta)\n```\n\n### Batch Delta Application\n```typescript\nconst deltas: Delta[] = [\n  { type: 'add', bullet: {...}, reason: '...', sourceSession: '...' },\n  { type: 'helpful', bulletId: 'b-xyz789', sourceSession: '...' },\n  { type: 'deprecate', bulletId: 'b-old123', reason: '...' }\n]\nconst updatedPlaybook = await applyDeltas(playbook, deltas)\n```\n\n### Type-Safe Handling\n```typescript\nfunction handleDelta(delta: Delta) {\n  switch (delta.type) {\n    case 'add':\n      return createBullet(delta.bullet, delta.reason)\n    case 'helpful':\n      return markHelpful(delta.bulletId, delta.sourceSession)\n    case 'harmful':\n      return markHarmful(delta.bulletId, delta.sourceSession, delta.reason)\n    case 'replace':\n      return updateContent(delta.bulletId, delta.newContent, delta.reason)\n    case 'deprecate':\n      return deprecateBullet(delta.bulletId, delta.reason, delta.replacedBy)\n    case 'merge':\n      return mergeBullets(delta.bulletIds, delta.mergedContent, delta.reason)\n  }\n}\n```\n\n## Audit Trail Integration\n\nEach delta should be logged for audit purposes:\n```typescript\n{\n  timestamp: '2025-12-07T14:30:00Z',\n  actor: 'claude',\n  delta: { type: 'add', bullet: {...}, reason: '...', sourceSession: '...' },\n  result: 'success' | 'failure',\n  error?: string\n}\n```\n\n## Acceptance Criteria\n- Zod discriminated union schema with all 6 delta types\n- Type-safe TypeScript interfaces\n- applyDelta function for single operations\n- applyDeltas function for batch operations\n- Type guard utilities for each delta type\n- Examples for all delta types\n- JSDoc documentation\n- Audit trail integration hooks\n- Validation for required fields\n- Error handling for invalid deltas","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:03.277644-05:00","updated_at":"2025-12-07T20:06:29.96717-05:00","closed_at":"2025-12-07T20:05:24.099995-05:00"}
{"id":"cass_memory_system-wco","title":"[Reflector] reflectOnSession - Main reflection function","description":"async function reflectOnSession(\n  diary: DiaryEntry,\n  sessionContent: string,\n  existingBullets: PlaybookBullet[],\n  config: Config\n): Promise\u003cPlaybookDelta[]\u003e\n\nMulti-iteration reflection (ACE pattern):\n1. Initialize empty deltas array and seen hash set\n2. For i = 0 to config.maxReflectorIterations:\n   - Build prompt with iteration context\n   - Call LLM for deltas\n   - Deduplicate against seen hashes\n   - Add unique deltas to array\n   - If no new deltas, break early\n3. Return all deltas\n\nWHY MULTI-ITERATION: First pass catches obvious insights. Subsequent passes catch nuances that might be missed.\n\nDEPENDENCIES:\n- buildReflectorPrompt()\n- deduplicateDeltas()\n- validateReflectorOutput()\n- shouldExitEarly()\n\nOUTPUT: Array of PlaybookDelta objects ready for application to playbook","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:51.615811-05:00","updated_at":"2025-12-07T18:56:09.918682-05:00","closed_at":"2025-12-07T18:56:03.109249-05:00"}
{"id":"cass_memory_system-wgf","title":"[Cass] cassTimeline - Get session activity over time","description":"Implement cassTimeline() to get session activity over time.\n\n## Signature\n```typescript\ninterface CassTimelineGroup {\n  date: string;\n  sessions: Array\u003c{\n    path: string;\n    agent: string;\n    messageCount: number;\n    startTime: string;\n    endTime: string;\n  }\u003e;\n}\n\ninterface CassTimelineResult {\n  groups: CassTimelineGroup[];\n}\n\nasync function cassTimeline(\n  days: number, \n  cassPath = \"cass\"\n): Promise\u003cCassTimelineResult\u003e\n```\n\n## CLI Command\n`cass timeline --days {days} --json`\n\n## Implementation\n- Use execFile() to run timeline command\n- Parse JSON output\n- Return structured timeline data\n- Return { groups: [] } on error\n\n## Error Handling\n- Return empty groups array on any error\n- Log parse errors at debug level\n- No retries needed (timeline is read-only)\n\n## Output Structure\nTimeline groups sessions by date:\n```json\n{\n  \"groups\": [\n    {\n      \"date\": \"2024-01-15\",\n      \"sessions\": [\n        {\n          \"path\": \"/path/to/session.txt\",\n          \"agent\": \"claude-code\",\n          \"messageCount\": 42,\n          \"startTime\": \"2024-01-15T10:30:00Z\",\n          \"endTime\": \"2024-01-15T11:45:00Z\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n## Usage\nUsed for:\n- Finding unprocessed sessions (reflect command)\n- Activity visualization\n- Stats and analytics\n- Session discovery\n\n```typescript\nconst timeline = await cassTimeline(7);\nconst allSessions = timeline.groups.flatMap(g =\u003e g.sessions);\n```","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:00.092946-05:00","updated_at":"2025-12-07T19:57:45.730685-05:00","closed_at":"2025-12-07T19:57:42.548458-05:00"}
{"id":"cass_memory_system-woh8","title":"E2E test: 'cass playbook' command","description":"E2E test for 'cass playbook' CLI command:\n- Real subprocess execution via bun\n- Test playbook display with various formats\n- Test filtering by category, scope, maturity\n- Test --robot and --json output formats\n- Verify output includes all expected fields\n- Test error cases: missing playbook, corrupted YAML\n- Detailed logging: command invoked, output structure\nSetup: fixture directory with various playbook states","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-07T20:27:14.99201-05:00","updated_at":"2025-12-07T20:27:14.99201-05:00","dependencies":[{"issue_id":"cass_memory_system-woh8","depends_on_id":"cass_memory_system-8dxr","type":"blocks","created_at":"2025-12-07T20:28:33.552292-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-wrur","title":"[Semantic] Lazy model download with progress","description":"Lazy model download with progress feedback.\n\nFirst use triggers download:\n- Model: ~23MB\n- Cache location: ~/.cache/huggingface/\n- Network required: First use only\n- Subsequent runs: Instant (cached)\n\nProgress handling:\n```typescript\nasync function getEmbedder(): Promise\u003cany\u003e {\n  if (!embedder) {\n    console.log(\"Downloading embedding model (one-time, ~23MB)...\");\n    const startTime = Date.now();\n    \n    embedder = await pipeline(\n      \"feature-extraction\",\n      \"Xenova/all-MiniLM-L6-v2\",\n      {\n        progress_callback: (progress: any) =\u003e {\n          if (progress.status === \"downloading\") {\n            const percent = Math.round(progress.progress * 100);\n            process.stdout.write(`\\rDownloading: ${percent}%`);\n          }\n        }\n      }\n    );\n    \n    const elapsed = Date.now() - startTime;\n    console.log(`\\nModel loaded in ${elapsed}ms`);\n  }\n  return embedder;\n}\n```\n\nUser experience:\n- First run: \"Downloading model... 45%\"\n- Takes: 10-30 seconds (depends on network)\n- Cached: Instant startup\n\nOffline handling:\n```typescript\ntry {\n  embedder = await pipeline(...);\n} catch (error) {\n  if (error.message.includes(\"network\")) {\n    // Check if cached version exists\n    const cached = checkLocalCache();\n    if (cached) {\n      console.log(\"Using cached model (offline mode)\");\n      embedder = await pipeline(..., { local_files_only: true });\n    } else {\n      console.warn(\"Model not cached and offline - disabling semantic search\");\n      config.semanticSearchEnabled = false;\n    }\n  }\n}\n```\n\nCache location:\n- Linux/Mac: ~/.cache/huggingface/\n- Windows: %USERPROFILE%\\.cache\\huggingface\\\n\nModel can be pre-downloaded:\n```bash\n# Pre-download for offline use\nnpx transformers-cli download Xenova/all-MiniLM-L6-v2\n```","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-07T16:49:49.026465-05:00","updated_at":"2025-12-07T17:14:56.039177-05:00","comments":[{"id":34,"issue_id":"cass_memory_system-wrur","author":"jemanuel","text":"Lazy model download with progress feedback.\n\nFirst use triggers download:\n- Model: ~23MB\n- Cache location: ~/.cache/huggingface/\n- Network required: First use only\n- Subsequent runs: Instant (cached)\n\nProgress handling:\n```typescript\nasync function getEmbedder(): Promise\u003cany\u003e {\n  if (!embedder) {\n    console.log(\"Downloading embedding model (one-time, ~23MB)...\");\n    const startTime = Date.now();\n    \n    embedder = await pipeline(\n      \"feature-extraction\",\n      \"Xenova/all-MiniLM-L6-v2\",\n      {\n        progress_callback: (progress: any) =\u003e {\n          if (progress.status === \"downloading\") {\n            const percent = Math.round(progress.progress * 100);\n            process.stdout.write(`\\rDownloading: ${percent}%`);\n          }\n        }\n      }\n    );\n    \n    const elapsed = Date.now() - startTime;\n    console.log(`\\nModel loaded in ${elapsed}ms`);\n  }\n  return embedder;\n}\n```\n\nUser experience:\n- First run: \"Downloading model... 45%\"\n- Takes: 10-30 seconds (depends on network)\n- Cached: Instant startup\n\nOffline handling:\n```typescript\ntry {\n  embedder = await pipeline(...);\n} catch (error) {\n  if (error.message.includes(\"network\")) {\n    // Check if cached version exists\n    const cached = checkLocalCache();\n    if (cached) {\n      console.log(\"Using cached model (offline mode)\");\n      embedder = await pipeline(..., { local_files_only: true });\n    } else {\n      console.warn(\"Model not cached and offline - disabling semantic search\");\n      config.semanticSearchEnabled = false;\n    }\n  }\n}\n```\n\nCache location:\n- Linux/Mac: ~/.cache/huggingface/\n- Windows: %USERPROFILE%\\.cache\\huggingface\\\n\nModel can be pre-downloaded:\n```bash\n# Pre-download for offline use\nnpx transformers-cli download Xenova/all-MiniLM-L6-v2\n```","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-wx1","title":"[Curator] CurationResult type definition","description":"Define TypeScript interfaces for curation results and reporting.\n\nCore Types:\n- CurationResult: Main return type with playbook, statistics, and reports\n- ConflictReport: Details about detected rule conflicts\n- PromotionReport: Tracks maturity state transitions\n- InversionReport: Records harmful-to-anti-pattern conversions\n\nInterface CurationResult:\n  playbook: Playbook\n  applied: number\n  skipped: number\n  conflicts: ConflictReport[]\n  promotions: PromotionReport[]\n  inversions: InversionReport[]\n  pruned: number\n\nInterface ConflictReport:\n  newBulletContent: string\n  conflictingBulletId: string\n  conflictingContent: string\n  reason: string\n\nInterface PromotionReport:\n  bulletId: string\n  from: string\n  to: string\n\nInterface InversionReport:\n  originalId: string\n  originalContent: string\n  antiPatternId: string\n  antiPatternContent: string\n\nThese types enable comprehensive tracking of all curation operations for debugging and user feedback.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:44:53.953125-05:00","updated_at":"2025-12-07T21:14:16.258021-05:00","closed_at":"2025-12-07T21:14:07.586551-05:00"}
{"id":"cass_memory_system-x2k0","title":"[Build] Release process documentation","description":"Document the release process with step-by-step checklist.\n\nRelease checklist:\n1. Update version in package.json (semantic versioning)\n2. Update CHANGELOG.md with release date and notes\n3. Run full test suite: npm test (ensure all pass)\n4. Build all platform binaries: npm run build:all\n5. Test binaries on each platform (macOS, Linux, Windows)\n6. Create git tag: git tag v0.1.0\n7. Push tag: git push origin v0.1.0\n8. Create GitHub release from tag\n9. Upload binaries as release assets:\n   - cass-memory-darwin-arm64\n   - cass-memory-darwin-x64\n   - cass-memory-linux-x64\n   - cass-memory-windows-x64.exe\n10. Update release notes with installation instructions\n11. Announce release (optional)\n12. Future: Update homebrew formula for macOS users\n\nAutomate with GitHub Actions in future","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:43.243256-05:00","updated_at":"2025-12-07T21:04:25.970634-05:00","closed_at":"2025-12-07T21:03:19.442286-05:00"}
{"id":"cass_memory_system-x5sb","title":"Fix Critical Issues: Exec Safety, Playbook Corruption, Serve Security, Filename collisions","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T21:09:25.589979-05:00","updated_at":"2025-12-07T21:10:46.245245-05:00","closed_at":"2025-12-07T21:10:46.245245-05:00"}
{"id":"cass_memory_system-xgvn","title":"[Test] Unit: scoring.ts - Decay algorithms and maturity","description":"# Unit Tests for scoring.ts\n\n## Functions to Test\n\n### calculateDecayedValue(eventDate, halfLifeDays)\nTest Cases:\n- Event from today → value ≈ 1.0\n- Event from 90 days ago with 90-day half-life → value ≈ 0.5\n- Event from 180 days ago with 90-day half-life → value ≈ 0.25\n- Event from 1 year ago → value approaches 0\n- Half-life of 30 days decays faster than 90 days\n- Future event date → value \u003e 1.0 (edge case)\n- Invalid date → throws or returns 0\n\n### getDecayedScore(events, halfLifeDays)\nTest Cases:\n- Empty array → 0\n- Single recent event → ≈ 1.0\n- Multiple recent events → sum of values\n- Mix of old and new events → weighted sum\n- All ancient events → near 0\n\n### getDecayedCounts(bullet)\nTest Cases:\n- No feedback events → { helpful: 0, harmful: 0 }\n- Only helpful events → { helpful: N, harmful: 0 }\n- Only harmful events → { helpful: 0, harmful: N }\n- Mix of helpful/harmful → correct split\n- Decay affects counts appropriately\n\n### getEffectiveScore(bullet, config)\nTest Cases:\n- New bullet with no feedback → 0\n- Bullet with only helpful → positive score\n- Bullet with only harmful → negative score (4x multiplier)\n- Balanced feedback → depends on recency\n- Maturity multiplier applied correctly:\n  - candidate: 0.5x\n  - established: 1.0x\n  - proven: 1.5x\n  - deprecated: 0x\n\n### calculateMaturityState(bullet, config)\nTest Cases:\n- New bullet → candidate\n- 3+ feedback events → established\n- 10+ helpful, \u003c10% harmful → proven\n- \u003e30% harmful → deprecated\n\n### checkForPromotion / checkForDemotion\nTest Cases:\n- Promotion from candidate → established\n- Promotion from established → proven\n- Demotion from proven → established\n- Auto-deprecation when harmful ratio high\n\n### isStale(bullet, staleDays)\nTest Cases:\n- Recent feedback → not stale\n- Old feedback → stale\n- No feedback → stale\n\n## Test File Structure\n\\`\\`\\`typescript\nimport { describe, it, expect } from \"bun:test\";\nimport { \n  calculateDecayedValue, \n  getDecayedScore,\n  getDecayedCounts,\n  getEffectiveScore,\n  calculateMaturityState\n} from \"../src/scoring\";\nimport { createTestBullet, createFeedbackEvent } from \"./helpers/factories\";\n\ndescribe(\"scoring\", () =\u003e {\n  describe(\"calculateDecayedValue\", () =\u003e {\n    it(\"returns ~1.0 for events from today\", () =\u003e {\n      const today = new Date().toISOString();\n      const value = calculateDecayedValue(today, 90);\n      expect(value).toBeCloseTo(1.0, 2);\n    });\n    // ... more tests\n  });\n});\n\\`\\`\\`","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T20:23:41.139604-05:00","updated_at":"2025-12-07T21:48:01.825721-05:00","closed_at":"2025-12-07T21:46:58.540151-05:00","dependencies":[{"issue_id":"cass_memory_system-xgvn","depends_on_id":"cass_memory_system-ai52","type":"blocks","created_at":"2025-12-07T20:28:09.966821-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-xhh","title":"[Cass] cassNeedsIndex - Check if index needs rebuild","description":"Implement cassNeedsIndex() to check if cass index needs rebuilding.\n\n## Signature\n```typescript\nfunction cassNeedsIndex(cassPath = \"cass\"): boolean\n```\n\n## CLI Command\n`cass health`\n\n## Implementation\n- Use execSync() to run cass health\n- Check exit code to determine index health\n- Return boolean indicating rebuild needed\n- Suppress stdout/stderr with stdio: \"pipe\"\n\n## Error Handling\n- Return true if exit code 1 or 3 (needs rebuild)\n- Return false if exit code 0 (healthy)\n- Return false on any other error (assume healthy to avoid false positives)\n\n## Exit Codes\n- 0: Index is healthy, no rebuild needed\n- 1: Index needs incremental update\n- 3: Index missing or corrupted, needs full rebuild\n\n## Usage\nUsed for proactive index maintenance:\n```typescript\nif (cassNeedsIndex()) {\n  console.log(\"Rebuilding cass index...\");\n  await cassIndex({ full: true });\n}\n```","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:54.407263-05:00","updated_at":"2025-12-07T19:00:00.648687-05:00","closed_at":"2025-12-07T18:59:58.998496-05:00"}
{"id":"cass_memory_system-xiw","title":"[Validator] isGenericRule - Detect overly obvious rules","description":"Implement the isGenericRule function - Detect overly obvious rules that add no value.\n\nSIGNATURE:\n```typescript\nfunction isGenericRule(content: string): boolean\n```\n\nGENERIC RULE EXAMPLES (REJECT THESE):\n- \"Write tests\"\n- \"Use good variable names\"\n- \"Handle errors\"\n- \"Document your code\"\n- \"Follow best practices\"\n- \"Keep code DRY\"\n- \"Use meaningful comments\"\n\nDETECTION HEURISTICS:\n\n1. LENGTH CHECK:\n   - Very short rules (\u003c 20 chars) are likely generic\n   - Example: \"Write tests\" (11 chars)\n\n2. GENERIC TERM PATTERNS:\n```typescript\nconst genericPatterns = [\n  /^write tests?$/i,\n  /^use (good|better|descriptive) (names|variables)/i,\n  /^handle errors?$/i,\n  /^document (your|the) code/i,\n  /^follow best practices/i,\n  /^keep.*DRY/i,\n  /^avoid code duplication/i,\n  /^use meaningful (names|comments)/i,\n  /^always validate input/i,\n  /^make code (readable|maintainable)/i\n];\n```\n\n3. NO SPECIFIC TECHNOLOGY:\n   - Generic: \"Use dependency injection\"\n   - Specific: \"Use React Context for dependency injection\"\n   - If no technology/framework/pattern mentioned → likely generic\n\n4. NO ACTIONABLE DETAIL:\n   - Generic: \"Handle errors properly\"\n   - Specific: \"Wrap async operations in try-catch and log to Sentry\"\n\nIMPLEMENTATION:\n```typescript\nfunction isGenericRule(content: string): boolean {\n  // Check 1: Too short\n  if (content.length \u003c 20) {\n    return true;\n  }\n\n  // Check 2: Generic patterns\n  const genericPatterns = [\n    /^write tests?$/i,\n    /^use (good|better|descriptive) (names|variables)/i,\n    /^handle errors?$/i,\n    /^document (your|the) code/i,\n    /^follow best practices/i,\n    /^keep.*DRY/i,\n    /^avoid code duplication/i,\n    /^use meaningful (names|comments)/i,\n    /^always validate input$/i,\n    /^make code (readable|maintainable)/i\n  ];\n\n  if (genericPatterns.some(pattern =\u003e pattern.test(content))) {\n    return true;\n  }\n\n  // Check 3: No specific technology mentioned\n  const hasTechnology = /\\b(React|TypeScript|Python|Node|PostgreSQL|Redis|Docker|AWS|API|REST|GraphQL|SQL)\\b/i.test(content);\n  const hasPattern = /\\b(dependency injection|event sourcing|CQRS|microservices|singleton|factory|strategy)\\b/i.test(content);\n\n  if (!hasTechnology \u0026\u0026 !hasPattern \u0026\u0026 content.length \u003c 50) {\n    return true;  // Short, generic, no specifics\n  }\n\n  return false;\n}\n```\n\nEXAMPLES:\n\nGeneric (return true):\n- \"Write unit tests\"\n- \"Use descriptive variable names\"\n- \"Handle errors properly\"\n- \"Keep functions small\"\n- \"Avoid code duplication\"\n\nSpecific (return false):\n- \"Use TypeScript strict mode with noImplicitAny enabled\"\n- \"Wrap all Prisma queries in try-catch blocks and log errors to Sentry\"\n- \"Use React.memo for expensive component renders in data tables\"\n- \"Implement retry logic with exponential backoff for external API calls\"\n\nWHY THIS MATTERS:\n- Prevents playbook pollution with obvious advice\n- Focuses validation resources on meaningful rules\n- Improves playbook quality and signal-to-noise ratio\n- Saves LLM costs by rejecting generics early\n\nDEPENDENCIES:\n- None (pure function)\n\nLOCATION:\n- src/validator/generic-rules.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:44:59.729673-05:00","updated_at":"2025-12-08T14:28:28.548927-05:00","closed_at":"2025-12-08T14:28:28.548927-05:00"}
{"id":"cass_memory_system-xjk","title":"[Utils] scoreBulletRelevance - Keyword-based bullet scoring","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:45:23.661135-05:00","updated_at":"2025-12-07T20:24:20.363501-05:00","closed_at":"2025-12-07T20:24:03.855946-05:00","comments":[{"id":35,"issue_id":"cass_memory_system-xjk","author":"jemanuel","text":"## Function Signature\n```typescript\nfunction scoreBulletRelevance(\n  bulletContent: string,\n  bulletTags: string[],\n  keywords: string[]\n): number\n```\n\n## Implementation Details\n- Initialize score = 0\n- For each keyword in keywords:\n  - If bulletContent.toLowerCase() includes keyword: score += 2\n  - If bulletTags includes keyword (case-insensitive): score += 3\n- Return total score\n- Higher score = more relevant to task\n\n## Why This Matters\nUsed in context command to rank bullets by task relevance. Bullets with matching keywords are more likely to be useful for current task. Tag matches weighted higher (3 vs 2) because tags are more intentional than content mentions.\n\n## Edge Cases to Handle\n- Empty keywords - return 0\n- Empty bulletContent and bulletTags - return 0\n- Case sensitivity - always compare lowercase\n- Partial matches - \"test\" matches \"testing\" (use includes)\n- Multiple keyword matches - accumulate score\n- Same keyword in content and tags - count both (score += 5 total)","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-xjx","title":"[Reflector] deduplicateDeltas - Remove duplicate insights","description":"function deduplicateDeltas(\n  newDeltas: PlaybookDelta[],\n  seenHashes: Set\u003cstring\u003e\n): PlaybookDelta[]\n\nFor each delta:\n- Hash the delta (content + type)\n- If hash in seenHashes, skip\n- Otherwise add hash and keep delta\n- Return unique deltas\n\nPURPOSE:\nPrevents same insight being proposed multiple times across iterations\n\nEXAMPLE SCENARIO:\n- Iteration 0: LLM proposes \"Use async/await for promises\"\n- Iteration 1: LLM proposes same insight with slightly different wording\n- Deduplication: Hash matches, second proposal is skipped\n\nALGORITHM:\n1. Create result array\n2. For each delta in newDeltas:\n   - hash = hashDelta(delta)\n   - if (seenHashes.has(hash)) continue\n   - seenHashes.add(hash)\n   - result.push(delta)\n3. Return result\n\nDEPENDENCIES:\n- hashDelta()\n\nUsed in reflectOnSession() main loop","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:54.645079-05:00","updated_at":"2025-12-07T18:58:26.034546-05:00","closed_at":"2025-12-07T18:58:10.737705-05:00"}
{"id":"cass_memory_system-xtj","title":"[Utils] expandPath - Home directory expansion","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:44:45.074017-05:00","updated_at":"2025-12-07T18:48:03.209209-05:00","closed_at":"2025-12-07T18:47:47.159171-05:00","comments":[{"id":36,"issue_id":"cass_memory_system-xtj","author":"jemanuel","text":"## Function Signature\n```typescript\nfunction expandPath(p: string): string\n```\n\n## Implementation Details\n- Check if path starts with \"~/\"\n- If yes, replace with os.homedir() + path.slice(1)\n- Otherwise return path unchanged\n- Use Node.js os.homedir() for cross-platform compatibility\n\n## Why This Matters\nCritical for config paths like \"~/.cass-memory/playbook.yaml\". Users expect tilde expansion to work like in shell commands. Without this, paths starting with ~ would fail to resolve.\n\n## Edge Cases to Handle\n- Empty string input - return unchanged\n- Path with only \"~\" (no slash) - should expand to home directory\n- Paths like \"~user/file\" (other user's home) - NOT supported, return unchanged\n- Windows paths (C:\\\\Users\\\\...) - return unchanged, no expansion needed\n- Null/undefined input - should throw or return empty string","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-xw0","title":"[Utils] generateDiaryId - Unique diary entry identifier","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:45:00.048552-05:00","updated_at":"2025-12-07T20:24:27.274867-05:00","closed_at":"2025-12-07T20:24:24.576265-05:00","comments":[{"id":37,"issue_id":"cass_memory_system-xw0","author":"jemanuel","text":"## Function Signature\n```typescript\nfunction generateDiaryId(sessionPath: string): string\n```\n\n## Implementation Details\n- Format: \"diary-{hash}\"\n- Combine sessionPath + Date.now() into single string\n- Hash using hashContent() (which uses SHA-256)\n- Prefix with \"diary-\" for clarity\n- Deterministic for same session at same millisecond\n\n## Why This Matters\nDiary entries need unique IDs that are tied to session but not globally unique. This allows same session to have multiple diary entries if processed at different times, while preventing exact duplicates.\n\n## Edge Cases to Handle\n- Same session processed twice in same ms - same ID (prevents duplicate diary entries)\n- Same session processed at different times - different IDs\n- Different sessions - different IDs\n- Empty sessionPath - still generates ID based on timestamp","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-y10h","title":"Fix cost tracking race condition","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T22:26:57.253222-05:00","updated_at":"2025-12-07T22:27:40.575401-05:00","closed_at":"2025-12-07T22:27:12.18048-05:00"}
{"id":"cass_memory_system-y1d4","title":"[Impl] Add Inline Feedback Parsing to Reflection","description":"# Implement Inline Feedback Parsing in Reflection\n\n## Purpose\nParse inline feedback comments from session logs during reflection, enabling zero-command feedback from agents.\n\n## Depends On\n- afjz (Feedback format design) - need to know exact format to parse\n\n## Implementation\n\n### Parser Module\nCreate parser that finds comments matching:\n\\`\\`\\`regex\n\\[cass:\\s*(helpful|harmful)\\s+(b-[a-z0-9]+)\\](?:\\s+(.+))?\n\\`\\`\\`\n\n### Integration Point\nIn reflection pipeline (src/reflect.ts):\n1. After loading session content\n2. Scan for inline feedback comments\n3. Apply each as if \\`cm mark\\` was called\n4. Log what was auto-extracted\n\n### Edge Cases\n- Multiple comments per session: process all\n- Duplicate feedback (inline + explicit): dedupe by session+rule\n- Invalid rule IDs: warn and skip\n- Comments in code strings: minimize false positives with context\n\n## Deliverables\n- [ ] Parser function for inline feedback\n- [ ] Integration with reflection pipeline\n- [ ] Tests for various comment formats\n- [ ] Warning log for invalid/skipped feedback","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-08T12:48:24.552377-05:00","updated_at":"2025-12-08T13:22:17.480928-05:00","closed_at":"2025-12-08T13:22:17.480928-05:00","dependencies":[{"issue_id":"cass_memory_system-y1d4","depends_on_id":"cass_memory_system-afjz","type":"blocks","created_at":"2025-12-08T12:48:46.798688-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-y22j","title":"[Docs] Configuration reference documentation","description":"Document all configuration options with types, defaults, and examples.\n\nConfiguration sources (precedence order):\n1. Command-line flags (highest)\n2. Environment variables\n3. Repo config (.cass/config.yaml)\n4. Global config (~/.cass-memory/config.json)\n5. Defaults (lowest)\n\nGlobal config: llm_provider, default_model, confidence_threshold, decay_half_life_days, max_bullets_per_section\nRepo config: project_name, playbook_path, diary_path, session_path, validation_rules\nEnvironment variables: OPENAI_API_KEY, ANTHROPIC_API_KEY, CASS_MEMORY_CONFIG, CASS_MEMORY_DEBUG\n\nInclude JSON schema for validation and example configs","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:28.411185-05:00","updated_at":"2025-12-08T13:51:54.466858-05:00","closed_at":"2025-12-08T13:51:54.466858-05:00"}
{"id":"cass_memory_system-y5s","title":"[Curator] pruneDeprecated - Remove deprecated from active list","description":"Remove deprecated bullets from active list and move to deprecated section.\n\nSignature:\nfunction pruneDeprecated(playbook: Playbook): number\n\nProcess:\n1. Initialize pruned counter\n2. Filter playbook.bullets:\n   - Keep bullets where maturity !== 'deprecated'\n   - Collect deprecated bullets\n3. For each deprecated bullet:\n   - Add to playbook.deprecated array (if it exists)\n   - Increment pruned counter\n4. Update playbook.bullets to filtered array\n5. Return pruned count\n\nImportant notes:\n- Does NOT delete data\n- Deprecated bullets move to separate section for history\n- Maintains complete audit trail\n- Allows future analysis of what didn't work\n\nWhy separate active from deprecated?\n- Keeps active playbook focused and clean\n- Prevents deprecated rules from being used\n- Preserves history for learning\n- Enables deprecation analytics\n\nPlaybook structure after pruning:\n{\n  bullets: [...active bullets...],\n  deprecated: [...deprecated bullets...],\n  stats: {\n    totalActive: bullets.length,\n    totalDeprecated: deprecated.length\n  }\n}\n\nThis is called at the END of curatePlaybook, after auto-inversion.\n\nPrune order matters:\n1. Process all deltas\n2. Auto-invert harmful bullets (creates deprecations)\n3. Prune deprecated (moves them out)\n4. Return final playbook","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:45:06.4804-05:00","updated_at":"2025-12-08T14:28:58.369048-05:00","closed_at":"2025-12-08T14:28:58.369048-05:00"}
{"id":"cass_memory_system-y6t","title":"[Types] CommandResult and Error Types","description":"## Overview\nDefine command result and error types for consistent CLI output and error handling across all cass-memory commands.\n\n## Purpose\nStandardize:\n1. Success/failure responses from all commands\n2. Error reporting with actionable messages\n3. Data payloads for JSON output mode\n4. Audit violation reporting\n5. Health check results\n\n## CommandResult\n\nStandard return type for all CLI commands.\n\nFields:\n\nsuccess: boolean\n- True if command completed successfully\n- False if command failed\n- Example: true\n\nmessage: string\n- Human-readable summary of result\n- Success: 'Added 3 new rules to playbook'\n- Failure: 'Failed to load playbook: file not found'\n- Required: Always present\n\ndata: unknown | undefined\n- Optional command-specific payload\n- Type varies by command\n- Examples:\n  - context command: ContextResult\n  - stats command: StatsReport\n  - validate command: ValidationReport\n- JSON mode: Serialized to output\n\nerror: string | undefined\n- Optional error details for failures\n- Stack trace (in verbose mode)\n- Technical details\n- Example: 'ENOENT: no such file or directory, open ~/.cass-memory/playbook.yaml'\n\n## AuditViolation\n\nIndividual violation found by audit command.\n\nFields:\n\nbulletId: string\n- ID of bullet that was violated or contradicted\n- Example: 'b-abc123'\n\nbulletContent: string\n- Text of the rule that was violated\n- Example: 'Use TokenValidator for JWT validation'\n\nsessionPath: string\n- Path to session where violation occurred\n- Example: '/cass/2025-12-07-api-impl.jsonl'\n\nevidence: string\n- Excerpt showing the violation\n- Example: 'Used direct JWT decode without TokenValidator'\n\nseverity: 'low' | 'medium' | 'high'\n- How serious the violation is\n- low: Stylistic deviation\n- medium: Best practice not followed\n- high: Security/correctness issue\n\n## AuditResult\n\nComplete audit report from audit command.\n\nFields:\n\nsessionsScanned: number\n- Count of sessions analyzed\n- Example: 25\n\nviolations: AuditViolation[]\n- Array of found violations\n- Grouped by: severity, then bulletId\n- Example: [{ bulletId: 'b-abc', bulletContent: 'Use TokenValidator', sessionPath: '/cass/...', evidence: '...', severity: 'high' }]\n\nsuggestions: string[]\n- Actionable recommendations\n- Examples:\n  - 'Consider deprecating rule b-xyz - violated in 80% of recent sessions'\n  - 'Rule b-abc is consistently followed - promote to proven'\n  - 'Add anti-pattern for direct JWT decode based on 5 violations'\n\n## ErrorTypes\n\nCommon error categories for better error handling.\n\nCategories:\n\nConfigError:\n- Config file not found\n- Invalid config format\n- Missing required config fields\n\nPlaybookError:\n- Playbook file not found\n- Invalid playbook YAML\n- Schema validation failure\n\nCassError:\n- cass executable not found\n- cass search failed\n- cass timeout\n\nValidationError:\n- Invalid bullet data\n- Rule validation failed\n- Evidence gate not passed\n\nLLMError:\n- API key missing\n- API call failed\n- Rate limit exceeded\n- Invalid response format\n\n## Success Response Examples\n\nContext command:\n{ success: true, message: 'Found 12 relevant rules for task', data: { task: '...', relevantBullets: [...], ... } }\n\nReflect command:\n{ success: true, message: 'Processed 5 sessions, added 3 rules, updated 2', data: { addedCount: 3, updatedCount: 2 } }\n\nStats command:\n{ success: true, message: 'Playbook statistics', data: { totalBullets: 42, activeCount: 35, ... } }\n\n## Error Response Examples\n\nConfig error:\n{ success: false, message: 'Config file not found', error: 'ENOENT: ~/.cass-memory/config.yaml' }\n\nPlaybook error:\n{ success: false, message: 'Invalid playbook format', error: 'YAML parsing failed at line 42: unexpected indent' }\n\nValidation error:\n{ success: false, message: 'Validation failed', error: 'Insufficient evidence: only 1 session found' }\n\n## JSON Output Mode\n\nWhen config.jsonOutput = true:\n- All commands return CommandResult as JSON\n- Suppress human-friendly formatting\n- Include full data payload\n- Errors as structured objects\n\nExample:\n{ \"success\": true, \"message\": \"Context retrieved\", \"data\": { \"task\": \"...\", \"relevantBullets\": [...] } }\n\n## Acceptance Criteria\n- CommandResult interface with all fields\n- AuditViolation interface\n- AuditResult interface\n- Error type definitions\n- Success/error response examples\n- JSON serialization support\n- Zod schemas for validation\n- TypeScript exports\n- JSDoc documentation\n- Consistent error messages across commands","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:08.437115-05:00","updated_at":"2025-12-07T21:48:02.175478-05:00","closed_at":"2025-12-07T21:47:39.450911-05:00"}
{"id":"cass_memory_system-y7x","title":"[Generator] separateAntiPatterns - Split rules from pitfalls","description":"Separate anti-patterns from regular rules for distinct presentation.\n\nSIGNATURE:\nfunction separateAntiPatterns(scoredBullets: ScoredBullet[]): { rules: ScoredBullet[]; antiPatterns: ScoredBullet[] }\n\nPURPOSE:\nSplit scored bullets into two categories for different sections of the context output. Anti-patterns (pitfalls) are shown separately to highlight what NOT to do.\n\nCLASSIFICATION LOGIC:\nA bullet is an anti-pattern if:\n  bullet.type === 'anti-pattern' || bullet.kind === 'anti_pattern'\n\nBoth field names supported for backwards compatibility.\n\nOUTPUT STRUCTURE:\n{\n  rules: ScoredBullet[],        // Regular patterns/rules (what to do)\n  antiPatterns: ScoredBullet[]  // Anti-patterns (what NOT to do)\n}\n\nPRESENTATION:\nRules appear in: 'Relevant Playbook Rules' section\nAnti-patterns appear in: 'PITFALLS TO AVOID' section\n\nEXAMPLE:\nInput: [\n  { id: 'b1', content: 'Use async/await for DB calls', type: 'pattern' },\n  { id: 'b2', content: 'AVOID: Blocking DB calls in event loop', type: 'anti-pattern' },\n  { id: 'b3', content: 'Cache frequently-read data', type: 'optimization' }\n]\n\nOutput: {\n  rules: [b1, b3],\n  antiPatterns: [b2]\n}\n\nSCORE PRESERVATION:\nBoth arrays maintain the scoring metadata (relevanceScore, effectiveScore, finalScore) from scorePlaybookBullets for potential display.\n\nIMPLEMENTATION NOTES:\n- Simple filter operation (no mutation)\n- Preserves order within each category\n- Empty antiPatterns array is valid (no pitfalls relevant)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:44:57.792421-05:00","updated_at":"2025-12-07T19:20:01.027529-05:00","closed_at":"2025-12-07T19:18:39.77653-05:00"}
{"id":"cass_memory_system-y8o","title":"Phase 3: Advanced Features + Intelligence","description":"# EPIC: Advanced Features + Intelligence\n\n## Purpose\nAdd intelligent features that dramatically improve relevance and usability:\nlocal semantic search, multi-iteration reflection, scientific validation,\nand playbook health analytics.\n\n## Background \u0026 Reasoning\nSimple keyword matching for bullet relevance achieves ~60% accuracy. By adding\nlocal semantic embeddings via @xenova/transformers (all-MiniLM-L6-v2, 23MB model),\nwe can reach ~90% relevance without network calls.\n\nThe GPT Pro proposal introduced \"scientific validation\" - before accepting a new\nrule, query cass for historical evidence. Did this pattern succeed or fail in the\npast? This prevents accepting rules that contradict historical evidence.\n\nMulti-iteration reflection (from ACE paper) runs the reflector multiple times per\nsession, focusing on different aspects each iteration. This catches insights that\na single pass might miss.\n\n## Priority Features (from ROI analysis)\n- P7: Local semantic search @xenova/transformers (4× impact)\n- P9: Stats command playbook health dashboard (2× impact)\n\n## Key Deliverables\n1. `cass-memory validate \"\u003crule\u003e\"` - Scientific validation against history\n2. `cass-memory stats` - Playbook health dashboard\n3. Local embedding-based relevance scoring\n4. Multi-iteration reflector (configurable 1-3 iterations)\n5. Cross-agent enrichment in diaries\n\n## Technical Specifications\n### Semantic Search\n- Model: Xenova/all-MiniLM-L6-v2 (runs locally, ~23MB)\n- Embedding dimension: 384\n- Scoring: 40% keyword + 60% semantic similarity\n- Cache: ~/.cass-memory/embeddings/bullets.embeddings\n\n### Stats Dashboard Metrics\n- Total bullets by scope (global/workspace)\n- Distribution by maturity (candidate/established/proven/retired)\n- Distribution by kind (project_convention/stack_pattern/workflow_rule/anti_pattern)\n- Top performers (highest effective scores)\n- At-risk bullets (negative effective scores)\n- Stale bullets (no feedback in 90+ days)\n- Merge candidates (high semantic similarity pairs)\n\n## Dependencies\n- Requires Phase 2 completion (diary, reflect, curate pipeline)","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-07T16:16:41.554097-05:00","updated_at":"2025-12-07T16:16:41.554097-05:00","dependencies":[{"issue_id":"cass_memory_system-y8o","depends_on_id":"cass_memory_system-0ew","type":"blocks","created_at":"2025-12-07T16:25:25.218629-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-y8o.1","title":"Validate Command: Scientific Validation (GPT Pro Pattern)","description":"# Feature: Validate Command (Scientific Validation)\n\n## Purpose\nValidate a proposed rule against historical evidence from cass.\nThis implements the GPT Pro proposal's \"scientific validation\" - \ntreating rule proposals as hypotheses to be tested against data.\n\n## Usage\n```bash\ncass-memory validate \"Always use httpx instead of requests\" --json\ncass-memory validate \"Prefer composition over inheritance\" --verbose\n```\n\n## Process Flow\n```\n1. Extract validation keywords from proposed rule\n2. Check evidence-count gate (auto-accept/reject if clear signal)\n3. If ambiguous, run LLM validator with evidence\n4. Return verdict with reasoning\n```\n\n## Implementation\n```typescript\nasync function validateCommand(\n  proposedRule: string,\n  flags: ValidateFlags\n): Promise\u003cvoid\u003e {\n  const config = await loadConfig();\n  \n  // 1. Extract keywords\n  const keywords = extractKeywords(proposedRule);\n  \n  // 2. Check evidence gate\n  const gateResult = await evidenceCountGate(proposedRule, config);\n  \n  if (gateResult.action !== \"needs-llm\") {\n    output({\n      proposedRule,\n      verdict: gateResult.action === \"auto-accept\" ? \"ACCEPT\" : \"REJECT\",\n      confidence: gateResult.confidence,\n      reason: `${gateResult.action}: ${gateResult.successCount} successes, ${gateResult.failureCount} failures`,\n      evidence: gateResult.relevantSessions.map(h =\u003e ({\n        session: h.source_path,\n        snippet: h.snippet,\n        outcome: classifySessionOutcome(h)\n      }))\n    }, formatValidationResult, flags);\n    return;\n  }\n  \n  // 3. Run LLM validator\n  const validation = await runValidator(\n    ValidationResultSchema,\n    proposedRule,\n    formatEvidenceForPrompt(gateResult.relevantSessions),\n    config\n  );\n  \n  output({\n    proposedRule,\n    verdict: validation.valid ? \"ACCEPT\" : \"REJECT\",\n    confidence: validation.confidence || 0.7,\n    reason: validation.reason,\n    refinedRule: validation.refinedContent,\n    evidence: gateResult.relevantSessions.map(h =\u003e ({\n      session: h.source_path,\n      snippet: h.snippet\n    }))\n  }, formatValidationResult, flags);\n}\n```\n\n## Output Example\n```json\n{\n  \"proposedRule\": \"Always use httpx instead of requests\",\n  \"verdict\": \"ACCEPT_WITH_CAUTION\",\n  \"confidence\": 0.75,\n  \"reason\": \"Evidence shows httpx succeeded in 4 sessions for async use cases, but requests was fine for simple sync calls\",\n  \"refinedRule\": \"Prefer httpx for async HTTP calls; requests is acceptable for simple synchronous requests\",\n  \"evidence\": [\n    {\n      \"session\": \"~/.claude/sessions/abc.jsonl\",\n      \"snippet\": \"Switched to httpx for async support, much cleaner code\"\n    },\n    {\n      \"session\": \"~/.cursor/sessions/def.jsonl\", \n      \"snippet\": \"requests worked fine for this simple GET request\"\n    }\n  ]\n}\n```","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T16:24:14.956313-05:00","updated_at":"2025-12-07T20:07:53.578028-05:00","closed_at":"2025-12-07T20:06:51.580903-05:00","dependencies":[{"issue_id":"cass_memory_system-y8o.1","depends_on_id":"cass_memory_system-y8o","type":"parent-child","created_at":"2025-12-07T16:24:14.958057-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-y8o.1","depends_on_id":"cass_memory_system-0ew.4","type":"blocks","created_at":"2025-12-07T16:25:25.294018-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-y8o.1","depends_on_id":"cass_memory_system-5eh.9","type":"blocks","created_at":"2025-12-07T16:25:25.373799-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-y8o.2","title":"Stats Command: Playbook Health Dashboard (P9)","description":"# Feature: Stats Command (P9 - Playbook Health Dashboard)\n\n## Purpose\nDisplay comprehensive playbook health metrics. Helps identify:\n- At-risk bullets that need attention\n- Stale bullets that may be outdated\n- Top performers worth promoting\n- Merge candidates (similar content)\n\n## Usage\n```bash\ncass-memory stats\ncass-memory stats --json\ncass-memory stats --category testing\n```\n\n## Metrics Displayed\n\n### 1. Overview\n- Total bullets (global vs workspace)\n- Distribution by state (draft/active/proven/retired)\n- Distribution by kind (project_convention/stack_pattern/workflow_rule/anti_pattern)\n\n### 2. Score Distribution\n- Excellent (effective score \u003e 10)\n- Good (5-10)\n- Neutral (0-5)\n- At Risk (\u003c 0)\n\n### 3. Top Performers\n- Top 5 bullets by effective score\n- Most frequently marked helpful\n\n### 4. Needs Attention\n- Bullets with negative effective scores\n- Stale bullets (no feedback in 90+ days)\n- Merge candidates (similarity \u003e 0.8)\n\n## Implementation\n```typescript\nasync function statsCommand(flags: StatsFlags): Promise\u003cvoid\u003e {\n  const config = await loadConfig();\n  const playbook = await loadMergedPlaybook(config);\n  \n  // Calculate all metrics\n  const stats = {\n    total: playbook.bullets.length,\n    byScope: countByScope(playbook.bullets),\n    byState: countByState(playbook.bullets),\n    byKind: countByKind(playbook.bullets),\n    scoreDistribution: calculateScoreDistribution(playbook.bullets, config),\n    topPerformers: getTopPerformers(playbook.bullets, config, 5),\n    atRisk: getAtRiskBullets(playbook.bullets, config),\n    stale: getStaleBullets(playbook.bullets, 90),\n    mergeCandidates: findMergeCandidates(playbook.bullets, 0.8)\n  };\n  \n  output(stats, formatStatsHuman, flags);\n}\n```\n\n## Human Output\n```\n╭─────────────────────────────────────────────────────────────╮\n│              CASS-MEMORY PLAYBOOK HEALTH                    │\n├─────────────────────────────────────────────────────────────┤\n│ Total Bullets: 156 (Global: 89, Workspace: 67)              │\n│                                                             │\n│ BY STATE:                                                   │\n│   ● Draft:       23 (14.7%)  ░░░░░                          │\n│   ● Active:      87 (55.8%)  ████████████████               │\n│   ● Proven:      34 (21.8%)  ███████                        │\n│   ● Retired:     12 (7.7%)   ███                            │\n│                                                             │\n│ BY KIND:                                                    │\n│   project_convention: 42  stack_pattern: 58                 │\n│   workflow_rule: 48       anti_pattern: 8                   │\n│                                                             │\n│ SCORE DISTRIBUTION:                                         │\n│   Excellent (\u003e10):  18  ████                                │\n│   Good (5-10):      45  ██████████                          │\n│   Neutral (0-5):    71  ████████████████                    │\n│   At Risk (\u003c0):     10  ███  ⚠️                             │\n│                                                             │\n│ TOP PERFORMERS:                                             │\n│   1. b-abc123 (24.3) \"Use waitFor for async assertions...\"  │\n│   2. b-def456 (18.7) \"Prefer httpx for async HTTP...\"       │\n│   3. b-ghi789 (15.2) \"Mock external APIs in tests...\"       │\n│                                                             │\n│ NEEDS ATTENTION:                                            │\n│   ⚠️ 10 bullets at risk (negative scores)                   │\n│   🕐 8 bullets stale (no feedback 90+ days)                 │\n│   🔄 3 merge candidate pairs detected                       │\n╰─────────────────────────────────────────────────────────────╯\n```","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-07T16:24:16.21366-05:00","updated_at":"2025-12-07T20:01:12.831731-05:00","closed_at":"2025-12-07T20:00:53.872944-05:00","dependencies":[{"issue_id":"cass_memory_system-y8o.2","depends_on_id":"cass_memory_system-y8o","type":"parent-child","created_at":"2025-12-07T16:24:16.214832-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-y8o.2","depends_on_id":"cass_memory_system-5eh.8","type":"blocks","created_at":"2025-12-07T16:25:25.45307-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-y8o.2","depends_on_id":"cass_memory_system-5eh.6","type":"blocks","created_at":"2025-12-07T16:25:25.523207-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-y8o.3","title":"Local Semantic Search: @xenova/transformers (P7)","description":"# Feature: Local Semantic Search (P7 - 4× Relevance Impact)\n\n## Purpose\nDramatically improve bullet relevance matching by using local semantic\nembeddings. Catches synonyms and conceptual matches that keyword search misses.\n\n## The Problem\nKeyword matching misses:\n- \"authentication\" vs \"auth\" vs \"login\" vs \"session\"\n- \"error handling\" vs \"exception management\" vs \"failure recovery\"\n- \"performance optimization\" vs \"speed improvement\" vs \"making it faster\"\n\n## Solution: Local Embeddings\nUse @xenova/transformers with all-MiniLM-L6-v2 model:\n- Runs 100% locally (no network calls)\n- ~23MB model download (one time)\n- ~3ms per embedding on modern laptop\n- 384-dimension dense vectors\n\n## Implementation\n```typescript\nimport { pipeline } from \"@xenova/transformers\";\n\nlet embedder: any = null;\n\nasync function getEmbedder() {\n  if (!embedder) {\n    embedder = await pipeline(\n      \"feature-extraction\",\n      \"Xenova/all-MiniLM-L6-v2\"\n    );\n  }\n  return embedder;\n}\n\nasync function embedText(text: string): Promise\u003cnumber[]\u003e {\n  const embed = await getEmbedder();\n  const result = await embed(text, { pooling: \"mean\", normalize: true });\n  return Array.from(result.data);\n}\n\nfunction cosineSimilarity(a: number[], b: number[]): number {\n  let dot = 0, normA = 0, normB = 0;\n  for (let i = 0; i \u003c a.length; i++) {\n    dot += a[i] * b[i];\n    normA += a[i] * a[i];\n    normB += b[i] * b[i];\n  }\n  return dot / (Math.sqrt(normA) * Math.sqrt(normB));\n}\n```\n\n## Enhanced Bullet Scoring\n```typescript\nasync function scoreBulletsEnhanced(\n  bullets: PlaybookBullet[],\n  task: string,\n  config: Config\n): Promise\u003cScoredBullet[]\u003e {\n  // 1. Keyword scoring (fast, always run)\n  const keywords = extractKeywords(task);\n  const keywordScored = bullets.map(b =\u003e ({\n    bullet: b,\n    keywordScore: scoreBulletRelevance(b.content, b.tags, keywords)\n  }));\n  \n  // 2. Semantic scoring (if enabled)\n  if (!config.semanticSearchEnabled) {\n    return keywordScored.map(({ bullet, keywordScore }) =\u003e ({\n      ...bullet,\n      combinedScore: keywordScore,\n      effectiveScore: getEffectiveScore(bullet, config)\n    }));\n  }\n  \n  const taskEmbedding = await embedText(task);\n  \n  const semanticScored = await Promise.all(\n    keywordScored.map(async ({ bullet, keywordScore }) =\u003e {\n      // Load cached or compute embedding\n      const bulletEmbedding = bullet.embedding || await embedText(bullet.content);\n      const semanticScore = cosineSimilarity(taskEmbedding, bulletEmbedding);\n      \n      return {\n        ...bullet,\n        keywordScore,\n        semanticScore,\n        // Combined: 40% keyword + 60% semantic\n        combinedScore: (keywordScore * 0.4) + (semanticScore * 10 * 0.6),\n        effectiveScore: getEffectiveScore(bullet, config)\n      };\n    })\n  );\n  \n  return semanticScored;\n}\n```\n\n## Embedding Cache\n```typescript\n// ~/.cass-memory/embeddings/bullets.json\ninterface EmbeddingCache {\n  version: string;\n  model: string;\n  bullets: Record\u003cstring, {\n    contentHash: string;\n    embedding: number[];\n    computedAt: string;\n  }\u003e;\n}\n\nasync function loadOrComputeEmbeddings(\n  playbook: Playbook,\n  cache: EmbeddingCache\n): Promise\u003cvoid\u003e {\n  for (const bullet of playbook.bullets) {\n    const hash = hashContent(bullet.content);\n    const cached = cache.bullets[bullet.id];\n    \n    if (cached \u0026\u0026 cached.contentHash === hash) {\n      bullet.embedding = cached.embedding;\n    } else {\n      bullet.embedding = await embedText(bullet.content);\n      cache.bullets[bullet.id] = {\n        contentHash: hash,\n        embedding: bullet.embedding,\n        computedAt: now()\n      };\n    }\n  }\n  await saveEmbeddingCache(cache);\n}\n```\n\n## Performance Characteristics\n- Model download: ~23MB (first use only)\n- Model load: ~500ms (first embedding only)\n- Per-embedding: ~3ms\n- 100 bullets: ~300ms total\n- Cache hit: ~0ms (just array lookup)","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-07T16:24:17.511923-05:00","updated_at":"2025-12-07T17:14:55.602893-05:00","dependencies":[{"issue_id":"cass_memory_system-y8o.3","depends_on_id":"cass_memory_system-y8o","type":"parent-child","created_at":"2025-12-07T16:24:17.513127-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-y8o.3","depends_on_id":"cass_memory_system-5eh.3","type":"blocks","created_at":"2025-12-07T16:25:25.607173-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-y8o.3","depends_on_id":"cass_memory_system-5eh.8","type":"blocks","created_at":"2025-12-07T16:25:25.68334-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-y9k","title":"[Foundation] tsconfig.json with strict TypeScript settings","description":"Create tsconfig.json with strict TypeScript configuration for type safety and ESM module support.\n\n## Context\nTypeScript configuration is critical for ensuring type safety, proper module resolution, and IDE support throughout the CASS Memory System codebase. The configuration must support ESM, strict type checking, and clean import paths.\n\n## Technical Specification\n\n### Compiler Options:\n- target: ESNext - Use latest JavaScript features\n- module: ESNext - ES module output\n- moduleResolution: bundler - Modern resolution for Bun\n- strict: true - Enable all strict type checking options\n- esModuleInterop: true - Better compatibility with CommonJS modules\n- skipLibCheck: true - Skip type checking of declaration files for faster builds\n- resolveJsonModule: true - Allow importing JSON files\n- allowSyntheticDefaultImports: true - Allow default imports from modules with no default export\n- forceConsistentCasingInFileNames: true - Ensure consistent file name casing\n- noImplicitAny: true - Disallow implicit any types\n- strictNullChecks: true - Strict null checking\n- strictFunctionTypes: true - Strict function type checking\n- noUnusedLocals: true - Report errors on unused local variables\n- noUnusedParameters: true - Report errors on unused parameters\n- noImplicitReturns: true - Report error when not all code paths return a value\n- noFallthroughCasesInSwitch: true - Report errors for fallthrough cases in switch\n\n### Path Mapping:\n- paths: { @/*: [./src/*] } - Clean imports like import { Playbook } from '@/types'\n\n### Include/Exclude:\n- include: [src/**/*] - Include all source files\n- exclude: [node_modules, dist] - Exclude dependencies and build output\n\n### Output:\n- outDir: ./dist - Output directory for compiled files\n- declaration: true - Generate .d.ts files for library use\n- declarationMap: true - Generate sourcemaps for declarations\n- sourceMap: true - Generate sourcemaps for debugging\n\n## Reasoning\n\n### Why Strict Mode:\n1. Catch Bugs Early: Strict null checks prevent null/undefined errors at runtime\n2. Better Refactoring: Type errors guide you when making changes\n3. IDE Support: Better autocomplete and IntelliSense\n4. LLM Integration: Type safety is crucial when parsing LLM responses\n\n### Why ESNext Target:\n1. Bun Support: Bun natively supports modern JavaScript\n2. Smaller Polyfills: No need to transpile to ES5\n3. Modern Features: Use async/await, optional chaining, etc.\n\n### Why Bundler Module Resolution:\n1. Modern Standard: Aligns with modern bundlers and runtimes\n2. Better Imports: Supports package.json exports field\n3. Bun Compatibility: Matches Bun's module resolution algorithm\n\n### Why Path Mapping:\n1. Clean Imports: @/types instead of ../../../types\n2. Refactor-Friendly: Moving files doesn't break imports\n3. Readability: Clear namespace separation\n\n## Acceptance Criteria\n\n- tsconfig.json exists in project root\n- strict: true is enabled\n- target: ESNext is set\n- module: ESNext is set\n- moduleResolution: bundler is set\n- Path mapping configured for @/* -\u003e ./src/*\n- include/exclude properly configured\n- outDir set to ./dist\n- bun run typecheck runs without errors on initial project\n- IDE shows proper IntelliSense for imports\n- No implicit any warnings in editor\n\n## How This Serves the Universal Agent Memory System\n\nTypeScript configuration is the quality gate for the entire codebase:\n\n1. Type Safety: Prevents runtime errors when parsing LLM responses, file operations, and config management\n2. Developer Experience: IntelliSense and autocomplete make development faster and more reliable\n3. Maintainability: Strong types serve as living documentation for the codebase\n4. Refactoring Confidence: Type errors guide safe refactoring as the system evolves\n5. LLM Output Validation: Zod schemas combined with TypeScript types ensure structured outputs match expectations\n\nWithout strict TypeScript, the system would be prone to runtime errors, especially when dealing with dynamic LLM responses and user configurations.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:44.254164-05:00","updated_at":"2025-12-07T20:19:20.048682-05:00","closed_at":"2025-12-07T20:19:15.791505-05:00"}
{"id":"cass_memory_system-yagh","title":"[Critical] User-Friendly Error Messages","description":"$(cat /tmp/fix_yagh.txt)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T17:16:46.56704-05:00","updated_at":"2025-12-08T00:24:26.114362-05:00","closed_at":"2025-12-08T00:24:24.947379-05:00"}
{"id":"cass_memory_system-ydz","title":"[LLM] generateSearchQueries - Task-based query generation","description":"Function signature:\nasync function generateSearchQueries(task: string, config: Config): Promise\u003cstring[]\u003e\n\nSchema:\n{\n  queries: z.array(z.string()).max(5).describe('3-5 diverse search queries')\n}\n\nPrompt:\n'Given this task: {task}\n\nGenerate 3-5 diverse search queries to find relevant information in cass:\n- Similar problems encountered before\n- Related frameworks or tools\n- Relevant patterns or best practices\n- Error messages or debugging approaches\n\nMake queries specific enough to be useful but broad enough to match variations.'\n\nImplementation:\n1. Build prompt with task\n2. Call generateObject with:\n   - schema: queries array\n   - temperature: 0.5\n3. Return queries array\n\nUsed by: Generator phase to expand task into multiple cass search angles.\n\nExample: Task 'add authentication' → queries: ['JWT implementation', 'session management', 'password hashing', 'OAuth setup']","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:46:02.92747-05:00","updated_at":"2025-12-07T20:11:16.260667-05:00","closed_at":"2025-12-07T20:11:02.188879-05:00"}
{"id":"cass_memory_system-ygng","title":"[Critical] Implicit Feedback - Auto-Mark from Session Outcomes","description":"# Implicit Feedback - Auto-Mark from Session Outcomes\n\n## The Problem\nCurrent plan requires manual `cm mark helpful/harmful \u003crule\u003e` commands.\nUsers won't do this. They'll use the tool, benefit from rules, but never give feedback.\nWithout feedback, the confidence system is useless.\n\n## The Solution\nInfer feedback automatically from observable signals:\n\n### Signal Sources:\n1. **Session Success/Failure**: Did the task complete? Errors? Retries?\n2. **Time to Completion**: Fast = rules helped. Slow = rules didn't help or were wrong.\n3. **Pattern Matching**: Did the session use patterns matching rules we showed?\n4. **Explicit Signals**: User said \"that worked!\" or \"that was wrong\"\n\n### Implementation:\n```typescript\ninterface SessionOutcome {\n  sessionPath: string;\n  startTime: Date;\n  endTime: Date;\n  rulesShown: string[];  // Rule IDs shown in context\n  signals: {\n    completedSuccessfully: boolean;  // No error exit\n    hadRetries: boolean;  // Multiple attempts at same thing\n    userSentiment: \"positive\" | \"negative\" | \"neutral\" | null;\n    taskDuration: number;  // Seconds\n    errorCount: number;\n  };\n}\n\nasync function inferFeedback(outcome: SessionOutcome): Promise\u003cFeedbackEvent[]\u003e {\n  const feedback: FeedbackEvent[] = [];\n  \n  for (const ruleId of outcome.rulesShown) {\n    let implicit: FeedbackStrength | null = null;\n    \n    // Strong positive: Quick success with no errors\n    if (outcome.signals.completedSuccessfully \u0026\u0026 \n        !outcome.signals.hadRetries \u0026\u0026\n        outcome.signals.taskDuration \u003c FAST_THRESHOLD) {\n      implicit = \"helpful\";\n    }\n    \n    // Strong negative: Errors or retries on tasks using this rule\n    if (outcome.signals.errorCount \u003e 2 || outcome.signals.hadRetries) {\n      implicit = \"not_helpful\";\n    }\n    \n    // Explicit overrides implicit\n    if (outcome.signals.userSentiment === \"positive\") {\n      implicit = \"very_helpful\";\n    } else if (outcome.signals.userSentiment === \"negative\") {\n      implicit = \"harmful\";\n    }\n    \n    if (implicit) {\n      feedback.push({\n        bulletId: ruleId,\n        strength: implicit,\n        source: \"implicit\",\n        sessionId: outcome.sessionPath,\n        timestamp: new Date()\n      });\n    }\n  }\n  \n  return feedback;\n}\n```\n\n### Sentiment Detection (Lightweight):\n```typescript\nconst POSITIVE_PATTERNS = [\n  /that worked/i, /perfect/i, /thanks/i, /great/i,\n  /exactly what I needed/i, /solved it/i\n];\n\nconst NEGATIVE_PATTERNS = [\n  /that('s| is) wrong/i, /doesn't work/i, /broke/i,\n  /not what I wanted/i, /try again/i, /undo/i\n];\n\nfunction detectSentiment(sessionText: string): \"positive\" | \"negative\" | \"neutral\" {\n  const positiveCount = POSITIVE_PATTERNS.filter(p =\u003e p.test(sessionText)).length;\n  const negativeCount = NEGATIVE_PATTERNS.filter(p =\u003e p.test(sessionText)).length;\n  \n  if (positiveCount \u003e negativeCount) return \"positive\";\n  if (negativeCount \u003e positiveCount) return \"negative\";\n  return \"neutral\";\n}\n```\n\n### Feedback Weighting:\n```typescript\nconst FEEDBACK_WEIGHTS = {\n  // Explicit feedback (user ran command)\n  \"explicit_helpful\": 2.0,\n  \"explicit_harmful\": -3.0,\n  \n  // Implicit from session outcome\n  \"implicit_helpful\": 0.5,\n  \"implicit_not_helpful\": -0.3,\n  \n  // Implicit from sentiment\n  \"sentiment_positive\": 0.3,\n  \"sentiment_negative\": -0.5\n};\n```\n\n### Post-Session Hook:\n```typescript\n// Runs automatically after cass detects session end\nasync function onSessionEnd(sessionPath: string): Promise\u003cvoid\u003e {\n  // 1. Get rules that were shown for this session\n  const contextLog = await loadContextLog(sessionPath);\n  if (!contextLog?.rulesShown) return;  // Context wasn't used\n  \n  // 2. Analyze session outcome\n  const outcome = await analyzeSession(sessionPath);\n  outcome.rulesShown = contextLog.rulesShown;\n  \n  // 3. Infer and record feedback\n  const feedback = await inferFeedback(outcome);\n  for (const f of feedback) {\n    await recordFeedbackEvent(f);\n  }\n  \n  // 4. Update confidence scores\n  await updateConfidenceScores(feedback);\n}\n```\n\n## Why This Is Critical\n- Manual feedback has ~0% adoption rate\n- Without feedback, confidence scores never update\n- System can't learn what works vs what doesn't\n- Implicit feedback is \"good enough\" for most cases\n- Can always add explicit feedback later for edge cases\n\n## Trade-offs\n- False positives/negatives possible (mitigated by low weights)\n- Privacy: Analyzing session content (already in cass, so OK)\n- Complexity: Need to track which rules were shown","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T17:08:16.860446-05:00","updated_at":"2025-12-07T21:48:17.022665-05:00","closed_at":"2025-12-07T21:48:09.838663-05:00","comments":[{"id":38,"issue_id":"cass_memory_system-ygng","author":"jemanuel","text":"## Problem: Users Won't Provide Manual Feedback\nNobody will consistently run `cass-memory mark b-xyz --helpful` for every useful bullet.\n\n## Solution: Implicit Feedback Signals\n1. Session outcome correlation (bullet shown + success = implicit helpful)\n2. Audit-based feedback (violations auto-mark harmful)\n3. Agent integration (batch marking)\n4. Interactive batch marking mode\n\n## Acceptance Criteria\n- Track which bullets shown in each context call\n- Correlate with session outcomes\n- Implement implicit +0.5 helpful for success correlation\n- Add --batch-helpful and --interactive flags\n","created_at":"2025-12-07T23:15:50Z"},{"id":39,"issue_id":"cass_memory_system-ygng","author":"jemanuel","text":"## Problem: Users Won't Provide Manual Feedback\nNobody will consistently run `cm mark b-xyz --helpful` for every useful bullet.\n\n## Solution: Implicit Feedback Signals\n1. Session outcome correlation (bullet shown + success = implicit helpful)\n2. Audit-based feedback (violations auto-mark harmful)\n3. Agent integration (batch marking)\n4. Interactive batch marking mode\n\n## Acceptance Criteria\n- Track which bullets shown in each context call\n- Correlate with session outcomes\n- Implement implicit +0.5 helpful for success correlation\n- Add --batch-helpful and --interactive flags\n","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-yj1z","title":"[Test Infrastructure] Test fixtures and factory functions","description":"## Test Fixtures and Factory Functions\n\nCreate reusable test fixtures and factory functions for deterministic testing WITHOUT mocks.\n\n### Required Factories:\n1. `createTestPlaybook(overrides?)` - Returns valid Playbook with controllable defaults\n2. `createTestBullet(overrides?)` - Returns valid PlaybookBullet with all fields\n3. `createTestDiary(overrides?)` - Returns valid DiaryEntry\n4. `createTestConfig(overrides?)` - Returns valid Config with test-safe defaults\n5. `createTestFeedbackEvent(type, overrides?)` - Returns helpful/harmful events\n\n### Design Principles:\n- NO mocks - use real data structures\n- Deterministic - same inputs always produce same outputs\n- Composable - factories can be nested/combined\n- Type-safe - full TypeScript inference\n\n### Example Usage:\n```typescript\nconst bullet = createTestBullet({\n  helpfulCount: 5,\n  harmfulCount: 1,\n  maturity: 'proven'\n});\n```\n\n### File Location: test/fixtures/factories.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:23:03.081639-05:00","updated_at":"2025-12-07T21:13:03.932345-05:00","closed_at":"2025-12-07T21:12:32.212766-05:00"}
{"id":"cass_memory_system-yo24","title":"[E2E Tests] Full ACE pipeline - session to playbook","description":"## E2E Test: Full ACE Pipeline - Session to Playbook\n\n### Test Scenario\nComplete end-to-end test of the Autonomous Curation Engine:\nSession ingestion → Reflection → Validation → Playbook update\n\n### Test Steps\n\n#### 1. Setup\n- Create temp directory structure\n- Initialize cass-memory config\n- Create sample session transcript file\n- Create initial empty playbook\n\n#### 2. Execute Full Pipeline\n- Run `cm context` with session path\n- Trigger reflection (automatic or manual)\n- Verify diary entry created\n- Verify playbook updated\n\n#### 3. Validate Outputs\n- Diary entry has valid structure\n- Playbook has new bullets\n- Bullets have confidence scores\n- Timestamps are correct\n\n#### 4. Verify Logging\n- Each pipeline stage logs entry/exit\n- Timing information captured\n- Error paths logged appropriately\n- Verbose mode shows full details\n\n### Test Data\n- Sample session with 20+ messages\n- Mix of code, discussion, errors\n- Clear lessons to extract\n\n### Success Criteria\n- Pipeline completes without error\n- Diary entry matches session content\n- Playbook bullets are relevant\n- All intermediate files created\n\n### Verbose Logging Requirements\n- Log: 'Starting ACE pipeline for session: \u003cpath\u003e'\n- Log: 'Reflection phase: extracting lessons...'\n- Log: 'Validation phase: checking bullet quality...'\n- Log: 'Curation phase: updating playbook...'\n- Log: 'Pipeline complete. Added N bullets, duration: Xms'","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:24:28.156899-05:00","updated_at":"2025-12-08T01:36:53.861555-05:00","closed_at":"2025-12-08T01:36:53.861555-05:00","dependencies":[{"issue_id":"cass_memory_system-yo24","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2025-12-07T20:31:24.284276-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-yo24","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2025-12-07T20:31:24.445611-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-yo24","depends_on_id":"cass_memory_system-p4mv","type":"blocks","created_at":"2025-12-07T20:31:24.570764-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-yo24","depends_on_id":"cass_memory_system-33w3","type":"blocks","created_at":"2025-12-07T20:31:29.148468-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-yo24","depends_on_id":"cass_memory_system-0thy","type":"blocks","created_at":"2025-12-07T20:31:29.273785-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-yo24","depends_on_id":"cass_memory_system-z8y7","type":"blocks","created_at":"2025-12-07T20:31:29.404948-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-yo24","depends_on_id":"cass_memory_system-70sd","type":"blocks","created_at":"2025-12-07T20:31:29.525025-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-ypmh","title":"[ErrorHandling] validateAndSanitizeInput - Input validation","description":"Validate and sanitize user input to prevent errors and security issues.\n\nFunction signature:\nfunction validateAndSanitizeInput(\n  type: 'bulletId' | 'sessionPath' | 'task' | 'category',\n  value: string\n): string\n\nValidation rules:\n- bulletId: Must match pattern (e.g., 'B001', alphanumeric)\n- sessionPath: Valid file path, resolve relative to absolute\n- task: Non-empty, max length, no control characters\n- category: Must be in allowed list or match pattern\n\nSanitization:\n- Trim whitespace\n- Normalize unicode\n- Remove control characters\n- Resolve paths to absolute\n\nThrows descriptive error with hint if invalid:\n- What was invalid\n- What format is expected\n- Example of valid input\n\nReturns sanitized value on success.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:27.710962-05:00","updated_at":"2025-12-07T22:24:21.349065-05:00","closed_at":"2025-12-07T22:24:21.349065-05:00"}
{"id":"cass_memory_system-yqds","title":"[Tracking] atomicWrite - Safe file updates","description":"Purpose: Prevent file corruption on crashes/interruptions during writes\n\nFunction signature:\n```typescript\nasync function atomicWrite(\n  filePath: string,\n  content: string\n): Promise\u003cvoid\u003e\n```\n\nImplementation steps:\n1. Generate temp file path: {filePath}.tmp\n2. Write content to temp file\n3. Call fsync() on temp file descriptor to ensure data on disk\n4. Close temp file\n5. Rename temp file to final path (atomic operation on POSIX)\n6. On error: cleanup temp file and rethrow\n\nPlatform considerations:\n- POSIX (macOS/Linux): rename() is atomic\n- Windows: May need MoveFileEx with MOVEFILE_REPLACE_EXISTING\n\nError handling:\n```typescript\ntry {\n  await fs.writeFile(tmpPath, content);\n  const fd = await fs.open(tmpPath, 'r+');\n  await fd.sync();\n  await fd.close();\n  await fs.rename(tmpPath, filePath);\n} catch (err) {\n  await fs.unlink(tmpPath).catch(() =\u003e {});\n  throw err;\n}\n```\n\nUsed for: Playbooks, config files, processed logs, all critical data files","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:30.763028-05:00","updated_at":"2025-12-07T21:00:31.325812-05:00","closed_at":"2025-12-07T21:00:19.206216-05:00"}
{"id":"cass_memory_system-yue","title":"[Diary] findDiaryBySession - Lookup by session path","description":"Find diary entry by session path, used for evidence correlation.\n\nFunction Signature:\nasync function findDiaryBySession(\n  sessionPath: string,\n  config: Config\n): Promise\u003cDiaryEntry | null\u003e\n\nProcess:\n1. List all files in diary directory\n2. Filter for JSON files matching diary filename pattern\n3. For each diary file:\n   a. Load diary using loadDiaryEntry\n   b. Check if diary.sessionPath === sessionPath\n   c. Return diary if match found\n4. Return null if no match found\n\nOptimization:\n- Early exit on first match (no need to scan all)\n- Cache recently loaded diaries in memory\n- Use filename hash to skip unlikely matches\n\nKey Features:\n- Exact path matching\n- Graceful null return on no match\n- Error resilient (skips corrupted diaries)\n- Performance optimized for large diary collections\n\nUse Cases:\n- Validator looking up evidence for rule\n- Checking if diary already exists for session\n- Correlating playbook rules with diary insights\n- Evidence chain construction\n\nExample:\nconst session = '~/.claude/projects/myapp/session-123.jsonl';\nconst diary = await findDiaryBySession(session, config);\nif (diary) {\n  console.log('Session outcome:', diary.status);\n  console.log('Key learnings:', diary.keyLearnings);\n}\n\nPerformance:\n- O(n) worst case where n = number of diaries\n- O(1) best case with early exit\n- Consider indexing for large collections (future enhancement)\n\nOutput:\nReturns DiaryEntry if found, null otherwise.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:46:22.156714-05:00","updated_at":"2025-12-07T20:13:09.717523-05:00","closed_at":"2025-12-07T20:13:03.628487-05:00"}
{"id":"cass_memory_system-yyy","title":"[Types] DiaryEntry Schema - Structured Session Summary","description":"## Overview\nDefine DiaryEntry schema for structured session summaries - the Working Memory layer of the 3-layer memory system (Working Memory -\u003e Playbook -\u003e Long-term Sessions).\n\n## Purpose\nDiary entries compress raw cass sessions into structured, searchable summaries that:\n1. Enable fast semantic search across session history\n2. Provide context for playbook rule creation\n3. Support cross-session learning and pattern detection\n4. Serve as intermediate representation between raw logs and refined rules\n\n## Core Identity Fields\n\n### id: string\n- Format: 'diary-{hash}' (hash of sessionPath + timestamp)\n- Purpose: Unique identifier for diary entry\n- Example: 'diary-a3f8b2c1'\n\n### sessionPath: string\n- Purpose: Path to original cass session file\n- Required: Yes\n- Example: '/Users/dev/.cass/sessions/2025-12-07-auth-fix.jsonl'\n- Usage: Link back to full session details\n\n### timestamp: string\n- Purpose: When session occurred\n- Format: ISO 8601\n- Required: Yes\n- Example: '2025-12-07T14:30:00Z'\n- Usage: Chronological ordering, recency filtering\n\n## Context Fields\n\n### agent: string\n- Purpose: Which AI agent or tool conducted the session\n- Values: 'claude', 'codex', 'cursor', 'copilot', 'human', etc.\n- Required: Yes\n- Example: 'claude'\n- Usage: Agent-specific pattern analysis, multi-agent collaboration\n\n### workspace: string | undefined\n- Purpose: Repository/project where work occurred\n- Value: Absolute path to workspace root\n- Example: '/Users/dev/projects/auth-service'\n- Usage: Workspace-scoped rule creation, project context\n\n### duration: number | undefined\n- Purpose: Session length in seconds\n- Example: 1800 (30 minutes)\n- Usage: Productivity metrics, context weight\n\n### status: 'success' | 'failure' | 'mixed'\n- Purpose: Overall session outcome\n- Values:\n  - success: Completed task successfully\n  - failure: Task not completed or failed\n  - mixed: Partial success or mixed outcomes\n- Usage: Evidence weighting for validation\n\n## Structured Content (The Key Innovation)\n\n### accomplishments: string[]\n- Purpose: What was completed in this session\n- Examples: ['Implemented JWT token validation', 'Fixed authentication bypass bug', 'Added test coverage for auth flow']\n- Usage: Success pattern detection, context for helpful feedback\n\n### decisions: string[]\n- Purpose: Design/architecture choices made\n- Examples: ['Chose to centralize auth in TokenValidator service', 'Decided to use JWT over sessions for stateless auth', 'Selected Zod for schema validation']\n- Usage: Design pattern extraction, project convention creation\n\n### challenges: string[]\n- Purpose: Problems encountered and how they were solved\n- Examples: ['Struggled with circular dependency in auth module - resolved by extracting types', 'JWT library had breaking changes - migrated to jose v5']\n- Usage: Anti-pattern detection, pitfall documentation\n\n### preferences: string[]\n- Purpose: User style/preference revelations\n- Examples: ['Prefers async/await over Promise chains', 'Likes co-located tests', 'Uses Conventional Commits format']\n- Usage: Personalized workflow rule creation\n\n### keyLearnings: string[]\n- Purpose: Reusable insights and takeaways\n- Examples: ['Always validate JWT exp claim', 'Mock Router hooks cause flaky tests', 'Next.js middleware runs on edge runtime']\n- Usage: Direct rule extraction, playbook bullet candidates\n\n## Cross-Session Linking\n\n### relatedSessions: object[] | undefined\n- Purpose: Links to similar/related past sessions\n- Structure: [{ sessionPath: string, agent: string, relevanceScore: number, snippet: string }]\n- Example: [{ sessionPath: '/cass/2025-11-20-auth-refactor.jsonl', agent: 'claude', relevanceScore: 0.87, snippet: 'Refactored AuthService to use JWT tokens' }]\n- Usage: Cross-session pattern detection, evidence accumulation\n\n## Searchability Enhancement\n\n### tags: string[]\n- Purpose: Categorical labels for filtering\n- Examples: ['authentication', 'security', 'bug-fix', 'refactoring']\n- Usage: Faceted search, rule categorization\n\n### searchAnchors: string[]\n- Purpose: \"SEO for agents\" - optimized search terms\n- Content: Key phrases likely to be searched\n- Examples: ['JWT token validation', 'authentication bypass fix', 'TokenValidator service', 'Zod schema validation']\n- Usage: Improve recall in semantic search, make entries discoverable\n- Generation: Extracted from content + LLM enhancement\n\n## Complete Example\n\n{\n  id: 'diary-a3f8b2c1',\n  sessionPath: '/Users/dev/.cass/sessions/2025-12-07-auth-fix.jsonl',\n  timestamp: '2025-12-07T14:30:00Z',\n  agent: 'claude',\n  workspace: '/Users/dev/projects/auth-service',\n  duration: 1800,\n  status: 'success',\n  accomplishments: ['Fixed authentication bypass vulnerability', 'Implemented centralized JWT validation', 'Added comprehensive test coverage'],\n  decisions: ['Centralized all auth logic in TokenValidator service', 'Used jose library for JWT handling', 'Implemented token expiration checks'],\n  challenges: ['Circular dependency in auth module - resolved by extracting types file', 'Needed to update 15 call sites to use new TokenValidator'],\n  preferences: ['Prefers explicit token validation over implicit middleware'],\n  keyLearnings: ['Always validate JWT exp and iat claims', 'Centralized auth prevents bypass vulnerabilities', 'Type extraction breaks circular deps'],\n  relatedSessions: [{ sessionPath: '/cass/2025-11-20-auth-refactor.jsonl', agent: 'claude', relevanceScore: 0.87, snippet: 'Initial auth refactor discussion' }],\n  tags: ['authentication', 'security', 'bug-fix', 'jwt'],\n  searchAnchors: ['JWT token validation', 'authentication bypass fix', 'TokenValidator service', 'centralized auth pattern', 'token expiration validation']\n}\n\n## Integration with Playbook\n\nDiary entries are the RAW MATERIAL for playbook rules:\n1. Reflector analyzes diary entries to propose new rules\n2. Validation checks diary entries for supporting evidence\n3. Context enrichment pulls relevant diary snippets\n4. Cross-session patterns emerge from diary analysis\n\n## Storage and Indexing\n\n- Stored as individual YAML files in diary directory\n- File naming: {date}-{agent}-{hash}.yaml\n- Indexed by: timestamp, agent, workspace, tags\n- Searchable by: searchAnchors, content fields, semantic similarity\n\n## Acceptance Criteria\n- All core identity fields (id, sessionPath, timestamp)\n- Context fields (agent, workspace, duration, status)\n- Structured content arrays (accomplishments, decisions, challenges, preferences, keyLearnings)\n- relatedSessions linking structure\n- tags and searchAnchors arrays\n- Zod schema with validation\n- YAML serialization/deserialization\n- Examples showing all field types\n- JSDoc documentation","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:02.547524-05:00","updated_at":"2025-12-07T20:06:29.975406-05:00","closed_at":"2025-12-07T20:05:24.061476-05:00"}
{"id":"cass_memory_system-z7kw","title":"[Test] Helpers: Temp directory management","description":"Create test/helpers/temp.ts with:\n\n## Functions\n\n### createTempTestDir(testName: string): string\n- Creates unique temp directory: /tmp/cass-test-{testName}-{timestamp}/\n- Returns absolute path\n- Auto-registers for cleanup\n\n### cleanupTempTestDir(dir: string): void\n- Recursively removes directory\n- Safe (only removes dirs in /tmp/cass-test-*)\n- Logs cleanup in verbose mode\n\n### withTempDir\u003cT\u003e(testName: string, fn: (dir: string) =\u003e Promise\u003cT\u003e): Promise\u003cT\u003e\n- Higher-order helper that creates temp dir, runs fn, then cleans up\n- Handles errors gracefully (still cleans up)\n- Preferred pattern for tests\n\n## Example Usage\n\\`\\`\\`typescript\nimport { withTempDir } from \"./helpers/temp\";\n\nit(\"creates playbook file\", async () =\u003e {\n  await withTempDir(\"creates-playbook\", async (dir) =\u003e {\n    const playbookPath = path.join(dir, \"playbook.yaml\");\n    await savePlaybook(playbook, playbookPath);\n    expect(await fs.exists(playbookPath)).toBe(true);\n  });\n});\n\\`\\`\\`\n\n## Implementation Notes\n- Use crypto.randomUUID() for uniqueness\n- Use fs.rm with { recursive: true, force: true }\n- Add safety check to prevent deleting non-temp dirs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:22:43.322036-05:00","updated_at":"2025-12-07T21:13:03.934511-05:00","closed_at":"2025-12-07T21:12:33.857203-05:00"}
{"id":"cass_memory_system-z8y7","title":"[Unit Tests] scoring.ts - Confidence decay and effective scores","description":"## Unit Tests: scoring.ts - Confidence Decay and Effective Scores\n\n### Test Categories\n\n#### 1. calculateDecay()\n- Returns 1.0 at time zero\n- Exponential decay over time\n- Respects half-life parameter\n- Never drops below floor value\n\n#### 2. effectiveConfidence()\n- Combines base confidence with decay\n- Handles missing created_at timestamps\n- Uses current time as reference\n- Returns original if decay disabled\n\n#### 3. applyDecayToBullets()\n- Maps decay to array of bullets\n- Preserves other bullet properties\n- Adds effective_confidence field\n- Filters bullets below threshold\n\n#### 4. calculateMaturity()\n- New bullets start at 0\n- Increases with positive feedback\n- Decreases with negative feedback\n- Caps at 1.0 maximum\n- Has minimum floor\n\n#### 5. sortByEffectiveScore()\n- Primary sort by effective confidence desc\n- Secondary sort by maturity desc\n- Tertiary sort by created_at asc\n- Stable sort for equal scores\n\n#### 6. Half-Life Configurations\n- Default half-life (30 days)\n- Custom half-life from config\n- Very short half-life (rapid decay)\n- Very long half-life (slow decay)\n- Infinite half-life (no decay)\n\n### Test Data Requirements\n- Bullets with various created_at timestamps\n- Bullets with various base confidence scores\n- Config objects with different decay settings\n\n### Precision Testing\n- Floating point comparison with epsilon\n- Edge cases around decay thresholds","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T20:23:35.673912-05:00","updated_at":"2025-12-07T21:53:28.29937-05:00","closed_at":"2025-12-07T21:51:06.591471-05:00","dependencies":[{"issue_id":"cass_memory_system-z8y7","depends_on_id":"cass_memory_system-yj1z","type":"blocks","created_at":"2025-12-07T20:31:05.123149-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-z8y7","depends_on_id":"cass_memory_system-ep5y","type":"blocks","created_at":"2025-12-07T20:31:08.583992-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-zc1d","title":"Sub-Epic: Integration Tests (Real File I/O)","description":"# Sub-Epic: Integration Tests (Real File I/O)\n\n## Philosophy\nTest module interactions with REAL file system operations.\nUse temp directories for isolation, clean up after tests.\nNO mocking of file system - test actual behavior.\n\n## Test Infrastructure Required\n1. **Temp Directory Management**\n   - beforeAll: Create isolated temp dir\n   - afterAll: Clean up temp dir\n   - Helper: createTempConfig(), createTempPlaybook()\n\n2. **Fixture Data**\n   - test/fixtures/sessions/ - Sample session files (JSONL, JSON, MD)\n   - test/fixtures/playbooks/ - Sample playbook YAML files\n   - test/fixtures/diaries/ - Sample diary JSON files\n\n3. **Test Utilities**\n   - test/helpers/fs.ts - File system test helpers\n   - test/helpers/fixtures.ts - Fixture loading utilities\n   - test/helpers/assertions.ts - Custom assertions\n\n## Integration Test Areas\n\n### Area 1: Configuration System\n- config.ts: Load, save, merge (global + repo)\n- Path expansion (~/, ./, ../)\n- Default value handling\n- Schema validation on load\n\n### Area 2: File Locking\n- lock.ts: withLock() concurrent access\n- Lock timeout behavior\n- Lock release on error\n\n### Area 3: Processed Log Tracking\n- tracking.ts: ProcessedLog class\n- Atomic write verification\n- Malformed line resilience\n\n### Area 4: Cass Wrapper Integration\n- cass.ts: When cass binary available\n- Graceful degradation when unavailable\n- Error code handling\n\n### Area 5: Playbook File Operations\n- Load/save playbook YAML\n- Atomic write safety\n- Concurrent modification handling\n\n### Area 6: Diary File Operations\n- Generate diary → save to disk → reload\n- DiaryLoadError handling\n- Schema migration on load\n\n## Test Isolation\nEach test file gets its own temp directory.\nTests must not depend on global state.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-07T20:22:57.793123-05:00","updated_at":"2025-12-08T00:47:25.107092-05:00","closed_at":"2025-12-08T00:47:25.107092-05:00","dependencies":[{"issue_id":"cass_memory_system-zc1d","depends_on_id":"cass_memory_system-m7np","type":"blocks","created_at":"2025-12-07T20:23:08.502153-05:00","created_by":"daemon"},{"issue_id":"cass_memory_system-zc1d","depends_on_id":"cass_memory_system-mmxv","type":"blocks","created_at":"2025-12-07T20:23:08.74105-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-zex2","title":"[Critical] LLM Cost Controls - Budget Limits and Local-Only Mode","description":"# LLM Cost Controls\n\n## The Problem\nCurrent plan has LLM calls in: reflect, validate, curate, context, diary extraction.\nWith 10 sessions/day and all features enabled, that's 50+ LLM calls/day.\nAt ~$0.01-0.10 per call, that's $0.50-$5.00/day = $15-150/month.\n\n## The Solution\nMake LLM usage opt-in with clear cost visibility and hard limits.\n\n### Cost-Aware Configuration:\n```typescript\ninterface LLMConfig {\n  provider: \"anthropic\" | \"openai\" | \"ollama\" | \"none\";\n  budget: {\n    dailyLimit: number;  // Max $ per day, default: 0.10\n    monthlyLimit: number;  // Max $ per month, default: 2.00\n    warningThreshold: number;  // Warn at this %, default: 80\n  };\n}\n```\n\n### Local-Only Mode (Default):\n```bash\n# Default behavior - NO LLM CALLS\ncm context \"my task\"  # Uses keyword search, no embeddings\ncm reflect            # Extracts patterns with regex, no LLM\n\n# Opt-in to LLM\ncm reflect --llm      # Uses LLM for better extraction\ncm validate --llm     # Uses LLM for validation\n```\n\n### Cost Transparency:\n```bash\n$ cm reflect --llm\n\nReflecting on 3 sessions...\nExtracted 5 potential rules.\nCost: $0.03 (Daily: $0.08/$0.10, Monthly: $0.45/$2.00)\n\n$ cm usage\nToday:     $0.08 / $0.10 (80%) ⚠️\nThis month: $0.45 / $2.00 (22%)\nAll time:  $1.23\n```\n\n## Why This Is Critical\n- Users are cost-sensitive\n- Surprise bills = angry users = uninstalls\n- Local-first is privacy-friendly AND cost-friendly\n- LLM should enhance, not be required","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-07T17:08:16.006476-05:00","updated_at":"2025-12-08T13:53:45.582539-05:00","closed_at":"2025-12-08T13:53:45.582539-05:00","comments":[{"id":40,"issue_id":"cass_memory_system-zex2","author":"jemanuel","text":"## Problem: LLM Cost Explosion\n70+ LLM calls/day for active users = $5-20/day!\n\n## Solution: Multi-Layered Cost Controls\n1. Budget limits (daily/monthly USD caps)\n2. Cost tracking in stats\n3. Local-only mode (--local flag)\n4. Smart model selection (cheap for routine, expensive for validation)\n5. Batch operations to reduce calls\n\n## Acceptance Criteria\n- Daily/monthly budget limits enforced\n- Warning at 80% of budget\n- --local flag for zero-LLM mode\n- Cost displayed in stats command\n","created_at":"2025-12-07T23:15:50Z"}]}
{"id":"cass_memory_system-zgtb","title":"[Testing] Testing architecture and categories","description":"Test categories:\n- Unit tests: Individual functions, pure logic (bun test)\n- Integration tests: cass interaction, file I/O (bun test + fixtures)\n- LLM tests: Mocked LLM responses (bun test + mocks)\n- E2E tests: Full command workflows (shell scripts)\n- Property tests: Edge cases, fuzzing (fast-check)\n\nCoverage target: 80% line, 80% function, 70% branch","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-07T16:49:24.158242-05:00","updated_at":"2025-12-07T16:50:13.142277-05:00"}
{"id":"cass_memory_system-ziej","title":"[Impl] Simplify cm context Output for LLM Consumption","description":"# Simplify cm context Output for LLM Consumption\n\n## Purpose\nThe context command is THE most important command for agents. Its output must be optimized for LLM consumption:\n- Compact (fits in limited context budget)\n- Structured (easy to parse)\n- Actionable (rules have clear IDs for feedback)\n\n## Current Output Analysis\n\nCurrent `cm context` output includes:\n- Rules with scores\n- Anti-patterns\n- Historical session snippets\n- Suggested cass queries\n\n## Proposed Improvements\n\n### 1. Compact Mode (default for --json)\n- Only essential fields: id, content, category, score\n- No verbose metadata\n- No suggested queries (agent can figure this out)\n\n### 2. Size Control\n- Default to top 10 rules (was unlimited?)\n- Add `--compact` flag for even smaller output\n- Add `--verbose` for full metadata\n\n### 3. Better Structure\n```json\n{\n  \"task\": \"...\",\n  \"rules\": [\n    {\"id\": \"b-xyz\", \"content\": \"...\", \"score\": 8.5}\n  ],\n  \"antiPatterns\": [\n    {\"id\": \"b-abc\", \"content\": \"AVOID: ...\"}\n  ],\n  \"sessionCount\": 3,\n  \"note\": \"3 related sessions found. Run cm search for details.\"\n}\n```\n\n### 4. Remove Noise\n- No ASCII progress bars\n- No decorative elements\n- Minimal stderr output in --json mode\n\n## Implementation\n- Review contextCommand in src/commands/context.ts\n- Add compact output mode\n- Ensure consistent JSON structure\n- Add size limits with sensible defaults\n\n## Deliverables\n- [ ] Compact JSON output mode\n- [ ] Size control flags\n- [ ] Documentation of output schema\n- [ ] Tests for output format","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T12:47:11.675392-05:00","updated_at":"2025-12-08T13:20:09.481943-05:00","closed_at":"2025-12-08T13:20:09.481943-05:00","dependencies":[{"issue_id":"cass_memory_system-ziej","depends_on_id":"cass_memory_system-2bnu","type":"blocks","created_at":"2025-12-08T12:48:46.444461-05:00","created_by":"daemon"}]}
{"id":"cass_memory_system-zk7","title":"[Validator] validateDelta - Full validation pipeline","description":"Implement the validateDelta function - Full validation pipeline orchestrating pre-LLM gate and LLM validation.\n\nSIGNATURE:\n```typescript\nasync function validateDelta(\n  delta: PlaybookDelta,\n  config: Config\n): Promise\u003c{\n  valid: boolean;\n  reason: string;\n  evidence: string[];\n  suggestedState: \"draft\" | \"active\"\n}\u003e\n```\n\nVALIDATION FLOW:\n1. Check if validation should be skipped (non-add deltas, config disabled)\n2. Run shouldSkipValidation() heuristics\n3. Run evidenceCountGate() for pre-LLM filtering\n4. If gate fails, return invalid with reason\n5. If gate passes with overwhelming evidence (5+ success, 0 fail), skip LLM and return valid\n6. Otherwise, run runLLMValidation() for deeper analysis\n7. Return result with evidence citations and suggested state\n\nDECISION TREE:\n- Delta type != \"add\" → Pass through (valid: true)\n- evidenceCountGate().passed === false → Reject\n- successCount \u003e= 5 \u0026\u0026 failureCount === 0 → Accept without LLM\n- Otherwise → Run LLM validation\n\nRETURN VALUE:\n```typescript\n{\n  valid: boolean,              // Whether rule is valid\n  reason: string,              // Explanation of decision\n  evidence: string[],          // Citations from cass history\n  suggestedState: \"draft\" | \"active\"  // Recommended lifecycle state\n}\n```\n\nWHY THIS MATTERS:\n- Central orchestration point for validation logic\n- Optimizes costs by avoiding LLM when evidence is clear\n- Provides audit trail with evidence and reasoning\n- Ensures scientific rigor in rule acceptance\n\nDEPENDENCIES:\n- shouldSkipValidation() - Skip validation heuristics\n- evidenceCountGate() - Pre-LLM evidence filter\n- runLLMValidation() - Deep LLM-based validation\n- PlaybookDelta type\n\nLOCATION:\n- src/validator/validate-delta.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T16:44:52.189542-05:00","updated_at":"2025-12-07T20:53:50.977133-05:00","closed_at":"2025-12-07T20:53:11.227168-05:00"}
{"id":"cass_memory_system-zs4","title":"[Types] PlaybookBullet Schema Part 4 - Event-Level Feedback Tracking","description":"## Overview\nDefine event-level feedback tracking with timestamps for PlaybookBullet. This is the KEY INNOVATION enabling confidence decay - storing individual feedback events rather than simple counters.\n\n## Why Event-Level Tracking?\n\nTraditional Approach (Counters): { helpfulCount: 5, harmfulCount: 1 }\nProblem: No temporal information - can't tell if feedback is recent or ancient\n\nEvent-Level Approach (This System): { helpfulEvents: [{ timestamp: '2025-12-07T14:00:00Z', sessionPath: '/path/to/session1' }, { timestamp: '2025-12-06T10:00:00Z', sessionPath: '/path/to/session2' }], harmfulEvents: [{ timestamp: '2025-11-15T08:00:00Z', reason: 'outdated' }] }\nBenefit: Can calculate time-weighted confidence with decay\n\n## Fields\n\n### helpfulEvents: FeedbackEvent[]\n- Type: Array of FeedbackEvent objects\n- Purpose: Individual instances of helpful feedback\n- Each Event Contains: timestamp (when), sessionPath (which session), context (why helpful)\n- Usage: Calculate decayed helpful score / Identify trending rules (recent helpful events) / Analyze which sessions benefit from rule\n- Example: [{ timestamp: '2025-12-07T14:30:00Z', sessionPath: '/cass/2025-12-07-auth-fix.jsonl', context: 'Rule prevented authentication bypass' }, { timestamp: '2025-12-05T09:15:00Z', sessionPath: '/cass/2025-12-05-api-design.jsonl', context: 'Rule guided proper JWT validation' }]\n\n### harmfulEvents: FeedbackEvent[]\n- Type: Array of FeedbackEvent objects\n- Purpose: Individual instances of harmful feedback\n- Each Event Contains: timestamp (when), sessionPath (which session), reason (why harmful - HarmfulReason enum), context (explanation)\n- Usage: Calculate decayed harmful score / Detect deteriorating rules (recent harmful events) / Analyze failure patterns / Inform auto-pruning decisions\n- Example: [{ timestamp: '2025-11-20T11:00:00Z', sessionPath: '/cass/2025-11-20-refactor.jsonl', reason: 'outdated', context: 'AuthService was refactored to AuthManager' }]\n\n### helpfulCount: number\n- Type: Derived/aggregate field\n- Purpose: Quick access to total helpful feedback\n- Calculation: helpfulEvents.length\n- Usage: Display, quick filtering, promotion thresholds\n- NOT used for: Confidence scoring (use events instead)\n\n### harmfulCount: number\n- Type: Derived/aggregate field\n- Purpose: Quick access to total harmful feedback\n- Calculation: harmfulEvents.length\n- Usage: Display, pruning thresholds\n- NOT used for: Confidence scoring (use events instead)\n\n## Additional Tracking Fields\n\n### lastValidatedAt: string | undefined\n- Purpose: When rule was last scientifically validated by cass\n- Format: ISO 8601 timestamp\n- Usage: Determine if rule needs revalidation / Calculate staleness (days since validation) / Trigger periodic revalidation\n- Example: '2025-11-01T10:00:00Z'\n- Update Trigger: After running 'cass memory validate \u003cbulletId\u003e'\n\n### confidenceDecayHalfLifeDays: number\n- Purpose: Per-bullet customizable decay rate\n- Default: Inherited from config.defaultDecayHalfLife (90 days)\n- Range: 1-365 days\n- Usage: Calculate decay factor λ = ln(2) / halfLifeDays\n- Customization: 30 days (fast-moving tech), 90 days (default), 180 days (stable patterns), 365 days (timeless principles)\n\n## Confidence Decay Algorithm\n\nEffective Helpful Score:\nfunction calculateEffectiveHelpful(bullet) {\n  const now = Date.now()\n  const lambda = Math.ln(2) / bullet.confidenceDecayHalfLifeDays\n  return bullet.helpfulEvents.reduce((sum, event) =\u003e {\n    const ageInDays = (now - new Date(event.timestamp).getTime()) / (1000 * 60 * 60 * 24)\n    const decayFactor = Math.exp(-lambda * ageInDays)\n    return sum + decayFactor  // Each event worth 1.0 when fresh, decays over time\n  }, 0)\n}\n\nEffective Harmful Score: Same algorithm applied to harmfulEvents\n\nNet Confidence Score:\nfunction calculateConfidence(bullet) {\n  const effectiveHelpful = calculateEffectiveHelpful(bullet)\n  const effectiveHarmful = calculateEffectiveHarmful(bullet)\n  return effectiveHelpful - (effectiveHarmful * 2)  // Harmful has 2x weight\n}\n\n## Example Scenarios\n\nRecent Activity (High Confidence): helpfulEvents from today/yesterday/2 days ago, harmfulEvents empty -\u003e Effective score ≈ 2.95 (minimal decay)\n\nOld Activity (Low Confidence): helpfulEvents from 6-8 months ago, harmfulEvents empty -\u003e Effective score ≈ 0.15 (heavy decay at 90-day half-life)\n\nMixed Recent Feedback (Medium Confidence): 2 helpful from 1-2 weeks ago, 1 harmful from 10 days ago -\u003e Effective score ≈ -2.0 (negative, consider deprecation)\n\n## Integration Points\n\nCommands Using This Data:\n- context: Rank bullets by effective confidence score\n- stats: Show effective scores, not just counts\n- validate: Update lastValidatedAt timestamp\n- helpful/harmful: Append to appropriate events array\n- audit: Detect rules with declining confidence\n- prune: Remove rules with low effective score\n\nDisplay Formats:\n- Show effective score alongside counts\n- Visualize decay curve in stats\n- Highlight recently active rules\n- Flag stale rules (old lastValidatedAt)\n\n## Acceptance Criteria\n- helpfulEvents array field (FeedbackEvent[])\n- harmfulEvents array field (FeedbackEvent[])\n- helpfulCount derived field\n- harmfulCount derived field\n- lastValidatedAt optional timestamp\n- confidenceDecayHalfLifeDays number field with default\n- Decay calculation functions implemented\n- Event appending utility functions\n- Examples for all scenarios\n- JSDoc explaining decay algorithm","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T16:45:00.589588-05:00","updated_at":"2025-12-07T20:04:56.123862-05:00","closed_at":"2025-12-07T20:04:15.540628-05:00"}
{"id":"cass_memory_system-zs47","title":"[CLI:playbook] list - List all bullets","description":"List playbook bullets with optional filters.\n\nCommand signature:\n```bash\ncass-memory playbook list [options]\n\nOptions:\n  --all              Include deprecated bullets\n  --category CAT     Filter by category\n  --scope SCOPE      Filter by scope (global/workspace)\n  --json             Output as JSON\n```\n\nImplementation:\n1. Load playbook from memory directory\n2. Apply filters:\n   - By default: only active bullets (exclude deprecated)\n   - If --all: include deprecated\n   - If --category: filter by category\n   - If --scope: filter by global or workspace-scoped\n   \n3. Format output:\n   - Default: table format\n   - If --json: array of bullet objects\n\nTable format:\n```\nID          CATEGORY        MATURITY    SCORE   CONTENT\nb-abc123    best-practice   proven      0.95    Always run tests before committing\nb-def456    tools           accepted    0.78    Use httpx instead of requests\nb-ghi789    workflow        candidate   0.45    Prefer async/await over callbacks\n...\n\nTotal: 42 bullets (3 proven, 15 accepted, 24 candidates)\n```\n\nSorting:\n- Default: by score (descending)\n- Can add --sort option later (by category, maturity, created, etc)\n\nColumn widths:\n- ID: 12 chars\n- Category: 20 chars\n- Maturity: 12 chars\n- Score: 8 chars\n- Content: remaining width (truncate with ellipsis if needed)\n\nThis provides quick overview of playbook state.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T16:51:45.453109-05:00","updated_at":"2025-12-07T21:13:40.093915-05:00","closed_at":"2025-12-07T21:13:37.061982-05:00"}
{"id":"cass_memory_system-zvr1","title":"[Critical] Rename toxic to blocked - Better Terminology","description":"$(cat /tmp/fix_zvr1.txt)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T17:14:06.323937-05:00","updated_at":"2025-12-08T00:46:34.353451-05:00","closed_at":"2025-12-08T00:46:34.353451-05:00"}
